// Generated by CoffeeScript 1.7.1
define(['external/react', 'jquery', 'modules/clean/image_size', 'modules/clean/video_util', 'modules/core/i18n', 'modules/core/uri'], function(React, $j, _arg, VideoUtil, i18n, URI) {
  var PreviewVideo, d, image_best_fit_size, _;
  image_best_fit_size = _arg.image_best_fit_size;
  d = React.DOM;
  _ = i18n._;
  PreviewVideo = React.createClass({
    displayName: "PreviewVideo",
    propTypes: {
      "preview-url": React.PropTypes.string,
      "thumbnail-url-tmpl": React.PropTypes.string,
      onLoad: React.PropTypes.func
    },
    componentDidMount: function() {
      var $videoContainer, $videoPlayer;
      $videoContainer = $j(this.refs.previewVideoContainer.getDOMNode());
      $videoPlayer = $j(this.refs.previewVideoPlayer.getDOMNode());
      return this._player = VideoUtil.embed($videoPlayer, {
        src: this.props["preview-url"],
        type: Constants.transcoder_hls4web ? 'application/vnd.apple.mpegurl' : 'video/flv',
        width: $videoContainer.width(),
        height: $videoContainer.height(),
        controls: true,
        preload: 'auto',
        poster: this._getSizedImageUrl(),
        onReady: this.props.onLoad
      });
    },
    componentWillUnmount: function() {
      var e, _ref;
      if (this._player != null) {
        try {
          this._player.trigger("shutdown");
          if (this._player.techName === "Hls") {
            if ((_ref = this._player.tech.sourceBuffer) != null) {
              _ref.abort();
            }
          }
          this._player.dispose();
        } catch (_error) {
          e = _error;
        }
        return this._player = null;
      }
    },
    _getSizedImageUrl: function() {
      return URI.parse(this.props["thumbnail-url-tmpl"]).updateQuery({
        size: image_best_fit_size($j(window).width(), $j(window).height()),
        size_mode: 2
      }).toString();
    },
    render: function() {
      return d.div({
        ref: "previewVideoContainer",
        className: "preview-image-container"
      }, d.div({
        className: "preview-image-wrapper"
      }, d.div({
        ref: "previewVideoPlayer",
        className: "video-player"
      })));
    }
  });
  return {
    PreviewVideo: PreviewVideo
  };
});

//# sourceMappingURL=preview_video.map
