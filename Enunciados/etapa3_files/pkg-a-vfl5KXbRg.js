define("modules/clean/account/change_email_modals",["jquery","external/react","modules/core/notify","modules/core/i18n","modules/clean/form","modules/clean/account/email_verify","modules/clean/react/bubble_dropdown","modules/clean/react/input","modules/clean/react/modal","modules/clean/react/sprite","modules/clean/viewer","modules/clean/ajax"],function(e,t,n,o,i,r,s,a,c,u,l,_){var d,p,h,f,m,g,v,y,b,w;return w=o._,y=o.render_sentences,b=o.ungettext,g=c.Modal,v=t.DOM,m=t.createClass({propTypes:{user:t.PropTypes.object,inboxCount:t.PropTypes.number,onContinue:t.PropTypes.func},render:function(){return g({title:w("Warning!"),acceptButtonText:w("Continue anyway"),dismissButtonText:w("Cancel"),onAccept:this.showChange,ref:"modal"},this.getSSOWarning(),this.getInboxWarning())},getSSOWarning:function(){var e,t,n;return e=l.get_viewer().is_paired,n=e&&this.props.user.role===Constants.ROLE_WORK,t=this.props.user.sso_required,n&&t?v.div({},w("Your %(team)s Dropbox uses single sign-on. If you change your email address you may not be able to sign in.").format({team:l.get_viewer().team_name})):null},getInboxWarning:function(){var e;return e=l.get_viewer().is_paired,0===this.props.inboxCount?null:e&&this.props.user.role===Constants.ROLE_PERSONAL?b("Your %(num)d existing shared folder invitation in your personal Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your personal Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount}):e&&this.props.user.role===Constants.ROLE_WORK?b("Your %(num)d existing shared folder invitation in your %(team)s Dropbox will be removed if you change your email address.","Your %(num)d existing shared folder invitations in your %(team)s Dropbox will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount,team:l.get_viewer().team_name}):b("Your %(num)d existing shared folder invitation will be removed if you change your email address.","Your %(num)d existing shared folder invitations will be removed if you change your email address.",this.props.inboxCount).format({num:this.props.inboxCount})},showChange:function(e){var t,n;return e.preventDefault(),t=this.refs.modal,t.close(),"function"==typeof(n=this.props).onContinue?n.onContinue():void 0}}),p=t.createClass({propTypes:{user:t.PropTypes.object,onChange:t.PropTypes.func,onVerificationCheck:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return g({title:w("Update '%(email)s'").format({email:this.props.user.email}),className:"change-email-modal",acceptButtonText:w("Update email"),dismissButtonText:w("Cancel"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},v.form({action:"/account/change_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},v.div({},this.getPrompt()),v.div({className:"change-email-inputs"},a.text({name:"email",label:w("New email"),error:this.state.errors.email,autoComplete:"off"}),a.text({name:"confirm_email",label:w("Confirm email"),error:this.state.errors.confirm_email,autoComplete:"off"}),a.password({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),v.input({type:"hidden",name:Constants.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(){var t;return this.setState({submitting:!0,errors:{}}),t=e(this.refs.form.getDOMNode()),i.submit(t,this._success,this._error,this._complete)},_success:function(t){var n,o,i,r,s,a;return i=this.refs.modal,o=this.refs.form,n=e(o.getDOMNode()).find('input[name="email"]').val(),r="NEEDS_VERIFICATION"===t,i.close(),r?"function"==typeof(s=this.props).onVerificationCheck?s.onVerificationCheck(n):void 0:"function"==typeof(a=this.props).onChange?a.onChange(n):void 0},_error:function(e){return"string"==typeof e?n.error(e):e?this.setState({errors:e}):n.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=l.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===Constants.ROLE_PERSONAL?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===Constants.ROLE_WORK?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:l.get_viewer().team_name})),n&&t.push(w("You’ll need to verify your new email address in order to finish updating your %(team)s email.").format({team:l.get_viewer().team_name}))):n&&t.push(w("You’ll need to verify your new email address in order to finish updating your email.")),t.length?y(t):""}}),h=t.createClass({propTypes:{name:t.PropTypes.string.isRequired,type:t.PropTypes.string.isRequired,address:t.PropTypes.string,verified:t.PropTypes.bool,doChangeAddress:t.PropTypes.func,doMakePrimary:t.PropTypes.func,doCreateAlias:t.PropTypes.func,doDeleteAlias:t.PropTypes.func},render:function(){var e;return e=this.props.verified?"address verified":"address pending",v.div({className:"email-row bs-row clearfix clear","data-type":this.props.type},v.span({className:"type"},this.props.name),null!=this.props.address?v.span({className:e},this.props.address):void 0,null!=this.props.address?s({target:u({group:"web",name:"gear"}),arrow_position:"top-right"},v.div({className:"list-menu"},this.props.verified?void 0:v.div({className:"list-item",onClick:function(e){return function(){return r.send_verification_email(e.props.user,e.props.email,"generic",function(){return n.success(w("Verification email sent to %(email)s").format({email:e.props.address}))})}}(this)},w("Resend verification")),"primary"===this.props.type?v.div({className:"list-item",onClick:this.props.doChangeAddress},w("Change email address")):(v.div({className:"list-item",onClick:this.props.doMakePrimary},w("Make primary")),v.div({className:"list-item",onClick:function(e){return function(){return e.props.doDeleteAlias(e.props.address)}}(this)},w("Delete email"))))):v.a({className:"address prompt",onClick:this.props.doCreateAlias},"Add "+this.props.name.toLowerCase()+" email"))}}),d=t.createClass({propTypes:{user:t.PropTypes.object,onSuccess:t.PropTypes.func},getInitialState:function(){return{submitting:!1,errors:{}}},render:function(){return g({title:w("Add recovery email"),className:"change-email-modal",acceptButtonText:w("Add recovery email"),onAccept:this.handleSubmit,submitting:this.state.submitting,ref:"modal"},v.form({action:"/account/alias/add/recovery_email",className:"change-email-form",onSubmit:this.handleSubmit,onKeyDown:this.handleKey,ref:"form"},v.div({},w("If you request a password reset, we’ll send a link to both your primary and recovery emails.")),v.div({className:"change-email-inputs"},a.text({name:"email_alias",label:w("New email"),error:this.state.errors.email_alias,autoComplete:"off",onChange:function(e){return function(t){return e.newAddress=t.target.value}}(this)}),a.password({name:"password",label:w("Dropbox password"),error:this.state.errors.password,autoComplete:"off"}),v.input({type:"hidden",name:Constants.UID_PARAM_NAME,value:this.props.user.id}))))},handleKey:function(e){var t;return 13===e.keyCode&&"INPUT"===(null!=(t=e.target)?t.tagName:void 0)?this.handleSubmit(e):void 0},handleSubmit:function(e){return e.preventDefault(),this.state.submitting?void 0:this.submit()},submit:function(){var t;return this.setState({submitting:!0,errors:{}}),t=e(this.refs.form.getDOMNode()),i.submit(t,this._success,this._error,this._complete)},_success:function(e){var t,o,i,r;return i=this.refs.modal,o=this.refs.form,t=this.newAddress,r="ok:NEEDS_VERIFICATION"===e,r&&n.success(w("Please check your email to verify your recovery email.")),i.close(),this.props.onSuccess(t,!r)},_error:function(e){return"string"==typeof e?n.error(e):e?this.setState({errors:e}):n.error()},_complete:function(){return this.isMounted()?this.setState({submitting:!1}):void 0},getPrompt:function(){var e,t,n;return e=l.get_viewer().is_paired,n=this.props.user.email_verified,t=[],e&&this.props.user.role===Constants.ROLE_PERSONAL?(t.push(w("Enter a new email address for your personal Dropbox.")),n&&t.push(w("You'll need to verify your new email address in order to finish updating your personal email."))):e&&this.props.user.role===Constants.ROLE_WORK?(t.push(w("Enter a new email address for your %(team)s Dropbox.").format({team:l.get_viewer().team_name})),n&&t.push(w("You'll need to verify your new email address in order to finish updating your %(team)s email.").format({team:l.get_viewer().team_name}))):n&&t.push(w("You'll need to verify your new email address in order to finish updating your email.")),t.length?y(t):""}}),f=t.createClass({propTypes:{initialAliases:t.PropTypes.array,user:t.PropTypes.object,onAliasChange:t.PropTypes.func,startChangePrimaryFlow:t.PropTypes.func},getInitialState:function(){return{aliases:this.props.initialAliases}},deleteAlias:function(e){return new _.WebRequest({url:"/account/alias/remove",type:"POST",subject_user:this.props.user,data:{alias_type:"recovery_email",alias:e},success:function(t){return function(){var n,o,i;i=t.state.aliases.slice();for(o in i)if(n=i[o],n.alias===e){i.splice(o,1);break}return t.setState({aliases:i}),t.props.onAliasChange(i)}}(this)})},createAlias:function(){return g.showInstance(new d({user:this.props.user,onSuccess:function(e){return function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.props.onAliasChange(o)}}(this)}))},render:function(){var e;return g({title:w("Change %(role)s emails").format({role:"personal"}),className:"change-email-options-modal",acceptButtonText:w("Close"),ref:"modal"},v.div({className:"email-list-container"},h({user:this.props.user,name:w("Primary",{comment:"Primary email address"}),type:"primary",address:this.props.user.email,verified:this.props.user.is_email_verified,doChangeAddress:function(e){return function(){return e.props.startChangePrimaryFlow()}}(this)}),function(){var t,n,o,i;for(o=this.state.aliases,i=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&i.push(h({user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",address:e.alias,verified:e.verified,doDeleteAlias:this.deleteAlias}));return i}.call(this),0===this.state.aliases.length?h({user:this.props.user,name:w("Recovery",{comment:"Recovery email address; 'backup'"}),type:"recovery",doCreateAlias:this.createAlias}):void 0))}}),{ChangeEmailWarningModal:m,ChangeEmailModal:p,ChangeEmailOptionsModal:f,AddRecoveryEmailModal:d}}),define("modules/clean/account/email",["jquery","external/react","modules/core/browser","modules/core/notify","modules/core/i18n","modules/core/uri","modules/clean/account/change_email_modals","modules/clean/account/email_verify","modules/clean/account/verify_email_modals","modules/clean/react/modal","modules/clean/react/react_i18n","modules/clean/viewer"],function(e,t,n,o,i,r,s,a,c,u,l,_){var d,p,h,f,m,g,v,y,b,w,E,T,S,C,x;return x=i._,f=s.ChangeEmailModal,m=s.ChangeEmailOptionsModal,g=s.ChangeEmailWarningModal,p=s.AddRecoveryEmailModal,T=c.VerifyEmailModal,E=c.ResendVerifyEmailModal,S=c.VerifyEmailSentModal,b=c.EmailVerifiedModal,v=c.ChangedEmailVerifiedModal,w=u.Modal,y=function(){function e(e){var t;this.role=e,this.user=this.role?_.get_viewer().get_user_by_role(this.role,!0):_.get_viewer().deprecated_first_user_in_the_cookie,this.email_to_verify=null!=(t=this.user)?t.email:void 0,this.verify_for_change=!1}return e.prototype.polling=!1,e.prototype.show_resend=!1,e.getForRole=function(t){return this.initalized||(this.legacy=new e(null),this.personal=new e("personal"),this.work=new e("work"),this.initalized=!0),"personal"===t?this.personal:"work"===t?this.work:this.legacy},e.get_for_user=function(e){return this.getForRole(e.role)},e.reset=function(){return this.initalized=!1},e.prototype.set_email_to_verify=function(e){return this.email_to_verify=e,this.verify_for_change=this.email_to_verify!==this.user.email},e.prototype.send_email=function(e,t){return a.send_verification_email(this.user,this.email_to_verify,e,t)},e.prototype.flash_email_sent_notification=function(){return o.success(x("Verification email sent to %(email)s").format({email:this.email_to_verify}))},e.prototype.ensure_polling=function(e){return a.listen_for_verification(this.user,this.email_to_verify,function(t){return function(){return null!=e?(t.user.is_email_verified=!0,e()):n.reload()}}(this))},e.prototype.email_sent=function(e){return this.show_resend=!0,this.show(),this.flash_email_sent_notification(),this.ensure_polling(e)},e.prototype.show=function(e,t){return this.show_resend?this.show_resend_verify_modal(t):this.show_verify_modal(e,t)},e.prototype.show_verify_modal=function(t,n){return null==n&&(n=this.verify_for_change?"change_email":e.REASON),w.showInstance(new T({user:this.user,reason:n,email:this.email_to_verify,onShowChange:function(e){return function(){return h.show(e.user)}}(this),onEmailSent:function(n){return function(){var o;return o=e.get_for_user(n.user),o.email_sent(t)}}(this)}))},e.prototype.show_resend_verify_modal=function(t){return null==t&&(t=this.verify_for_change?"change_email":e.REASON),w.showInstance(new E({user:this.user,email:this.email_to_verify,reason:t,onShowChange:function(e){return function(){return h.show(e.user)}}(this),onEmailSent:function(t){return function(){var n;return n=e.get_for_user(t.user),n.email_sent()}}(this)}))},e.prototype.verified_or_show=function(e){return this.user.is_email_verified?!0:(this.show(null,e),!1)},e.prototype.show_sent_modal=function(){return w.showInstance(new S({email:this.email_to_verify}))},e.prototype.show_verified_modal=function(){return w.showInstance(new b({reason:e.REASON,email:this.email_to_verify}))},e.prototype.show_verified_and_changed_modal=function(){return w.showInstance(new v({user:this.user,email:this.email_to_verify}))},e}(),h={inbox_counts:{},set_inbox_counts:function(t){return e.extend(this.inbox_counts,t)},show_options:function(e){var t,n,o,i;return i=e.user_id,t=e.aliases,n=e.on_alias_change,o=_.get_viewer().get_user_by_id(i),o.role===Constants.ROLE_WORK?h.show(i):w.showInstance(new m({user:o,initialAliases:t,onAliasChange:n,startChangePrimaryFlow:function(){return function(){return h.show(i)}}(this)}))},show:function(e){var t;return t=_.get_viewer().get_user_by_id(e),this._should_show_warning(t)?this._show_warning_modal(t):this._show_change_modal(t)},_should_show_warning:function(e){var t,n,o,i;return n=_.get_viewer().is_paired,i=n&&e.role===Constants.ROLE_WORK,o=i&&e.sso_required,t=this.inbox_counts[e.id]>0,o||t},_show_change_modal:function(){return function(e){return w.showInstance(new f({user:e,onChange:function(t){return h.trigger_change(e,t),"/account"!==r.parse(n.get_href()).path?n.redirect("/home?send_verification_email=1"):t!==e.email?n.reload():void 0},onVerificationCheck:function(t){var n;return h.trigger_change(e,t,!0),n=y.get_for_user(e),n.set_email_to_verify(t),n.email_sent()}}))}}(this),_show_warning_modal:function(e){return w.showInstance(new g({user:e,inboxCount:this.inbox_counts[e.id],onContinue:function(t){return function(){return t._show_change_modal(e)}}(this)}))},listen_for_change:function(t,n){var o;return o=this._email_change_event_for_user(t),e(document).on(o,n)},trigger_change:function(t,n,o){var i;return i=this._email_change_event_for_user(t),e(document).trigger(i,[n,o])},_email_change_event_for_user:function(e){return"db:email_changed:"+e.id}},INLINE_JS.ChangeEmail=h,C=t.DOM,d=t.createClass({propTypes:{userId:t.PropTypes.number,emailName:t.PropTypes.string,initialPendingEmail:t.PropTypes.string,initialAliases:t.PropTypes.array,showRecoveryEmailsGui:t.PropTypes.bool,showAliasGui:t.PropTypes.bool,showChangeEmail:t.PropTypes.bool},getInitialState:function(){return{pendingEmail:this.props.initialPendingEmail,aliases:void 0!==this.props.initialAliases?this.props.initialAliases:[]}},pendingVerifyLinkClick:function(e){return e.preventDefault(),y.get_for_user(this.user).show(),!1},pendingVerifyCancelClick:function(t){return t.preventDefault(),e.ajax("/cancelpendingemailchange",{type:"POST",success:function(e){return function(){return e.setState({pendingEmail:void 0})}}(this),subject_user:this.user.id}),!1},onAliasChange:function(e){return this.setState({aliases:e})},onUserAddressChange:function(e,t,n){return n?this.setState({pendingEmail:t}):this.forceUpdate()},componentDidMount:function(){return h.listen_for_change(this.user,this.onUserAddressChange)},render:function(){var e;return this.user=_.get_viewer().get_user_by_id(this.props.userId),C.div({className:"fieldset user-info"},C.div({},C.h3({},this.props.emailName,this.props.showRecoveryEmailsGui&&this.props.showChangeEmail&&this.user.is_email_verified?C.a({href:"#",className:"inline-change",onClick:function(e){return function(t){return t.preventDefault(),h.show_options({user_id:e.props.userId,aliases:e.state.aliases,on_alias_change:e.onAliasChange}),!1}}(this)},x("Change",{comment:"Change the user's contact methods (primary email, recovery email, maybe phone?)"})):void 0),this.props.showRecoveryEmailsGui?C.h4({className:"email-type-header"},x("Primary",{comment:"Primary email address"})):void 0,C.div({},this.user.email),this.user.is_email_verified?this.props.showChangeEmail?this.props.showRecoveryEmailsGui?void 0:C.a({href:"#",onClick:function(e){return function(t){return t.preventDefault(),h.show(e.props.userId,e.state.aliases),!1}}(this)},x("Change email")):C.a({href:"/account#work"},x("Contact your team admin to change email")):C.div({},C.a({href:"#",onClick:function(e){return function(t){return t.preventDefault(),"work"===e.user.role?y.getForRole(Constants.ROLE_WORK).verified_or_show():y.getForRole(Constants.ROLE_PERSONAL).verified_or_show(),!1}}(this)},x("Verify email"))),this.props.showAliasGui&&"work"!==this.user.role?C.div({},C.a({href:"#",onClick:function(e){return e.preventDefault(),!1}},x("Other ways to contact you"))):void 0),this.state.pendingEmail?C.div({className:"pending-unverified-email-container"},C.br({}),C.div({}),"work"===this.user.role?C.h3({},x("Pending %(team_name)s email change").format({team_name:_.get_viewer().team_name})):"personal"===this.user.role?C.h3({},x("Pending personal email change")):C.h3({},x("Pending email change")),C.div({className:"pending-unverified-email"},this.state.pendingEmail),C.div({},C.a({href:"#",onClick:this.pendingVerifyLinkClick},x("Verify email"))),C.div({}),C.a({href:"#",onClick:this.pendingVerifyCancelClick},x("Cancel"))):void 0,this.props.showRecoveryEmailsGui&&"work"!==this.user.role&&this.user.is_email_verified?C.div({},C.br({}),C.h4({className:"email-type-header"},x("Recovery",{comment:"Recovery email address; 'backup email'"})),function(){var t,n,o,i;if(0!==this.state.aliases.length){for(o=this.state.aliases,i=[],t=0,n=o.length;n>t;t++)e=o[t],"recovery_email"===e.type&&i.push(C.div({},C.span({},e.alias),e.verified?void 0:C.span({},x(" (pending)"))));return i}return C.a({href:"#",onClick:function(e){return function(t){return t.preventDefault(),w.showInstance(new p({user:e.user,onSuccess:function(t,n){var o;return o=e.state.aliases.slice(),o.push({alias:t,type:"recovery_email",verified:n}),e.setState({aliases:o})}})),!1}}(this)},x("Add a recovery email"))}.call(this)):void 0)}}),{EmailVerification:y,ChangeEmail:h,AccountPageEmailBlock:d}}),define("modules/clean/account/email_verify",["jquery","modules/clean/ajax"],function(e,t){var n;return n={_POLLING:{},send_verification_email:function(e,n,o,i){return t.WebRequest({url:"/sendverifyemail",data:{email:n,reason:o},success:function(){return i()},subject_user:e})},check_verification:function(e,n,o,i){return t.AuthenticatedRequest({url:"/isemailverified",data:{email:n},success:function(e){return"ok"===e?o():i()},subject_user:e})},listen_for_verification:function(e,t,n){var o;return o=""+e.id+":"+t,this._POLLING[o]?void 0:(this._POLLING[o]=!0,this._poll_for_verification(e,t,n))},_poll_for_verification:function(e,t,n){var o;return o=4e3,this.check_verification(e,t,n,function(i){return function(){return setTimeout(function(){return i._poll_for_verification(e,t,n)},o)}}(this))}}}),define("modules/clean/account/email_verify_reasons",[],function(){var e;return e={SHARE_FOLDER:"share_folder",CREATE_API_APP:"create_api_app",PUBLIC_FOLDER:"public_folder",GENERIC:"generic",SHMODAL:"shmodal",MOBILE_SHARE_FOLDER:"mobile_share_folder",EMAIL_ALIAS:"email_alias",CAROUSEL:"carousel",CHANGE_EMAIL:"change_email",CAROUSEL_EMAIL_ALIAS:"carousel_email_alias",PROMPT_CAMPAIGN:"prompt_campaign",ADD_COMMENT:"add_comment",SUBSCRIBE_TO_COMMENTS:"subscribe_to_comments",CREATE_FILE_COLLECTOR:"create_file_collector"}}),define("modules/clean/account/verify_email_modals",["external/react","modules/core/i18n","modules/clean/account/email_verify","modules/clean/account/email_verify_reasons","modules/clean/analytics","modules/clean/react/button","modules/clean/react/modal","modules/clean/viewer","modules/clean/react/react_i18n"],function(e,t,n,o,i,r,s,a,c){var u,l,_,d,p,h,f,m,g,v;return v=t._,h=i.UserActivityLogger,_=s.Modal,g=e.DOM,d=c.R_,f=e.createClass({propTypes:{user:e.PropTypes.object,reason:e.PropTypes.string,email:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func},render:function(){var e;return e={reason:this.props.reason},h.log("web","email_verify_shown",e),_({title:v("Verify your email address"),className:"verify-email",acceptButtonText:v("Send email"),dismissButtonText:v("Cancel"),onAccept:this.sendEmail,ref:"modal"},g.div({},g.div({},this.getPrompt()),g.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},v("Update email address"))))},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},close:function(){return this.refs.modal.close()},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},showChangeEmail:function(e){var t,n;return t={reason:this.props.reason},h.log("web","email_verify_change_first",t),e.preventDefault(),this.close(),"function"==typeof(n=this.props).onShowChange?n.onShowChange():void 0},getPrompt:function(){var e;switch(this.props.reason){case o.ADD_COMMENT:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can add comments. It's as simple as clicking the link in the verification email we send to you.");case o.SUBSCRIBE_TO_COMMENTS:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can subscribe. It's as simple as clicking the link in the verification email we send to you.");case o.SHARE_FOLDER:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share folders. It's as simple as clicking the link in the verification email we send to you.");case o.SHMODAL:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to share links. It's as simple as clicking the link in the verification email we send to you.");case o.CREATE_API_APP:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> before you can register an API app. It's as simple as clicking the link in the verification email we send to you.");case o.PUBLIC_FOLDER:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to enable your Public folder. It's as simple as clicking the link in the verification email we send to you.");case o.CHANGE_EMAIL:return e=a.get_viewer().is_paired,e&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your personal email. It's as simple as clicking the link in the verification email we send to you."):e&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your %(team)s email. It's as simple as clicking the link in the verification email we send to you."):d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to finish updating your email. It's as simple as clicking the link in the verification email we send to you.");case o.CREATE_FILE_COLLECTOR:return d({email:this.props.email},"Dropbox needs to verify your email address <strong>%(email)s</strong> to create file requests. It’s as simple as clicking the link in the verification email we send to you.");default:return d({email:this.props.email},"Verify your email address at <strong>%(email)s</strong> to share folders and ensure your account can be recovered.")}}}),p=e.createClass({propTypes:{user:e.PropTypes.object,email:e.PropTypes.string,reason:e.PropTypes.string,onEmailSent:e.PropTypes.func,onShowChange:e.PropTypes.func},render:function(){var e;return e={reason:this.props.reason},h.log("web","email_verify_resend_shown",e),_({title:v("Verify your email address"),buttonComponent:this.renderButtons(),ref:"modal"},g.div({},g.div({},this.getPrompt()),g.a({href:"#",className:"change-email-before-verify",onClick:this.showChangeEmail},v("Update email address"))))},renderButtons:function(){return g.div({className:"db-modal-buttons"},r.link_button({className:"dbmodal-button",importance:"primary",onClick:this.close},v("Done")),r.link_button({className:"dbmodal-button",importance:"tertiary",onClick:this.sendEmail},v("Resend email")))},close:function(){return this.refs.modal.close()},showChangeEmail:function(e){var t,n;return t={reason:this.props.reason},h.log("web","email_verify_resend_change_first",t),e.preventDefault(),this.close(),"function"==typeof(n=this.props).onShowChange?n.onShowChange():void 0},sendEmail:function(e){return e.preventDefault(),n.send_verification_email(this.props.user,this.props.email,this.props.reason,this.emailSent)},emailSent:function(){var e;return this.close(),"function"==typeof(e=this.props).onEmailSent?e.onEmailSent():void 0},getPrompt:function(){var e;return e=a.get_viewer().is_paired,this.props.reason!==o.CHANGE_EMAIL?d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."):e&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your personal email. If you can't find it, check your spam folder or click the button to resend the email."):e&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your %(team)s email. If you can't find it, check your spam folder or click the button to resend the email."):d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to finish updating your email. If you can't find it, check your spam folder or click the button to resend the email.")}}),m=e.createClass({propTypes:{email:e.PropTypes.string},render:function(){var e;return e=d({email:this.props.email},"Dropbox has sent a verification email to <strong>%(email)s</strong>. Check your inbox and click on the link in the email to verify your address. If you can't find it, check your spam folder or click the button to resend the email."),_({title:v("Verification email sent!"),acceptButtonText:v("Done")},g.div({},e))}}),l=e.createClass({propTypes:{reason:e.PropTypes.string,email:e.PropTypes.string},render:function(){return _({title:v("Your email address has been verified"),acceptButtonText:v("Done")},g.div({},this.getPrompt()))},getPrompt:function(){switch(this.props.reason){case o.SHARE_FOLDER:return d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Now you can share folders with friends, family, or coworkers.");case o.CREATE_API_APP:return d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. You can now register API apps.");case o.PUBLIC_FOLDER:return d({email:this.props.email},"Thanks for verifying your email address. You can now enable the Public folder for your <strong>%(email)s</strong> Dropbox.")}return""}}),u=e.createClass({propTypes:{email:e.PropTypes.string,user:e.PropTypes.object},render:function(){return _({title:v("Your email address has been verified"),acceptButtonText:v("Done")},g.div({},this.getPrompt()))},getPrompt:function(){var e;return e=a.get_viewer().is_paired,e&&this.props.user.role===Constants.ROLE_PERSONAL?d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your personal account has successfully been changed."):e&&this.props.user.role===Constants.ROLE_WORK?d({email:this.props.email,team:a.get_viewer().team_name},"Thanks for verifying your email address <strong>%(email)s</strong>. Your %(team)s account has successfully been changed."):d({email:this.props.email},"Thanks for verifying your email address <strong>%(email)s</strong>. Your account has successfully been changed.")}}),{VerifyEmailModal:f,ResendVerifyEmailModal:p,VerifyEmailSentModal:m,EmailVerifiedModal:l,ChangedEmailVerifiedModal:u}}),define("modules/clean/account_photo_modal/account_header",["jquery","modules/clean/account_photo_modal/controller","modules/core/uri"],function(e,t){var n;return n=function(){function n(){}return n.init=function(n,o,i){return e(n).on("click",function(e){return e.preventDefault(),t.show()}),e(o).on("click",function(e){return e.preventDefault(),t.show()}),e(document).on("db:accountphoto:photo_set",function(){return e(o).addClass(i)}),e(document).on("db:accountphoto:photo_deleted",function(){return e(o).removeClass(i)})},n}()});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/account_photo_modal/controller",["jquery","external/flash_detect","external/plupload_dev","modules/clean/account_photo_modal/mode_enum","modules/clean/account_photo_modal/ui","modules/clean/analytics","modules/clean/ajax","modules/clean/react/modal","modules/clean/viewer","modules/core/browser","modules/core/cookies","modules/core/dom","modules/core/i18n","modules/core/uri"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p){var h,f,m,g;return m=r.UserActivityLogger,f=a.Modal,g=d._,h=function(){function t(){}return t.ERROR_MESSAGES={DEFAULT:g("There was an error uploading your photo."),SIZE_TOO_LARGE:g("Your photo should be no more than 10 MB in size."),DIMENSIONS_TOO_SMALL:g("Your photo should be at least 256px by 256px."),INVALID:g("We couldn't process your photo."),MULTIPLE_FILES:g("You selected multiple files. Your photo should be a single file."),UNSUPPORTED_EXTENSION:g("This file type isn't supported. For best results, select a PNG or JPG file.")},t.PHOTO_SOURCE={UPLOADER:"uploader",CHOOSER:"chooser"},t.VALID_MIME_TYPES=["image/png","image/jpeg","image/tiff"],t.show=function(){var e;return t.upload_button_id="account-photo-upload-button",t.upload_container_id="account-photo-upload-container",t.runtime=u.msie_version_at_most(9)?"flash":"html5",t.can_dragdrop="html5"===t.runtime,
t.can_upload=t.can_dragdrop||"flash"===t.runtime&&window.FlashDetect.versionAtLeast(9),e={can_upload:t.can_upload,can_dragdrop:t.can_dragdrop,upload_button_id:t.upload_button_id,upload_container_id:t.upload_container_id,chooser_button_click_handler:t.chooser_button_click_handler,save_button_click_handler:t.save_button_click_handler,start_over_button_click_handler:t.start_over_button_click_handler,dismiss_handler:t._enable_drag_drop_beyond_dropzone},t.modal=f.showInstance(i(e)),t.can_upload&&t._init_uploader(),m.log("web","account_photo_modal_shown")},t.chooser_button_click_handler=function(){var e;return e={success:function(e){return t._show_loading(),s.WebRequest({url:"/account/set_account_photo",type:"POST",data:{selected_file:e[0].link},success:function(e){return t._show_photo_preview(e,t.PHOTO_SOURCE.CHOOSER)}})},linkType:"direct",multiselect:!1,extensions:["images"]},Dropbox.choose(e)},t.start_over_button_click_handler=function(){return t.can_upload&&t.uploader.disableBrowse(!1),t.modal.setState({mode:o.SELECT}),s.WebRequest({url:"/account/delete_account_photo",type:"POST",success:function(){},error:function(){return!1},timeout:function(){}}),e(document).trigger("db:accountphoto:photo_deleted"),m.log("web","account_photo_modal_start_over")},t.post_init_handler=function(){var n;return t.can_dragdrop?(n=e("#"+t.upload_button_id),n.on("dragenter",function(){return t._uploader_browse_button_disabled()?void 0:t.modal.setState({dragover:!0})}),n.on("dragleave drop",function(){return t.modal.setState({dragover:!1})}),t._disable_drag_drop_beyond_dropzone()):void 0},t.files_added_handler=function(e,n){var o,i,r,s,a,c,u,_,d;if(i=t.PHOTO_SOURCE.UPLOADER,t._uploader_browse_button_disabled()){for(_=[],r=0,a=n.length;a>r;r++)o=n[r],_.push(t.uploader.removeFile(o));return _}if(n.length>1){for(t._show_error(t.ERROR_MESSAGES.MULTIPLE_FILES,i),d=[],s=0,c=n.length;c>s;s++)o=n[s],d.push(t.uploader.removeFile(o));return d}return o=n[0],o.origSize>10*Math.pow(1024,2)?(t._show_error(t.ERROR_MESSAGES.SIZE_TOO_LARGE,i),t.uploader.removeFile(o)):(u=o.type,__indexOf.call(t.VALID_MIME_TYPES,u)<0?(t._show_error(t.ERROR_MESSAGES.UNSUPPORTED_EXTENSION,i),t.uploader.removeFile(o)):(t._show_loading("0"),t.uploader.settings.multipart_params.t=l.read(Constants.JS_CSRF_COOKIE),t.uploader.start()))},t.upload_progress_handler=function(e,n){return t._show_loading(n.percent)},t.error_handler=function(){return t._show_error(t.ERROR_MESSAGES.DEFAULT,t.PHOTO_SOURCE.UPLOADER)},t.file_uploaded_handler=function(e,n,o){var i,r;return r=JSON.parse(o.response),i=t.PHOTO_SOURCE.UPLOADER,null!=r.error_token&&r.error_token in t.ERROR_MESSAGES?t._show_error(t.ERROR_MESSAGES[r.error_token],i):null!=r.photo_url?t._show_photo_preview(r.photo_url,i):t._show_error(t.ERROR_MESSAGES.DEFAULT,i)},t.save_button_click_handler=function(){return e(document).trigger("db:accountphoto:flow_completed"),t._enable_drag_drop_beyond_dropzone(),m.log("web","account_photo_modal_save")},t._init_uploader=function(){var e,t;return e={t:l.read(Constants.JS_CSRF_COOKIE),is_xhr:!0},e[Constants.UID_PARAM_NAME]=c.get_viewer().get_users()[0].id,t={browse_button:this.upload_button_id,drop_element:this.upload_button_id,container:this.upload_container_id,url:"https://"+Constants.BLOCK_CLUSTER+"/upload_account_photo",file_data_name:"file",multipart_params:e,runtimes:this.runtime,flash_swf_url:Constants.static_url_moxie_swf,multi_selection:!1,init:{PostInit:this.post_init_handler,FilesAdded:this.files_added_handler,Error:this.error_handler,UploadProgress:this.upload_progress_handler,FileUploaded:this.file_uploaded_handler}},this.uploader=new window.plupload.Uploader(t),this.uploader.init()},t._show_loading=function(e){return t.can_upload&&t.uploader.disableBrowse(!0),t.modal.setState({mode:o.UPLOADING,percent_uploaded:e})},t._show_error=function(e,n){var i;return t.can_upload&&t.uploader.disableBrowse(!1),t.modal.setState({mode:o.ERROR,error_message:e}),i={source:n},m.log("web","account_photo_modal_error",i)},t._show_photo_preview=function(n,i){var r,s;return t.can_upload&&t.uploader.disableBrowse(!0),s=p.parse(n).updateQuery({size:"256x256"}).toString(),t.modal.setState({mode:o.CONFIRM,large_photo_url:s}),e(document).trigger("db:accountphoto:photo_set",{saved_photo_url:s}),r={source:i},m.log("web","account_photo_modal_photo_selected",r)},t._disable_event_propagation_and_behavior=function(e){return e.stopPropagation(),e.preventDefault()},t._disable_drag_drop_beyond_dropzone=function(){return e(document).on("dragenter dragover drop",t._disable_event_propagation_and_behavior)},t._enable_drag_drop_beyond_dropzone=function(){return e(document).off("dragenter dragover drop",t._disable_event_propagation_and_behavior)},t._uploader_browse_button_disabled=function(){return e('.moxie-shim input[type="file"]').prop("disabled")},t}()}),define("modules/clean/account_photo_modal/mode_enum",[],function(){var e;return e={SELECT:"select",ERROR:"error",UPLOADING:"uploading",CONFIRM:"confirm"}}),define("modules/clean/account_photo_modal/ui",["jquery","external/react","modules/clean/account_photo_modal/mode_enum","modules/clean/react/image","modules/clean/react/button","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,o,i,r,s){var a,c,u,l,_;return u=i.button,c=r.Modal,_=s._,l=t.DOM,a=t.createClass({propTypes:{can_upload:t.PropTypes.bool,can_dragdrop:t.PropTypes.bool,upload_button_id:t.PropTypes.string,upload_container_id:t.PropTypes.string,chooser_button_click_handler:t.PropTypes.func,start_over_button_click_handler:t.PropTypes.func,save_button_click_handler:t.PropTypes.func,dismiss_handler:t.PropTypes.func},getInitialState:function(){return{mode:n.SELECT,error_message:null,percent_uploaded:null,large_photo_url:null,dragover:!1}},render:function(){return c({acceptButtonText:null,onDismiss:this.props.dismiss_handler,ref:"modal",style:"clean",width:700},l.div({id:this.props.upload_container_id,className:"add-account-photo-modal"},this.renderTopText(),this.renderCenterBox(),this.renderButtons()))},renderTopText:function(){var e;return e=function(){switch(!1){case this.state.mode!==n.CONFIRM:return l.span({},l.strong({},_("Looking good!"))," ",_("Your account photo has been set."));default:return _("Select an account photo so your friends and coworkers can recognize you around Dropbox.")}}.call(this),l.div({className:"top-text"},e)},renderCenterBox:function(){var e,t,i,r,s;switch(e=["center-box"],r="content",!1){case!this.state.dragover:e.push("green-box"),i=l.div({className:r},l.strong({},_("Drop file to upload")));break;case this.state.mode!==n.SELECT:e.push("gray-box"),this.props.can_dragdrop?(e.push("clickable"),t=l.div({},l.strong({},_("Drag and drop a photo")),l.br(),l.span({},_("Or click to choose from your computer")))):this.props.can_upload?(e.push("clickable"),t=_("Click to choose a photo from your computer")):t=_("Click an option below to choose a photo"),i=l.div({className:r},o({src:"account_photo/landscape.png",className:"landscape"}),l.br(),t);break;case this.state.mode!==n.ERROR:e.push("red-box"),this.props.can_upload&&e.push("clickable"),i=l.div({className:r},l.strong({},_("Error")),l.br(),this.state.error_message,l.br(),_("Please choose another photo."));break;case this.state.mode!==n.UPLOADING:e.push("gray-box"),s=this.state.percent_uploaded?_("%(percent_uploaded)s%(percent_symbol)s Uploading...",{comment:'"percent_symbol" will be substituted with an actual percent symbol'}).format({percent_symbol:"%",percent_uploaded:this.state.percent_uploaded}):_("Uploading..."),i=l.div({className:r},o({src:"icons/ajax-loading-small.gif",className:"loading"}),l.br(),s);break;case this.state.mode!==n.CONFIRM:e.push("white-box"),i=l.div({className:r},l.div({className:"avatar-component photo circle"},l.img({src:this.state.large_photo_url,className:"preview-photo"})))}return l.div({id:this.props.upload_button_id,className:e.join(" ")},l.div({className:"inner-container"},i))},renderButtons:function(){return this.state.mode===n.CONFIRM?l.div({},u({importance:"tertiary",id:this.props.upload_button_id,onClick:this.props.start_over_button_click_handler},_("Change photo")),u({importance:"primary",className:"left-margin",onClick:this.saveButtonClickHandler},_("Done"))):l.div({},u({importance:"tertiary",onClick:this.props.chooser_button_click_handler,disabled:this.state.mode===n.UPLOADING},_("Choose from Dropbox")))},saveButtonClickHandler:function(){return this.props.save_button_click_handler(),this.refs.modal.close()}})});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/activity/activity",["modules/clean/activity/activity_user","modules/clean/activity/comment","modules/clean/activity/like","modules/clean/datetime","modules/core/exception"],function(e,t,n,o,i){var r,s,a,c,u,l;return a={ADD:0,EDIT:1,POST:2,FILE:3,COMMENT:4,NS_RELATED_EVENT:5},s={SHARED_LINK_VIEW:1,SHARED_LINK_LIGHTBOX:2,BROWSE_FILE_VIEWER:3,BROWSE_LIGHTBOX:4},l=function(e){return e===a.FILE?u:e===a.COMMENT?c:i.assert(!1,"Invalid activity type")},r=function(){function t(t){var o,i,r,s,a;this.activity_key=t.activity_key,this.activity_type=t.activity_type,this.activity_data=t.activity_data,this.when=t.when,this.feedback_off=t.feedback_off,this.can_edit_feedback=t.can_edit_feedback,i=t.comment_activity_dicts,s=t.like_dicts,a=t.owner,this.owner=new e(a),this.when_mses=1e3*this.when,this.comment_activities=function(){var e,t,n;for(n=[],e=0,t=i.length;t>e;e++)o=i[e],n.push(new c(o));return n}(),this.likes=function(){var e,t,o;for(o=[],e=0,t=s.length;t>e;e++)r=s[e],o.push(new n(r));return o}()}return t.prototype.when_pretty=function(){return o.ago(new Date(this.when_mses))},t.prototype._remove_comment_activity=function(e){return this.comment_activities=this.comment_activities.filter(function(t){return t.activity_key!==e.activity_key})},t.prototype._add_comment_activity=function(e){return this.comment_activities.push(e)},t.prototype._update_like=function(e,t){var o;return o=new n({liker_dict:e,when_mses:Date.now()}),t?this._add_like(o):this._remove_like(o)},t.prototype._remove_like=function(e){return this.likes=this.likes.filter(function(t){return t.liker.id!==e.liker.id})},t.prototype._add_like=function(e){return this.likes.push(e)},t}(),c=function(e){function n(e){n.__super__.constructor.call(this,e),this.comment=new t(e.comment),this.permissions={user_ids_who_can_delete:e.permissions.user_ids_who_can_delete}}return __extends(n,e),n}(r),u=function(t){function n(t){var o;n.__super__.constructor.call(this,t),this.ns_path=t.ns_path,this.file_icon=t.file_icon,this.users_to_notify=function(){var n,i,r,s;for(r=t.users_to_notify,s=[],n=0,i=r.length;i>n;n++)o=r[n],s.push(new e(o));return s}()}return __extends(n,t),n}(r),{ActivityType:a,ActivityContext:s,get_activity_class_by_type:l,Activity:r,CommentActivity:c,FileActivity:u}}),define("modules/clean/activity/activity_local_storage",["modules/clean/storage"],function(e){var t,n;return n="tmp-file-comments-",new(t=function(){function t(){}return t.prototype.get_store=function(t,o){var i;return i=e.SessionStorage.get(""+n+t),i&&i.activity_key===o&&(new Date).getTime()-i.time<3e5?i:null},t.prototype.clear_store=function(t){return e.SessionStorage.set(""+n+t,null)},t.prototype.set_store=function(t,o,i){return e.SessionStorage.set(""+n+t,{activity_key:o,comment_activity_key:i,time:(new Date).getTime()})},t}())});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/activity/activity_store",["modules/clean/ajax","modules/clean/activity/activity","modules/clean/activity/like","modules/core/exception","modules/core/uri"],function(e,t,n,o){var i,r;return i=function(){function n(e,t){this.activity_context=e,this.activity_context_data=t}return n.prototype._activity_type=function(){return o.assert(!1,"Not implemented")},n.prototype._fetch_activity_url=function(){return o.assert(!1,"Not implemented")},n.prototype._comment_url=function(){return o.assert(!1,"Not implemented")},n.prototype._update_like_url=function(){return o.assert(!1,"Not implemented")},n.prototype._update_resolved_url=function(){return o.assert(!1,"Not implemented")},n.prototype._update_subscribe_url=function(){return o.assert(!1,"Not implemented")},n.prototype._update_feedback_setting_url=function(){return o.assert(!1,"Not implemented")},n.prototype._submit_product_feedback_url=function(){return o.assert(!1,"Not implemented")},n.prototype.gen_activities=function(e){var n,o,i,r,s;for(n=[],r=0,s=e.length;s>r;r++)i=e[r],o=t.get_activity_class_by_type(this._activity_type()),n.push(new o(i));return n},n.prototype._parse_activity_and_callback=function(e,t){var n,o;return e=JSON.parse(e),o=e.payload,n=this.gen_activities([o]),1===(null!=n?n.length:void 0)&&"function"==typeof t?t(n[0]):void 0},n.prototype.fetch_activity=function(t,n,o,i){var r;return null==i&&(i=!1),r=function(e){return function(t){return e._parse_activity_and_callback(t,n)}}(this),e.WebRequestOref({url:this._fetch_activity_url(),type:"GET",data:{activity_context:this.activity_context,activity_context_data:this.activity_context_data,activity_type:this._activity_type(),with_comments_revisions:i},success:r,error:o,subject_user:t.id})},n.prototype.add_comment=function(n,o,i,r,s,a){var c;return c=function(e){return e=JSON.parse(e),"error"===e.status?a(e.payload):(n._add_comment_activity(new t.CommentActivity(e.payload)),"function"==typeof s?s(e.payload):void 0)},e.WebRequestOref({url:this._comment_url(),type:"POST",data:{activity_context:this.activity_context,activity_context_data:this.activity_context_data,comment_text:i,comment_meta_json:null!=r?JSON.stringify(r):null},success:c,error:a,subject_user:o.id})},n.prototype.delete_comment=function(n,o,i,r,s){var a;return a=function(e){e=JSON.parse(e),n._remove_comment_activity(new t.CommentActivity(e.payload)),"function"==typeof r&&r(e.payload)},e.WebRequestOref({url:"/file_activity/comment/delete",type:"POST",data:{comment_key:i,activity_context:this.activity_context,activity_context_data:this.activity_context_data},success:a,error:s,subject_user:o.id})},n.prototype.add_like=function(e,t,n,o,i){return this._update_like(e,t,!0,this._update_like_url(),n,o,i)},n.prototype.remove_like=function(e,t,n,o,i){return this._update_like(e,t,!1,this._update_like_url(),n,o,i)},n.prototype.add_comment_like=function(e,t,n,o,i){return this._update_like(e,t,!0,this._update_comment_like_url(),n,o,i)},n.prototype.remove_comment_like=function(e,t,n,o,i){return this._update_like(e,t,!1,this._update_comment_like_url(),n,o,i)},n.prototype._update_like=function(t,n,o,i,r,s,a){var c;return t._update_like(n,o),"function"==typeof r&&r(t),c=function(){return function(e){return t._update_like(n,!o),"function"==typeof r&&r(t),"function"==typeof a?a(e):void 0}}(this),e.WebRequestOref({url:i,type:"POST",data:{activity_key:t.activity_key,activity_context:this.activity_context,activity_context_data:this.activity_context_data,liked:o},success:s,error:c,subject_user:n.id})},n.prototype.update_subscribe=function(t,n,o,i,r,s,a){var c,u,l,_,d,p;return p=i||n,c=function(){return t.users_to_notify.push(p)},l=function(){return t.users_to_notify=t.users_to_notify.filter(function(e){return e.email!==p.email})},o?c():l(),_=function(e){return function(t){return e._parse_activity_and_callback(t,s)}}(this),u=function(e){return function(t){return o?l():c(),e._parse_activity_and_callback(t,a)}}(this),d=null!=i?i.email:void 0,e.WebRequestOref({url:this._update_subscribe_url(),type:"POST",data:{activity_context:this.activity_context,activity_context_data:this.activity_context_data,subscribed:o,target_user_identifier:d},success:_,error:u,subject_user:n.id}),"function"==typeof r?r(t):void 0},n.prototype.update_feedback_setting=function(t,n,o,i,r,s){var a;return t.feedback_off=o,"function"==typeof i&&i(t),a=function(){return function(e){return t.feedback_off=!o,"function"==typeof i&&i(t),"function"==typeof s?s(e):void 0}}(this),e.WebRequestOref({url:this._update_feedback_setting_url(),type:"POST",data:{activity_context:this.activity_context,activity_context_data:this.activity_context_data,feedback_off:o},success:r,error:a,subject_user:n.id})},n.prototype.update_resolved=function(t,n,o,i,r){var s;return t.comment.resolved=o,s=function(){return function(e){return t.comment.resolved=!o,"function"==typeof r?r(e):void 0}}(this),e.WebRequestOref({url:this._update_resolved_url(),type:"POST",data:{activity_key:t.activity_key,activity_context:this.activity_context,activity_context_data:this.activity_context_data,resolved:o},success:i,error:s,subject_user:n.id})},n.prototype.submit_product_feedback=function(t,n,o,i){return e.WebRequestOref({url:this._submit_product_feedback_url(),type:"POST",data:{activity_context:this.activity_context,activity_context_data:this.activity_context_data,feedback_text:n},success:o,error:i,subject_user:t.id})},n}(),r=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.prototype._activity_type=function(){return t.ActivityType.FILE},n.prototype._fetch_activity_url=function(){return"/file_activity/file_activity"},n.prototype._comment_url=function(){return"/file_activity/comment"},n.prototype._update_like_url=function(){return"/file_activity/like"},n.prototype._update_comment_like_url=function(){return"/file_activity/comment/like"},n.prototype._update_resolved_url=function(){return"/file_activity/comment/resolve"},n.prototype._update_subscribe_url=function(){return"/file_activity/subscribe"},n.prototype._update_feedback_setting_url=function(){return"/file_activity/feedback_setting"},n.prototype._submit_product_feedback_url=function(){return"/file_activity/product_feedback"},n}(i),{ActivityStore:i,FileActivityStore:r}}),define("modules/clean/activity/activity_user",["modules/core/user_i18n"],function(e){var t;return t=function(){function t(t){t?(this.id=t.id,this.fname=t.fname,this.lname=t.lname,this.display_name=t.display_name,this.email=t.email,this.photo_url=t.photo_url,this.photo_circle_url=t.photo_circle_url,this.initials=e.getInitials(this.display_name),this.unique_id=t.unique_id,this.is_email_verified=t.is_email_verified,this.is_signed_in=!0):this.is_signed_in=!1}return t.prototype.get_display_identity=function(){return this.display_name?this.display_name:this.email},t}()}),define("modules/clean/activity/comment",["modules/clean/activity/activity_user","modules/clean/datetime"],function(e,t){var n;return n=function(){function n(t){var n,i;this.comment_gid=t.comment_gid,i=t.commenter_dict,this.comment_text=t.comment_text,this.raw_comment_text=t.raw_comment_text,this.when_mses=t.when_mses,this.resolved=t.resolved,this.revision=t.revision,n=t.comment_meta_json,this.commenter=new e(i),this.comment_metadata=null!=n?new o(n):null}var o;return o=function(){function e(e){var t,n;t=JSON.parse(e),null!=t.revision&&(this.revision=t.revision),null!=t.annotation&&(this.annotation=t.annotation),null!=t.index&&(this.type=t.type,this.index=t.index,this.state=null!=(n=t.state)?n:"present")}return e.prototype.has_revision_data=function(){return null!=this.revision},e.prototype.has_annotation_data=function(){return null!=this.annotation},e.prototype.has_pptx_data=function(){return null!=this.index},e.prototype.as_string=function(){return this._type_as_string(this.type)+" "+this.index},e.prototype._type_as_string=function(e){switch(e){case"slide":return"Slide";default:return console.warn("Unrecognised type: "+e),e}},e.prototype.is_deleted=function(){return"deleted"===this.state?!0:!1},e}(),n.prototype.when_pretty=function(){return t.ago(new Date(this.when_mses))},n.prototype.has_metadata=function(){return null!=this.comment_metadata},n.prototype.get_metadata_as_string=function(){return this.has_metadata()?this.comment_metadata.as_string():""},n.prototype.is_metadata_deleted=function(){return this.has_metadata()&&this.comment_metadata.is_deleted()},n}()}),define("modules/clean/activity/file_viewer_state",["jquery","modules/clean/frame_messenger","modules/clean/activity/activity","modules/clean/gandalf_util"],function(e,t,n,o){var i,r;return i=n.ActivityContext,r=function(){function n(n){this.isPptxInlineCommentingAllowed=o.getGandalfRule("pptx-commenting"),this.isPptx=!1,this._file=null,this._currentPage=null,this._selectedObject=null,this._stateChangedCBList=[],this._frameMessenger=new t,this._frameMessenger.configureChildMessaging(this._getIframeQuery(n),e.proxy(this._handleMessageFromChild,this),["page-change"]),this._frameMessenger.startListening()}return n.prototype.get_state=function(){return{currentPage:this._currentPage,selectedObject:this._selectedObject}},n.prototype.setFile=function(e){var t,n;return this._file=e,null!=this._file&&this._file.filename?(t="pptx",n=this._file.filename.length-t.length,this.isPptx=n>0&&document.title.lastIndexOf(t)===n):this.isPptx=!1},n.prototype.getFileRevision=function(){return{nsid:this._file.ns_id||null,sjid:this._file.sjid||null}},n.prototype.setSelectedObject=function(e){return this._selectedObject=e,this._notifyStateChanged()},n.prototype.navToObject=function(e){return e&&"slide"===e.type?this._nav_to_slide(e.index):void 0},n.prototype.registerStateChangedCB=function(e){return this._stateChangedCBList.push(e)},n.prototype._notifyStateChanged=function(){var e,t,n,o,i;for(o=this._stateChangedCBList,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(e(this.get_state()));return i},n.prototype._updateCurrentPage=function(e){return this._currentPage=e},n.prototype._nav_to_slide=function(e){return this._frameMessenger.postMessageToChildren("nav-to-page",{page:e})},n.prototype._updateSelectedObject=function(e){return this._selectedObject=e},n.prototype._getIframeQuery=function(e){switch(e){case i.BROWSE_FILE_VIEWER||i.BROWSE_LIGHTBOX:return".preview-content-container > iframe";case i.SHARED_LINK_VIEW||i.SHARED_LINK_LIGHTBOX:return".preview-box iframe";default:return null}},n.prototype._sanitizePageNumber=function(e){var t;return null==e?0:(t=parseInt(e),isNaN(t)?0:t)},n.prototype._handleMessageFromChild=function(e){var t,n,o;switch(e.action){case"page-change":if(t=this._sanitizePageNumber(e.parameters.current_page),n=this._sanitizePageNumber(e.parameters.pages_count),0>=t||0>=n)return;return this._updateCurrentPage(t),o=null,this.isPptxInlineCommentingAllowed&&this.isPptx&&(o={type:"slide",index:""+t,state:"present"}),this._updateSelectedObject(o),this._notifyStateChanged()}},n}()}),define("modules/clean/activity/like",["modules/clean/activity/activity_user","modules/clean/datetime"],function(e,t){var n;return n=function(){function n(t){var n;n=t.liker_dict,this.when_mses=t.when_mses,this.liker=new e(n)}return n.prototype.when_pretty=function(){return t.ago(new Date(this.when_mses))},n}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},__bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/ajax",["jquery","external/underscore","modules/core/cookies","modules/core/exception","modules/core/html","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/job_progress","modules/clean/storage","modules/clean/undo"],function(e,t,n,o,i,r,s,a,c,u,l){var _,d,p,h,f,m,g,v,y,b,w,E,T,S,C,x,k,O,A,N,I,R,P,L,M,D,U,F,B,q,j,H,W,G,V,$,z,K,Y;return Y=r._,R="err:",I="async_task_started:",N="async_task_err:",A="done:",k="oref",P=function(t,n){var o,i,r,s;return null==t&&(t={}),null==n&&(n=[]),null==t.type&&(null!=t.method?(("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)||console.log('Expected "type" attribute; received "method"'),r=t.method):r="POST",t.type=r),o=new f(t),i=z(o,n),s=e.ajax({url:i.url(),type:t.type,noDropboxDefaults:!0,data:i.data(),dataType:t.dataType||"text",traditional:!0,xhrFields:i.xhrFields(),success:function(e,t,n){return i.success(e,t,n)},error:function(e,t,n){return i.error(e,t,n)},complete:function(e,t){return i.complete(e,t)},ajax:t.ajax||!0}),i.request(s)},z=function(e,n){var o,i,r,s,a,c,u,l;for(i=[e],l=t(n.slice(0)).reverse(),s=0,c=l.length;c>s;s++)o=l[s],i.push(new o);for(r=null,a=0,u=i.length;u>a;a++)o=i[a],r&&(o.next=r),r=o;return r},f=function(){function e(e){null==e&&(e={}),this.options=function(){return e},this.url=function(){return String(e.url||"")},this.data=function(){return e.data||{}},this.xhrFields=function(){return e.xhrFields||{}},this.success=e.success||this.identity,this.error=e.error||this.identity,this.complete=e.complete||this.identity,this.request=this.identity}return e.prototype.identity=function(e){return e},e}(),v=function(){function e(){}return e.prototype.options=function(){return this.next.options()},e.prototype.url=function(){return this.next.url()},e.prototype.data=function(){return this.next.data()},e.prototype.xhrFields=function(){return this.next.xhrFields()},e.prototype.success=function(e,t,n){return this.next.success(e,t,n)},e.prototype.error=function(e,t,n){return this.next.error(e,t,n)},e.prototype.complete=function(e,t){return this.next.complete(e,t)},e.prototype.request=function(e){return this.next.request(e)},e}(),g=function(i){function r(){return r.__super__.constructor.apply(this,arguments)}return __extends(r,i),r.prototype.SUPPORTED_TLDS=["dropbox.com","carousel.com"],r.prototype.data=function(){var t;return o.assert(this._is_db_domain(),"injecting CSRF token into request to non-dropbox domain"),t={is_xhr:!0,t:n.read(Constants.JS_CSRF_COOKIE)||""},e.extend(t,this.next.data())},r.prototype._is_db_domain=function(){var e,n;return(e=a.parse(String(this.url())).authority)?(n=e.split("."),t.reduce(this.SUPPORTED_TLDS,function(e,t){var o,i;return i=t.split("."),o=n.slice(-1*i.length).join("."),e||t===o},!1)):!0},r}(v),F=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.data=function(){var e,t;return e=this.next.data(),t=this.options(),t.subject_user&&!e[Constants.UID_PARAM_NAME]&&(e[Constants.UID_PARAM_NAME]=String(t.subject_user)),e},t}(v),m=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.error=function(e,t,n){var o,i;return 403===e.status&&(o=u.SessionStorage.get("reload-timestamp"),i=(new Date).getTime(),(!o||i-o>3e4)&&(u.SessionStorage.set("reload-timestamp",i),window.location.reload(!0))),this.next.error(e,t,n)},t}(v),M=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t;return t=this.next.data(),null!=e.ajaxSettings.restrict&&(t.restrict=e.ajaxSettings.restrict),t},n}(v),L=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,n;return t=this.next.data(),Constants.REQUEST_TRACING_ENABLED&&"post"===this.options().type.toLowerCase()?(n={parent_request_id:Constants.REQUEST_ID},e.extend(n,t)):t},n}(v),w=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,n;return t=this.next.data(),Constants.CPROFILE_ENABLED?(n={parent_request_id:Constants.REQUEST_ID,cProfile:Constants.CPROFILE_PARAMETER},e.extend(n,t)):t},n.prototype.success=function(e,t,n){return this._report_cprofile(e,t,n),this.next.success(e,t,n)},n.prototype._report_cprofile=function(t,n,o){var i,r,s;return i=e("#cprofile"),i.length?(r=this._build_cprofile_link(o),s=i.find(".ajax"),s.length>=10&&s.last().remove(),i.prepend(r)):void 0},n.prototype._build_cprofile_link=function(t){var n,o,i,r,s,c,u,l,_,d,p;if(i=t.getResponseHeader("X-Dropbox-Request-Id"),u=t.getResponseHeader("X-Server-Response-Time")||"-1",r={request_id:""+Constants.REQUEST_ID+"-"+i},l=this.url(),-1!==l.indexOf(Constants.BLOCK_CLUSTER))r.block=1;else for(p=Constants.BATCH_THUMB_ENDPOINTS,_=0,d=p.length;d>_;_++)if(o=p[_],-1!==l.indexOf(o)){r.block=1;break}return l=l.replace(/[^/]*\/\/[^/]+/,"").replace(/\?.*$/,""),s=e('<a target="_new" />').attr("href",String(a({path:"/profile/cprofile",query:r}))).text("CG "),c=e('<a target="_new" />').attr("href",String(a({path:"/profile/ioprofile",query:r}))).text("IO "),n=e('<div class="ajax">').text("Ajax: "+l+" ("+u+"ms)").prepend(s,c)},n}(v),E=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t;return t=this.next.data(),Constants.GANDALF_PANEL?e.extend({gandalf_panel:1},t):t},n.prototype.success=function(e,t,n){return this._report_gandalf(e,t,n),this.next.success(e,t,n)},n.prototype._report_gandalf=function(t,n,o){var i;return e("#gandalf_panel").length&&"/gandalf_panel"!==this.url().substring(0,14)&&null!=(i=window.gandalf_panel)?i.add(this.url(),o.getResponseHeader("X-Dropbox-Request-Id")):void 0},n}(v),b=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.error=function(e,t,n){return this._notify_dev(e,t,n),this.next.error(e,t,n)},n.prototype._notify_dev=function(t){var n,o,r;return!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)&&500===t.status&&t.getResponseHeader("X-Debug-Url")?(r=t.getResponseHeader("X-Debug-Url"),n=e("<span />"),n.text(s.DEFAULT_ERROR),o=e("<a/>",{href:r,target:"_blank"}).text(Y("View debug")),n.append("&nbsp;").append(o),s.error(new i(n.html()))):void 0},n}(v),B=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.success=function(e,t,n){var o,i;return n.responseText.length?0===n.responseText.indexOf(R)?(o=n.responseText.substr(R.length),"{"!==(i=o[0])&&"["!==i&&s.error(o),this.next.error(n,t,o)):this.next.success(e,t,n):this.next.error(n,t,"")},t}(v),q=function(e){function t(){return this._clear_working_msg=__bind(this._clear_working_msg,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.request=function(e){return this.xhr=e,setTimeout(function(e){return function(){return e._request_finished()?void 0:e._should_show_working_msg()?(e._show_working_msg(),e.xhr.done(e._clear_working_msg)):void 0}}(this),4e3),this.next.request(this.xhr)},t.prototype._request_finished=function(){return 4===this.xhr.readyState},t.prototype._should_show_working_msg=function(){return s.isShown()&&s.current()!==l.undo_notification},t.prototype._show_working_msg=function(){return this.notification=s.success(Y("Still working..."))},t.prototype._clear_working_msg=function(){return s.isShown()&&this.notification===s.current()?s.clear():void 0},t}(v),O=function(t){function n(){return this._watch=__bind(this._watch,this),n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.prototype.data=function(){var t,o;return this.job_id=n.generate_job_id(),t=this.next.data(),this.uid=t[Constants.UID_PARAM_NAME],o=this.options().subject_user,!this.uid&&o&&(this.uid=String(o)),e.extend({job_id:this.job_id},t)},n.prototype.request=function(e){return this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval),this.next.request(e)},n.prototype.success=function(e,t,n){return this.next.success(e,t,n)},n.prototype.error=function(e,t,n){return this.next.error(e,t,n)},n.prototype.complete=function(e,t){return this._stop(),c.Job.handled(this.job_id),this.next.complete(e,t)},n.prototype._watch=function(){return c.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},n.prototype._stop=function(){return clearInterval(this._watch_id),
c.ModalProgress.hide()},n.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,c.ModalProgress.show(this.options().progress_text))},n.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[Constants.UID_PARAM_NAME]=this.uid),h({url:"/job_status/"+this.job_id,data:e,success:function(){return function(e,t,n){var o;return o=0===n.responseText.indexOf("done")?"1/1":n.responseText,c.ModalProgress.update(o)}}(this),error:function(e){return function(t,n,o){return e._failures++,e._failures<3?void 0:(e._stop(),e.next.error(t,n,o))}}(this)})},n.generate_job_id=function(){var e,t,n;return e=new Date,n=e.getTime().toString(),t=Math.floor(1e6*Math.random()).toString().lpad(6),n+t},n}(v),d=function(e){function t(){return this._watch=__bind(this._watch,this),t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.data=function(){var e,t;return e=this.next.data(),this.uid=e[Constants.UID_PARAM_NAME],t=this.options().subject_user,!this.uid&&t&&(this.uid=String(t)),e},t.prototype.success=function(e,t,n){return this._is_async_job_response(n)?(this.job_id=n.responseText.split(":")[1],this._interval=1e3,this._failures=0,this._watch_count=0,this._watch_id=setInterval(this._watch,this._interval)):this.next.success(e,t,n)},t.prototype.complete=function(e,t){return this._is_async_job_response(e)?void 0:this.next.complete(e,t)},t.prototype._is_async_job_response=function(e){var t,n;return 0!==(null!=(n=e.responseText)?n.indexOf(I):void 0)?!1:(t=e.responseText.split(":")[1],t.match(/^[A-Za-z0-9_\-=]*$/))},t.prototype._watch=function(){return c.Job.peek(this.job_id)?this._stop():(this._watch_count++,this._watch_count%10===0&&(clearInterval(this._watch_id),this._interval=Math.min(Math.floor(1.5*this._interval),3e4),this._watch_id=setInterval(this._watch,this._interval)),this._show_progress_modal(),this._fetch_progress())},t.prototype._stop=function(){return clearInterval(this._watch_id),c.ModalProgress.hide()},t.prototype._show_progress_modal=function(){return this._modal_shown?void 0:(this._modal_shown=!0,c.ModalProgress.show(this.options().progress_text))},t.prototype._fetch_progress=function(){var e;return e={},this.uid&&(e[Constants.UID_PARAM_NAME]=this.uid),h({url:"/async_task_status/"+this.job_id,data:e,success:function(e){return function(t,n,o){var r,a,u;return u=o.responseText,0===u.indexOf(A)?(c.Job.handled(e.job_id),e._stop(),u=u.substr(A.length),o.responseText=u,e.next.success(u,n,o),e.next.complete(o,n)):0===u.indexOf(R)?(c.Job.handled(e.job_id),e._stop(),r=u.substr(R.length),s.error(r),e.next.error(o,n,r),e.next.complete(o,n)):0===u.indexOf(N)?(c.Job.handled(e.job_id),e._stop(),a=u.substr(N.length),s.error(new i(a)),e.next.complete(o,n)):c.ModalProgress.update(u)}}(this),error:function(e){return function(t,n,o){return e._failures++,e._failures<3?void 0:(e._stop(),e.next.error(t,n,o),e.next.complete(t,n))}}(this)})},t}(v),_=[F,g,m,M],p=function(e){return null==e&&(e={}),P(e,_)},x=[q],y=[b,E,w,L],C=[d],H=[].concat(x,[B],y,_,C),V=function(e){return null==e&&(e={}),P(e,H)},$=function(e){var t;return null==e&&(e={}),t=a.parse(document.URL).getQuery()[k],t&&(e.data||(e.data={}),e.data[k]=t),P(e,H)},T=[].concat(x,y,_,C),S=function(e){return null==e&&(e={}),P(e,T)},W=[].concat(x,[B],y,_,[O],C),G=function(e){return null==e&&(e={}),P(e,W)},h=function(e){return null==e&&(e={}),P(e,[].concat(y,_))},D=[F,g,M],U=function(e){return null==e&&(e={}),P(e,[].concat(y,D))},j=function(t){var n,o,i;return null==t&&(t={}),n=new f(t),o=z(n,_),i=e.ajax({url:o.url(),type:"OPTIONS",noDropboxDefaults:!0,data:o.data(),success:function(e,t,n){return o.success(e,t,n)},error:function(e,t,n){return o.error(e,t,n)},complete:function(e,t){return o.complete(e,t)}}),o.request(i)},K={Request:P,AuthenticatedRequest:p,BackgroundRequest:h,SilentBackgroundRequest:U,WebRequest:V,WebRequestOref:$,FormWebRequest:S,WebProgressRequest:G,ValidationSchemaRequest:j}}),define("modules/clean/analytics",["jquery","modules/clean/viewer","modules/clean/ajax"],function(e,t,n){var o,i,r,s,a,c,u,l,_,d,p,h,f,m,g;return g=function(e){var n,o,i;return i=new t(Constants._viewer_properties),n=e?[e]:function(){var e,t,n,r;for(n=i.get_users(),r=[],e=0,t=n.length;t>e;e++)o=n[e],r.push(o.id);return r}()},o={log:function(e,t){var o,i,r,s,a;for(r=0,s=0,a=e.length;a>s;s++)o=e[s],o.dir&&r++;return i=e.length-r,n.AuthenticatedRequest({url:"/browse_actions_context_menu_logger",data:{file_count:i,folder_count:r,action:t}})}},i={log:function(e,t){return null==t&&(t={}),n.AuthenticatedRequest({url:"/preview_activity_log",data:{event_name:e,input_method:t.input_method,file_ext:t.file_ext,extra:t.extra}})}},r={log:function(e,t,o,i,r,s,a){return n.AuthenticatedRequest({url:"/preview_quality_popup_logger",subject_user:t,data:{event_name:e,file_nsid:o,file_sjid:i,extension:r,doc_preview_status:s,feedback_text:a}})}},s={log:function(e,t,o){return null==o&&(o={}),n.AuthenticatedRequest({url:"/searchclientlogger",subject_user:t,data:{event_name:e,action_type:o.action_type,displayed:o.displayed,failure_type:o.failure_type,file_nsid:o.file_nsid,file_sjid:o.file_sjid,firefly:o.firefly,infinite_scroll:o.infinite_scroll,latency:o.latency,match_type:o.match_type,path_scoped:o.path_scoped,position:o.position,query_string:o.query_string,request_id:o.request_id,result_count:o.result_count,search_type:o.search_type,viewport:o.viewport}})}},a={flow_id:null,log:function(e,t,o,i,r){var s;return null==o&&(o=null),null==i&&(i={}),null==r&&(r=!1),(r||null===this.flow_id)&&(s=new Date,this.flow_id=s.getTime().toString()+Math.random().toString(),this.flow_id=this.flow_id.replace(".","")),n.AuthenticatedRequest({url:"/sflogger",data:{platform:e,event_name:t,extra:JSON.stringify(i),active_uid:null!=o?o.id:null,flow_id:this.flow_id}})}},c={log:function(e,t,o){return new n.AuthenticatedRequest({url:"/shmuilog",data:{evt:e,origin:t,target_item:o}})},log_with_target_file:function(e,t,n){return this.log(e,t,this.get_target_item(n))},get_target_item:function(e){return e.dir?e.is_shared_folder()?"folder-is-sf":e.could_be_shared_folder()?"folder-can-sf":"folder-no-sf":"file"}},_={log:function(e,t,o,i){var r;return null==i&&(i=null),r=g(i),n.AuthenticatedRequest({url:"/teamswalogger",data:{event_name:e,extra:JSON.stringify(t),for_uids:JSON.stringify(r)},success:o?o:void 0,error:o?o:void 0})}},d={log:function(e,t,o,i){var r;return null==i&&(i=null),r=g(i),n.AuthenticatedRequest({url:"/ualogger",data:{platform:e,event_name:t,extra:JSON.stringify(o),for_uids:JSON.stringify(r)}})}},p={log:function(e,t,o,i){return n.AuthenticatedRequest({url:"/virallogger",data:{user_ids:JSON.stringify(e),viral_type:t,action:o,extra:JSON.stringify(i||{})}})}},u={log:function(e,t){return n.AuthenticatedRequest({url:"/simplesharinglogger",data:{active_uid:e,simple_sharing_action:t}})}},f={log:function(e,t,o){var i;return null==o&&(o=null),i=g(o),n.AuthenticatedRequest({url:"/misclogger",data:{event_name:e,extra:JSON.stringify(t),for_uids:JSON.stringify(i)}})}},l={_log:function(e,t){return null==t&&(t={}),n.AuthenticatedRequest({url:"/support_experiments_log",data:{event_name:e,extra:JSON.stringify(t)}})},log_file_restore:function(e){return this._log("file_restore",{ref:e})}},h={VIEW:"view",SOCIAL_SHARE_VIEW:"social_share_view",SOCIAL_SHARE_FACEBOOK:"social_share_facebook",SOCIAL_SHARE_TWITTER:"social_share_twitter",SOCIAL_SHARE_GET_LINK:"social_share_get_link",SOCIAL_SHARE_SELECT_INLINE_LINK:"social_share_select_inline_link",LIKES_EXPERIMENT_VIEW:"likes_experiment_view",LIKES_EXPERIMENT_LOADED:"likes_experiment_loaded",LIKES_EXPERIMENT_MOUSED_OVER_LIKE:"likes_experiment_moused_over_like",LIKES_EXPERIMENT_CLICKED_LIKE:"likes_experiment_clicked_like",LIKES_EXPERIMENT_COMPLETED_LIKE:"likes_experiment_completed_like",LIKES_EXPERIMENT_CLICKED_UNLIKE:"likes_experiment_clicked_unlike",LIKES_EXPERIMENT_MOUSED_OVER_OTHERS:"likes_experiment_moused_over_others",log:function(e,t,o){var i;return null==o&&(o=null),i=g(o),n.AuthenticatedRequest({url:"/web_lightbox_log",data:{event_name:e,extra:JSON.stringify(t),for_uids:JSON.stringify(i)}})}},m={BrowseActionsContextMenuLogger:o,PreviewQualityPopupLogger:r,PreviewActivityLogger:i,SearchClientActivityLogger:s,SharedFolderActivityLogger:a,ShmodelUILogger:c,SupportExperimentsWebLogger:l,TeamsWebActionsLogger:_,UserActivityLogger:d,ViralLogger:p,SimpleSharingLogger:u,WebLightboxLogger:h,WebMiscActivityLogger:f},INLINE_JS.TeamsWebActionsLogger=_,INLINE_JS.ShmodelUILogger=c,m}),define("modules/clean/avatar/size",[],function(){var e,t,n;return e={XSMALL:16,SMALL:24,MEDIUM:32,LARGE:48,XLARGE:64},t=function(){var t;t=[];for(n in e)t.push(e[n]);return t}(),{AVATAR_DIMENSION_BY_SIZE:e,VALID_AVATAR_DIMENSIONS:t}}),define("modules/clean/avatar/style",["modules/clean/avatar/size"],function(e){var t,n;return t=e.VALID_AVATAR_DIMENSIONS,n=function(e){var t,n;for(t=5381*e.length,n=0;n<e.length;)t=e.charCodeAt(n)+((t<<6)+(t<<16)-t),n++;return t=Math.abs(t),"hsl("+t%360+", 60%, 53%)"},{hsl_color_value_for_avatar_name:n}}),define("modules/clean/base64",[],function(){var e,t,n,o,i;return i=function(e){var t,n,o,i,r,s,a,c,u;if(null===e||"undefined"==typeof e)return"";for(a=e+"",u="",s=void 0,i=void 0,c=0,s=i=0,c=a.length,r=0;c>r;){if(t=a.charCodeAt(r),o=null,128>t)i++;else if(t>127&&2048>t)o=String.fromCharCode(t>>6|192,63&t|128);else if(t&!0)o=String.fromCharCode(t>>12|224,t>>6&63|128,63&t|128);else{if(t&!0)throw new RangeError("Unmatched trail surrogate at "+r);if(n=a.charCodeAt(++r),n&!0)throw new RangeError("Unmatched lead surrogate at "+(r-1));t=((1023&t)<<10)+(1023&n)+65536,o=String.fromCharCode(t>>18|240,t>>12&63|128,t>>6&63|128,63&t|128)}null!==o&&(i>s&&(u+=a.slice(s,i)),u+=o,s=i=r+1),r++}return i>s&&(u+=a.slice(s,c)),u},o=function(e){var t,n,o,i,r,s;for(s=[],r=0,t=0,n=0,o=0,i=0,e+="";r<e.length;)n=e.charCodeAt(r),128>n?(s[t++]=String.fromCharCode(n),r++):n>191&&224>n?(o=e.charCodeAt(r+1),s[t++]=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),i=e.charCodeAt(r+2),s[t++]=String.fromCharCode((15&n)<<12|(63&o)<<6|63&i),r+=3);return s.join("")},t=function(e){var t,n,o,i,r,s,a,c,u,l,_,d,p,h;if(n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l=void 0,_=void 0,d=void 0,r=void 0,s=void 0,a=void 0,c=void 0,o=void 0,u=0,t=0,i="",h=[],!e)return e;for(;;)if(l=e.charCodeAt(u++),_=e.charCodeAt(u++),d=e.charCodeAt(u++),o=l<<16|_<<8|d,r=o>>18&63,s=o>>12&63,a=o>>6&63,c=63&o,h[t++]=n.charAt(r)+n.charAt(s)+n.charAt(a)+n.charAt(c),!(u<e.length))break;return i=h.join(""),p=e.length%3,(p?i.slice(0,p-3):i)+"===".slice(p||3)},e=function(e,t){var n,i,r,s,a,c,u,l,_,d,p,h,f,m,g;if(p=function(e){return e},a=t?p:o,"function"==typeof window.atob)return a(window.atob(e));if(i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",d=0,n=0,g=[],!e)return e;for(e+="";;)if(c=i.indexOf(e.charAt(d++)),u=i.indexOf(e.charAt(d++)),l=i.indexOf(e.charAt(d++)),_=i.indexOf(e.charAt(d++)),r=c<<18|u<<12|l<<6|_,h=r>>16&255,f=r>>8&255,m=255&r,g[n++]=64===l?String.fromCharCode(h):64===_?String.fromCharCode(h,f):String.fromCharCode(h,f,m),!(d<e.length))break;return s=g.join(""),s=a(s)},n={encode:t,decode:e}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/browse_interface",["modules/clean/viewer","modules/core/uri"],function(e,t){var n;return n=function(n){function o(){return o.__super__.constructor.apply(this,arguments)}return __extends(o,n),o.get_browse_root=function(t){return e.get_viewer().is_paired?t.role===Constants.ROLE_PERSONAL?"/personal":"/work":"/home"},o.browse_uri_for_fq_path=function(e,n){return t({scheme:"https",authority:Constants.WEBSERVER,path:""+o.get_browse_root(e)+n})},o}(Object)});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/captcha",["jquery","external/react","modules/clean/ajax","modules/clean/react/recaptcha_challenge","modules/core/notify"],function(e,t,n,o,i){var r;return r=function(){function r(e,t,n,o,i,r){var s;this.parent_form=e,this.captcha_div=t,this.other_recaptcha_div=n,this.endpoint=o,this.email_name=i,this.variant=r,this.captcha_display_handler=__bind(this.captcha_display_handler,this),this._hide_other_captcha=__bind(this._hide_other_captcha,this),this._hide_captcha=__bind(this._hide_captcha,this),this._show_captcha=__bind(this._show_captcha,this),this.$recaptcha_container=null!=(s=this.parent_form.find(this.captcha_div))?s[0]:void 0,this.$recaptcha_react_component=null}return r.prototype._show_captcha=function(e,n){var i,r;return null==(null!=(r=this.$recaptcha_container)?r.children:void 0)&&(this.$recaptcha_react_component=null),null==this.$recaptcha_react_component?(i=o({public_key:e,variant:this.variant}),this.$recaptcha_react_component=t.render(i,this.$recaptcha_container)):this.$recaptcha_react_component.reload(n)},r.prototype._hide_captcha=function(){var e;return null==(null!=(e=this.$recaptcha_container)?e.children:void 0)&&(this.$recaptcha_react_component=null),null!=this.$recaptcha_react_component?(t.unmountComponentAtNode(this.$recaptcha_container),this.$recaptcha_react_component=null):void 0},r.prototype._hide_other_captcha=function(){var n;return n=e(this.other_recaptcha_div)[0],null!=(null!=n?n.children:void 0)?t.unmountComponentAtNode(n):void 0},r.prototype.captcha_display_handler=function(e,t){return n.WebRequest({url:this.endpoint,data:{email:this.parent_form.find("input[name='"+this.email_name+"']").val()},success:function(n){return function(o){var r;try{return r=JSON.parse(o),r.needs_captcha?(n._hide_other_captcha(),n._show_captcha(r.recaptcha_public_key,null!=t?t.recaptcha_response:void 0)):n._hide_captcha()}catch(s){return e=s,i.error(i.DEFAULT_ERROR)}}}(this)})},r}()}),define("modules/clean/clipboard",["jquery","modules/core/dom","external/swfobject"],function(e,t){var n,o,i,r,s;return i=function(){var e,t;return e=(new Date).getTime(),t=Math.floor(1e6*Math.random()).toString().lpad(6),"swf_"+e+"_"+t},r=function(e,t){return e.on("mouseover",function(){return t.addClass("hovered")}),e.on("mousedown",function(){return t.addClass("pressed")}),e.on("mouseout",function(){return t.removeClass("hovered pressed")}),e.on("mouseup",function(){return t.removeClass("pressed")})},s=function(e,t){return window.ClipboardSWFRegister=window.ClipboardSWFRegister||{},window.ClipboardSWFRegister[e]=function(){return t()},"ClipboardSWFRegister."+e},n=function(n,o,a,c){var u,l,_;return null==a&&(a=null),null==c&&(c=null),c=c||e(document.body),_=i(),u=e("<div />",{id:"flash_copy_container"}).append(e("<div />",{id:_})).css({position:"absolute",zIndex:1}),r(u,o),c.append(u),t.clone_position(u,o,{}),l=s(_,a),window.copyLoaded=function(){return function(){var t;return t=e("#"+_)[0],t.setCopyText(n),t.setCallbackFunction(l)}}(this),window.swfobject.embedSWF(Constants.static_url_copy_clipboard_swf,_,"100%","100%","6.0.65",!1,!1,{wmode:"transparent",scale:"exactfit",allowScriptAccess:"always"}),u},o={clipboard_overlay:n}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/ajax_form",["jquery","modules/core/dom","modules/core/exception","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/validators/validators"],function(e,t,n,o,i,r,s){var a,c;return c=n.assert,a=function(){function n(e,n,o){this.$container=e,this.do_before_submitting=n,this._clear_pending=__bind(this._clear_pending,this),this._clear_errors=__bind(this._clear_errors,this),this._handle_errors=__bind(this._handle_errors,this),this._on_error=__bind(this._on_error,this),this._on_success=__bind(this._on_success,this),this._submit_form=__bind(this._submit_form,this),this._install_schema=__bind(this._install_schema,this),o=o||{},this.$form="FORM"===this.$container.prop("tagName")?this.$container:this.$container.find("form"),this.$form.submit(this._submit_form),this.$submit_button=this.$form.find("[type='submit']"),t.set_controller(this.$form,this),this.schema={},this.should_validate=o.client_side_validation,this.should_submit_once=o.should_submit_once,this.should_validate&&this._fetch_schema()}return n.SUCCESS_EVENT="db:ajaxform:success",n.ERROR_EVENT="db:ajaxform:error",n.extract_errors=function(e){var t,n;if(0!==e.indexOf("err:"))return!1;e=e.substr(4);try{return t=JSON.parse(e)}catch(o){return n=o,"string"==typeof e?e:i.DEFAULT_ERROR}},n.clear_errors=function(e){return e.find(".input-error").removeClass("input-error"),e.find(".error-message").remove()},n.fill_errors=function(t,n){var o,i,r,s;s=[];for(i in n)r=n[i],o=e("<span>",{"class":"error-message"}),r.message_html?o.html(r.message_html):o.text(r.message_text),o.insertBefore(t.find("[data-error-field-name='"+i+"']")),s.push(t.find("input[name='"+i+"'], input[data-encrypted-name='"+i+"']").addClass("input-error"));return s},n.prototype._install_schema=function(t){var n,o;try{n=JSON.parse(t)}catch(i){o=i}return e.each(n,function(e){return function(t,n){return n?e.schema[t]=s.create(n):void 0}}(this))},n.prototype._fetch_schema=function(){return r.ValidationSchemaRequest({url:this.$form.attr("action"),success:function(e){return function(t){return e._install_schema(t)}}(this)})},n.prototype.reset=function(){var t,n,o,i,r;for(i=this.$form.find("input"),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(e(t).closest(".text-input").val(t.defaultValue));return r},n.prototype.set_input_value=function(e,t){return this.$form.find("input[name='"+e+"']").closest(".text-input").val(t)},n.prototype._get_form_data=function(){var t,n,o,i,r,s,a,u;for(t={},u=this.$form.find("input, select, textarea").not(":disabled"),s=0,a=u.length;a>s;s++)n=u[s],i=e(n).attr("name"),i&&(o=e(n).attr("type"),r="checkbox"===o?e(n).prop("checked")?"True":"":e(n).val(),"radio"!==o&&c(!(i in t),"found multiple inputs with the same name"),t[i]=r);return t},n.prototype._validate=function(t){var n,o;return this.should_validate?(n={},o=!0,e.each(t,function(e){return function(i,r){var s;if(e.schema[i])try{return e.schema[i].validate(r,{field:i,data:t,errors:n})}catch(a){return s=a,o=!1,n[i]={message_text:s.message}}}}(this)),o?null:n):null},n.prototype._submit_form=function(e){var t;return e.preventDefault(),"function"==typeof this.do_before_submitting&&this.do_before_submitting(),this._clear_errors(),this.$form.prop("disabled",!0),this.$form.addClass("ajax-loading"),this.$submit_button.prop("disabled",!0),t=this._validate(this._get_form_data()),t?this._handle_errors(t):this.send_request()},n.prototype.send_request=function(){return r.FormWebRequest({url:this.$form.attr("action"),data:this._get_form_data(),success:this._on_success,error:this._on_error,complete:this._on_complete})},n.prototype._on_success=function(e,t,o){var r,s,a,c;if(a=o.responseText,r=n.extract_errors(a),r!==!1)return void this._handle_errors(r);try{s=JSON.parse(a)}catch(u){return c=u,this.$form.trigger(n.ERROR_EVENT),i.error(),void this._clear_pending(!0)}return this.$form.trigger(n.SUCCESS_EVENT,s),this._clear_pending(!this.should_submit_once)},n.prototype._on_error=function(){return i.error(),this._clear_pending(!0)},n.prototype._handle_errors=function(e){return"string"==typeof e?(i.error(new o(e)),void this._clear_pending(!0)):(n.fill_errors(this.$form,e),this._clear_pending(!0),this.$form.trigger(n.ERROR_EVENT,e))},n.prototype._clear_errors=function(){return this.$form.find(".error-message").remove(),this.$form.find("input").removeClass("input-error")},n.prototype._clear_pending=function(e){return this.$form.removeClass("ajax-loading"),e?(this.$form.prop("disabled",!1),this.$submit_button.prop("disabled",!1)):void 0},n}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/bubble_dropdown",["jquery"],function(e){var t;return t=function(){function t(n,o,i,r){this.$root=n,this.arrow_direction=o,this.top_adjustment=null!=r?r:0,this._hide_bubble=__bind(this._hide_bubble,this),this._show_bubble=__bind(this._show_bubble,this),this._toggle_bubble=__bind(this._toggle_bubble,this),this._on_global_hover=__bind(this._on_global_hover,this),this._on_mouseout=__bind(this._on_mouseout,this),this._on_mouseover=__bind(this._on_mouseover,this),this.openDropdown=__bind(this.openDropdown,this),this.closeDropdown=__bind(this.closeDropdown,this),this.$target=this.$root.find(".bubble-dropdown-target"),this.$dropdown=this.$root.find(".bubble-dropdown"),this.$arrow_anchor=this.$root.find(".bubble-dropdown-arrow-anchor"),this.$arrow=this.$dropdown.find(".bubble-arrow"),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[this.arrow_direction],i?(this.$target.on("mouseover",this._on_mouseover),this.$dropdown.on("mouseover",this._on_mouseover),this.$target.on("mouseout",this._on_mouseout),this.$dropdown.on("mouseout",this._on_mouseout),e(document).on(t.HOVER_SHOWN,this._on_global_hover)):(this.$target.click(this._toggle_bubble),e("body").on("click",function(t){return function(n){var o;return e(n.target).is("select")?!0:(o=e(n.target).closest(t.$target).length||e(n.target).closest(t.$dropdown).length,o||t._hide_bubble(),!0)}}(this)))}return t.HOVER_SHOWN="bubble:hover:shown",t.prototype._dropdown_shown=!1,t.prototype.closeDropdown=function(){return this._dropdown_shown?this._hide_bubble():void 0},t.prototype.openDropdown=function(){return this._dropdown_shown?void 0:this._show_bubble()},t.prototype._on_mouseover=function(){return e(document).trigger(t.HOVER_SHOWN,this.$target),this._show_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))},t.prototype._on_mouseout=function(){var e;return e=setTimeout(this._hide_bubble,200),this.$dropdown.data("timeout_id",e)},t.prototype._on_global_hover=function(e,t){return this._dropdown_shown&&t!==this.$target?(this._hide_bubble(),clearTimeout(this.$dropdown.data("timeout_id"))):void 0},t.prototype._toggle_bubble=function(){return this._dropdown_shown?this._hide_bubble():this._show_bubble(),!0},t.prototype._show_bubble=function(){var e,t,n,o,i,r;if(!this.$target.hasClass("disabled")){switch("right"===this.arrow_direction?this.$dropdown.css("display","block"):this.$dropdown.css("display","inline-block"),r=this.$arrow.outerWidth(),t=this.$arrow.outerHeight()-this.top_adjustment,i=this.$arrow.position().top,n=this.$arrow.position().left,this.arrow_direction){case"left":e="left+"+r+"px top-"+i+"px";break;case"right":e="right-"+r+"px top-"+i+"px";break;case"top":e="left-"+n+"px top+"+t+"px";break;case"bottom":e="left-"+n+"px bottom-"+t+"px"}return o={my:e,at:this.target_position,of:this.$arrow_anchor.length?this.$arrow_anchor:this.$target,collision:"none"},this.$dropdown.position(o),this.$dropdown.position(o),this._dropdown_shown=!0}},t.prototype._hide_bubble=function(){return this.$dropdown.hide(),this._dropdown_shown=!1},t}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/bubble_picker",["jquery"],function(e){var t;return t=function(){function t(e){this.$bubble_picker=e,this.enable_option=__bind(this.enable_option,this),this.disable_option=__bind(this.disable_option,this),this.show_dropdown=__bind(this.show_dropdown,this),this.hide_dropdown=__bind(this.hide_dropdown,this),this.set_value=__bind(this.set_value,this),this._listen=__bind(this._listen,this),this.$label_wrapper=this.$bubble_picker.find(".bubble-picker-label-wrapper"),this.$label=this.$bubble_picker.find(".bubble-picker-label"),this.$dropdown=this.$bubble_picker.find(".bubble-picker-dropdown"),this._dropdown_shown=!1,this._listen()}return t.CHANGED="db:bubblepicker:changed",t.prototype._listen=function(){return e(document).click(function(t){return function(n){var o,i;return i=e(n.target).closest(t.$label_wrapper).length>0,o=e(n.target).closest(t.$dropdown).length>0,t._dropdown_shown&&!o?t.hide_dropdown():i?t.show_dropdown():void 0}}(this)),this.$dropdown.find(".bubble-picker-option:not('.disabled')").click(function(n){return function(o){var i,r;return i=e(o.currentTarget),i.hasClass("disabled")?void 0:(r=n.get_value(),n.set_value(i.data("value")),n.$bubble_picker.trigger(t.CHANGED,{clicked_val:i.data("value"),old_val:r}),n.hide_dropdown())}}(this))},t.prototype.get_value=function(){return this.$bubble_picker.attr("data-selected-value")},t.prototype.set_value=function(e){var t;return this.$bubble_picker.attr("data-selected-value",e),this.$label.empty(),t=this.$bubble_picker.find("[data-value='"+e+"']"),this.$label.html(t.clone().html())},t.prototype.hide_dropdown=function(){return this.$dropdown.hide(),this._dropdown_shown=!1},t.prototype.show_dropdown=function(){return this.$dropdown.show(),this._dropdown_shown=!0},t.prototype.disable_option=function(t,n){var o,i;return i=this.$bubble_picker.find(".bubble-picker-option[data-value="+t+"]:not('.disabled')"),i.length>0&&(o=e(i.find(".role-option")),o.attr("saved-title",o.attr("title")),o.attr("title",n)),i.addClass("disabled")},t.prototype.enable_option=function(t){var n,o;return o=this.$bubble_picker.find(".bubble-picker-option.disabled[data-value="+t+"]"),n=e(o.find(".role-option")),n.attr("saved-title")&&(n.attr("title",n.attr("saved-title")),n.removeAttr("saved-title")),o.removeClass("disabled")},t}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/components/input",["jquery","modules/clean/components/tabbable","modules/core/i18n","modules/core/exception"],function(e,t,n,o){var i,r,s,a,c;return a=n._,s=o.assert,c=function(t){var n;return n=e.data(t,"input-element"),s(n.length,"TextInput element has no related input element please ensure it was setup correctly"),n},e.valHooks.textinput={get:function(e){return c(e).val()},set:function(e,t){return c(e).val(t).trigger("input")}},r=function(t){function n(t){var o,i;this.$text_input=t,this._on_change=__bind(this._on_change,this),this.persistent_label=this.$text_input.is(".label-above"),this.$input=this.$text_input.find(".text-input-input"),this.$text_input.data("input-element",this.$input),this.$label=this.$text_input.find("label"),this.$text_input.find(".error-message").length&&this.$input.addClass("input-error"),this.$text_input.each(function(e,t){return t.type="textinput"}),this.$text_input.focus(function(e){return function(){return setTimeout(function(){return e.$input.focus()},0)}}(this)),o="BODY"===(null!=(i=document.activeElement)?i.tagName:void 0),o&&e(".autofocus:visible").first().focus(),this._listen(),this._on_change(),n.__super__.constructor.call(this)}return __extends(n,t),n.prototype._listen=function(){return this.$input.on("keydown keyup paste input blur",function(e){return function(){return e._on_change()}}(this)),this.$input.on("blur",function(e){return function(t){return e.$text_input.trigger(t)}}(this)),this.$input.on("focus",function(e){return function(){return e.$input.removeClass("input-error")}}(this))},n.prototype._on_change=function(){return this.persistent_label?void 0:this.$label.toggle(!this.$input.val())},n}(t),i=function(t){function n(e){this.$text_input=e,this._on_change=__bind(this._on_change,this),this.$bubble_title=this.$text_input.find(".password-bubble-title"),this.$bubble_desc=this.$text_input.find(".password-bubble-desc"),this.$meter=this.$text_input.find(".password-input-meter"),this.$default_bubble_text=this.$bubble_desc.text(),this.$last_pwd="",require(["external/zxcvbn"]),n.__super__.constructor.call(this,this.$text_input)}return __extends(n,t),n.prototype._on_change=function(){var e,t,o,i,r;return t=this.$input.val(),this.$last_pwd!==t?(this.$last_pwd=t,"correcthorsebatterystaple"===t||"Tr0ub4dour&3"===t||"Tr0ub4dor&3"===t?(o=0,i=a("lol",{comment:"'lol'='laugh out loud'"}),this.$bubble_title.text(i),"correcthorsebatterystaple"===t?(e=a("Whoa there, don't take advice from a webcomic too literally ;)",{comment:"This text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(e)):(e=a("Guess again",{comment:"this text is displayed rarely, whenever a user selects a password that is from this comic: http://imgs.xkcd.com/comics/password_strength.png"}),this.$bubble_desc.text(e))):(r=["",a("Weak"),a("So-so"),a("Good"),a("Great!")],o=this._score(t),i=r[o],this.$bubble_title.text(i),this.$bubble_desc.text(this.$default_bubble_text)),this.$meter.find(".password-input-dot").removeClass("password-input-dot-selected"),this.$meter.find(".password-input-dot").slice(4-o,4).addClass("password-input-dot-selected"),n.__super__._on_change.apply(this,arguments)):void 0},n.prototype._get_user_inputs=function(){var t,n,o,i,r;for(n=["dropbox"],r=this.$text_input.closest("form").find("input[type=text], input[type=email]"),o=0,i=r.length;i>o;o++)t=r[o],n.push(e(t).val());return n},n.prototype._score=function(e){return window.zxcvbn&&e?Math.max(1,zxcvbn(e,this._get_user_inputs()).score):0},n}(r),{TextInput:r,PasswordWatchInput:i}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/components/login_form",["jquery","external/security/cyfd","modules/core/html","modules/core/i18n","modules/core/notify","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/sso_login_checks","modules/core/browser"],function(e,t,n,o,i,r,s,a,c,u){var l,_;return _=o._,l=function(){function o(e,t,n){this.multi_login=t,this.variant=n,this._finish_login=__bind(this._finish_login,this),this._fill_two_factor_error=__bind(this._fill_two_factor_error,this),this._fill_login_error=__bind(this._fill_login_error,this),this._resend_code=__bind(this._resend_code,this),this._resend_code_success=__bind(this._resend_code_success,this),this._switch_from_twofactor_to_login_error=__bind(this._switch_from_twofactor_to_login_error,this),this._two_factor_success=__bind(this._two_factor_success,this),this._login_success=__bind(this._login_success,this),this._show_two_factor=__bind(this._show_two_factor,this),this._show_login=__bind(this._show_login,this),this._hide_sso=__bind(this._hide_sso,this),this._show_sso=__bind(this._show_sso,this),this._cyberfend_submit=__bind(this._cyberfend_submit,this),this._set_focus_to_password=__bind(this._set_focus_to_password,this),this.$login_form=e.find(".login-form"),this.$two_factor_form=e.find(".two-factor-form"),this.login_controller=new a(this.$login_form,this._cyberfend_submit,{should_submit_once:!0}),this.$captcha_component=new s(this.$login_form,"#react-login-recaptcha-challenge-div","#react-signup-recaptcha-challenge-div","/needs_captcha","login_email",this.variant),this.$login_form.on(a.SUCCESS_EVENT,this._login_success),this.$login_form.on(a.ERROR_EVENT,this.$captcha_component.captcha_display_handler),this.$login_form.is(":visible")&&this.$captcha_component.captcha_display_handler(),this.cont=this.$login_form.find("input[name='cont']").val(),this.two_factor_controller=new a(this.$two_factor_form,function(){return null},{should_submit_once:!0}),this.$two_factor_form.on(a.SUCCESS_EVENT,this._two_factor_success),this.$two_factor_form.find(".resend-two-factor-code").click(this._resend_code),this.$login_form.find(".sso-optout a").click(function(e){return function(){return e._hide_sso(!0)}}(this)),this.$login_form.find(".login-button").attr("disabled",!1),this._set_focus_to_password(),new c(this.$login_form.find("input[name='login_email']"),this._show_sso,this._hide_sso)}return o.LOGIN_SUCCESS="db:login:success",o.MULTI_LOGIN_SUCCESS="db:multilogin:success",o.prototype._set_focus_to_password=function(){if(this.$login_form.find("input[name='login_email']")[0].value)try{return this.$login_form.find("input[name='login_password']")[0].focus()}catch(e){}},o.prototype._cyberfend_submit=function(){return null!=t&&"function"==typeof t.cfsubmit?t.cfsubmit():void 0;

},o.prototype._show_sso=function(e){return this.$login_form.find("input[name='login_password']").val(""),this.$login_form.addClass("sso-required"),e?this.$login_form.addClass("sso-optional"):void 0},o.prototype._hide_sso=function(e){if(null==e&&(e=!1),this.$login_form.removeClass("sso-required sso-optional"),e)try{return this.$login_form.find("input[name='login_password']").focus()}catch(t){}},o.prototype._show_login=function(){return this.$two_factor_form.hide(),e(".login-register-header, .login-register-switch").show(),this.$login_form.show(),this.$login_form.find("input[name='login_password']").val("")},o.prototype._show_two_factor=function(){e(".login-register-header, .login-register-switch").hide(),this.$login_form.hide(),this.$two_factor_form.show();try{return this.$two_factor_form.find("input[name='code']").val("").focus()}catch(t){}},o.prototype._login_success=function(e,t){var o;switch(t.status){case"OK":return this._finish_login(t);case"TWOFACTOR":return t.last_four_digits?(this.$two_factor_form.addClass("hide-authenticator"),this.$two_factor_form.find(".last-four-digits").text(t.last_four_digits)):this.$two_factor_form.addClass("hide-sms"),this.$two_factor_form.find("input[name='remember_me']").val(t.remember_me),this._show_two_factor();case"TWOFACTOR_REQUIRED":return u.redirect(t.cont);case"SSO":return u.unsafeRedirect(t.sso_url);case"RATELIMIT":return this._fill_login_error(_("You've tried to log in too many times. Please try again in a few minutes."));case"ERROR":return o=t.html_response?new n(t.message):t.message,i.error(o);case"EXPIRED":return u.redirect(t.cont);default:return i.error()}},o.prototype._two_factor_success=function(e,t){switch(t.status){case"OK":return this._finish_login(t);case"EXPIRED":return this._switch_from_twofactor_to_login_error(t.message);case"REQUIRES_ROLE":return this._switch_from_twofactor_to_login_error(t.message);case"ERROR":return i.error(t.message);default:return i.error()}},o.prototype._switch_from_twofactor_to_login_error=function(e){return this.two_factor_controller._clear_pending(!0),this.login_controller._clear_pending(!0),this._show_login(),this._fill_login_error(e),this._set_focus_to_password()},o.prototype._resend_code_success=function(e){switch(e){case"OK":return i.success(_("We sent you another code. It may take a few minutes to arrive."));case"RATELIMIT":return this._fill_two_factor_error(_("You've tried to log in too many times. Please try again in a few minutes."));case"UNREACHABLE":return this._fill_two_factor_error(_("We couldn't reach your phone number. Are you sure it's correct?"));case"EXPIRED":return this._fill_two_factor_error(_("Sorry, your phone code has expired. Please log in again."));case"BADCARRIER":return this._fill_two_factor_error(_("Unfortunately, your carrier is not supported at this time."));case"INVALIDNUMBER":return this._fill_two_factor_error(_("That is not a valid phone number."));case"NOTAMOBILE":return this._fill_two_factor_error(_("That phone number does not appear to be a valid mobile number."));default:return i.error()}},o.prototype._resend_code=function(){return r.WebRequest({url:"/twofactor_resend",success:this._resend_code_success,error:function(){return i.error()}}),!1},o.prototype._fill_login_error=function(e){return a.fill_errors(this.$login_form,{login_email:{message_text:e}})},o.prototype._fill_two_factor_error=function(e){return a.fill_errors(this.$two_factor_form,{code:{message_text:e}})},o.prototype._finish_login=function(e){var t;return t=this.multi_login?o.MULTI_LOGIN_SUCCESS:o.LOGIN_SUCCESS,this.$login_form.trigger(t,e),this.cont?u.redirect(this.cont):void 0},o}(),__CONDITIONAL_JS__.LoginForm=l,l}),define("modules/clean/components/login_or_register",["jquery"],function(e){var t;return t=function(){function t(t){var n,o;n=t.find(".login-register-login-part"),o=t.find(".login-register-register-part"),t.click(function(){return function(t){return e(t.target).hasClass("login-register-switch-link")?(t.preventDefault(),n.toggle(),o.toggle(),n.find(".text-input input:visible").first().focus(),o.find(".text-input input:visible").first().focus()):void 0}}(this))}return t}()}),define("modules/clean/components/tabbable",["jquery"],function(e){var t;return t=function(){function t(){t.initialized||this.listen()}return t.initialized=!1,t.prototype.listen=function(){return t.initialized=!0,e(document).on("keydown",function(){return function(t){return 9===t.keyCode?e(document.body).addClass("tabbing"):void 0}}(this)),e(document).on("mousedown",function(){return function(){return e(document.body).removeClass("tabbing")}}(this))},t}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/components/tooltip",["jquery","modules/core/dom"],function(e,t){var n,o,i;return i=[],n=function(){function e(e,n){var o;this.$wrapper=e,this.prompt=this.$wrapper.find(".tooltip-prompt"),this.tooltip=this.$wrapper.find(".tooltip-tooltip"),this.hover_target=this.find_hover_target(),this.position_global=n,this.listen(),o=t.clone(this.tooltip).appendTo("body"),o.css({position:"static",display:"inline-block"}),this.tooltip.css({width:o.width(),position:"absolute",display:"none"}),o.remove(),this.position_global&&this.tooltip.remove().appendTo("body")}return e.prototype.tooltip_shown=!1,e.prototype.position_global=!1,e.prototype.listen=function(){var e,t,n,o,i;for(o=[this.hover_target,this.tooltip],i=[],t=0,n=o.length;n>t;t++)e=o[t],e.mouseenter(function(e){return function(){return clearTimeout(e.tooltip.data("timeout_id")),e.show_tooltip()}}(this)),i.push(e.mouseleave(function(e){return function(){var t;return t=setTimeout(function(){return e.hide_tooltip()},200),e.tooltip.data("timeout_id",t)}}(this)));return i},e.prototype.find_hover_target=function(){return this.prompt},e.prototype.show_tooltip=function(){var e,t,n,o;if(!this.tooltip_shown){for(e=this.position_global?this.hover_target.offset():this.hover_target.position(),n=0,o=i.length;o>n;n++)t=i[n],t.hide_tooltip();return i.push(this),this.tooltip.css("top",e.top-this.tooltip.outerHeight()/2+this.hover_target.outerHeight()/2),this.tooltip.css("left",e.left+this.hover_target.width()+2),this.tooltip.show(),this.tooltip.animate({left:"+=7"},50),this.tooltip_shown=!0}},e.prototype.hide_tooltip=function(){var e;if(this.tooltip_shown)return clearTimeout(this.tooltip.data("timeout_id")),this.tooltip.hide(),this.tooltip_shown=!1,e=i.indexOf(this),-1!==e?i.splice(e,1):void 0},e}(),o=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.find_hover_target=function(){return this.prompt.find(".sprite")},t}(n),{DBTooltip:n,InfoTooltip:o}}),define("modules/clean/contacts/bloodhound_contacts",["jquery","external/typeahead.bundle","modules/clean/contacts/cache","modules/clean/viewer"],function(e,t,n,o){var i,r,s;return s=n.DefaultContactsCache,i=function(){function t(t){null==t&&(t=10),this.limit=t,this.contacts=new Bloodhound({datumTokenizer:function(e){return[e.name,e.email,e.fname,e.lname].concat(e.name_tokens)},queryTokenizer:function(t){return[e.trim(t)]},limit:this.limit,sorter:this._contacts_sorter,local:[]}),this.contacts.initialize(),this.sortedContacts=[],o.get_viewer().is_signed_in&&s.load_contacts(!1,!1,function(e){return function(t){return e._init_contacts(t)}}(this))}return t.prototype._contacts_sorter=function(e,t){return e.priority>t.priority?-1:e.priority<t.priority?1:0},t.prototype._init_contacts=function(e){return this._update_contacts(e),s.register_for_updates("bloodhound_contacts",function(e){return function(t){return e._update_contacts(t)}}(this))},t.prototype._update_contacts=function(e){var t;return this.contacts.clear(),t=e.excludePairedUserDuplicates(),this.contacts.add(t.contacts),t.contacts.sort(function(e){return function(t,n){return e._contacts_sorter(t,n)}}(this)),this.sortedContacts=t.contacts.slice(0,this.limit)},t.prototype.get=function(e,t){return 0===e.trim().length?t(this.sortedContacts):this.contacts.get(e,function(){return function(e){return t(e)}}(this))},t}(),r=new i});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/cache",["modules/core/exception","modules/clean/ajax","modules/clean/contacts/list"],function(e,t,n){var o,i,r;return r=e.assert,o=function(){function e(){this._update_loading_state=__bind(this._update_loading_state,this),this._invoke_callbacks=__bind(this._invoke_callbacks,this),this._invoke_all_callbacks=__bind(this._invoke_all_callbacks,this),this.unregister_for_updates=__bind(this.unregister_for_updates,this),this.register_for_updates=__bind(this.register_for_updates,this),this.loading_state=e.HAVENT_LOADED,this.callbacks={},this.one_time_callbacks=[]}return e.HAVENT_LOADED=0,e.LOADING_NONE_AVAILABLE=1,e.LOADING_STALE_AVAILABLE=2,e.LOADED=3,e.prototype.is_loaded=function(){return this.loading_state===e.LOADED||this.loading_state===e.LOADING_STALE_AVAILABLE},e.prototype.load_contacts=function(o,i,r){var s;if(null!=r&&__indexOf.call(this.one_time_callbacks,r)<0&&this.one_time_callbacks.push(r),o){if(this.loading_state===e.LOADING_STALE_AVAILABLE)return}else{if(this.loading_state===e.LOADING_NONE_AVAILABLE)return;if(this.loading_state!==e.HAVENT_LOADED)return void this._invoke_all_callbacks()}return this._update_loading_state(this.loading_state===e.LOADED?e.LOADING_STALE_AVAILABLE:e.LOADING_NONE_AVAILABLE),s=function(e){return function(t,o){var i;return e._update_loading_state(o),i=n.create_contacts_list(t),e.precached_contacts=i.contacts,e.cached_contacts=i,e._invoke_all_callbacks()}}(this),this.loading_state===e.LOADING_NONE_AVAILABLE&&t.BackgroundRequest({url:"/get_cached_contacts",data:{include_rooms:i},success:function(t){return function(n){var o;return t.loading_state===e.LOADING_NONE_AVAILABLE&&(o=JSON.parse(n),o.length)?s(o,e.LOADING_STALE_AVAILABLE):void 0}}(this)}),t.BackgroundRequest({url:"/get_refreshed_contacts?long_running=1",data:{include_rooms:i},success:function(){return function(t){var n;return n=JSON.parse(t),s(n,e.LOADED)}}(this)})},e.prototype.register_for_updates=function(e,t){return this.callbacks[e]=t},e.prototype.unregister_for_updates=function(e){return __indexOf.call(Object.keys(this.callbacks),e)>=0?delete this.callbacks[e]:void 0},e.prototype._invoke_all_callbacks=function(){return this._invoke_callbacks(this.one_time_callbacks,!0),this._invoke_callbacks(this.callbacks,!1)},e.prototype._invoke_callbacks=function(e,t){var n,o,i,r,s;for(r=Object.keys(e),s=[],o=0,i=r.length;i>o;o++)n=r[o],e[n](this.cached_contacts),s.push(t?delete e[n]:void 0);return s},e.prototype._update_loading_state=function(t){return r(t===e.LOADING_NONE_AVAILABLE||t===e.LOADING_STALE_AVAILABLE||t===e.LOADED),this.loading_state=t},e}(),i=new o,{ContactsCache:o,DefaultContactsCache:i}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/contacts/data",["external/underscore","modules/core/exception","modules/clean/contacts/cache","modules/clean/contacts/types","modules/clean/fuzzy","modules/clean/viewer"],function(e,t,n,o,i,r){var s,a,c,u;return u=t.assert,c=n.DefaultContactsCache,s=function(){function e(e){this.type=e.type,this.name=e.name,this.email=e.email,this.fb_id=e.fb_id,this.group_id=e.group_id,this.members=e.members,this.group_avatar=e.group_avatar,this.avatar_url=e.avatar_url,this.invalid=e.invalid,this.on_team=e.on_team,this.nameMatch=e.nameMatch,this.emailMatch=e.emailMatch}return e.prototype.getKey=function(){var e;return this.type===o.FB?"contact-fb-"+this.fb_id:(e=this.type)===o.USER_GROUP||e===o.NEW_STYLE_GROUP?"contact-group-"+this.group_id:this.type===o.CAROUSEL_ROOM?"contact-room-"+this.members:"contact-email-"+this.email},e}(),a=function(){function t(e){var n;this.user=e.user,this.filterFunc=e.filterFunc,this._setContacts=__bind(this._setContacts,this),u(this.user,"must include user"),null==this.filterFunc&&(this.filterFunc=function(){return!0}),this._filteredContacts=[],this.user.is_team&&(this._teamContacts={}),this.instance=t.INSTANCE++,n="contacts-data-source:"+this.instance,c.register_for_updates(n,this._setContacts),c.load_contacts()}return t.INSTANCE=0,t.prototype.is_loaded=function(){return c.is_loaded()},t.prototype._setContacts=function(t){var n,o,i,s,a,c;if(this.user.is_team)for(this._teamContacts={},this._teamContacts[r.get_viewer().work_email]=1,o=t.sortByTeamFirst(),c=o.contacts,s=0,a=c.length;a>s;s++)n=c[s],n.team&&(this._teamContacts[n.email]=1);return i=t.includeForUser(this.user.id).contacts,this._filteredContacts=e.filter(i,this.filterFunc)},t.prototype.isTeamEmail=function(e){return this.user.is_team&&null!=this._teamContacts[e]},t.prototype.query=function(t,n){var r,a,c,u,l,_,d,p,h,f;for(c=[],f=this._filteredContacts,u=p=0,h=f.length;h>p;u=++p)d=f[u],a=i.match(t,d.email||""),l=i.match(t,d.name||""),(a||l)&&(_=d.type!==o.FB&&(d.type!==o.EMAIL||this.isTeamEmail(d.email)),c.push({contact:d,emailMatch:a,nameMatch:l,on_team:_,score:Math.max((null!=a?a.score:void 0)||0,(null!=l?l.score:void 0)||0),index:u}));return c.sort(function(e,t){var n;return n=t.score-e.score,n?n:e.index-t.index}),r=e.map(c,function(e){return d=e.contact,d.nameMatch=e.nameMatch,d.emailMatch=e.emailMatch,d.on_team=e.on_team,new s(d)}),n(r)},t}(),{Contact:s,ContactTypes:o,ContactsDataSource:a}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/contacts/facebook_modal",["modules/clean/dbmodal"],function(e){var t,n;return t=e.DBUserModal,n=function(e){function t(e,n,o){this.show_hidden_modal=n,this.link_with_facebook=o,this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this.on_hide=__bind(this.on_hide,this),t.__super__.constructor.call(this,e,{element_id:"facebook-confirm-modal-user-"+e.id})}return __extends(t,e),t.prototype.on_hide=function(){return"function"==typeof this.show_hidden_modal?this.show_hidden_modal():void 0},t.prototype.on_confirm_button_click=function(){return this.hide(),this.link_with_facebook()},t}(t)}),define("modules/clean/contacts/facebook_oauth",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/viewer"],function(e,t,n,o,i){var r,s;return s=t.assert,r={do_auth:function(e,t){var o;return s(null!=t,"user_id must be specified"),o=window.open(n({path:"/fb/access_token"}).updateQuery(Constants.UID_PARAM_NAME,t).toString(),"fb_auth","width=600,height=450"),e?r.onLoginSuccessCallback=e:void 0},post:function(e,t,a,c,u,l,_){return s(null!=_,"user_id must be specified!"),i.get_viewer().is_signed_in?("function"==typeof r.custom_show_posting&&r.custom_show_posting(),new o.WebRequest({url:"/fb/post",data:{message:e,link:t,link_name:a,description:c,from_referrals:r.from_referrals,from_getspace:r.from_getspace,picture:u?u:""},success:function(n,o,i){var s;return s=i.responseText,0===s.indexOf("ok")?"function"==typeof r.custom_show_complete?r.custom_show_complete():void 0:0===s.indexOf("auth")?r.do_auth(function(){return r.post(e,t,a,c,u,l,_)},_):void 0},error:function(){return"function"==typeof l?l():void 0},subject_user:_})):void window.open(n.parse("http://www.facebook.com/sharer.php").setQuery({u:t,t:a}).toString())}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/contacts/importer",["jquery","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri","modules/clean/ajax","modules/clean/analytics","modules/clean/contacts/cache","modules/clean/contacts/facebook_modal","modules/clean/contacts/facebook_oauth","modules/clean/profile_services/profile_services_constants","modules/clean/history","modules/clean/viewer"],function(e,t,n,o,i,r,s,a,c,u,l,_,d){var p,h,f,m,g;return m=t.assert,g=n._,f=s.SharedFolderActivityLogger,h=a.DefaultContactsCache,p=function(){function t(e,n,o,i){var s;return this.user=e,this.on_update_services=n,this.hide_containing_modal=o,this.show_containing_modal=i,this.update_contacts_to_import_from_email_address=__bind(this.update_contacts_to_import_from_email_address,this),this._get_content_tab_selector=__bind(this._get_content_tab_selector,this),this._finish_auth_failure=__bind(this._finish_auth_failure,this),this._finish_auth_success=__bind(this._finish_auth_success,this),this.yahoo_auth_complete=__bind(this.yahoo_auth_complete,this),this.facebook_auth_complete=__bind(this.facebook_auth_complete,this),this.google_auth_complete=__bind(this.google_auth_complete,this),this.auth_complete=__bind(this.auth_complete,this),this.deauth_import=__bind(this.deauth_import,this),this.auth_import=__bind(this.auth_import,this),this.has_connected_services=__bind(this.has_connected_services,this),this.has_unconnected_services=__bind(this.has_unconnected_services,this),this.paired_account_has_facebook=__bind(this.paired_account_has_facebook,this),m(null!=this.user,"invalid user"),s=function(){var e,t,n,o,i;for(e={},i=l.services(),n=0,o=i.length;o>n;n++)t=i[n],e[""+t]=!0;return e},this.contacts_to_import=l.NONE,this.connected_services=s(),this.suggestions_enabled=!1,this.photo_loaded_callback=null,this.photo_load_error=null,t.ever_updated||t.update_connection_state_from_server(),d.get_viewer().is_user_signed_in(this.user)&&r.WebRequest({url:"/contacts/get_importer_suggestions_pref",subject_user:this.user.id,success:function(e){return function(t,n,o){return e.suggestions_enabled=JSON.parse(o.responseText)}}(this)}),this}return t._USER_CACHE={},t.get_contacts_importer=function(e){var n,o,i;return null!=(null!=e?e.user:void 0)?i=e.user:null!=(null!=e?e.user_id:void 0)?i=d.get_viewer().get_user_by_id(e.user_id,n=!0):m(!1,"must pass a user= or user_id= in options"),null!=this._USER_CACHE[i.id]?(o=this._USER_CACHE[i.id],null!=(null!=e?e.on_update_services:void 0)&&(o.on_update_services=e.on_update_services),null!=(null!=e?e.hide_containing_modal:void 0)&&(o.hide_containing_modal=e.hide_containing_modal),null!=(null!=e?e.show_containing_modal:void 0)&&(o.show_containing_modal=e.show_containing_modal)):o=this._USER_CACHE[i.id]=new t(i,null!=e?e.on_update_services:void 0,null!=e?e.hide_containing_modal:void 0,null!=e?e.show_containing_modal:void 0),o},t.update_connection_state_from_server=function(){return this.ever_updated=!0,r.WebRequest({url:"/contacts/connected_services",success:function(e,n,o){var i,r,s,a,c;a=JSON.parse(o.responseText),c=[];for(s in a)i=a[s],r=t.get_contacts_importer({user_id:s}),r.connected_services=i,r.update_contacts_to_import_from_email_address(),c.push("function"==typeof r.on_update_services?r.on_update_services():void 0);return c}})},t.prototype.paired_account_has_facebook=function(){var e,n,o,i,r,s;for(s=d.get_viewer().get_users(e=!0),i=0,r=s.length;r>i;i++)if(o=s[i],o!==this.user&&(n=t.get_contacts_importer({user:o}),n.connected_services[l.FACEBOOK]))return!0;return!1},t.prototype.has_unconnected_services=function(){var e,t,n,o;e=!0,o=this.connected_services;for(t in o)n=o[t],e=e&&n;return!e},t.prototype.has_connected_services=function(){var e,t,n,o;e=!1,o=this.connected_services;for(t in o)n=o[t],e=e||n;return e},t.prototype.auth_import=function(e,t){var n,o;return null==t&&(t="none"),n=function(t){return function(){var n,o;switch(o=function(e,n){var o;return o={},o[Constants.UID_PARAM_NAME]=t.user.id,window.open(String(i.parse(e).setQuery(o)),n,"width=600,height=450")},e){case l.GOOGLE:o("/google/authentry","google_auth");break;case l.YAHOO:o("/yahoo/authentry","yahoo_auth");break;case l.FACEBOOK:o("/fb/access_token","fb_auth");break;default:m(!1,"Should never get here.  Input should be an ProfileServicesConstants.")}return n={service:l.logging_identifiers(e)},f.log("web","import_contacts_from_service",t.user,n),"function"==typeof t.on_open_auth_popup?t.on_open_auth_popup():void 0}}(this),this.paired_account_has_facebook()&&e===l.FACEBOOK?("function"==typeof this.hide_containing_modal&&this.hide_containing_modal(),o=new c(this.user,this.show_containing_modal,n),o.show()):n()},t.prototype.deauth_import=function(t,n){var i;switch(i=this._get_content_tab_selector(),t){case l.GOOGLE:return r.WebRequest({url:"/google/remove_contacts",subject_user:this.user.id,data:{source_id:n},success:function(){return e(""+i+" .auth-gmail").show(),e(""+i+" .deauth-gmail").hide(),o.success(g("Successfully removed Gmail contacts"))},error:function(){return o.error(g("We were unable to remove your Gmail contacts"))}});case l.YAHOO:return r.WebRequest({url:"/yahoo/remove_contacts",subject_user:this.user.id,success:function(){return e(""+i+" .auth-yahoo-mail").show(),e(""+i+" .deauth-yahoo-mail").hide(),o.success(g("Successfully removed Yahoo! Mail contacts."))},error:function(){return o.error(g("We were unable to remove your Yahoo! Mail contacts."))}});default:return m(!1,"Should never get here.  Input should be an ProfileServicesConstants.")}},t.prototype.auth_complete=function(e,t,n,o){var i;return null==o&&(o=null),i={},i[l.GOOGLE]=this.google_auth_complete,i[l.YAHOO]=this.yahoo_auth_complete,i[l.FACEBOOK]=this.facebook_auth_complete,"function"==typeof i[e]?i[e](t,n,o):void 0},t.prototype.google_auth_complete=function(e,t,n){var o;return null==n&&(n=null),o={service:l.logging_identifiers(l.GOOGLE),success:e,error:t},f.log("web","import_contacts_auth_completed",this.user,o),e?this._finish_auth_success(l.GOOGLE,g("Imported Gmail contacts.")):this._finish_auth_failure(l.GOOGLE,t||g("We need your permission to import your Gmail contacts."))},t.prototype.facebook_auth_complete=function(e,t){var n;return n={service:l.logging_identifiers(l.FACEBOOK),success:e,error:t},f.log("web","import_contacts_auth_completed",this.user,n),e?(u.authed_user_id=this.user.id,null!=u.onLoginSuccessCallback&&(u.onLoginSuccessCallback(),u.onLoginSuccessCallback=null),this._finish_auth_success(l.FACEBOOK,g("Successfully connected to Facebook."))):this._finish_auth_failure(l.FACEBOOK,t||g("We need your permission to import your Facebook friends."))},t.prototype.yahoo_auth_complete=function(e,t){var n;return n={service:l.logging_identifiers(l.YAHOO),success:e,error:t},f.log("web","import_contacts_auth_completed",this.user,n),e?this._finish_auth_success(l.YAHOO,g("Imported Yahoo! Mail contacts.")):this._finish_auth_failure(l.YAHOO,t||g("We need your permission to import your Yahoo! Mail contacts."))},t.prototype._finish_auth_success=function(n,i){var s,a;switch(n){case l.GOOGLE:_.get_url().startsWith("/account")&&(a=this._get_content_tab_selector(),r.WebRequest({url:"/google/display_email",subject_user:this.user.id,dataType:"json",success:function(){return function(t){var n;return n=t.gmail_address,e(""+a+" .gmail-address").text(n)}}(this),error:function(){return function(){return e(""+a+" .gmail-address").text(g("Connected"))}}(this),complete:function(){return function(){return e(""+a+" .auth-gmail").hide(),e(""+a+" .deauth-gmail").show()}}(this)}));break;case l.FACEBOOK:0===_.get_url().indexOf("/account")&&(a=this._get_content_tab_selector(),r.WebRequest({url:"/fb/get_fb_profile",subject_user:this.user.id,dataType:"json",success:function(){return function(t){var n,o;return n=t,o=n.username?n.username:'"'+n.name+'"',e(""+a+" .facebook-username").text(o)}}(this),error:function(){return function(){return e(""+a+" .facebook-username").text(g("Connected"))}}(this),complete:function(){return function(){return e(".auth-facebook").show(),e(""+a+" .auth-facebook").hide(),e(".deauth-facebook").hide(),e(""+a+" .deauth-facebook").show()}}(this)}));break;case l.YAHOO:a=this._get_content_tab_selector(),e(""+a+" .auth-yahoo-mail").hide(),e(""+a+" .deauth-yahoo-mail").show()}return n===this.contacts_to_import&&(this.contacts_to_import=l.VARIOUS),this.connected_services[n]=!0,t.update_connection_state_from_server(),h.load_contacts(s=!0),o.success(i),"function"==typeof this.on_update_services&&this.on_update_services(),"function"==typeof this.on_auth_success?this.on_auth_success(n):void 0},t.prototype._finish_auth_failure=function(e,t){return o.error(t),"function"==typeof this.on_auth_failure?this.on_auth_failure(e):void 0},t.prototype._get_content_tab_selector=function(){return d.get_viewer().is_paired?"#"+this.user.role+"-content":""},t.prototype.update_contacts_to_import_from_email_address=function(){var e,t,n;return e=/@(.+?)\./g,t=e.exec(this.user.email),t&&t.length>1?this.contacts_to_import="gmail"!==t[1]||this.connected_services[l.GOOGLE]?"yahoo"!==(n=t[1])&&"ymail"!==n&&"rocketmail"!==n||this.connected_services[l.YAHOO]?l.VARIOUS:l.YAHOO:l.GOOGLE:void 0},t}(),INLINE_JS.ContactsImporter=p,p});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/list",["jquery","modules/clean/em_string","modules/clean/contacts/types"],function(e,t,n){var o;return o=function(){function e(e){var t;this.contacts=e,this._lowercaseContact=__bind(this._lowercaseContact,this),this._excludeType=__bind(this._excludeType,this),this.sortByTeamFirst=__bind(this.sortByTeamFirst,this),this.excludeNonTeamActive=__bind(this.excludeNonTeamActive,this),this.excludeNonTeam=__bind(this.excludeNonTeam,this),this.excludePairedUserDuplicates=__bind(this.excludePairedUserDuplicates,this),this.excludeTeamMembers=__bind(this.excludeTeamMembers,this),this.excludeRooms=__bind(this.excludeRooms,this),this.excludeFacebook=__bind(this.excludeFacebook,this),this.excludeNewStyleGroups=__bind(this.excludeNewStyleGroups,this),this.excludeGroups=__bind(this.excludeGroups,this),this.excludeMe=__bind(this.excludeMe,this),this.excludeByEmail=__bind(this.excludeByEmail,this),this.includeForViewer=__bind(this.includeForViewer,this),this.includeForUser=__bind(this.includeForUser,this),this.slice=__bind(this.slice,this),this.length=__bind(this.length,this),this.filterContacts=__bind(this.filterContacts,this),this.lcontacts=function(){var e,n,o,i;for(o=this.contacts,i=[],e=0,n=o.length;n>e;e++)t=o[e],i.push(this._lowercaseContact(t));return i}.call(this)}return e._format_contact_array=function(e){var n,o,i,r;for(n=22,i=0,r=e.length;r>i;i++)o=e[i],null!=o.email&&(o.email_snippet=t.em_snippet(o.email,n)),null!=o.name&&(o.name=t.em_snippet(o.name,n));return e},e.create_contacts_list=function(t){return t=e._format_contact_array(t),new e(t)},e.prototype.filterContacts=function(t){var n;return n=this.contacts.filter(t),new e(n)},e.prototype.length=function(){return this.contacts.length},e.prototype.slice=function(t,n){return new e(this.contacts.slice(t,n))},e.prototype.includeForUser=function(e){return this.filterContacts(function(t){return t.owning_user_id===e})},e.prototype.includeForViewer=function(e){var t;return t=e.get_user_ids(),this.filterContacts(function(e){var n;return n=e.owning_user_id,__indexOf.call(t,n)>=0})},e.prototype.excludeByEmail=function(e){var t,n;return n=[function(){var n,o,i;for(i=[],n=0,o=e.length;o>n;n++)t=e[n],i.push(t.toLowerCase());return i}()],this.filterContacts(function(){return function(e){var t;return t=e.email.toLowerCase(),!(__indexOf.call(n,t)>=0)}}(this))},e.prototype.excludeMe=function(){return this.filterContacts(function(e){return!e.is_owner})},e.prototype.excludeGroups=function(){return this._excludeType(n.USER_GROUP)},e.prototype.excludeNewStyleGroups=function(){return this._excludeType(n.NEW_STYLE_GROUP)},e.prototype.excludeFacebook=function(){return this._excludeType(n.FB)},e.prototype.excludeRooms=function(){return this._excludeType(n.CAROUSEL_ROOM)},e.prototype.excludeTeamMembers=function(){return this.filterContacts(function(e){return!e.team})},e.prototype.excludePairedUserDuplicates=function(){return this.filterContacts(function(e){return!e.paired_user_duplicate})},e.prototype.excludeNonTeam=function(){return this.filterContacts(function(e){return e.team})},e.prototype.excludeNonTeamActive=function(){return this.filterContacts(function(e){return e.team&&"active"===e.join_state})},e.prototype.sortByTeamFirst=function(){var t,o,i,r,s,a;for(i=[],o=[],a=this.contacts,r=0,s=a.length;s>r;r++)t=a[r],t.team||t.type===n.USER_GROUP?i.push(t):o.push(t);return new e(i.concat(o))},e.prototype._excludeType=function(e){return this.filterContacts(function(t){return t.type!==e})},e.prototype._lowercaseContact=function(e){var t,n,o;n={};for(t in e)o=e[t],("string"==typeof o||o instanceof String)&&(o=o.toLowerCase()),n[t]=o;return n},e}()}),define("modules/clean/contacts/tokenizer",["external/react","modules/core/i18n","modules/clean/contacts/data","modules/clean/contacts/typeahead","modules/clean/contacts/types","modules/clean/react/sprite","modules/clean/tokenizer"],function(e,t,n,o,i,r,s){var a,c,u,l,_,d,p,h,f,m,g,v;return v=t._,a=n.Contact,l=n.ContactsDataSource,p=o.ContactsTypeaheadSelector,h=s.Tokenizer,f=e.DOM,c={invalid:"invalid",warn:"warn",pending:"pending",ok:"ok"},_=e.createClass({propTypes:{customClass:e.PropTypes.string,contact:e.PropTypes.object.isRequired,hoverMsg:e.PropTypes.string,onRemove:e.PropTypes.func,tokenState:e.PropTypes.oneOf(function(){var e;e=[];for(m in c)g=c[m],e.push(g);return e}()).isRequired},render:function(){var t,n;return n={"tokenizer-token":!0,"contact-token":!0,invalid:this.props.tokenState===c.invalid,warned:this.props.tokenState===c.warn,pending:this.props.tokenState===c.pending,"title-bubble-component":null!=this.props.hoverMsg,north:null!=this.props.hoverMsg},n[this.props.customClass]=null!=this.props.customClass,t=e.addons.classSet(n),this.transferPropsTo(f.a({className:t,"data-title":this.props.hoverMsg,tabIndex:-1},this._renderInput(),this._renderIcon(),this._renderText(),this._makeCloseButton()))},_getTokenName:function(){switch(this.props.contact.type){case i.FB:return"fb_ids";case i.EMAIL:return"emails";case i.USER_GROUP:return"group_ids";case i.NEW_STYLE_GROUP:return"new_style_group_ids";case i.CAROUSEL_ROOM:return"carousel_rooms";default:return"invalids"}},_getTokenValue:function(){switch(this.props.contact.type){case i.FB:return this.props.contact.fb_id;case i.USER_GROUP:return this.props.contact.group_id;case i.NEW_STYLE_GROUP:return this.props.contact.group_id;case i.CAROUSEL_ROOM:return this.props.contact.members;default:return this.props.contact.email}},_renderIcon:function(){switch(this.props.contact.type){case i.FB:return f.img({src:"/static/images/icons/fb_16-vflbiYTkC.png"});case i.EMAIL:return f.img({src:"/static/images/icons/email_16-vflcFyDTl.png"});case i.USER_GROUP:return r({group:"groups",name:"group"});case i.NEW_STYLE_GROUP:return r({group:"groups",name:"group"});case i.CAROUSEL_ROOM:return f.img({src:"/static/images/carousel/icon-57px-vfluuaZ5j.png"});default:return""}},_renderInput:function(){return f.input({type:"hidden",name:this._getTokenName(),value:this._getTokenValue()})},_renderText:function(){return this.props.contact.name||this.props.contact.email},_makeCloseButton:function(){return this.props.onRemove?f.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(e.props.contact),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),u={basic:function(e){var t;return t=!1,{state:e.invalid?c.invalid:c.ok,msg:t?e.email:null}},warn:function(e){return{state:e.on_team?c.ok:e.invalid?c.invalid:c.warn,msg:null}},forbid:function(e){return{state:e.on_team?c.ok:c.invalid,msg:null}}},d=e.createClass({displayName:"ContactsTokenizer",propTypes:{user:e.PropTypes.object.isRequired,customClass:e.PropTypes.string,customContactFilter:e.PropTypes.func,customContactValidator:e.PropTypes.func,importer:e.PropTypes.object,onContentsChange:e.PropTypes.func,placeholder:e.PropTypes.string,populatedInputData:e.PropTypes.shape({tokens:e.PropTypes.array,
value:e.PropTypes.string})},getDefaultProps:function(){return{customContactFilter:function(){return!0},customContactValidator:u.basic,placeholder:v("Invite more people"),populatedInputData:{tokens:[],value:""}}},render:function(){return new h({ref:"tokenizer",dataSource:new l({user:this.props.user,filterFunc:this.props.customContactFilter}),customClass:this.props.customClass,initialInputText:this.props.populatedInputData.value,placeholderText:this.props.placeholder,renderSelector:function(e){return function(){return p({contactImporter:e.props.importer})}}(this),renderInput:function(){return f.textarea({className:"contacts-tokenizer-input",rows:1})},renderToken:this._renderToken,onContentsChange:this.props.onContentsChange,stringTokenizer:this.tokenizeEmails,populatedTokenData:this.props.populatedInputData.tokens},this.props.children)},_renderToken:function(e){var t;return t=this.props.customContactValidator(e),new _({contact:e,tokenState:t.state,hoverMsg:t.msg})},tokenizeEmails:function(e,t){var n,o,r,s,c,u,l,_,d,p,h;for(null==t&&(t=!1),n=/[,|;\n]+/,o=/[,|;\n ]+/,r=/^['&A-Z0-9._%+-]+@[A-Z0-9.-]+\.[A-Z]{2,15}$/i,c=e.split(o),l=2===c.length&&r.test(c[0])&&""===c[1]?c:e.split(n),d="",t||(d=l.pop()),_=[],p=0,h=l.length;h>p;p++)u=l[p],s=u.trim(),""!==s&&_.push(new a({name:s,email:s,type:i.EMAIL,invalid:!r.test(s),on_team:this.refs.tokenizer.props.dataSource.isTeamEmail(s)}));return{tokens:_,value:d}},serializeInputData:function(){return this.refs.tokenizer.serializeInputData()},getContacts:function(){var e,t,n,o;return o=this.serializeInputData(),t=o.tokens,n=o.value,e=this.tokenizeEmails(n,!0),t.concat(e.tokens)},tokenizeAll:function(){return this.refs.tokenizer.tokenizeAll()}}),{ContactsTokenizer:d,ContactTokenValidator:u,ContactTokenState:c}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/contacts/typeahead",["jquery","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/contacts/importer","modules/clean/profile_services/profile_services_constants","modules/clean/contacts/types","modules/clean/react/sprite","modules/clean/typeahead"],function(e,t,n,o,i,r,s,a,c,u,l,_){var d,p,h,f,m,g,v,y,b,w,E,T,S,C;return E=o.assert,C=i._,v=s.SharedFolderActivityLogger,w=_.TypeaheadSelectorMixin,T=t.DOM,S=function(t,n){return e.extend({},t,n)},p=S(w,{getOptions:function(){var e,t,n,o;return null==this.props.queryOptions?[]:this.state.importsExpanded?function(){var e,t,o,i;for(o=c.contact_services(),i=[],e=0,t=o.length;t>e;e++)n=o[e],i.push(new y({provider:n,connected:this.props.contactImporter.connected_services[n]}));return i}.call(this):(e=this.props.maxVisible||this.props.queryOptions.length,t=this.props.queryOptions.slice(0,e),(null!=(o=this.props.contactImporter)?o.has_unconnected_services():void 0)&&t.push(new f),t)},renderOption:function(e){return e instanceof f?m():e instanceof y?b({"import":e}):this.props.renderQueryOption(e)},onSelect:function(e){var t,n;return e instanceof f?this.setState({importsExpanded:!0,selectionIndex:0}):e instanceof y?(E((n=e.provider,__indexOf.call(c.contact_services(),n)>=0),"invalid party contact provider "+e.provider),this.props.contactImporter.connected_services[e.provider]?(t=C("You're already connected to %(service_name)s").format({service_name:c.to_name(e.provider)}),void r.success(t)):(this.reset(),this.props.contactImporter.auth_import(e.provider))):this.props.onSelect(e)},reset:function(){return this.setState({importsExpanded:!1,selectionIndex:0})}}),d=t.createClass({mixins:[p],propTypes:{contactImporter:t.PropTypes.object,customClass:t.PropTypes.string,maxVisible:t.PropTypes.number,onClose:t.PropTypes.func.isRequired,onSelect:t.PropTypes.func.isRequired,queryOptions:t.PropTypes.array,renderQueryOption:t.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onSelect:function(){},renderQueryOption:function(e){return h({contact:e})}}},render:function(){var e;return this.getOptions().length?(e={"typeahead-selector":!0,"contacts-selector":!0},e[this.props.customClass]=null!=this.props.customClass,T.ul({className:t.addons.classSet(e)},this.renderOptions())):T.div({})}}),h=t.createClass({propTypes:{contact:t.PropTypes.object.isRequired,customClass:t.PropTypes.string},render:function(){var e;return e={"contacts-typeahead-option":!0},e[this.props.customClass]=null!=this.props.customClass,this.transferPropsTo(T.li({className:t.addons.classSet(e)},T.div({className:"option-left"},this._renderIcon()),T.div({className:"option-right"},T.div({className:"option-primary"},this._renderPrimary()),T.div({className:"option-secondary"},this._renderSecondary()))))},_renderPrimary:function(){return this._renderMatch(this.props.contact.name,this.props.contact.nameMatch)},_renderSecondary:function(){switch(this.props.contact.type){case u.EMAIL:return this.props.contact.email===this.props.contact.name?"":this._renderMatch(this.props.contact.email,this.props.contact.emailMatch);case u.FB:return C("Facebook message");case u.USER_GROUP:return this.props.contact.members;case u.NEW_STYLE_GROUP:return this.props.contact.members;default:return""}},_renderMatch:function(e,t){var n,o,i,r,s,a,c,u,l;if(!t)return e;for(i=0,s=[],u=t.highlighted,a=0,c=u.length;c>a;a++)l=u[a],o=l[0],r=l[1],o>i&&s.push(e.slice(i,o)),n=e.slice(o,o+r),s.push(T.strong({key:"highlight-"+n+"-"+o},n)),i=o+r;return i<e.length&&s.push(e.slice(i)),s},_renderIcon:function(){var e,t,n;switch(e=this.props.contact,t="contact-icon",e.type){case u.EMAIL:return T.img({src:"/static/images/icons/mail28-vflHfHPJ0.png",className:t});case u.FB:return T.img({src:"https://graph.facebook.com/"+e.fb_id+"/picture",className:t});case u.USER_GROUP:return e.group_avatar;case u.NEW_STYLE_GROUP:return g({text:e.name});case u.CAROUSEL_ROOM:return n=e.avatar_url||"/static/images/carousel/icon-57px-vfluuaZ5j.png",T.img({src:n,className:t});default:return""}}}),g=t.createClass({propTypes:{text:t.PropTypes.string},INITIAL_HASH:5381,render:function(){var e;return e={},e["background-color"]="hsl("+this._calculateHue()+", 70%, 30%)",T.span({className:"avatar-icon",style:e},this._getInitials())},_getInitials:function(){return n.map(this.props.text.split(" "),function(e){return e.charAt(0).toUpperCase()}).splice(0,2).join("")},_calculateHue:function(){var e,t,n;for(n=0,t=this.INITIAL_HASH,e=this.props.text;n<e.length;)t=e.charCodeAt(n)+((t<<6)+(t<<16)-t),n++;return Math.abs(t)%360}}),f=function(){function e(){}return e.prototype.getKey=function(){return"expand-importer"},e}(),m=t.createClass({render:function(){return this.transferPropsTo(T.li({className:"expand-imports-option"},T.div({className:"option-left"},l({group:"web",name:"user_add"})),T.div({className:"option-right"},T.div({className:"option-primary"},C("Import contacts")))))}}),y=function(){function e(e){this.provider=e.provider,this.connected=e.connected}return e.prototype.getKey=function(){return"third-party-import"+this.provider},e}(),b=t.createClass({propTypes:{"import":t.PropTypes.object.isRequired},render:function(){var e,t,n,o;return o=this.props["import"],n=o.provider,e=o.connected,t=e?C("Connected"):"",this.transferPropsTo(T.li({className:"third-party-option"},T.div({className:"option-left"},T.img({src:c.to_img(n)})),T.div({className:"option-right"},T.div({className:"option-primary"},c.to_name(n)),T.div({className:"option-secondary"},t))))}}),{ContactsTypeaheadSelector:d,ContactsTypeaheadSelectorOption:h,ExpandImportOption:m,ThirdPartyImportOption:b}}),define("modules/clean/contacts/types",[],function(){var e;return e={EMAIL:0,FB:1,INVALID:2,USER_GROUP:3,NEW_STYLE_GROUP:4,CAROUSEL_ROOM:5}}),define("modules/clean/datetime",["modules/core/exception","modules/core/i18n"],function(e,t){var n,o,i,r,s,a,c,u,l,_,d,p,h,f;return i=e.assert,f=t._,h=t.ungettext,_=[f("January"),f("February"),f("March"),f("April"),f("May"),f("June"),f("July"),f("August"),f("September"),f("October"),f("November"),f("December")],n=[f("Jan"),f("Feb"),f("Mar"),f("Apr"),f("May"),f("Jun"),f("Jul"),f("Aug"),f("Sep"),f("Oct"),f("Nov"),f("Dec")],l=function(e,t){return t?n[e]:_[e]},s=function(e,t){var n;return n=[f("AM"),f("PM")],t.replace(/'[^']*'|y+|M+|d+|h+|k+|K+|H+|m+|s+|S+|a+/g,function(t){var o;switch(t[0]){case"'":return 2===t.length?"'":t.slice(1,-1);case"y":if("yy"===t)return e.getYear()%100;o=e.getFullYear();break;case"M":if(t.length>=3)return l(e.getMonth(),3===t.length);o=e.getMonth()+1;break;case"d":o=e.getDate();break;case"h":o=e.getHours()%12||12;break;case"k":o=e.getHours()%12+1;break;case"K":o=e.getHours()%12;break;case"H":o=e.getHours();break;case"m":o=e.getMinutes();break;case"s":o=e.getSeconds();break;case"S":o=e.getMilliseconds();break;case"a":return n[1*(e.getHours()>=12)]}return o=""+o,o.length<t.length&&(o=("00000000"+o).slice(-1*t.length)),o})},a=function(e){var t,n,o,r,s,a,c;for(r=[86400,3600,60,1],e=isNaN(e)?0:e,t=a=0,c=r.length;c>a;t=++a)if(o=r[t],e>=o){s=parseInt(e/o,10)||0;break}return 1>e&&(s=0),t>=3?n=h("%d sec","%d secs",s).format(s):2===t?n=h("%d min","%d mins",s).format(s):1===t?n=h("%d hour","%d hours",s).format(s):0===t?n=h("%d day","%d days",s).format(s):i(!1,"Invalid time"),n},u=function(e,t){return f("%(month)s %(year)s",{comment:"Like Jun 2012"}).format({month:l(e,!0),year:t})},d=function(e,t,n,o){var i,r,s,a;return null==n&&(n=!1),null==o&&(o=!1),n?(i=e.getUTCDate(),r=e.getUTCMonth(),a=e.getUTCFullYear()):(i=e.getDate(),r=e.getMonth(),a=e.getFullYear()),s=l(r,!o),t?f("%(month)s %(date)s, %(year)s",{comment:"Like Jan 15, 2014"}).format({month:s,date:i,year:a}):f("%(month)s %(date)s",{comment:"Like Jan 15"}).format({month:s,date:i})},o=function(e,t){var n,o,i,r,s,a,c,u;return null==t&&(t=!1),s=new Date(Date.now()),a=(s.getTime()-e.getTime())/1e3,60>a?f("Just now"):3600>a?(i=parseInt(a/60,10),h("%d min ago","%d mins ago",i).format(i)):86400>a?(o=parseInt(a/3600,10),h("%d hour ago","%d hours ago",o).format(o)):2592e3>a?(n=parseInt(a/86400,10),h("%d day ago","%d days ago",n).format(n)):4838400>a?(c=parseInt(a/604800,10),h("%d week ago","%d weeks ago",c).format(c)):31536e3>a?(r=parseInt(a/2592e3,10),h("%d month ago","%d months ago",r).format(r)):(u=parseInt(a/31536e3,10),h("%d year ago","%d years ago",u).format(u))},c=function(e,t,n,o,i,r){return null==t&&(t=0),null==n&&(n=0),null==o&&(o=0),null==i&&(i=0),null==r&&(r=0),e.setFullYear(e.getFullYear()+t),e.setMonth(e.getMonth()+n),e.setDate(e.getDate()+o),e.setHours(e.getHours()+i),e.setMinutes(e.getMinutes()+r),e},p=function(){return(new Date).getTime()},r={abbr_month_names:n,ago:o,format_date:s,format_time:a,increment_date:c,month_abbr_with_year:u,month_name:l,month_names:_,nice_date_with_month_name:d,time:p}}),define("modules/clean/db_bubble",["jquery","modules/core/exception"],function(e,t){var n,o;return o=t.assert,n={position:function(t,n,i){var r,s,a,c,u,l,_;for(t=e(t).css({bottom:"auto",left:"auto",position:"absolute",right:"auto",top:"auto"}),o(t.find(".db-arrow").length,"db-arrow not found"),r=t.find(".db-arrow-border"),o(r.length,"db-arrow-border not found"),c=null,_=["top","right","bottom","left"],u=0,l=_.length;l>u;u++)if(a=_[u],t.hasClass("db-"+a+"-arrow")){c=a;break}return o(c,"No db-#{direction}-arrow class set"),"left"===c?s="left+"+r.outerWidth()+"px top-"+r.position().top+"px":"right"===c?s="right-"+r.outerWidth()+"px top-"+r.position().top+"px":"top"===c?s="left-"+r.position().left+"px top+"+r.outerHeight()+"px":"bottom"===c&&(s="left-"+r.position().left+"px bottom-"+r.outerHeight()+"px"),i||(i={top:"bottom",left:"right",bottom:"top",right:"left"}[c]),t.position({my:s,at:i,of:n,collision:"none"})}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/dbmodal",["jquery","external/jquery_ui","external/keymaster","modules/core/browser","modules/core/dom","modules/core/exception","modules/clean/viewer"],function(e,t,n,o,i,r){var s,a,c,u;return u=r.assert,a=function(){function t(){}return t.__stack=[],t.CLEAR="dbmodal:clear",t.pop=function(n){var o;return null==n&&(n=null),null!=n?t.remove(n):n=t.__stack.pop(),null!=n&&n._hide(),o=t.top(),null!=o?o._show():e(document).trigger(t.CLEAR)},t.push=function(e){var n;return u(e instanceof s,"must pass in valid DBModal"),t.remove(e),n=t.top(),(null!=n?n.visible:void 0)&&n._hide(),t.__stack.push(e),e._show()},t.top=function(){var e;return e=t.__stack.length,e?t.__stack[e-1]:null},t.remove=function(e){var n,o,i,r,s;for(o=[],s=t.__stack,i=0,r=s.length;r>i;i++)n=s[i],n!==e&&o.push(n);t.__stack=o},t.clear=function(){var n,o,i,r;for(n=i=r=t.__stack.length-1;i>=0;n=i+=-1)o=t.__stack[n],o.visible&&o._hide();return e(document).trigger(t.CLEAR),t.__stack=[]},t.register=function(n,o){return e(document).on(n,o),e(document).on(t.CLEAR,function(){return e(document).off(n,o)})},t.unregister=function(t,n){return e(document).off(t,n)},t.trigger=function(t,n){return e(document).trigger(t,n)},t}(),s=function(){function t(e){var n;this.options=e,this.set_title=__bind(this.set_title,this),this._hide=__bind(this._hide,this),this.resize=__bind(this.resize,this),this._show=__bind(this._show,this),this.hide=__bind(this.hide,this),this.show=__bind(this.show,this),this.__focus=__bind(this.__focus,this),this.__unlisten=__bind(this.__unlisten,this),this.__listen_buttons=__bind(this.__listen_buttons,this),this.__listen=__bind(this.__listen,this),this.__overlay_click_handler=__bind(this.__overlay_click_handler,this),this.__fix_position=__bind(this.__fix_position,this),this.__keydown_handler=__bind(this.__keydown_handler,this),this.__tabbable_elements=__bind(this.__tabbable_elements,this),this.__x_click_handler=__bind(this.__x_click_handler,this),this.__show_modal=__bind(this.__show_modal,this),this.__clone_modal=__bind(this.__clone_modal,this),this.format=__bind(this.format,this),this.on_cancel_button_click=__bind(this.on_cancel_button_click,this),this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this.before_show=__bind(this.before_show,this),this.element_id=t.add_role_to_id(this.options.element_id,this.options.role),this.$template=t.get_template(this.options.element_id),n=this.$template.find(".db-modal"),u(this.$template.length,"Missing DBModal pyxl element for '"+this.element_id+"'"),this.options.focus&&("confirm"===this.options.focus?u(n.find(".confirm-button").length,"DBModal pyxl element is missing a confirm button to focus"):"cancel"===this.options.focus?u(n.find(".cancel-button").length,"DBModal pyxl element is missing a cancel button to focus"):u(n.find(this.options.focus).length,"DBModal pyxl element is missing focus element with selector '"+this.options.focus+"'")),null!=this.on_show&&u("function"==typeof this.on_show,"'on_show' must be a function"),null!=this.before_show&&u("function"==typeof this.before_show,"'before_show' must be a function"),null!=this.on_hide&&u("function"==typeof this.on_hide,"'on_hide' must be a function"),null!=this.on_confirm_button_click&&u("function"==typeof this.on_confirm_button_click,"'on_confirm_button_click' must be a function"),null!=this.on_cancel_button_click&&u("function"==typeof this.on_cancel_button_click,"'on_cancel_button_click' must be a function"),this.options.vars&&(this.vars=this.options.vars),this.click_out_to_close=!0,this.options.click_out_to_close===!1&&(this.click_out_to_close=!1),this.prev_key_scope=null,this.vertical_offset=90}return t.KEY_SCOPE="dbmodal",t.__stack=[],t.get_containing_modal=function(e){var n,o;return o=e.closest(".db-modal-wrapper"),n=i.controller(o),n&&u(n instanceof t,"controller of .db-modal-wrapper must be a DBModal object"),n},t.prototype.before_show=function(){return null!=this.options.title?this.set_title(this.options.title):void 0},t.prototype.on_confirm_button_click=function(e){return e.preventDefault(),a.pop()},t.prototype.on_cancel_button_click=function(e){return e.preventDefault(),a.pop()},t.prototype.on_show=null,t.prototype.on_hide=null,t.prototype.format=function(e){var t,n;for(t in e)__hasProp.call(e,t)&&(n=e[t],this.$modal_window.find(t).text(n));return this},t.prototype.__clone_modal=function(){return this.$modal_window||(this.options.preloaded?(this.$modal_window=e("#"+this.element_id),this.$modal_window.removeClass("db-modal-wrapper--preloaded")):this.$modal_window=i.clone(this.$template).attr("id",this.element_id),this.$overlay=this.$modal_window.find(".db-modal-overlay")),i.set_controller(this.$modal_window,this),i.bind_controllers(this.$modal_window),this.options.preloaded?void 0:e("body").prepend(this.$modal_window)},t.prototype.__show_modal=function(){return this.$modal_window.show(),this.__fix_position()},t.prototype.__x_click_handler=function(e){return e.preventDefault(),a.clear()},t.prototype.__tabbable_elements=function(){var t,n,o,i,r,s,a,c,l,_;if(a=this.$modal_window.find(".db-modal").find(":tabbable"),u(a.length,'"dbmodal-x" should be in tabbable_elms'),c=function(){var t,n,i;for(i=[],t=0,n=a.length;n>t;t++)o=a[t],parseInt(e(o).attr("tabindex"))>-1&&i.push(o);return i}(),c.length){for(s=function(t,n){var o,i;return o=parseInt(e(t).attr("tabindex"),10),i=parseInt(e(n).attr("tabindex"),10),i>o?-1:o>i?1:0},c.sort(s),i=-1,l=0,_=c.length;_>l;l++)o=c[l],r=a.index(o),-1===i&&(i=r),a.splice(r,1);u(i>-1,"First index should be set"),n=a.slice(0,i),t=a.slice(i),a=e.merge(n,c),a=e.merge(a,t)}return a},t.prototype.__keydown_handler=function(t){var n,o,r,s;if((27===t.keyCode||8===t.keyCode&&!i.focus_in_input())&&(t.preventDefault(),a.clear()),9===t.keyCode){if(t.preventDefault(),n=this.__tabbable_elements(),o=n.index(e(t.target)),0>o)return this.focus_element?e(this.focus_element).focus():(s=t.shiftKey?n.last():n.first(),s.focus());if(o>-1)return r=t.shiftKey?-1:1,s=(o+r)%n.length,n.get(s).focus()}},t.prototype.__fix_position=function(){var e,t;return e=this.$modal_window.find(".db-modal"),t=e.width(),e.css({margin:"0 0 0 "+Math.floor(-t/2).toString()+"px",position:"fixed",top:this.vertical_offset})},t.prototype.__overlay_click_handler=function(e){return e.preventDefault(),a.clear()},t.prototype.__listen=function(){return this.click_out_to_close!==!1&&this.$overlay.on("click",this.__overlay_click_handler),this.$db_modal_x=this.$modal_window.find(".db-modal-x"),this.$db_modal_x.on("click",this.__x_click_handler),e(document).on("keydown",this.__keydown_handler),this.__listen_buttons()},t.prototype.__listen_buttons=function(){return null!=this.on_confirm_button_click&&(this.$confirm_button=this.$modal_window.find(".confirm-button"),this.$confirm_button.on("click",this.on_confirm_button_click)),null!=this.on_cancel_button_click?(this.$cancel_button=this.$modal_window.find(".cancel-button"),this.$cancel_button.on("click",this.on_cancel_button_click)):void 0},t.prototype.__unlisten=function(){return this.click_out_to_close!==!1&&this.$overlay.off("click"),this.$db_modal_x.off("click"),e(document).off("keydown",this.__keydown_handler),null!=this.on_confirm_button_click&&this.$confirm_button.off("click"),null!=this.on_cancel_button_click?this.$cancel_button.off("click"):void 0},t.prototype.__focus=function(){var e,t,n,i;return t=this.$modal_window.find(".db-modal"),"confirm"===this.options.focus?this.focus_element=t.find(".confirm-button").first():"cancel"===this.options.focus?this.focus_element=t.find(".cancel-button").first():this.options.focus?this.focus_element=t.find(this.options.focus).first():(this.focus_element=t,e=t.find("input[type=text], input[type=email]").first(),e.length?this.focus_element=e:o.msie||(n=t.find("input[type=button]").first(),n.length&&(this.focus_element=n),i=t.find("input[type=submit]").first(),i.length&&(this.focus_element=i))),this.focus_element.focus()},t.add_role_to_id=function(e,t){return t?""+e+"-"+t:e},t.get_template=function(n,o){var i;return i=t.add_role_to_id(n,o),e("#db-modal-"+i)},t.prototype.show=function(){return a.push(this)},t.prototype.hide=function(){return this!==a.top()?(a.remove(this),this._hide()):a.pop()},t.prototype._show=function(){return this.visible?void 0:(this.__clone_modal(),"function"==typeof this.before_show&&this.before_show(this.$modal_window),this.__show_modal(),this.resize(),this.__listen(),this.visible=!0,window.key.getScope()!==this.constructor.KEY_SCOPE&&(this.prev_key_scope=window.key.getScope()),window.key.setScope(this.constructor.KEY_SCOPE),e(document).trigger("modalOpened",[1]),i.scroll_lock_document(),"function"==typeof this.on_show&&this.on_show(),this.__focus(),this)},t.prototype.resize=function(){var t,n;return t=e(window).height()-130-this.vertical_offset,this.$modal_window.find(".db-modal-content").css(this.$modal_window.find(".db-modal").height()>t?{"max-height":t+"px","overflow-y":"auto"}:{"max-height":"","overflow-y":""}),this.options.restrict_width?(n=e(window).width()-60,this.$modal_window.find(".db-modal-content").css(this.$modal_window.find(".db-modal").width()>n?{"max-width":n+"px","overflow-x":"auto"}:{"max-width":"","overflow-x":""})):void 0},t.prototype._hide=function(){return this.visible?(this.__unlisten(),window.key.setScope(this.prev_key_scope),this.$modal_window.remove(),this.visible=!1,this.prev_key_scope=null,e(document).trigger("modalClosed",[1]),i.scroll_unlock_document(),"function"==typeof this.on_hide&&this.on_hide(),this):void 0},t.prototype.set_title=function(e){return this.$modal_window.find(".db-modal-title-text").text(e),this},t}(),c=function(t){function n(e,t){this.user=e,this.__inject_basic_user_properties=__bind(this.__inject_basic_user_properties,this),this.before_show=__bind(this.before_show,this),n.__super__.constructor.call(this,t)}return __extends(n,t),n.prototype.before_show=function(e){return n.__super__.before_show.call(this,e),this.__inject_basic_user_properties(e)},n.prototype.__inject_basic_user_properties=function(t){var n,o;return n=t.find("form"),n.find("input[name='"+Constants.UID_PARAM_NAME+"']").remove(),o=e('<input type="hidden">').attr({name:Constants.UID_PARAM_NAME,value:this.user.id}),n.append(o),t.find(".dbmodal-email-placeholder").text(this.user.email)},n}(s),__CONDITIONAL_JS__.DBModalStack=INLINE_JS.DBModalStack=a,INLINE_JS.DBModal=s,{DBModalStack:a,DBModal:s,DBUserModal:c}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/dbmodal_loading",["modules/clean/dbmodal","modules/clean/uirequest"],function(e,t){var n;return n=function(e){function n(e){n.__super__.constructor.call(this,e)}return __extends(n,e),n.prototype.on_show=function(){return this.fetch()},n.prototype.fetch=function(){return new t(this.$modal_window,this.options.endpoint_url,{data:this.options.parameters||{},subject_user:this.options.subject_user,html_in_error_msg:this.options.html_in_error_msg,success:function(e){return function(){return e.resize()}}(this),error:function(e){return function(){return e.hide()}}(this)})},n.prototype.on_confirm_button_click=null,n.prototype.on_cancel_button_click=null,n}(e.DBModal)}),define("modules/clean/display_format",["modules/core/i18n"],function(e){var t,n,o;return o=e._,n=function(t,n){var i,r,s;return null==n&&(n=2),t=parseFloat(t),i=Math.abs(t),1024>i?(n=0,r=t,s=e.ungettext("byte","bytes",t)):921600>i?(r=t/1024,s=o("KB")):943718400>i?(r=t/1048576,s=o("MB")):966367641600>i||0===n&&1099511627776>t?(r=t/1073741824,s=o("GB")):(r=t/1099511627776,s=o("TB")),r=Math.round(r*Math.pow(10,n))/parseFloat(Math.pow(10,n)),r=r.toFixed(n),""+r+" "+s},t={format_bytes:n}}),define("modules/clean/dropbox_nav",["jquery","modules/clean/analytics","modules/clean/photos/photos_engagement_logger"],function(e,t,n){var o;return o=function(){function o(){e(".carousel-nav-item").click(function(e){return function(){return e.log_click("carousel_nav_link_click")}}(this)),e(".composer-nav-item").click(function(e){return function(){return e.log_click("composer_nav_link_click")}}(this)),e(".mailbox-nav-item").click(function(e){return function(){return e.log_click("mailbox_nav_link_click")}}(this)),e(".carousel-nav-item").click(function(){return n.log_and_send(n.CAROUSEL_NAV_LINK_CLICK)}),e(".photos-nav-item").click(function(){return n.log_and_send(n.PHOTOS_NAV_LINK_CLICK)})}return o.prototype.log_click=function(e){return t.WebMiscActivityLogger.log(e)},o}()}),define("modules/clean/em_string",[],function(){var e;return e=function(){function e(t){return this instanceof e?(this.s=t,this.info=this.widthInfo(),void(this.length=t.length?this.info[this.s.length-1]:0)):new e(t)}return e.em_snippet=function(t,n,o){return null==n&&(n=50),null==o&&(o=.75),new e(t.toString()).snippet(n,o).toString()},e.prototype.widthInfo=function(){var e,t,n,o;for(t={},t[-1]=0,e=n=0,o=this.s.length;o>=0?o>n:n>o;e=o>=0?++n:--n)t[e]=t[e-1]+this.ems(this.s.charAt(e));return t},e.prototype.findSpot=function(e){var t,n,o,i;if(!e)return 0;for(i=0,n=this.s.length;n>=i;)if(o=Math.floor(i/2+n/2),t=this.info[o-1],t>e)n=o-1;else{if(!(e>t))return o;i=o+1}return i>o?i:o},e.prototype.ems=function(t){var n,o,i,r,s;return o=.65,n=1.08,i=.58,r=t.charCodeAt(0),s=e.CODEPOINT_TO_WIDTH[r],s?s/Math.pow(10,e.ACCURACY):r>=768&&879>=r?0:r>=65377&&65500>=r?i:r>=11904&&40911>=r||r>=44032&&55215>=r||r>=4352&&4607>=r||r>=63744&&64255>=r||r>=65280&&65535>=r||r>=131072&&196607>=r?n:o},e.prototype.substr=function(t,n){var o,i;return i=this.findSpot(t),null!=n?(o=this.findSpot(t+n),new e(this.s.substr(i,o-i))):new e(this.s.substr(i))},e.prototype.toString=function(){return this.s},e.prototype.snippet=function(t,n){var o,i,r,s,a;return null==t&&(t=50),null==n&&(n=.75),this.length<=t?this:(t-=e._ELLIPSIS_LENGTH,o=t*n,s=t-o,a=this.length-s,r=this.substr(0,o),i=this.substr(a),new e(r.toString()+"…"+i.toString()))},e.ACCURACY=2,e.CODEPOINT_TO_WIDTH={32:38,33:25,34:42,35:67,36:58,37:92,38:75,39:25,40:33,41:33,42:58,43:58,44:25,45:33,46:25,47:42,48:58,49:58,50:58,51:58,52:58,53:58,54:58,55:58,56:58,57:58,58:25,59:25,60:58,61:58,62:58,63:50,64:100,65:67,66:67,67:67,68:75,69:58,70:58,71:75,72:83,73:33,74:25,75:67,76:58,77:100,78:83,79:83,80:67,81:83,82:67,83:58,84:58,85:75,86:67,87:100,88:67,89:58,90:58,91:33,92:42,93:33,94:58,95:50,96:67,97:58,98:67,99:50,100:67,101:58,102:33,103:58,104:67,105:25,106:25,107:58,108:25,109:100,110:67,111:67,112:67,113:67,114:42,115:50,116:42,117:67,118:58,119:83,120:58,121:58,122:50,123:42,124:58,125:42,126:58,161:25,162:58,163:58,164:58,165:58,166:58,167:58,168:67,169:92,170:42,171:50,172:58,174:92,175:58,176:50,177:58,178:42,179:42,180:67,181:67,182:75,183:25,184:25,185:42,186:42,187:50,188:83,189:83,190:83,191:50,192:67,193:67,194:67,195:67,196:67,197:67,198:92,199:67,200:58,201:58,202:58,203:58,204:33,205:33,206:33,207:33,208:75,209:83,210:83,211:83,212:83,213:83,214:83,215:58,216:83,217:75,218:75,219:75,220:75,221:58,222:67,223:67,224:58,225:58,226:58,227:58,228:58,229:58,230:92,231:50,232:58,233:58,234:58,235:58,236:25,237:25,238:25,239:25,240:67,241:67,242:67,243:67,244:67,245:67,246:67,247:58,248:67,249:67,250:67,251:67,252:67,253:58,254:67,255:58,256:75,257:67,258:75,259:67,260:75,261:67,262:75,263:58,264:75,265:58,266:75,267:58,268:75,269:58,270:83,271:83,272:83,273:75,274:67,275:67,276:67,277:67,278:67,279:67,280:67,281:67,282:67,283:67,284:83,285:75,286:83,287:75,288:83,289:75,290:83,291:75,292:83,293:75,294:92,295:75,296:33,297:33,298:33,299:33,300:33,301:33,302:33,303:33,304:33,305:25,306:67,307:67,308:42,309:33,310:75,311:67,312:67,313:58,314:33,315:58,316:33,317:58,318:42,319:58,320:50,321:67,322:42,323:83,324:75,325:83,326:75,327:83,328:75,329:83,330:83,331:75,332:92,333:67,334:92,335:67,336:92,337:67,338:100,339:100,340:75,341:50,342:75,343:50,344:75,345:50,346:67,347:58,348:67,349:58,350:67,351:58,352:67,353:58,354:75,355:42,356:75,357:42,358:75,359:42,360:83,361:75,362:83,363:75,364:83,365:75,366:83,367:75,368:83,369:75,370:83,371:75,372:100,373:92,374:75,375:58,376:75,377:67,378:67,379:67,380:67,381:67,382:67,383:42,384:75,385:83,386:67,387:75,388:75,389:67,390:75,391:83,392:58,393:83,394:100,395:67,396:75,397:67,398:67,399:75,400:58,401:58,402:75,403:83,404:75,405:100,406:50,407:50,408:75,409:67,410:50,411:67,412:117,413:83,414:75,415:92,416:92,417:75,418:117,419:100,420:75,421:75,422:75,423:67,424:58,425:67,426:58,427:42,428:75,429:42,430:75,431:83,432:75,433:92,434:83,435:75,436:75,437:67,438:67,439:67,440:67,441:58,442:58,443:75,444:75,445:58,446:50,447:67,448:33,449:50,450:50,451:33,452:142,453:142,454:133,455:100,456:92,457:67,458:117,459:117,460:100,461:75,462:67,463:33,464:33,465:92,466:67,467:83,468:75,469:83,470:75,471:83,472:75,473:83,474:75,475:83,476:75,477:67,478:75,479:67,480:75,481:67,482:100,483:100,484:92,485:75,486:83,487:75,488:75,489:67,490:92,491:67,492:92,493:67,494:67,495:58,496:33,497:142,498:142,499:133,500:83,501:75,502:117,503:67,504:83,505:75,506:75,507:67,508:100,509:100,510:92,511:67,512:75,513:67,514:75,515:67,516:67,517:67,518:67,519:67,520:33,521:33,522:33,523:33,524:92,525:67,526:92,527:67,528:75,529:50,530:75,531:50,532:83,533:75,534:83,535:75,536:67,537:58,538:75,539:42,540:58,541:58,542:83,543:75,544:83,545:100,546:92,547:67,548:67,549:67,550:75,551:67,552:67,553:67,554:92,555:67,556:92,557:67,558:92,559:67,560:92,561:67,562:75,563:58,564:67,565:100,566:67,567:33,568:100,569:100,570:75,571:75,572:58,573:58,574:67,575:58,576:58,577:67,578:50,579:75,580:75,581:75,582:75,583:58,584:58,585:25,586:83,587:58,588:75,589:33,590:75,591:58,880:67,881:50,882:67,883:50,884:33,885:33,886:75,887:67,888:108,889:108,890:67,891:58,892:58,893:58,894:42,895:108,896:108,897:108,898:108,899:108,900:67,901:67,902:75,903:42,904:83,905:100,906:58,907:108,908:100,909:108,910:100,911:100,912:42,913:75,914:67,915:58,916:83,917:67,918:67,919:83,920:92,921:33,922:75,923:75,924:100,925:83,926:75,927:92,928:83,929:67,930:108,931:67,932:75,933:75,934:83,935:75,936:83,937:92,938:33,939:75,940:83,941:58,942:75,943:42,944:67,945:83,946:67,947:67,948:67,949:58,950:75,951:75,952:67,953:42,954:67,955:67,956:75,957:67,958:67,959:67,960:92,961:67,962:67,963:75,964:67,965:67,966:92,967:67,968:92,969:100,970:42,971:67,972:67,973:67,974:100,975:108,976:58,977:75,978:75,979:100,980:75,981:92,982:100,983:67,984:92,985:67,986:75,987:58,988:58,989:58,990:67,991:58,992:75,993:92,994:100,995:92,996:75,997:58,998:75,999:58,1e3:75,1001:75,1002:67,1003:67,1004:83,1005:58,1006:50,1007:42,1008:67,1009:67,1010:58,1011:33,1012:92,1013:58,1014:58,1015:67,1016:67,1017:75,1018:100,1019:83,1020:58,1021:75,1022:75,1023:75,1024:67,1025:67,1026:92,1027:58,1028:75,1029:67,1030:33,1031:33,1032:42,1033:108,1034:108,1035:83,1036:75,1037:83,1038:75,1039:83,1040:75,1041:67,1042:67,1043:58,1044:83,1045:67,1046:92,1047:67,1048:83,1049:83,1050:75,1051:83,1052:100,1053:83,1054:92,1055:83,1056:67,1057:75,1058:75,1059:75,1060:83,1061:75,1062:83,1063:75,1064:108,1065:108,1066:75,1067:92,1068:67,1069:75,1070:108,1071:75,1072:67,1073:67,1074:58,1075:58,1076:75,1077:67,1078:83,1079:58,1080:75,1081:75,1082:67,1083:67,1084:83,1085:75,1086:67,1087:75,1088:75,1089:58,1090:58,1091:58,1092:92,1093:67,1094:75,1095:58,1096:92,1097:100,1098:67,1099:83,1100:58,1101:58,1102:92,1103:58,1104:67,1105:67,1106:75,1107:58,1108:58,1109:58,1110:33,1111:33,1112:42,1113:92,1114:92,1115:75,1116:67,1117:75,1118:58,1119:75,1120:100,1121:75,1122:75,1123:67,1124:83,1125:83,1126:75,1127:67,1128:100,1129:92,1130:92,1131:83,1132:117,1133:108,1134:67,1135:67,1136:83,1137:83,1138:92,1139:67,1140:83,1141:67,1142:83,1143:67,1144:133,1145:125,1146:92,1147:67,1148:100,1149:75,1150:100,1151:75,1152:75,1153:58,1154:75,1155:0,1156:0,1157:0,1158:0,1159:108,1160:0,1161:0,1162:83,1163:75,1164:67,1165:58,1166:67,1167:75,1168:58,1169:58,1170:67,1171:58,1172:75,1173:67,1174:100,1175:92,1176:67,1177:58,1178:75,1179:67,1180:83,1181:75,1182:75,1183:67,1184:83,1185:75,1186:83,1187:75,1188:100,1189:83,
1190:117,1191:100,1192:92,1193:75,1194:75,1195:58,1196:75,1197:58,1198:75,1199:58,1200:75,1201:58,1202:75,1203:75,1204:100,1205:83,1206:75,1207:67,1208:75,1209:67,1210:75,1211:58,1212:92,1213:75,1214:92,1215:75,1216:33,1217:92,1218:83,1219:75,1220:67,1221:83,1222:67,1223:83,1224:75,1225:83,1226:75,1227:75,1228:58,1229:100,1230:83,1231:25,1232:75,1233:67,1234:75,1235:67,1236:100,1237:100,1238:67,1239:67,1240:75,1241:67,1242:75,1243:67,1244:92,1245:83,1246:67,1247:58,1248:67,1249:58,1250:83,1251:75,1252:83,1253:75,1254:92,1255:67,1256:92,1257:67,1258:92,1259:67,1260:75,1261:58,1262:75,1263:58,1264:75,1265:58,1266:75,1267:58,1268:75,1269:58,1270:58,1271:42,1272:92,1273:83,1274:58,1275:42,1276:75,1277:58,1278:75,1279:58,2026:67,19977:108,65403:58},e._ELLIPSIS_LENGTH=new e("…").length,e}()}),define("modules/clean/event_load",["jquery"],function(){var e,t,n;return e=function(e){return window.setTimeout(function(){return e.apply(e)},0)},n=function(t){return"complete"===document.readyState?e(t):null!=window.attachEvent?window.attachEvent("onload",t):null!=window.addEventListener?window.addEventListener("load",t,!1):void 0},t={window_load:n}}),define("modules/clean/filepath",["modules/core/i18n"],function(e){var t,n,o,i,r,s,a,c,u,l,_;return _=e._,u=function(e){return e?("/"!==e.charAt(0)&&(e="/"+e),"/"===e.charAt(e.length-1)?e.substr(0,e.length-1):e):""},a=function(e,t){return e=u(e),e=e.split("/"),a=e.pop(),""===a?t||_("Dropbox"):a},c=function(e){return-1===e.indexOf(".")?e:e.split(".").slice(0,-1).join(".")},i=function(e){return e.split(".").pop()},r=function(e){return-1===e.indexOf(".")?"":i(e).toLowerCase()},t={_other:"page_white",log:"page_white",msg:"page_white",sln:"page_white",vcproj:"page_white",txt:"page_white_text",wps:"page_white_text",doc:"page_white_word",docx:"page_white_word",docm:"page_white_word",rtf:"page_white_word",pages:"page_white_word",wpd:"page_white_word",odt:"page_white_word",pdf:"page_white_acrobat",xls:"page_white_excel",xlsm:"page_white_excel",xlsx:"page_white_excel",xlsb:"page_white_excel",ods:"page_white_excel",ppt:"page_white_powerpoint",pptx:"page_white_powerpoint",pptm:"page_white_powerpoint",pps:"page_white_powerpoint",ppsx:"page_white_powerpoint",ppsm:"page_white_powerpoint",odp:"page_white_powerpoint",key:"page_white_keynote",css:"page_white_code",html:"page_white_code",htm:"page_white_code",xml:"page_white_code",php:"page_white_code",c:"page_white_code",h:"page_white_code",rb:"page_white_code",cpp:"page_white_code",java:"page_white_code",js:"page_white_code",json:"page_white_code",cs:"page_white_code",py:"page_white_code",exe:"page_white_gear",dll:"page_white_gear",app:"page_white_gear",mp3:"page_white_sound",m3u:"page_white_sound",wav:"page_white_sound",m4a:"page_white_sound",wma:"page_white_sound",aif:"page_white_sound",iff:"page_white_sound",mid:"page_white_sound",mpa:"page_white_sound",ra:"page_white_sound",aiff:"page_white_sound",amr:"page_white_sound",ogg:"page_white_sound",gif:"page_white_picture",png:"page_white_picture",jpg:"page_white_picture",jpeg:"page_white_picture",tiff:"page_white_picture",tif:"page_white_picture",bmp:"page_white_picture",odg:"page_white_picture",ari:"page_white_picture",arw:"page_white_picture",srf:"page_white_picture",sr2:"page_white_picture",bay:"page_white_picture",crw:"page_white_picture",cr2:"page_white_picture",cap:"page_white_picture",eip:"page_white_picture",dcs:"page_white_picture",dcr:"page_white_picture",drf:"page_white_picture",k25:"page_white_picture",kdc:"page_white_picture",dng:"page_white_picture",erf:"page_white_picture",fff:"page_white_picture",iiq:"page_white_picture",mef:"page_white_picture",mos:"page_white_picture",mrw:"page_white_picture",nef:"page_white_picture",nrw:"page_white_picture",orf:"page_white_picture",pef:"page_white_picture",ptx:"page_white_picture",pxn:"page_white_picture",r3d:"page_white_picture",raf:"page_white_picture",rw2:"page_white_picture",raw:"page_white_picture",rwl:"page_white_picture",rwz:"page_white_picture",obm:"page_white_picture",srw:"page_white_picture",x3f:"page_white_picture",avi:"page_white_film",mov:"page_white_film",mp4:"page_white_film",mkv:"page_white_film",wmv:"page_white_film",mpg:"page_white_film",m4v:"page_white_film",vob:"page_white_film",ogv:"page_white_film",gz:"page_white_compressed",tar:"page_white_compressed",rar:"page_white_compressed",zip:"page_white_compressed",tgz:"page_white_compressed",bz2:"page_white_compressed",iso:"page_white_dvd",dmg:"page_white_dvd",ai:"ai",psd:"page_white_paint",au:"page_white_sound",fla:"fla",swf:"fla"},o=function(e){return t[e]||"page_white"},s=function(e){var t;return t=i(e).toLowerCase(),o(t)},l=function(e){var t;return t=e.split("/").slice(0,-1).join("/"),t||"/"},n={filename:a,file_extension:i,filename_without_extension:c,file_extension_for_logging:r,file_icon:s,extension_icon:o,normalize:u,parent_dir:l}}),define("modules/clean/form",["jquery","modules/core/exception","modules/core/notify","modules/clean/ajax"],function(e,t,n,o){var i,r;return r=t.assert,i={submit:function(e,t,r,s){return o.FormWebRequest({url:e.attr("action"),data:this.collect_data(e),success:function(e,n,o){var s,a,c;return c=i.parse_response(o.responseText),a=c[0],s=c[1],a?t(s):r(s)},error:function(){return r(n.DEFAULT_ERROR)},complete:s})},collect_data:function(t){var n,o,i,r,s,a,c;for(n={},c=t.find("input, select, textarea"),s=0,a=c.length;a>s;s++)if(o=c[s],i=e(o).attr("name")){if("checkbox"===e(o).attr("type"))r=e(o).prop("checked")?"True":"";else if("radio"===e(o).attr("type")){if(!e(o).prop("checked"))continue;r=e(o).val()}else r=e(o).val();i in n?("string"==typeof n[i]&&(n[i]=[n[i]]),n[i].push(r)):n[i]=r}return n},parse_response:function(e){var t,o,i;if(0!==e.indexOf("err:"))return[!0,e];t=e.substr(4);try{return o=JSON.parse(t),[!1,o]}catch(r){return i=r,[!1,t||n.DEFAULT_ERROR]}},parse_error:function(e){var t,o;if("string"==typeof e)return[!0,e];if("object"==typeof e)for(o in e)if(t=e[o],"message_text"in t)return[!0,t.message_text];return[!1,n.DEFAULT_ERROR]}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/frame_messenger",["jquery"],function(e){var t;return t=function(){function t(){this.handleUntrustedMessage=__bind(this.handleUntrustedMessage,this),Object.defineProperty(this,"trustedParentOriginForPosting",{get:function(){return this._trustedParentOriginForPosting}}),Object.defineProperty(this,"trustedChildOriginForPosting",{get:function(){var t,n,o,i;if(null!=this._trustedChildOriginForPosting)return this._trustedChildOriginForPosting;for(t=e(this._childIframeQuery),o=0,i=t.length;i>o&&(n=t[o],!this._validateChildOriginForPosting(n.src));o++);return this._trustedChildOriginForPosting}})}return t._ALLOWED_CHILD_ORIGINS=["https://www.dropboxstatic.com","https://cf.dropboxstatic.com","https://www.dropbox.com","https://block-dbdev.dev.corp.dropbox.com","https://meta-dbdev.dev.corp.dropbox.com","https://dl-doc.dropbox.com","https://dl-web.dropbox.com"],t._ALLOWED_PARENT_ORIGINS=["https://www.dropbox.com","https://meta-dbdev.dev.corp.dropbox.com"],t._REQUEST_PARENT_ORIGIN_POLL_DELAY=100,t.prototype._childIframeQuery=null,t.prototype._trustedChildOriginForPosting=null,t.prototype._trustedParentOriginForPosting=null,t.prototype._validActionsFromChild=[],t.prototype._validActionsFromParent=[],t.prototype._trustedMessageFromChildHandler=null,t.prototype._trustedMessageFromParentHandler=null,t.prototype._parentMessageQueue=[],t.prototype._requestParentOriginPollRetry=null,t.prototype._onParentReady=null,t.prototype.resetOriginsForPosting=function(){return this._trustedChildOriginForPosting=null,this._trustedParentOriginForPosting=null},t.prototype.configureChildMessaging=function(e,t,n){return this._childIframeQuery=e,this._trustedChildOriginForPosting=null,this._validActionsFromChild=n,this._trustedMessageFromChildHandler=t},t.prototype.configureParentMessaging=function(e,t,n){return null==n&&(n=null),this._trustedParentOriginForPosting=null,this._validActionsFromParent=t,this._trustedMessageFromParentHandler=e,this._onParentReady=n},t.prototype.startListening=function(){return window.addEventListener("message",this.handleUntrustedMessage),null!=this._validActionsFromParent&&this._validActionsFromParent.length>0&&null!=this._trustedMessageFromParentHandler&&this._requestParentOrigin(),null!=this._validActionsFromChild&&this._validActionsFromChild.length>0&&null!=this._trustedMessageFromChildHandler?this.postMessageToChildren("parent-ready"):void 0},t.prototype.stopListening=function(){return window.removeEventListener("message",this.handleUntrustedMessage)},t.prototype._getOriginFromUrl=function(e){var t;return t=document.createElement("a"),t.href=e,"https://"+t.hostname},t.prototype._isChildOriginAllowed=function(e){return __indexOf.call(this.constructor._ALLOWED_CHILD_ORIGINS,e)>=0},t.prototype._isParentOriginAllowed=function(e){return __indexOf.call(this.constructor._ALLOWED_PARENT_ORIGINS,e)>=0},t.prototype._validateChildOriginForPosting=function(e){var t;return t=this._getOriginFromUrl(e),this._isChildOriginAllowed(t)?(this._trustedChildOriginForPosting=t,!0):(console.warn("Untrusted message from child blocked: "+e),!1)},t.prototype.childIsValidated=function(){return null!=this._trustedChildOriginForPosting},t.prototype._validateParentOriginForPosting=function(e){var t,n,o,i,r,s,a;if(i=this._trustedParentOriginForPosting,o=this._getOriginFromUrl(e),!this._isParentOriginAllowed(o))return console.warn("Untrusted message from parent blocked: "+e),!1;if(this._trustedParentOriginForPosting=o,this._parentMessageQueue.length>0){for(a=this._parentMessageQueue,r=0,s=a.length;s>r;r++)t=a[r],n=JSON.parse(t),this.postMessageToParent(n.action,n.parameters);this._parentMessageQueue=[]}return null!=this._trustedParentOriginForPosting&&null==i&&null!=this._onParentReady&&this._onParentReady(),!0},t.prototype.handleUntrustedMessage=function(e){var t,n,o,i;if(!this._isChildOriginAllowed(e.origin)&&!this._isParentOriginAllowed(e.origin))return void console.warn("Messsage received not in parent or child origin whitelist: "+e.origin);try{n=JSON.parse(e.data)}catch(r){return void(t=r)}if(null!=n.action)return"child-requesting-parent-origin"===n.action?void(this._validateChildOriginForPosting(e.origin)&&this.postMessageToChildren("parent-ready")):"parent-ready"===n.action?void this._validateParentOriginForPosting(e.origin):(o=n.action,__indexOf.call(this._validActionsFromChild,o)>=0&&this._validateChildOriginForPosting(e.origin)&&null!=this._trustedMessageFromChildHandler?void this._trustedMessageFromChildHandler(n):(i=n.action,void(__indexOf.call(this._validActionsFromParent,i)>=0&&this._validateParentOriginForPosting(e.origin)&&null!=this._trustedMessageFromParentHandler&&this._trustedMessageFromParentHandler(n))))},t.prototype._packagePostMessage=function(e,t){var n,o;return o=this.trustedChildOriginForPosting,n={action:e,parameters:t},JSON.stringify(n)},t.prototype.postMessageToChildElements=function(e,t,n){var o,i,r,s,a;if(null==n&&(n={}),null!=this.trustedChildOriginForPosting){for(i=this._packagePostMessage(t,n),a=[],r=0,s=e.length;s>r;r++)o=e[r],a.push(o.contentWindow.postMessage(i,this.trustedChildOriginForPosting));return a}},t.prototype.postMessageToChildren=function(t,n,o){var i;return null==n&&(n={}),null==o&&(o=null),null==o&&(o=this._childIframeQuery),i=e(o),this.postMessageToChildElements(i,t,n)},t.prototype.postMessageToParent=function(e,t){var n;return null==t&&(t={}),n=this._packagePostMessage(e,t),null==this.trustedParentOriginForPosting?void this._parentMessageQueue.push(n):window.parent.postMessage(n,this.trustedParentOriginForPosting)},t.prototype._requestParentOrigin=function(){var t;return window.parent.postMessage('{"action": "child-requesting-parent-origin"}',"*"),t=function(){return this._requestParentOriginPollRetry=null,null==this._trustedParentOriginForPosting?this._requestParentOrigin():void 0},setTimeout(e.proxy(t,this),this._REQUEST_PARENT_ORIGIN_POLL_DELAY)},t}()}),define("modules/clean/fuzzy",["external/underscore"],function(e){var t;return t={simpleFilter:function(e,n){return n.filter(function(n){return t.test(e,n)})},test:function(e,n){return null!==t.match(e,n)},match:function(e,t,n){var o,i,r,s,a,c,u,l,_,d,p,h,f,m;for(n=n||{},_=0,f=[],l=t.length,m=0,c=0,p=n.pre||"",d=n.post||"",r=n.caseSensitive&&t||t.toLowerCase(),o=void 0,i=void 0,e=n.caseSensitive&&e||e.toLowerCase(),u=0,h=[],s=0,a=0;l>u;)o=t[u],r[u]===e[_]?(o=p+o+d,a?a+=1:(s=u,a=1),_+=1,c+=1+c):(c=0,a&&(h.push([s,a]),a=0)),m+=c,f[f.length]=o,u++;return a&&h.push([s,a]),_===e.length?{highlighted:h,rendered:f.join(""),score:m}:null},filter:function(t,n,o){var i,r;return null==o&&(o={}),r=[],i=this._reduce.bind(this,t,o),e.reduce(n,i,r).sort(this._sort)},_reduce:function(e,n,o,i,r){var s,a;return a=i,n.extract&&(a=n.extract(i)),s=t.match(e,a,n),null!=s&&o.push({string:s.rendered,score:s.score,index:r,original:i}),o},_sort:function(e,t){var n;return n=t.score-e.score,n?n:e.index-t.index}}}),define("modules/clean/hi_res",["jquery"],function(e){var t;return t=function(){function t(e){var t;this.constructor._show_hi_res()&&(t=e.attr("data-hi-res-no-resize"),this.constructor.set_src(e,e.attr("data-hi-res"),t),this.constructor.set_bg(e,e.attr("data-hi-res-background"),t))}return t.set_src=function(e,t,n){return this._show_hi_res()&&t&&t!==e.attr("src")?this._replace(e,t,!n,this._replace_img):void 0},t.set_bg=function(e,t,n){return this._show_hi_res()?this._replace(e,t,!n,this._replace_background):void 0},t._show_hi_res=function(){return"devicePixelRatio"in window&&window.devicePixelRatio>1},t._replace=function(t,n,o,i){var r;if(n)return r=new Image,r.src=n,e(r).on("load",function(){return i(t,n,o,r.width,r.height)})},t._replace_img=function(e,t,n,o,i){return e.attr("src",t),n?(e.width(o/2),e.height(i/2)):void 0},t._replace_background=function(e,t,n,o,i){var r;return r="url('%(src)s')".format({src:t}),e.css("backgroundImage",r),n?e.css("backgroundSize",""+o/2+"px "+i/2+"px"):void 0},t}()}),define("modules/clean/history",["external/modernizr","modules/core/browser","modules/core/exception","modules/core/uri"],function(e,t,n,o){var i,r;return r=n.assert,i=function(){var n,i,s,a,c,u,l,_,d,p,h,f,m;return n=new RegExp("#|;|\\?|:|@|&|=|\\+|\\$"),h=function(){var i,r,s;return s=void 0,e.history||-1===t.get_href().indexOf("#!")?(i=window.location.pathname,r=window.location.search,-1!==i.search(n)&&(i=String(o({path:i}))),s=i+r):s=t.get_href().split("#!").pop(),s},c=function(e,t){return String(o.parse(e).setQuery(t))},u=function(e){var t;return null==e&&(e=h()),t=e.split("?"),{url:e,path:t[0],qargs:o.parse(e).getQuery()}},i={},l={},f=h(),m=null,p=function(e){return"/"+e.split("/")[1]},_=function(){var e,t,n;return n=f,t=u(n),e=p(t.path),e in i?(i[e](t.path.substr(e.length+1),t.qargs),!0):!1},d=function(){var e,t,n;return n=f,t=u(n),e=p(t.path),e in l?l[e](t.path.substr(e.length+1),t.qargs):void 0},s=function(e,t){var n,o;return o=p(e),n=p(t),o!==n?d():void 0},a=function(){var e;return e=h(),e!==f?(s(f,e),f=e,_()):void 0},{init:function(){return m?void 0:(f=h(),m=setInterval(a,50))},add_callback:function(e,t,n){return this.init(),r("string"==typeof e,"DBHistory prefix is not a string"),r(0===e.indexOf("/"),"DBHistory prefix must be absolute"),r(1===e.count("/"),"multi-component prefixes arent supported"),i[e]=t,n?void 0:_()},add_exit_callback:function(e,t){return this.init(),r("string"==typeof e,"DBHistory prefix is not a string"),r(0===e.indexOf("/"),"DBHistory prefix must be absolute"),r(1===e.count("/"),"multi-component prefixes arent supported"),l[e]=t},fire_callbacks:function(){return _()},_build_url_for_state_change:function(e,t){var n;return r("string"==typeof e,"DBHistory path is not a string"),r(0===e.indexOf("/"),"DBHistory path must be absolute"),r(-1===e.indexOf("//"),"DBHistory path contains //"),n=c(e,t)},_pre_state_change:function(e){return e===f?!1:(s(f,e),!0)},_post_state_change:function(){return f=h(),_()},replace_state:function(t,n){var o;return o=this._build_url_for_state_change(t,n),this._pre_state_change(o)?(r(e.history,"replace_state is only available on modern browsers"),window.history.replaceState(null,null,o),this._post_state_change()):void 0},push_state:function(t,n){var o;return r(-1===t.indexOf("?"),"DBHistory path contains ?"),r(-1===t.indexOf("#"),"DBHistory path contains #"),o=this._build_url_for_state_change(t,n),this._pre_state_change(o)?(e.history?window.history.pushState(null,null,o):window.location.href="#!"+o,this._post_state_change()):void 0},remove_query_param:function(t){var n;if(e.history)return n=this.deconstruct_url(),delete n.qargs[t],this.replace_state(n.path,n.qargs)},get_url:h,construct_url:c,deconstruct_url:u,URL_ESCAPE_REGEX:n}}()}),define("modules/clean/image_size",[],function(){var e;return e=function(e,t){var n,o,i,r,s,a,c;for(i=[["480x320",480,320],["640x480",640,480],["800x600",800,600],["1024x768",1024,768],["1280x960",1280,960],["1600x1200",1600,1200],["2048x1536",2048,1536]],a=0,c=i.length;c>a;a++)if(r=i[a],o=r[0],s=r[1],n=r[2],s>=e||n>=t)return o;return i[i.length-1][0]},{image_best_fit_size:e}}),define("modules/clean/job_progress",["jquery"],function(e){var t,n,o;return o={make:function(t,n){var o,i,r,s,a,c,u;return null==n&&(n=300),u=n.toString()+"px",r=e("<div />",{"class":"outer-progress-bar"}).css({width:u}),o=e("<div />",{"class":"inner-progress-bar",id:"pb_"+t}).css({width:u}),a=e("<div />",{"class":"under-pb progress-bar"}).css({width:u}),s=e("<div />",{"class":"over-pb progress-bar",id:"pb_"+t+"_over"}).css({display:"none"}),c=e("<div />",{"class":"pb-percentage",id:"pb_"+t+"_upct"}).css({width:u}),i=e("<div />",{"class":"pb-percentage",id:"pb_"+t+"_opct"}).css({width:u}),a.append(c),s.append(i),o.append(a),o.append(s),r.append(o),s.data("progress-width",n),r},set:function(t,n){var o,i,r;return(o=e("#pb_"+t+"_over"))?(n=Math.min(n,1),i=o.data("progress-width"),r=String(i*n)+"px",o.show(),o.css({backgroundColor:"#348DD3",overflow:"hidden",width:r})):void 0}},t={complete:{},handled:function(e){var n;return e?(n=!!t.complete[e],t.complete[e]=!0,n):!1},peek:function(e){return e?!!t.complete[e]:!1}},n={show:function(t){var n,i,r,s,a,c,u,l;if(t&&(null!=(u=__CONDITIONAL_JS__.DBModalStack)&&null!=(l=u.top())&&l.hide(),n=e("body"),i=e("<div />",{id:"modal-progress-overlay"}),i.hide(),i.appendTo(n),e("#browse-box").length?i.clonePosition(e("#browse-box")):e("#gallery-view-media").length?i.clonePosition(e("#gallery-view-media")):i.css({position:"fixed",width:"100%",height:"100%"}),i.width()))return a=e("<div />",{id:"modal-progress-content"}),s=e("<div />",{id:"modal-progress-container"}),r=e("<div />",{id:"modal-progress-bar",opacity:1,html:o.make("modal-progress",150,"")}),c=e("<div />",{id:"modal-progress-text",text:t}),a.hide(),s.append(r,c),a.append(s),n.append(a),i.fadeTo(250,.7),a.fadeIn(250)},update:function(e){var t;if(!(e.indexOf("/")>0&&(t=e.split("/"),e=Number(t[0])/Number(t[1]),isNaN(e))))return o.set("modal-progress",e)},hide:function(){return e("#modal-progress-overlay").fadeOut(250,function(){return e("#modal-progress-overlay").remove()}),e("#modal-progress-content").fadeOut(250,function(){return e("#modal-progress-content").remove()})}},{ModalProgress:n,Job:t}}),define("modules/clean/keycode",[],function(){var e;return e=function(){function e(){}return e.BACKSPACE=8,e.TAB=9,e.ENTER=13,e.SHIFT=16,e.CONTROL=17,e.ALT=18,e.ESC=27,e.SPACE=32,e.PAGE_UP=33,e.PAGE_DOWN=34,e.END=35,e.HOME=36,e.LEFT=37,e.UP=38,e.RIGHT=39,e.DOWN=40,e.INSERT=45,e.DELETE=46,e.TWO_KEY=50,e.EQUALS=61,e.COMMAND=91,e.PLUS_EQUALS_FF=107,e.MINUS_FF=109,e.PLUS_EQUALS_FF_GERMAN=171,e.MINUS_FF_MAC=173,e.PLUS_CHROME=187,e.MINUS_CHROME=189,e.FORWORD_SLASH=191,e.AT_SIGN=64,e.PROCESSING=229,e}()}),define("modules/clean/mailcheck",["jquery","modules/core/html","modules/core/i18n"],function(e,t,n){var o,i;return i=n._,o=function(){function e(e,t){this.$input=e,this.$suggestion_container=t,this.watch()}return e.DOMAINS=["gmail.com","hotmail.com","yahoo.com","aol.com","web.de","gmx.de","googlemail.com","me.com","live.com","msn.com","mail.ru","comcast.net","google.com","mac.com"],e.WHITELIST_REGEXS=[/ymail.com/,/yahoo\.co\./,/yahoo\.com\./,/hotmail\.co\./,/hotmail\.com\./,/gmx\.net/,/gmx\.at/,/gmx\.ch/,/gmx\.com/,/mail\.com/,/web\.com/],e.THRESHOLD=2,e.prototype.watch=function(){return this.$input.on("blur",function(e){return function(){var t;return t=e.suggest(e.$input.val()),t?e.populate(t):e.clear()}}(this))},e.prototype.populate=function(e){var n,o,r;return n=t.escape(e.address).toHTML(),o=t.escape(e.domain).toHTML(),r=""+n+"@<span class='email_warning_area'>"+o+"</span>",this.$suggestion_container.html(new t(i("Did you mean <a>%(suggested_email)s</a>?").format({suggested_email:r})).toHTML()),this.$suggestion_container.show(),this.$suggestion_container.on("click",function(t){return function(){return t.$input.val(e.full),t.clear()}}(this))},e.prototype.clear=function(){return this.$suggestion_container.empty(),this.$suggestion_container.hide()},e.prototype.suggest=function(e){var t,n,o,i;return e=e.toLowerCase(),(i=this.splitEmail(e))?(o=i.domain,t=i.address,this.whitelistedDomain(o)?!1:(n=this.findClosestDomain(o),n?{address:t,domain:n,full:""+t+"@"+n}:!1)):!1},e.prototype.whitelistedDomain=function(t){var n,o,i,r;for(r=e.WHITELIST_REGEXS,o=0,i=r.length;i>o;o++)if(n=r[o],n.match(t))return!0;return!1},e.prototype.splitEmail=function(e){var t;return t=e.split("@"),t.length<2?void 0:{domain:t.pop(),address:t.join("@")}},e.prototype.findClosestDomain=function(t){var n,o,i,r,s,a,c;for(r=99,o=null,c=e.DOMAINS,s=0,a=c.length;a>s;s++)n=c[s],i=this.stringDistance(t,n),r>i&&(r=i,o=n);return o&&o!==t&&r<=e.THRESHOLD?o:!1},e.prototype.stringDistance=function(e,t){var n,o,i,r,s,a;if(null==e||0===e.length)return null==t||0===t.length?0:t.length;if(null==t||0===t.length)return e.length;for(n=0,s=0,a=0,i=0,r=5;n+s<e.length&&n+a<t.length;){if(e.charAt(n+s)===t.charAt(n+a))i++;else for(s=0,a=0,o=0;r>o;){if(n+o<e.length&&e.charAt(n+o)===t.charAt(n)){s=o;break}if(n+o<t.length&&e.charAt(n)===t.charAt(n+o)){a=o;break}o++}n++}return(e.length+t.length)/2-i},e}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/marketing_tracker",["modules/core/exception"],function(e){var t,n;return t="https://marketing.dropbox.com",new(n=function(){function n(){this._load=__bind(this._load,this),this.push=__bind(this.push,this)}return n.prototype.el=!1,n.prototype.ready=!1,n.prototype.push=function(n){var o;return this.src=n.src,o=n.dataLayer,e.assert(this.src,"MarketingTracker.push requires src"),this.el||(this.el=this._load(this.src)),this.ready?this.el.contentWindow.postMessage(o,t):this.el.addEventListener("load",function(e){return function(){return e.ready=!0,e.el.contentWindow.postMessage(o,t)}}(this)),this},n.prototype._load=function(e){var t;return t=document.createElement("iframe"),t.style.display="none",t.hidden=!0,t.src=e,t.setAttribute("sandbox","allow-scripts allow-same-origin"),document.body.appendChild(t),t},n}())}),define("modules/clean/multiaccount_login",["jquery","modules/core/browser","modules/core/dom","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/viewer","modules/clean/components/login_form","modules/clean/dbmodal"],function(e,t,n,o,i,r,s,a,c){var u,l,_,d;return _=o.assert,d=i._,u=c.DBModal,l=function(){function o(){}return o.$element=function(){return e("#db-modal-multiaccount-login-modal")},o.set_during_login_callback=function(e){return _(!this._during_login_callback,"already have a during_login_callback"),this._during_login_callback=e},o.show_modal=function(o){var i,c,l,p,h;return null==o&&(o={}),this.$element=e.isFunction(this.$element)?this.$element():this.$element,_(null!=(h=this.$element)?h.length:void 0,"MultiaccountLogin needs its @$element to be set"),_(!(null!=o.on_success&&null!=o.success_href),"on_success and success_href are mutually exclusive"),null!=o.user?p=s.get_viewer().get_user_by_id(String(o.user),!0):null!=o.user_id?p=s.get_viewer().get_user_by_id(o.user_id,!0):null!=o.role&&(p=s.get_viewer().get_user_by_role(o.role,!0)),_(null!=p,"invalid user"),c=p.role,_(!s.get_viewer().is_user_signed_in(p),"called MultiaccountLogin for a user that's already signed in"),l="personal"===c?d("Sign in to your personal Dropbox"):d("Sign in to your %(team_name)s Dropbox").format({team_name:s.get_viewer().team_name}),i=this.$element.find("form"),n.controller(i).reset(),n.controller(i).set_input_value("login_email",p.email),this.auth_success_callback=function(e){return function(){var n;return s.get_viewer()._sign_in_all_users(),e.set_logged_out_role(null),n=function(n){return null!=n?(r.error(n),s.get_viewer()._sign_out_user_by_id(p.id),e.set_logged_out_role(p.role),void e.modal.hide()):null!=o.success_href?t.get_uri().toString()!==o.success_href?t.redirect(o.success_href):t.reload():(e.modal.hide(),"function"==typeof o.on_success?o.on_success():void 0)},null!=e._during_login_callback&&null==o.success_href?e._during_login_callback(p,n):n(),!1}}(this),e(document).off(a.MULTI_LOGIN_SUCCESS),e(document).on(a.MULTI_LOGIN_SUCCESS,this.auth_success_callback),this.modal=new u({element_id:"multiaccount-login-modal"}),this.modal.show(),this.modal.set_title(l),this.$element.find('input[name="login_password"]').focus()},o.set_logged_out_role=function(e){return this.logged_out_role=e},o.set_team_name=function(e){return this.team_name=e},o.show_page_login_modal=function(e){var t;if(this.logged_out_role)return t={role:this.logged_out_role},"string"==typeof e?t.success_href=e:"function"==typeof e&&(t.on_success=e),this.show_modal(t),!1},o}(),INLINE_JS.MultiaccountLogin=l,l});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/open_with",["modules/clean/browse_interface","modules/clean/filepath","modules/core/uri"],function(e,t,n){var o;return o=function(){function o(){}var i;return o.MAX_SUPPORTED_FILE_SIZE_B=157286400,i=[{id:"excel",ext:["ods","xlsb","xlsm","xlsx"],icon:"excel",name:"Microsoft Excel Online"},{id:"powerpoint",ext:["odp","ppsx","pptx"],icon:"powerpoint",name:"Microsoft PowerPoint Online"},{id:"word",ext:["odt","docm","docx"],icon:"word",name:"Microsoft Word Online"}],o.SUPPORTED_APPS={word:!1,excel:!1,powerpoint:!1},o.get_open_handler_for=function(r,s){var a,c,u;return a=t.file_extension(r.filename).toLowerCase(),u=i.filter(function(e){return __indexOf.call(e.ext,a)>=0}),u.length&&o.SUPPORTED_APPS&&o.SUPPORTED_APPS[u[0].id]?(c=n.encode_parts(r.fq_path),{icon:u[0].icon,name:u[0].name,uri:"/ow/msft/edit"+e.get_browse_root(s)+c}):null},o.file_supported=function(e){var n,o;return n=t.file_extension(e.filename).toLowerCase(),o=i.filter(function(e){return __indexOf.call(e.ext,n)>=0}),o.length>0},o}(),__CONDITIONAL_JS__.OpenWith=o,o});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/openwith/logger",["jquery","modules/clean/ajax"],function(e,t){var n,o;return n=function(){function e(){}return e.log=function(e,n,o){return o=o||{},o.vendor=e,t.AuthenticatedRequest({url:"/ow/js_log",data:{evt:n,extra:JSON.stringify(o)}})},e}(),o=function(e){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,e),n.log=function(e,t){return n.__super__.constructor.log.call(this,"msft",e,t)},n.log_postmessage_received=function(e,t,o){var i,r,s,a,c;for(i={user_id:e,wopi_id:t},c=["origin","timeStamp","data"],s=0,a=c.length;a>s;s++)r=c[s],r in o&&(i[r]=o[r]);return n.log("postmessage_received",i)},n.log_postmessage_sent=function(e,t,o,i){var r,s,a,c,u;for(r={user_id:e,wopi_id:t,postmsg_url:o},u=["MessageId","SendTime","Values"],a=0,c=u.length;c>a;a++)s=u[a],s in i&&(r[s]=i[s]);return n.log("postmessage_sent",r)},n.log_conflict_modal_shown=function(e,t,o){var i;return i={user_id:e,wopi_id:t},n.log(o,i)},n.log_open_button_pressed=function(e,n,o,i){return t.AuthenticatedRequest({url:"/ow/log_open_button_pressed",data:{user_id:e,server_path:""+o+":"+i,file_extension:n}})},n}(n),__CONDITIONAL_JS__.OpenWithMicrosoftLogger=o,{OpenWithLogger:n,OpenWithMicrosoftLogger:o}}),define("modules/clean/payments/cash",[],function(){var e,t,n,o;return o=function(){function e(){}return e._groupSymbol=",",e._decimalSymbol=".",e._minusSignSymbol="-",e._currencyFormatMap={USD:"$%v"},e.set_locale_number_format=function(t,n,o){e._groupSymbol=null!=t?t:",",e._decimalSymbol=null!=n?n:".",e._minusSignSymbol=null!=o?o:"-"},e.set_currency_format_map=function(t){e._currencyFormatMap=t},e._formatAmountThousandsHelper=function(t){var n;return n=Math.abs(parseInt(t)).toFixed(0)+"",n.length<=3?n:e._formatAmountThousandsHelper(n.substr(0,n.length-3))+e._groupSymbol+n.substr(n.length-3)},e.roundCurrency=function(e,t,n){return null==t&&(t="USD"),null==n&&(n=2),e%1===0&&(n=0),this.formatCurrency(e,t,n)},e.formatCurrency=function(t,n,o,i){var r,s,a,c;return null==n&&(n="USD"),null==o&&(o=2),null==i&&(i=!1),"JPY"===n&&(o=0),s=e.formatNumber(t,o),a=(null!=(c=e._currencyFormatMap[n])?c.replace("%v",s):void 0)||s+" "+n,i?(r=a.indexOf(e._decimalSymbol),-1===r?[a,""]:[a.slice(0,r+1),a.slice(r+1)]):a},e.formatNumber=function(t,n){return null==n&&(n=2),(0>t?e._minusSignSymbol:"")+e._formatAmountThousandsHelper(t)+(n>0?e._decimalSymbol+t.toFixed(n).split(".")[1]:"")},e}(),t=function(){function e(e,t){this.cash1=e,this.cash2=t}return e}(),n=function(){function e(){}return e}(),e=function(){function e(e,t){if(this.currency=t,!e&&0!==e||!this.currency)throw new n;this.amount=parseFloat(e)}return e.prototype.add=function(n){if(this.currency!==n.currency)throw new t(self,n);return new e(this.amount+n.amount,this.currency)},e.prototype.subtract=function(t){return this.add(new e(-t.amount,t.currency))},e.prototype.multiply=function(t){return new e(this.amount*t,this.currency)},e.prototype.divide=function(t){return new e(this.amount/t,this.currency)},e.prototype.round=function(t){var n;return null==t&&(t=2),n=Math.pow(10,t),new e(Math.round(this.amount*n)/n,this.currency)},e.prototype.toString=function(e){return null==e&&(e=2),"JPY"===this.currency&&(e=0),o.roundCurrency(this.amount,this.currency,e)},e.fromObject=function(t){return new e(t.amount,t.currency)},e}(),{CashUtil:o,CashCurrenciesDoNotMatch:t,CashNeedsAmountAndCurrency:n,Cash:e}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/payments/credit_card_util",[],function(){var e;return e={_credit_card_info_map:null,setCreditCardInfoMap:function(e){this._credit_card_info_map=e},getAllTypes:function(){var e,t;return function(){var n,o;n=this._credit_card_info_map,o=[];for(t in n)e=n[t],o.push(t);return o}.call(this)},getValidCardTypesForCountryCode:function(e){var t,n,o,i;o=[],i=this._credit_card_info_map;for(n in i)t=i[n],(__indexOf.call(t.accepted_countries,"all")>=0||__indexOf.call(t.accepted_countries,e)>=0)&&o.push(n);return o},isValidCardTypeForCountryCode:function(e,t){return __indexOf.call(this.getValidCardTypesForCountryCode(t),e)>=0},getNameForType:function(e){return this._credit_card_info_map[e].name}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/payments/dfb_util",["jquery","external/underscore","modules/clean/payments/cash","modules/clean/payments/validation","modules/core/exception"],function(e,t,n,o,i){var r,s,a,c,u;return r=n.Cash,u=i.assert,c=function(){function e(e,t,n,o,i,r,s){this.plan_ids=e,this.schedule_ids=t,this.license_ids_and_counts=n,this.currencies=o,this.country_code=i,this.zip_code=r,this.vat_id=s,this.renew=!1,this.discount_ratio=0}return e.prototype.set_only_license_count=function(e){var t;return t=Object.keys(this.license_ids_and_counts)[0],
this.license_ids_and_counts[t]=e},e.prototype.get_only_license_count=function(){var e;return e=Object.keys(this.license_ids_and_counts)[0],this.license_ids_and_counts[e]},e.prototype.set_country_code=function(e){this.country_code=e},e.prototype.set_zip_code=function(e){this.zip_code=e},e.prototype.set_currencies=function(e){this.currencies=e},e.prototype.set_renew=function(e){this.renew=e},e.prototype.set_discount_ratio=function(e){this.discount_ratio=e},e.prototype.set_vat_id=function(e){return this.vat_id=""!==e&&o.validate_vat(this.country_code,e)?e:""},e.prototype.cache_key=function(){return[this.plan_ids.join(","),this.schedule_ids.join(","),this.get_only_license_count(),this.currencies.join(","),this.country_code,this.zip_code,this.vat_id,this.renew,this.discount_ratio].join(":")},e.prototype.to_json=function(){var e;return e=this.renew?{renew:1}:{},e=t.extend(e,{plan_ids:JSON.stringify(this.plan_ids),schedule_ids:JSON.stringify(this.schedule_ids),license_ids_and_counts:JSON.stringify(this.license_ids_and_counts),currencies:JSON.stringify(this.currencies),country_code:this.country_code,zip_code:this.zip_code,vat_id:this.vat_id,discount_percentage:JSON.stringify(100*this.discount_ratio)})},e.from_transition_view_models=function(n){var o,i,r,s,a,c,l,_,d,p,h,f,m,g,v,y,b,w,E,T,S,C,x,k;for(a=[],c=[],r=[],s=!1,i=!1,_=!1,d=!1,p=0,m=n.length;m>p;p++)if(l=n[p],a.push(l.state.plan.id),c.push(l.state.schedule.id),r.push(l.state.currency),s===!1){for(s={},y=l.state.allocated_licenses,h=0,g=y.length;g>h;h++)o=y[h],s[o.license_id]=o.license_count;i=null!=(b=l.read_only_invoice)?b.tax_country_code:void 0,d=null!=(w=l.read_only_invoice)?w.tax_zip_code:void 0,_=null!=(E=l.read_only_invoice)?E.tax_exclusion_id:void 0,d=null!=(T=l.read_only_invoice)?T.tax_zip_code:void 0}else{for(u(l.state.allocated_licenses.length===Object.keys(s).length,"License sets differ"),S=l.state.allocated_licenses,f=0,v=S.length;v>f;f++)o=S[f],u(o.license_id in s,"License sets differ"),u(s[o.license_id]===o.license_count,"License count must match");u(i===(null!=(C=l.read_only_invoice)?C.tax_country_code:void 0),"country codes must match"),u(d===(null!=(x=l.read_only_invoice)?x.tax_zip_code:void 0),"zip codes must match"),u(_===(null!=(k=l.read_only_invoice)?k.tax_exclusion_id:void 0),"VAT IDs must match")}return new e(t.uniq(a),t.uniq(c),s,t.uniq(r),i,d,_)},e}(),s=function(){function e(e){this.transition_view_model=e,this.current_total=this.transition_view_model.read_only_invoice?r.fromObject(this.transition_view_model.read_only_invoice.total):new r(0,this.transition_view_model.state.currency),this.per_license_price=this.transition_view_model.state.per_license_prices.length?r.fromObject(this.transition_view_model.state.per_license_prices[0].price):new r(0,this.transition_view_model.state.currency),this.recurring_total=r.fromObject(this.transition_view_model.state.total_recurring_price)}return e}(),a=function(){function t(e){this.default_transition_view_models=e,this._get_transition_info_for=__bind(this._get_transition_info_for,this),this._add_to_cache=__bind(this._add_to_cache,this),this.has_inflight_request=__bind(this.has_inflight_request,this),this.transition_view_model_requests={},this.transition_info_cache={},this._add_to_cache(this.default_transition_view_models)}return t.prototype.get=function(t,n){var o,i,r;return r=c.from_transition_view_models(this.default_transition_view_models),n.total_users&&r.set_only_license_count(n.total_users),n.country_code&&r.set_country_code(n.country_code),n.currency&&r.set_currencies([n.currency]),n.zip_code&&r.set_zip_code(n.zip_code),n.renew&&r.set_renew(n.renew),n.vat_id&&r.set_vat_id(n.vat_id),n.discount_ratio&&r.set_discount_ratio(n.discount_ratio),o=r.cache_key(),(i=this._get_transition_info_for(o))?void t(i):this.transition_view_model_requests[o]?void 0:(this.transition_view_model_requests[o]=!0,e.ajax({url:"/business/transition-model",type:"GET",dataType:"json",data:r.to_json(),success:function(e){return function(n){var i;return delete e.transition_view_model_requests[o],i=e._add_to_cache(n),t(i)}}(this),error:function(e){return function(){return delete e.transition_view_model_requests[o]}}(this)}))},t.prototype.has_inflight_request=function(){return Object.keys(this.transition_view_model_requests).length},t.prototype._add_to_cache=function(e){var t,n,o;return t=c.from_transition_view_models(e).cache_key(),n=function(){var t,n,i;for(i=[],t=0,n=e.length;n>t;t++)o=e[t],i.push(new s(o));return i}(),this.transition_info_cache[t]=n,n},t.prototype._get_transition_info_for=function(e){return e in this.transition_info_cache?this.transition_info_cache[e]:null},t}(),{DfBTransitionInfo:s,DfBTransitionInfoFetcher:a}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/payments/pro_trial_onboarding_tour",["jquery","modules/clean/ajax","modules/clean/dbmodal","modules/clean/dbmodal_loading"],function(e,t,n){var o,i,r,s;return o=n.DBModal,i=n.DBModalStack,r=function(n){function o(e){this.options=e,this._log=__bind(this._log,this),this._redraw=__bind(this._redraw,this),this._log_and_show_current_step=__bind(this._log_and_show_current_step,this),this._finish_tour=__bind(this._finish_tour,this),this._advance_tour=__bind(this._advance_tour,this),this._go_back_tour=__bind(this._go_back_tour,this),this._hide=__bind(this._hide,this),this._show=__bind(this._show,this),o.__super__.constructor.call(this,this.options),this.vertical_offset=200}return __extends(o,n),o.show=function(e){var t;return t=new this({element_id:"pro-trial-onboarding-tour",click_out_to_close:!1,vars:{trigger:e}}),t.show()},o.prototype._show=function(){return o.__super__._show.apply(this,arguments),this._listen(),this._current_step=0,this._log_and_show_current_step(this.vars.trigger)},o.prototype._hide=function(){return o.__super__._hide.apply(this,arguments),this._unlisten(),e("#pro-trial-tour-header-bubble").removeClass("force-hidden")},o.prototype._listen=function(){return e(document).on("click",".prev-step",this._go_back_tour),e(document).on("click","button.next-step",this._advance_tour),e(document).on("click","button.finish-tour",this._finish_tour)},o.prototype._unlisten=function(){return e(document).off("click",".prev-step",this._go_back_tour),e(document).off("click","button.next-step",this._advance_tour),e(document).on("click","button.finish-tour",this._finish_tour)},o.prototype._go_back_tour=function(e){return e.preventDefault(),this._current_step-=1,this._log_and_show_current_step()},o.prototype._advance_tour=function(e){return e.preventDefault(),this._current_step+=1,this._log_and_show_current_step()},o.prototype._finish_tour=function(){return this._log("finish_trial_onboarding"),this.hide()},o.prototype._log_and_show_current_step=function(e){var t;return t=e?{trigger:e}:{},this._log("view_trial_onboarding_"+this._current_step,t),this._redraw()},o.prototype._redraw=function(){var e,t;return this.$modal_window.find(".welcome, .tour-feature").hide(),t=this.$modal_window.find(".db-modal-x"),0===this._current_step?(this.$modal_window.find(".welcome").show(),t.hide()):(e=this._current_step,this.$modal_window.find('.tour-feature[data-step-num="'+e+'"]').show(),t.show())},o.prototype._log=function(e,n){return t.WebRequest({url:"/pro/trial_onboarding_tour_log",data:{evt:e,extra_data:JSON.stringify(n)}})},o}(o),s=function(){function e(e){this.$container=e,this._listen()}return e.prototype._listen=function(){return this.$container.find(".start-tour").on("click",function(){return function(e){return e.preventDefault(),r.show("restart_tour")}}(this))},e}(),{ProTrialOnboardingTour:r,ProTrialOnboardingTourHeaderLink:s}}),define("modules/clean/payments/validation",[],function(){var e,t;return e={AT:/^ATU[0-9]{8}$/,BE:/^BE(0?|1)[0-9]{9}$/,BG:/^BG[0-9]{9,10}$/,CH:/^CHE[0-9]{9}(TVA|MWST|IVA)$/,CY:/^CY[0-9]{8}[A-Z]$/,CZ:/^CZ[0-9]{8,10}$/,DE:/^DE[0-9]{9}$/,DK:/^DK[0-9]{8}$/,EE:/^EE[0-9]{9}$/,GR:/^EL[0-9]{9}$/,ES:/^ES([A-Z][0-9]{7}[0-9A-Z]|[0-9A-Z][0-9]{7}[A-Z])$/,FI:/^FI[0-9]{8}$/,FR:/^FR[0-9A-Z]{2}[0-9]{9}$/,GB:/^GB([0-9]{9}|[0-9]{12}|GD[0-9]{3}|HA[0-9]{3})$/,HR:/^HR[0-9]{11}$/,HU:/^HU[0-9]{8}$/,IE:/^IE([0-9][0-9A-Z+*][0-9]{5}[A-Z]|[0-9]{7}WI)$/,IT:/^IT[0-9]{11}$/,LT:/^LT([0-9]{9}|[0-9]{12})$/,LU:/^LU[0-9]{8}$/,LV:/^LV[0-9]{11}$/,MT:/^MT[0-9]{8}$/,NL:/^NL[0-9]{9}B[0-9]{2}$/,NO:/^NO[0-9]{9}(MVA)?$/,PL:/^PL[0-9]{10}$/,PT:/^PT[0-9]{9}$/,RO:/^RO[0-9]{2,10}$/,SE:/^SE[0-9]{12}$/,SI:/^SI[0-9]{8}$/,SK:/^SK[0-9]{10}$/},t=function(t,n){var o;return o=e[t],o&&o.test(n)},{validate_vat:t}}),define("modules/clean/photos/batch_thumb_loader",["jquery","modules/clean/ajax","modules/core/uri"],function(e,t,n){var o;return o=function(){function o(e){var t,n;t=e.batch_size,n=e.max_parallel_requests,this.on_batch=e.on_batch,this.batch_logger=e.batch_logger,this.on_batch_success=e.on_batch_success,this.batch_size=t||this.DEFAULT_BATCH_SIZE,this.max_parallel_requests=n||this.DEFAULT_MAX_PARALLEL_REQUESTS,this.thumb_url_queue=[],this.batch_queue=[],this.callback_by_id={},this.request_ids_by_url={},this.num_requests_in_flight=0,this.flushing=!1,this.next_thumb_request_id=0,this.next_batch_id=0,this.cancelled_urls={},this.outstanding_batches={}}return o.prototype.DEFAULT_BATCH_SIZE=16,o.prototype.DEFAULT_MAX_PARALLEL_REQUESTS=6,o.prototype.MAX_URL_LENGTH=6e3,o.prototype.queue_thumb=function(t,n,o){var i,r,s;return null==o&&(o={}),null==o.start_flushing&&(o.start_flushing=!0),null==o.prioritize_batch&&(o.prioritize_batch=!1),t?e.support.cors&&Constants.BATCH_THUMB_ENDPOINTS.length?(r=this.next_thumb_request_id,this.next_thumb_request_id++,(null!=(s=this.request_ids_by_url[t])?s.length:void 0)>0||(this.thumb_url_queue.push(t),this.request_ids_by_url[t]=[]),this.request_ids_by_url[t].push(r),this.callback_by_id[r]={url:t,callback:n},this.thumb_url_queue.length>=this.batch_size&&(o.prioritize_batch?this.batch_queue.unshift(this.thumb_url_queue.splice(0,this.batch_size)):this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size)),o.start_flushing&&this._send_batch_requests()),r):(i=!0,"function"==typeof n&&n(t,i),null):null},o.prototype.cancel_thumb=function(e){var t,n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T,S,C;if(null!=this.callback_by_id[e]){for(u=this.callback_by_id[e].url,delete this.callback_by_id[e],w=this.request_ids_by_url[u],i=_=0,f=w.length;f>_;i=++_)if(r=w[i],r===e){this.request_ids_by_url[u].splice(i,1);break}if(0===this.request_ids_by_url[u].length){for(delete this.request_ids_by_url[u],E=this.thumb_url_queue,i=d=0,m=E.length;m>d;i=++d)if(c=E[i],c===u)return void this.thumb_url_queue.splice(i,1);for(T=this.batch_queue,i=p=0,g=T.length;g>p;i=++p)for(n=T[i],s=h=0,v=n.length;v>h;s=++h)if(c=n[s],c===u)return n.splice(s,1),void(0===n.length&&this.batch_queue.splice(i,1));this.cancelled_urls[u]=1,C=[];for(o in this.outstanding_batches){for(S=this.outstanding_batches[o],l=S.urls,a=S.request,t=!0,b=0,y=l.length;y>b;b++)u=l[b],t=null!=this.cancelled_urls[u]&&t;if(t){a.abort();break}C.push(void 0)}return C}}},o.prototype.prioritize_thumb=function(){},o.prototype.flush=function(){for(;this.thumb_url_queue.length;)this.batch_queue.push(this.thumb_url_queue.splice(0,this.batch_size));return this._send_batch_requests()},o.prototype.reset=function(e){var t;return t=e.batch_size,this.batch_logger=e.batch_logger,this.batch_size=t||this.DEFAULT_BATCH_SIZE},o.prototype.clear=function(){return this.thumb_url_queue=[]},o.prototype.pause=function(){return this.flushing=!1},o.prototype._send_batch_requests=function(){var e,n,o,i,r,s,a;if(!(0===this.batch_queue.length||this.num_requests_in_flight>=this.max_parallel_requests))return this.flushing=!0,s=this.batch_queue.shift(),a=this._generate_request_params(s),o=a[0],i=a[1],n=a[2],"function"==typeof this.on_batch&&this.on_batch(s),e=this.next_batch_id,this.next_batch_id++,this.num_requests_in_flight++,r=t.AuthenticatedRequest({xhrFields:{withCredentials:!0},url:o,type:i,data:n,success:this._success.bind(this,s),error:this._error.bind(this,s),complete:this._complete.bind(this,e)}),this.outstanding_batches[e]={urls:s,request:r},this._send_batch_requests()},o.prototype._success=function(e,t){var n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v;for(s=t.split("\n"),a={},_=0,h=e.length;h>_;_++)l=e[_],a[l]=!1;for(r=d=0,f=s.length;f>d;r=++d)i=s[r],c=i.indexOf(":"),-1!==c&&(u=i.substring(0,c).split("-"),o=parseInt(u[0],10),n=i.substring(c+1),l=e[o],a[l]=!0,this._call_callback(l,n),"function"==typeof this.batch_logger&&this.batch_logger(r,e.length));for("function"==typeof this.on_batch_success&&this.on_batch_success(e),g=e.filter(function(e){return!a[e]}),v=[],p=0,m=g.length;m>p;p++)l=g[p],v.push(null==this.cancelled_urls[l]?this._call_callback(l,l):void 0);return v},o.prototype._error=function(e){var t,n,o,i;for(i=[],n=0,o=e.length;o>n;n++)t=e[n],i.push(this._call_callback(t,t));return i},o.prototype._complete=function(e){var t,n,o,i,r,s;for(this.num_requests_in_flight--,s=this.outstanding_batches[e],o=s.urls,t=s.request,i=0,r=o.length;r>i;i++)n=o[i],delete this.cancelled_urls[n];return delete this.outstanding_batches[e],this.flushing?this._send_batch_requests():void 0},o.prototype._call_callback=function(e,t){var n,o,i,r,s;if(n=0===t.indexOf("data:image")?t:e,null!=this.request_ids_by_url[e])for(s=this.request_ids_by_url[e],i=0,r=s.length;r>i;i++)o=s[i],this.callback_by_id[o].callback(n,!1),delete this.callback_by_id[o];return delete this.request_ids_by_url[e]},o.prototype._generate_request_params=function(t){var o,i,r,s,a,c,u,l;return u=e.map(t,function(e){return n.parse(e).setScheme().setAuthority().toString()}),l=JSON.stringify(u),s=Math.abs(this._hash_string_to_int(l)),i=s%Constants.BATCH_THUMB_ENDPOINTS.length,o=Constants.BATCH_THUMB_ENDPOINTS[i],c={image_urls:l,parallel:!0},r=n.parse(o).setQuery(c).toString(),a=r.length>this.MAX_URL_LENGTH?"POST":"GET",[o,a,c]},o.prototype._hash_string_to_int=function(e){var t,n,o,i,r;if(n=0,0===e.length)return n;for(o=i=0,r=e.length;r>=0?r>i:i>r;o=r>=0?++i:--i)t=e.charCodeAt(o),n=(n<<5)-n+t;return n},o}()}),define("modules/clean/photos/legacy_thumb_loader",["jquery","modules/clean/photos/batch_thumb_loader","modules/clean/sprite"],function(e,t,n){var o;return o={MAX_THUMB_BATCH_REQUESTS:24,batch_load_thumbs:function(o,i,r,s){var a,c,u,l,_,d,p,h,f,m,g;for(d=e.grep(o,function(t){return e(t).data("src")}),this.img_map={},h=0,m=d.length;m>h;h++)c=d[h],l=String(e(c).data("src")),null==(p=this.img_map)[l]&&(p[l]=[]),this.img_map[l].push(c);for(this.instance?this.instance.reset({batch_size:i,batch_logger:s}):this.instance=new t({batch_size:i,max_parallel_requests:this.MAX_THUMB_BATCH_REQUESTS,on_batch:function(t){return function(n){var o,i,r,s,a;for(a=[],r=0,s=n.length;s>r;r++)i=n[r],o=e(t.img_map[i]),o.data("src",null),a.push(o.data("loading-src",i));return a}}(this),batch_logger:s}),u=[],f=0,g=d.length;g>f;f++)c=d[f],a=e(c),_=a.data("src"),this.instance.queue_thumb(_,function(e,t,o,i){return i||t.data("loading-src")?(t.data("loading-src",null),0===o.indexOf("data:image")?(t.attr("src",o),"function"==typeof r?r(t[0]):void 0):(t.error(function(){return t.attr("src",t.data("fail-src")||n.SPACER)}),t.load(function(){return"function"==typeof r?r(t[0]):void 0}),t.attr("src",o))):void 0}.bind(this,_,a));return this.instance.flush()},clear_all_pending_batches:function(){var e;return null!=(e=this.instance)?e.clear():void 0}}}),define("modules/clean/photos/photos_engagement_logger",["jquery","modules/clean/ajax"],function(e,t){var n;return n=function(){function n(){}return n.Platform={WEB:"web",WEB_CAROUSEL:"web_carousel"},n.PROMO_BANNER_CLICKED="promo_banner_clicked",n.PROMO_BANNER_BUTTON_CLICKED="promo_banner_button_clicked",n.PROMO_BANNER_SURVEY_RESPONSE="promo_banner_survey_response",n.CAROUSEL_WEB_PROMO_OPT_IN_MODAL_CONFIRM="carousel_web_promo_opt_in_modal_confirm",n.CAROUSEL_NAV_LINK_CLICK="carousel_nav_link_click",n.PHOTOS_NAV_LINK_CLICK="photos_nav_link_click",n.WEBAPP_LOGO_CLICKED="webapp_logo_clicked",n.WEBAPP_BACK_TO_DROPBOX_CLICKED="webapp_back_to_dropbox_clicked",n.WEBAPP_VIEW_TIMELINE="webapp_view_gallery",n.WEBAPP_VIEW_SHARED_ALBUM="webapp_view_conversations",n.WEBAPP_VIEW_SHARED_ALBUMS_GRID="webapp_view_shared_albums_grid",n.WEBAPP_VIEW_ALBUMS_GRID="webapp_view_albums_grid",n.WEBAPP_VIEW_ALBUM="webapp_view_albums",n.WEBAPP_VIEW_FLASHBACK="webapp_view_flashback",n.WEBAPP_VIEW_SETTINGS="webapp_view_settings",n.WEBAPP_VIEW_DUPLICATES="webapp_view_duplicates",n.WEBAPP_VIEW_USER_SETTINGS="webapp_view_user_settings",n.WEBAPP_USER_SETTINGS_IOS="webapp_user_settings_ios",n.WEBAPP_USER_SETTINGS_ANDROID="webapp_user_settings_android",n.WEBAPP_USER_SETTINGS_HELP="webapp_user_settings_help",n.WEBAPP_USER_SETTINGS_LEGAL="webapp_user_settings_legal",n.WEBAPP_USER_SETTINGS_FEEDBACK="webapp_user_settings_feedback",n.WEBAPP_USER_SETTINGS_LOGOUT="webapp_user_settings_logout",n.WEBAPP_USER_SETTINGS_OPT_IN="webapp_user_settings_opt_in",n.WEBAPP_USER_SETTINGS_OPT_OUT="webapp_user_settings_opt_out",n.WEBAPP_ACTION_ADD_TO_ALBUM="webapp_action_add_to_album",n.WEBAPP_ACTION_REMOVE_FROM_ALBUM="webapp_action_remove_from_album",n.WEBAPP_ACTION_DOWNLOAD="webapp_action_download",n.WEBAPP_ACTION_SHOW_IN_FOLDER="webapp_action_show_in_folder",n.WEBAPP_ACTION_DELETE="webapp_action_delete",n.WEBAPP_SHOW_EXCLUDE_MODAL="webapp_show_exclude_modal",n.ATTEMPT_EXCLUDE_CAROUSEL_SUBFOLDER="attempt_exclude_carousel_subfolder",n.ATTEMPT_EXCLUDE_CU_FOLDER="attempt_exclude_cu_folder",n.ATTEMPT_EXCLUDE_CAROUSEL_FOLDER="attempt_exclude_carousel_folder",n.ATTEMPT_EXCLUDE_DROPBOX_ROOT="attempt_exclude_dropbox_root",n.WEBAPP_GALLERY_SELECT_EVENT="webapp_gallery_select_event",n.WEBAPP_GALLERY_DESELECT_EVENT="webapp_gallery_deselect_event",n.WEBAPP_GALLERY_SELECT_ITEM="webapp_gallery_select_item",n.WEBAPP_GALLERY_DESELECT_ITEM="webapp_gallery_deselect_item",n.WEBAPP_GALLERY_TIME_FIRST_ITEM="webapp_gallery_time_first_item",n.WEBAPP_GALLERY_TIME_EVENTS_OUTLINE="webapp_gallery_time_events_outline",n.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_EVENTS="webapp_gallery_time_first_visible_events",n.WEBAPP_GALLERY_TIME_FIRST_VISIBLE_THUMBS_BATCH="webapp_gallery_time_first_visible_thumbs_batch",n.WEBAPP_GALLERY_EMPTY="webapp_gallery_empty",n.WEBAPP_GALLERY_CONTEXT_MENU_SHOWN="webapp_gallery_context_menu_shown",n.WEBAPP_LIGHTBOX_OPEN="webapp_lightbox_open",n.WEBAPP_LIGHTBOX_DOWNLOAD="webapp_lightbox_download",n.WEBAPP_LIGHTBOX_SELECT_ITEM="webapp_lightbox_select_item",n.WEBAPP_LIGHTBOX_DESELECT_ITEM="webapp_lightbox_deselect_item",n.WEBAPP_LIGHTBOX_FORWARD="webapp_lightbox_forward",n.WEBAPP_LIGHTBOX_BACK="webapp_lightbox_back",n.WEBAPP_LIGHTBOX_SHARE="webapp_lightbox_share",n.WEBAPP_LIGHTBOX_CLOSE_ICON="webapp_lightbox_close_icon",n.WEBAPP_LIGHTBOX_CLOSE_KEY="webapp_lightbox_close_key",n.WEBAPP_TIMELINE_NAVIGATION_SHOWN="webapp_timeline_navigation_shown",n.WEBAPP_TIMELINE_NAVIGATION_TRACK_CLICKED="webapp_timeline_navigation_track_clicked",n.WEBAPP_TIMELINE_NAVIGATION_SCRUBBER_DRAGGED="webapp_timeline_navigation_scrubber_dragged",n.WEBAPP_SHARE_CART_CANCEL="webapp_share_cart_cancel",n.WEBAPP_SHARE_CART_SHARE="webapp_share_cart_share",n.WEBAPP_SHARE_CART_SHARE_FACEBOOK="webapp_share_cart_share_facebook",n.WEBAPP_SHARE_CART_SHARE_TWITTER="webapp_share_cart_share_twitter",n.WEBAPP_SHARE_CART_ITEM_CLICKED="webapp_share_cart_item_clicked",n.WEBAPP_GALLERY_DELETE_MODAL_CONFIRMED="webapp_gallery_delete_modal_confirmed",n.WEBAPP_GALLERY_DELETE_MODAL_CANCELED="webapp_gallery_delete_modal_canceled",n.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CONFIRMED="webapp_gallery_remove_from_album_modal_confirmed",n.WEBAPP_GALLERY_REMOVE_FROM_ALBUM_MODAL_CANCELED="webapp_gallery_remove_from_album_modal_canceled",n.WEBAPP_SHARE_COMPOSER_RECIPIENT="webapp_share_composer_recipient",n.WEBAPP_SHARE_COMPOSER_MESSAGE="webapp_share_composer_message",n.WEBAPP_SHARE_COMPOSER_SHARE="webapp_share_composer_share",n.WEBAPP_SHARE_COMPOSER_TWITTER="webapp_share_composer_twitter",n.WEBAPP_SHARE_COMPOSER_FACEBOOK="webapp_share_composer_facebook",n.WEBAPP_SHARE_COMPOSER_LINK="webapp_share_composer_link",n.WEBAPP_SHARE_WITH_SELF_ATTEMPT="webapp_share_with_self_attempt",n.WEBAPP_CONVERSATIONS_ROOM_CLICKED="webapp_conversations_room_clicked",n.WEBAPP_CONVERSATIONS_VIEW_SETTINGS="webapp_conversations_view_settings",n.WEBAPP_CONVERSATIONS_CLOSE_SETTINGS="webapp_conversations_close_settings",n.WEBAPP_CONVERSATIONS_TIME_FIRST_POST="webapp_conversations_time_first_post",n.WEBAPP_CONVERSATIONS_EMPTY="webapp_conversations_empty",n.WEBAPP_CONVERSATIONS_CHAT_VIEW_CLICKED="webapp_conversations_chat_view_clicked",n.WEBAPP_CONVERSATIONS_GALLERY_VIEW_CLICKED="webapp_conversations_gallery_view_clicked",n.WEBAPP_CONVERSATIONS_CHAT_VIEW_LOAD_MORE="webapp_conversations_chat_view_load_more",n.WEBAPP_CONVERSATIONS_GALLERY_VIEW_LOAD_MORE="webapp_conversations_gallery_view_load_more",n.WEBAPP_SHARING_COMMENT_SUBMIT="webapp_sharing_comment_submit",n.WEBAPP_SHARING_GALLERY_ADD_PHOTOS="webapp_sharing_gallery_add_photos",n.WEBAPP_SHARING_COPY_LINK="webapp_sharing_copy_link",n.WEBAPP_SHARING_LIKE_ITEM="webapp_sharing_like_item",n.WEBAPP_SHARING_UNLIKE_ITEM="webapp_sharing_unlike_item",n.WEBAPP_FLASHBACK_SELECT_EVENT="webapp_flashback_select_event",n.WEBAPP_FLASHBACK_SELECT_ITEM="webapp_flashback_select_item",n.WEBAPP_FLASHBACK_CLICK_ITEM="webapp_flashback_click_item",n.WEBAPP_FLASHBACK_CLICK_SHARE="webapp_flashback_click_share",n.WEBAPP_FLASHBACK_SURVEY_RESPONSE="webapp_flashback_survey_response",n.WEBAPP_FLASHBACK_SURVEY_FREE_RESPONSE="webapp_flashback_survey_free_response",n.WEBAPP_FLASHBACK_SHARE_ALL="webapp_flashback_share_all",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_FACEBOOK="webapp_flashback_share_single_item_facebook",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_TWITTER="webapp_flashback_share_single_item_twitter",n.WEBAPP_FLASHBACK_SHARE_SINGLE_ITEM_LINK="webapp_flashback_share_single_item_link",n.WEBAPP_REPLY_COMPOSER_CLICKED="webapp_reply_composer_clicked",n.WEBAPP_REPLY_COMPOSER_ADD_PHOTOS="webapp_reply_composer_add_photos",n.WEBAPP_REPLY_COMPOSER_SEND="webapp_reply_composer_send",n.WEBAPP_OPT_IN_BANNER_SHOWN="webapp_opt_in_banner_shown",n.WEBAPP_OPT_IN_BANNER_CONFIRM="webapp_opt_in_banner_confirm",n.WEBAPP_OPT_OUT_BANNER_SHOWN="webapp_opt_out_banner_shown",n.WEBAPP_OPT_OUT_BANNER_CONFIRM="webapp_opt_out_banner_confirm",n.WEBAPP_OPT_OUT_MODAL_CONFIRM="webapp_opt_out_modal_confirm",n.PUBLIC_LASS_INPUT_CLICK="public_lass_input_click",n.PUBLIC_LASS_INPUT_MESSAGE="public_lass_input_message",n.PUBLIC_LASS_INPUT_SUBMIT="public_lass_input_submit",n.PUBLIC_LASS_ADD_PHOTOS="public_lass_add_photos",n.PUBLIC_LASS_LIKE_CLICK="public_lass_like_click",n.PUBLIC_LASS_START_LOGIN="public_lass_start_login",n.PUBLIC_LASS_FINISH_LOGIN="public_lass_finish_login",n.PHOTO_SPACE_START_LOGIN="photo_space_start_login",n.PHOTO_SPACE_FINISH_LOGIN="photo_space_finish_login",n.PHOTO_SPACE_SUBSCRIBE="photo_space_subscribe",n.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_SHARE="share_cart_share",n.MOBILE_DROPBOX_FLASHBACK_SHARE_CART_CANCEL="share_cart_cancel",n.MOBILE_DROPBOX_FLASHBACK_LINK_GENERATED="link_generated",n.MOBILE_DROPBOX_FLASHBACK_SHARE_DONE="share_done",n.first_log_sent=!1,n.logs_queued=[],n.HACK_prefix_to_replace=null,n.HACK_prefix_replace_with=null,n.HACK_new_platform=null,n.HACK_extra={},n.hack_all_log_prefixes_and_platform=function(e){var t,o,i,r;return r=e.prefix_to_replace,i=e.prefix_replace_with,o=e.new_platform,t=e.extra,n.HACK_prefix_to_replace=r,n.HACK_prefix_replace_with=i,n.HACK_new_platform=o,n.HACK_extra=t},n.apply_hacky_log_overrides=function(t,o,i){var r,s;return n.HACK_prefix_to_replace?(s=0===t.indexOf(n.HACK_prefix_to_replace)?t.replace(n.HACK_prefix_to_replace,n.HACK_prefix_replace_with):0!==t.indexOf(n.HACK_prefix_replace_with)?n.HACK_prefix_replace_with+t:t,r=e.extend({},i,this.HACK_extra),[s,n.HACK_new_platform,r]):[t,o,i]},n.log_and_send=function(e,o,i){var r;return null==o&&(o={}),null==i&&(i=n.Platform.WEB),r=n.apply_hacky_log_overrides(e,i,o),e=r[0],i=r[1],o=r[2],t.AuthenticatedRequest({url:"/photos/photos_engagement_log",data:{event:e,extra:JSON.stringify(o),platform:i}})},n.log=function(e,t,o){var i,r;return n.first_log_sent?(null==t&&(t={}),null==o&&(o=n.Platform.WEB),r=n.apply_hacky_log_overrides(e,o,t),e=r[0],o=r[1],t=r[2],i={event:e,extra:t,platform:o},n.logs_queued.push(i)):(n.log_and_send(e,t,o),void(n.first_log_sent=!0))},n.log_carousel=function(e,t){return n.log(e,t,n.Platform.WEB_CAROUSEL)},n._send_log_batch=function(){return n.logs_queued.length?(t.AuthenticatedRequest({url:"/photos/photos_engagement_batch_log",data:{events:JSON.stringify(n.logs_queued)}}),n.logs_queued=[]):void 0},n}(),setInterval(n._send_log_batch,1e4),e(window).unload(n._send_log_batch),n}),define("modules/clean/profile_services/profile_services_constants",["modules/core/exception","modules/core/i18n"],function(e,t){var n,o,i;return o=e.assert,i=t._,n={GOOGLE:"1",YAHOO:"2",FACEBOOK:"3",TWITTER:"4",YAHOO_LEGACY:"5",MOBILE:"6",VARIOUS:"-1",NONE:"-2",services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK,this.TWITTER,this.YAHOO_LEGACY]},contact_services:function(){return[this.GOOGLE,this.YAHOO,this.FACEBOOK]},to_img:function(e){switch(e){case this.GOOGLE:return"/static/images/icons/gmail_logo28-vflpyJYQh.png";case this.YAHOO:case this.YAHOO_LEGACY:return"/static/images/icons/yahoo_mail_logo28-vflNeyC7Q.png";case this.FACEBOOK:return"/static/images/icons/facebook_logo28-vflIeRTN-.png";default:return o(!1,"Should never get ProfileServicesConstants.to_img with service: "+e)}},to_name:function(e){switch(e){case this.GOOGLE:return i("Gmail");case this.YAHOO:return i("Yahoo! Mail");case this.FACEBOOK:return i("Facebook");case this.VARIOUS:return i("Email");case this.YAHOO_LEGACY:return i("Yahoo! Mail");default:return o(!1,"Should never get ProfileServicesConstants.to_name with service: "+e)}},logging_identifiers:function(e){switch(e){case this.GOOGLE:return"google";case this.YAHOO:return"yahoo";case this.FACEBOOK:return"facebook";case this.VARIOUS:return"email";case this.YAHOO_LEGACY:return"yahoo_legacy";default:return o(!1,"Should never get ProfileServicesConstants.logging_identifiers with service: "+e)}}}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/activity/contacts_selector",["external/react","external/typeahead.bundle","jquery","modules/clean/keycode","modules/clean/ajax","modules/clean/viewer","modules/clean/activity/activity_user","modules/clean/contacts/bloodhound_contacts","modules/clean/contacts/importer","modules/clean/avatar/components","modules/clean/profile_services/profile_services_constants","modules/clean/react/sprite","modules/core/i18n","modules/core/exception"],function(e,t,n,o,i,r,s,a,c,u,l,_,d){var p,h,f,m,g,v,y,b,w,E,T,S,C;return p=u.AvatarWithDefault,y=u.InitialsAvatar,T=e.addons.classSet,S=e.DOM,C=r.get_viewer(),f=0,m=1,E=3,b=4,w=5,g=99,v=3,h=e.createClass({propTypes:{showNullHint:e.PropTypes.bool,contactSelectedCallback:e.PropTypes.func,contactHighlightedCallback:e.PropTypes.func,noAtMentionTriggerCallback:e.PropTypes.func,resultsLimit:e.PropTypes.number,matchFullQUery:e.PropTypes.bool,noMatchesText:e.PropTypes.string,user:e.PropTypes.object,showContactsInNullState:e.PropTypes.bool,x_offset:e.PropTypes.number,y_offset:e.PropTypes.number,enable_import:e.PropTypes.bool,show_contacts:e.PropTypes.bool,should_dropdown:e.PropTypes.bool,last_keydown:e.PropTypes.number},getInitialState:function(){return this.contactSelectedCallback=this.props.contactSelectedCallback,this.props.user&&this.props.user.is_signed_in&&(this.contacts_importer=c.get_contacts_importer({user_id:this.props.user.id}),this.contacts_importer.on_auth_success=this._contacts_importer_auth_success),{suggestions:[],matches_count:0,focused_row:null,query:"",show_no_results:!1,hover_import_contact:!1,show_import_list:!1}},getDefaultProps:function(){return{contactSelectedCallback:void 0,should_dropdown:!0,show_contacts:!1,enable_import:!0,x_offset:0,y_offset:0,last_keydown:-1,showNullHint:!0,showContactsInNullState:!1,noMatchesText:d._("No matches. Keep typing an email address."),matchFullQUery:!1}},componentWillMount:function(){return 0===this.state.query.length&&this.props.showContactsInNullState?this.get_suggestions(""):void 0},componentDidMount:function(){var e,t;return this.$typeahead_container=n(null!=(e=this.refs.suggestionsContainer)?e.getDOMNode():void 0),this.$typeahead_suggestions=n(null!=(t=this.refs.suggestionsList)?t.getDOMNode():void 0),this._position_contacts_list(),this._toggle_contacts_list(),this.state.show_contacts?void 0:this._reset_import_state()},componentDidUpdate:function(){var e,t,o;return this.$typeahead_container=n(null!=(t=this.refs.suggestionsContainer)?t.getDOMNode():void 0),this.$typeahead_suggestions=n(null!=(o=this.refs.suggestionsList)?o.getDOMNode():void 0),this._position_contacts_list(),this._toggle_contacts_list(),"function"==typeof(e=this.props).contactHighlightedCallback?e.contactHighlightedCallback(this._get_suggestion_row(this.state.focused_row)):void 0},_reset_import_state:function(){return this.setState({hover_import_contact:!1,show_import_list:!1})},_contacts_importer_auth_success:function(){},_append_import_to_suggestions:function(e){return e.push(this._append_provider(l.FACEBOOK)),e.push(this._append_provider(l.GOOGLE)),e.push(this._append_provider(l.YAHOO)),e},_append_provider:function(e){return{type:g,provider:e,name:l.to_name(e),photo_url:l.to_img(e)}},_import_contacts_mouseover:function(){return this.setState({hover_import_contact:!0})},_import_contacts_mouseleave:function(){return this.setState({hover_import_contact:!1})},_mouse_down_import_contacts:function(e){return e.preventDefault(),this.setState({hover_import_contact:!this.state.hover_import_contact,show_import_list:!this.state.show_import_list})},_focus_suggestion_row:function(e){return null!=e&&this.state.focused_row!==e||null===e?this.setState({focused_row:e}):void 0},_focus_suggestion_row_mouseover:function(e){var t,o;return t=n(e.currentTarget),o=t.index(),o>-1?this._focus_suggestion_row(o):void 0},_get_suggestion_row:function(){return this.$typeahead_suggestions.find(".suggestion-row.focused")},_get_suggestions_callback:function(e,t,n){var i,r,s,a,c;return t=function(){var e,n,o,r;for(r=[],e=0,n=t.length;n>e;e++)i=t[e],(o=i.type)!==E&&o!==b&&r.push(i);return r}(),n||(t=e.length>=w?this._getApproximateNameMatches(e,t):this._getExactFirstOrLastNameMatches(e,t)),t=t.slice(0,this.props.resultsLimit),r=t.length,s=0===r&&this.props.last_keydown!==o.SPACE&&e.indexOf(" ")<0||0===r&&this.props.matchFullQUery,n||"function"==typeof(a=this.props).noAtMentionTriggerCallback&&a.noAtMentionTriggerCallback(r),this.props.enable_import&&0===r?t=this._append_import_to_suggestions(t):r>0&&this._reset_import_state(),this.props.should_dropdown?c=0:(c=t.length-1,t.reverse()),this.setState({suggestions:t,focused_row:c,show_no_results:s,matches_count:r})},_has_suggestion_row_at_index:function(e){return null!=e&&e>=0&&e<this.get_suggestions_count()},_mouse_down_select_suggestion:function(e){return e.preventDefault(),this.select_suggestion(e.currentTarget)},_position_contacts_list:function(){var e,t;return t=this.$typeahead_container.parent(),e=this.$typeahead_container.width(),e+this.props.x_offset>t.width()?this.$typeahead_container.css("left",t.width()-e):this.$typeahead_container.css("left",this.props.x_offset),this.props.should_dropdown?this.$typeahead_container.css("top",this.props.y_offset):this.$typeahead_container.css("top",this.props.y_offset-this.$typeahead_container.height()-12)},_toggle_contacts_list:function(){return this.props.show_contacts&&(this._matches_count()>0||0===this.state.query.length||this.state.show_no_results&&this.state.query.length)?this.$typeahead_container.show():this.$typeahead_container.hide()},_matches_count:function(){return this.state.matches_count;

},_getExactFirstOrLastNameMatches:function(e,t){var n;return function(){var o,i,r;for(r=[],o=0,i=t.length;i>o;o++)n=t[o],__indexOf.call(n.name_tokens,e)>=0&&r.push(n);return r}()},_getApproximateNameMatches:function(e,t){var n,o,i,r,s,a,c,u;for(o=[],r=0,a=t.length;a>r;r++)for(n=t[r],u=n.name_tokens,s=0,c=u.length;c>s;s++)if(i=u[s],0===i.indexOf(e)){o.push(n);break}return o},get_suggestions:function(e,t){return null==t&&(t=!0),this.props.user&&this.props.user.is_signed_in?(a.get(e,function(n){return function(o){return n._get_suggestions_callback(e,o,t)}}(this)),this.setState({query:e})):void 0},get_suggestions_count:function(){return this.props.show_contacts?this.$typeahead_suggestions.children().size():0},navigate_suggestions:function(e){var t,n,i,r,s;if(t=e.keyCode||e.which||e.charCode,e.keyCode===o.ENTER||e.keyCode===o.TAB){if(e.preventDefault(),this._has_suggestion_row_at_index(this.state.focused_row))return r=this._get_suggestion_row(this.state.focused_row),this.select_suggestion(r)}else if(((s=e.keyCode)===o.UP||s===o.DOWN)&&(n=this.get_suggestions_count(),n>0))if(e.keyCode===o.UP){if(i=null!=this.state.focused_row?this.state.focused_row:n,0!==this.state.focused_row)return this._focus_suggestion_row((i-1)%n)}else if(e.keyCode===o.DOWN&&(i=null!=this.state.focused_row?this.state.focused_row:-1,this.state.focused_row!==n-1))return this._focus_suggestion_row((i+1)%n)},select_suggestion:function(e){var t;return t=n(e),t.data("type")===g?void this.contacts_importer.auth_import(""+t.data("provider"),"contact-importer-modal"):(null!=this.contactSelectedCallback&&this.contactSelectedCallback(t),this.isMounted()?this.setState({focused_row:null,suggestions:[]}):void 0)},render:function(){var t,n,o,i;return t=e.addons.classSet({"contacts-list-suggestions":!0,"animating-down":this.props.show_contacts&&!this.props.should_dropdown,"animating-up":this.props.show_contacts&&this.props.should_dropdown}),S.div({className:t,ref:"suggestionsContainer"},this.props.show_contacts&&this.props.user?this.props.user.is_signed_in?0===this.state.query.length&&this.props.showNullHint&&!this.props.showContactsInNullState?S.div({className:"suggestion-row empty-state-row"},d._("Mention someone by name or email")):this.state.query.length||0===this.state.query.length&&this.props.showContactsInNullState?(i=S.div({ref:"suggestionsList"},function(){var e,n,i,r;for(i=this.state.suggestions,r=[],e=0,n=i.length;n>e;e++)o=i[e],r.push(function(e){return function(n){var o,i,r,a,c,u,l,_;return t={"import-row":n.type===g,"suggestion-row":!0,focused:null!=e.state.focused_row&&e.state.suggestions.indexOf(n)===e.state.focused_row},r=T(t),n.type===f?(u=n.email,a=n.email):n.type===m?(u="fb_"+n.fb_id,a="Facebook Contact"):(_=n.type)===E||_===b?(u=n.group_id,a="Group"):n.type===g&&(u="Import-"+n.name,i=S.img({src:n.photo_url})),null!=n.name&&n.name.length>0?l=n.name:null!=n.email&&(l=n.email.substring(0,n.email.indexOf("@")).replace(/[_-]/g," ")),n.type===g||null==n.photo_url&&null==l||(o=new s({display_name:l}),c=o.initials,i=new p({dimension:32,photoUrl:n.photo_url,defaultAvatar:new y({dimension:32,shape:"CIRCLE",initials:c})})),S.div({key:u,className:r,"data-identifier":u,"data-name":l,"data-type":n.type,"data-photo-url":n.photo_url,"data-dbx-account-id":n.dbx_account_id||null,"data-provider":n.provider||null,onMouseDown:function(t){return e._mouse_down_select_suggestion(t)},onMouseEnter:function(t){return e._focus_suggestion_row_mouseover(t)}},S.div({className:"suggestion-wrapper"},i?S.div({className:"suggestion-avatar"},i):void 0,S.div({className:"suggestion-info"},null!=l?S.div({className:"suggestion-name"},l):void 0,null!=a?S.div({className:"suggestion-identifier"},a):void 0)))}}(this)(o));return r}.call(this)),this.state.show_no_results?S.div({},S.div({className:"suggestion-row empty-state-row"},S.div({className:"empty-state-row-text"},this.state.hover_import_contact||this.state.show_import_list?d._("Import Contacts"):this.props.noMatchesText),this.props.enable_import?(n={"import-contacts":!0,active:null!=this.state.show_import_list},S.a({className:T(n),onMouseDown:function(e){return function(t){return e._mouse_down_import_contacts(t)}}(this),onMouseEnter:function(e){return function(t){return e._import_contacts_mouseover(t)}}(this),onMouseLeave:function(e){return function(t){return e._import_contacts_mouseleave(t)}}(this)},_({group:"web",name:"user_add"}))):void 0),this.state.show_import_list?S.div({className:T({"suggestion-row-top-divider":!0,"animating-down":this.props.should_dropdown,"animating-up":!this.props.should_dropdown})},i):void 0):this._matches_count()>0?i:void 0):void 0:S.div({className:"suggestion-row empty-state-row"},d._("Login to @mention your contacts")):void 0)}})});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/activity/like_bar",["external/react","modules/core/i18n","modules/core/notify","modules/clean/activity/activity","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/viewer"],function(e,t,n,o,i,r,s){var a,c,u,l,_,d;return d=t._,l=e.DOM,_=s.get_viewer(),a=o.ActivityType,u=15,c=e.createClass({propTypes:{context_activity_store:e.PropTypes.object.isRequired,activity:e.PropTypes.object.isRequired,user:e.PropTypes.object.isRequired,add_like_callback:e.PropTypes.func},is_liked_by_viewing_user:function(){var e,t;return this.props.user.is_signed_in?(t=this.props.user.id,__indexOf.call(function(){var t,n,o,i;for(o=this.props.activity.likes,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(e.liker.id);return i}.call(this),t)>=0):void 0},addLike:function(){var e,t,o;return e=this.props.activity,this.props.user.is_signed_in&&(t=function(e){return function(){return n.error(d("We weren't able to submit your like.")),e.forceUpdate()}}(this),e.activity_type===a.COMMENT?this.props.context_activity_store.add_comment_like(e,this.props.user,null,null,t):this.props.context_activity_store.add_like(e,this.props.user,null,null,t),this.setState({like_added:!0})),"function"==typeof(o=this.props).add_like_callback?o.add_like_callback():void 0},removeLike:function(){var e,t;return e=this.props.activity,t=function(e){return function(){return n.error(d("We weren't able to remove your like.")),e.forceUpdate()}}(this),e.activity_type===a.COMMENT?this.props.context_activity_store.remove_comment_like(e,this.props.user,null,null,t):this.props.context_activity_store.remove_like(e,this.props.user,null,null,t),this.forceUpdate()},getInitialState:function(){return{like_added:!1}},render:function(){var t,n,o,s,a,c,_,p,h;return c=this.props.activity.likes,h=this.is_liked_by_viewing_user()?"bluestar":"star",_=c.length,p=this.is_liked_by_viewing_user()?function(e){return function(){return e.removeLike()}}(this):function(e){return function(){return e.addLike()}}(this),t=e.addons.classSet({"like-sprite":!0,animating:this.is_liked_by_viewing_user()&&this.state.like_added}),a=function(){var e,t,o;for(o=[],e=0,t=c.length;t>e;e++)n=c[e],o.push(n.liker);return o}(),a=a.slice(0,u),c.length>u&&a.push({id:"extra",display_name:d("%(num_extra)d more...").format({num_extra:c.length-u})}),o=_>0?l.div({className:"liker-names"},function(){var e,t,n;for(n=[],e=0,t=a.length;t>e;e++)s=a[e],n.push(function(){return function(e){return l.div({key:e.id},e.display_name)}}(this)(s));return n}.call(this)):this.props.user.is_signed_in?l.span({},d("Like")):l.span({},d("Login to like comment")),l.div({className:"like-bar"},r.Tooltip({position:r.TooltipPosition.TOP,tooltip_contents:o,tooltip_classname:"like-tooltip"},l.div({},l.a({className:t,onMouseDown:p},i({group:"web",name:h})),_>0?l.div({className:"like-text"},_):void 0)))}})});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/react/activity/mentions_controller",["jquery","external/react","external/purify","modules/core/browser","modules/core/exception","modules/clean/activity/activity_user","modules/clean/keycode","modules/clean/validators/validators","modules/clean/react/bubble_dropdown","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/react/tooltip","modules/clean/react/activity/contacts_selector","modules/clean/react/activity/contacts_selector_popup"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h){var f,m,g,v,y,b,w,E,T,S,C;return b=t.addons.classSet,w=t.DOM,g=l.R_,E="\ufeff",T=new RegExp(E,"g"),v=" ",y="",f="",S=[s.UP,s.DOWN,s.ESC,s.ENTER,s.TAB],C=a.check(a.create(["EmailValidator"])),m=t.createClass({displayName:"MentionsController",propTypes:{contacts_should_dropdown:t.PropTypes.bool,enableNoAtMentions:t.PropTypes.bool,showContactsInNullState:t.PropTypes.bool,initial_text:t.PropTypes.string,user:t.PropTypes.object,position_contacts_callback:t.PropTypes.func,showMentionsHelper:t.PropTypes.bool,bottomSharpCorners:t.PropTypes.bool,contactsSelectorPopupShown:t.PropTypes.func,contactPopupSelectedCallback:t.PropTypes.func,contactSelectedCallback:t.PropTypes.func,onKeyDown:t.PropTypes.func,onKeyUp:t.PropTypes.func,onAtSignKeyPress:t.PropTypes.func,onNoAtSignKeyPress:t.PropTypes.func,onBlur:t.PropTypes.func,onFocus:t.PropTypes.func,onPaste:t.PropTypes.func,onMention:t.PropTypes.func,placeholder_text:t.PropTypes.string,resultsLimit:t.PropTypes.number,resize_callback:t.PropTypes.func,onSkipAddMention:t.PropTypes.func,onAddPeopleMouseUp:t.PropTypes.func},getInitialState:function(){var e;return e=!1,this.isInNoAtMentionMode=!1,this.currentCursorWordStartPosition=0,this.currentCursorWordEndPosition=0,this.props.initial_text&&this.props.initial_text.length>0&&(e=!0),{default_state:!0,x_offset:0,y_offset:0,in_edit_mode:e,mention_triggered:!1,search_end_position:-1,search_start_position:-1,show_contacts:!1,last_keydown:-1}},getDefaultProps:function(){return{contacts_should_dropdown:!0,initial_text:"",user:new r,resultsLimit:5,shouldShowNoNotifyHint:!1,bottomSharpCorners:!1,enableNoAtMentions:!1}},componentDidMount:function(){return this._componentSetup()},componentDidUpdate:function(e,t){var n,o;return this._componentSetup(),o=this._getCaretPosition(),t.show_contacts!==this.state.show_contacts&&((null!=o?o.left:void 0)!==this.state.x_offset||(null!=o?o.top:void 0)!==this.state.y_offset)&&(n={x_offset:o.left,y_offset:o.top},this.setState(n)),this.state.default_state&&this.props.initial_text.length>0?this._replaceInputWithText(this.props.initial_text):void 0},showNoNotifyHint:function(){var e,t;return this.refreshDropdownDirection(),null!=(e=this.refs.mentionsHintDropdown)&&e.show(),null!=(t=this.refs.mentionsContactSelectorPopup)?t.showNoNotifyHint():void 0},_resetInputToPlaceholderState:function(){return this._dangerouslySetInputHtml(""),this.setState({in_edit_mode:!1,search_end_position:-1,search_start_position:-1})},_replaceInputWithText:function(e){var t,o,i,r,s,a;return e=n.sanitize(e),this._clearInputWithoutBlurring(),this.$text_input.focus(),a=this._extractCursorInfo(),o=a[0],i=a[1],s=a[2],r=document.createRange(),o&&(r.setStart(o,0),t=/@\[[^:^\[]+:[^:^\]]+\]/g,e=e.replace(t,function(e){return function(t){var n;return n=t.split(/\[|\]|:/),e._mentionWrapper(n[1],n[2])}}(this)),this.unsafeInsertHtmlAtRange(e,r,!0),!this.state.in_edit_mode)?this.setState({in_edit_mode:!0}):void 0},_componentSetup:function(){return this.contacts_selector=this.refs.contactSelector,this.$mentions_input=e(this.refs.input.getDOMNode()),this.$text_input=e(this.refs.textInput.getDOMNode())},_parseInputTextAndReplace:function(){var e,t;return e=0,t=new RegExp(/@[a-z0-9!#$%&'*+\/=?^_`{|}~-]+(?:\.[a-z0-9!#$%&'*+\/=?^_`{|}~-]+)*@(?:[a-z0-9](?:[a-z0-9-]*[a-z0-9])?\.)+[a-z0-9](?:[a-z0-9-]*[a-z0-9])?/gi),this._parseInputTextWithRegex(t,function(t){return function(n,i){var r,s,a,c,u;return s=n[0],r=n.index,c=s.substring(1),C(c)&&null==o.msie?(u=document.createRange(),u.setStart(i,r),u.setEnd(i,r+s.length),a=t._createMentionObject(c,c),t._addMentionIntoInput(a,u),e++):void 0}}(this)),e>0?this.setCursorToEndOfInput():void 0},_parseInputTextWithRegex:function(t,n){var i,r,s,a,c,u,l,_;if(r=this.$text_input.html().replace(T,""),null!=r&&""!==r){for(l=this.$text_input[0].childNodes,_=[],c=0,u=l.length;u>c;c++)i=l[c],null!=o.msie&&e(i).is("p")||i.nodeType===Node.TEXT_NODE&&""!==i.nodeValue.trim()?(a=null!=o.msie?e(i).text():i.nodeValue,_.push(function(){var e;for(e=[];null!==(s=t.exec(a));)e.push(n(s,i));return e}())):_.push(void 0);return _}},refreshDropdownDirection:function(){var e;return"function"==typeof(e=this.props).position_contacts_callback?e.position_contacts_callback():void 0},_getEndRangeUnicodeIndex:function(){return this.$text_input.html().indexOf(f)},_getStartRangeUnicodeIndex:function(){return this.$text_input.html().indexOf(y)},_endRangeUnicodeExists:function(){return this._getEndRangeUnicodeIndex()>=0},_startRangeUnicodeExists:function(){return this._getStartRangeUnicodeIndex()>=0},_startAndEndRangeUnicodeExistsAndValid:function(){var e,t;return t=this._getStartRangeUnicodeIndex(),e=this._getEndRangeUnicodeIndex(),t>=0&&e>0&&e>t},_clearStartToEndRangeUnicode:function(){return this._dangerouslyReplaceStartToEndRangeUnicode(""),this._clearRangeUnicode()},_dangerouslyInsertValueBeforeStartUnicode:function(e){var t,o,i,r,s;return this._getStartRangeUnicodeIndex()>=0?(s=this._getStartRangeUnicodeIndex(),o=this.$text_input.html(),t=o.substr(0,s),i=o.substr(s),e=n.sanitize(e),r=""+t+e+i,this._dangerouslySetInputHtml(r)):void 0},_dangerouslyReplaceStartToEndRangeUnicode:function(e){var t,o,i,r,s;return this._startAndEndRangeUnicodeExistsAndValid()?(s=this._getStartRangeUnicodeIndex(),o=this._getEndRangeUnicodeIndex(),r=this.$text_input.html(),i=r.substr(0,s),t=r.substr(o),e=n.sanitize(e),this._dangerouslySetInputHtml(""+i+y+e+f+t)):void 0},_clearRangeUnicode:function(){var e;return e=this.$text_input.html(),e=e.replace(/\u0091/g,""),e=e.replace(/\u0092/g,""),this.$text_input.html(e)},_dangerouslyInsertLiveTextWithRangeUnicode:function(e){var t;return null==o.msie&&this._cleanUpDelimiters(),(this._getStartRangeUnicodeIndex()<0||this._getEndRangeUnicodeIndex()<0)&&(this._clearRangeUnicode(),this._dangerouslySetInputHtml(""+this.$text_input.html()+y+f)),t=this._isSpaceBeforeStartUnicode()?"":" ",e=n.sanitize(e),this._dangerouslyReplaceStartToEndRangeUnicode(""+t+e)},_getRangeBetweenStartEndRangeUnicode:function(){var t,n,i,r,s,a,c,u,l;if(n=this.$text_input.html().replace(T,""),null!=n&&""!==n)for(l=this.$text_input[0].childNodes,c=0,u=l.length;u>c;c++)if(t=l[c],a=null!=o.msie?e(t).text():t.nodeValue,null!=a&&a.length>0&&(s=a.indexOf(y),i=a.indexOf(f),s>=0&&i>0&&i>s))return r=document.createRange(),r.setStart(t,s),r.setEnd(t,i),r},_isSpaceBeforeStartUnicode:function(){var e;return e=this._getStartRangeUnicodeIndex(),e>=0?this._isSpaceBeforeIndex(e):!1},_isSpaceBeforeIndex:function(e){var t;return t=this.$text_input.html(),e>0&&" "===t.substr(e-1,1)||e>=6&&"&nbsp;"===t.substr(e-6,6)},_dangerouslySetInputHtml:function(e){return this.$text_input.html(e)},_onAddPeopleMouseUp:function(e){var t;return"function"==typeof(t=this.props).onAddPeopleMouseUp?t.onAddPeopleMouseUp(e):void 0},_onSkipAddMention:function(e){var t,n;return null!=(n=this.refs.mentionsHintDropdown)&&n.hide(),"function"==typeof(t=this.props).onSkipAddMention?t.onSkipAddMention(e):void 0},_contactsSelectorPopupHidden:function(){return this.props.showMentionsHelper&&(this._clearStartToEndRangeUnicode(),0===this.$text_input.html().trim().length&&this.state.in_edit_mode&&this._getCaretPosition().top<=0)?this._resetInputToPlaceholderState():void 0},_contactsSelectorPopupShown:function(){var t;return this.props.showMentionsHelper?(this.state.in_edit_mode||this._clearDefaultState(),setTimeout(function(){return function(){return e(".contacts-selector-popup input").trigger("focus")}}(this),100),"function"==typeof(t=this.props).contactsSelectorPopupShown?t.contactsSelectorPopupShown():void 0):void 0},_emailEnteredCallback:function(e){return this._addMentionIntoRangeUnicode(this._createMentionObject(e)),this.setCursorToEndOfInput(),this.refs.mentionsHintDropdown.hide()},_clearContactHighlightedCallback:function(){return this._clearStartToEndRangeUnicode()},_contactHighlightedCallback:function(e){var t,n;return n=(null!=e?e.data("name"):void 0)||"",t=(null!=e?e.data("identifier"):void 0)||"",this._dangerouslyInsertLiveTextWithRangeUnicode("@"+n)},_contactPopupSelectedCallback:function(e){var t;return this._addMentionIntoRangeUnicode(this._createMentionObjectFromSuggestion(e)),this.setCursorToEndOfInput(),this.refs.mentionsHintDropdown.hide(),"function"==typeof(t=this.props).contactPopupSelectedCallback?t.contactPopupSelectedCallback(e):void 0},_contactSelectedCallback:function(e){var t;return this._addMentionIntoInput(this._createMentionObjectFromSuggestion(e)),"function"==typeof(t=this.props).contactSelectedCallback?t.contactSelectedCallback(this.isInNoAtMentionMode):void 0},_addMentionIntoRangeUnicode:function(e){var t;return this._isSpaceBeforeStartUnicode()||this._dangerouslyInsertValueBeforeStartUnicode(" "),t=this._getRangeBetweenStartEndRangeUnicode(),t?(this._addMentionIntoInput(e,t),this._clearRangeUnicode()):void 0},_noAtMentionTriggerCallback:function(e){var t;if(this.props.enableNoAtMentions){if(!this.state.show_contacts&&e>0)return this.refreshDropdownDirection(),this.setState({show_contacts:!0}),this.isInNoAtMentionMode=!0,"function"==typeof(t=this.props).onNoAtSignKeyPress?t.onNoAtSignKeyPress():void 0;if(this.isInNoAtMentionMode&&0===e)return this.setState({show_contacts:!1}),this.isInNoAtMentionMode=!1}},setCursorToEndOfInput:function(){return setTimeout(function(e){return function(){var t,n;return e.focusInput(),t=e.$text_input[0].lastChild,null!=t?(n=document.createRange(),n.selectNode(t),n=n.cloneRange(),n.setStartAfter(t),n.collapse(!1),e._selection().removeAllRanges(),e._selection().addRange(n)):void 0}}(this),10)},_getCaretPosition:function(){var e,t,n;return t=this.refs.container.getDOMNode().getClientRects()[0],e={left:this.state.x_offset,top:this.state.y_offset},this._selection().rangeCount>0&&(n=this._selection().getRangeAt(0).getClientRects()[0],null!=n&&(e.left=n.left-t.left,e.top=this.props.contacts_should_dropdown?n.bottom-t.top:n.top-t.top)),e},unsafeInsertHtmlAtRange:function(t,n,o){var i,r,s,a;for(n.deleteContents(),a=e("<span />").html(t)[0],i=document.createDocumentFragment();s=a.firstChild;)r=i.appendChild(s);return n.insertNode(i),r&&o&&(n=n.cloneRange(),n.setStartAfter(r),n.collapse(!0),this._selection().removeAllRanges(),this._selection().addRange(n)),r},_checkEndOfLine:function(){var t,n,r,s,a;return i.assert(null!=o.mozilla,"_checkEndOfLine called from non mozilla browser"),a=this._extractCursorInfo(),n=a[0],r=a[1],s=a[2],e(n).hasClass("text-input")&&e(this.$text_input.contents()[r]).is("br")&&r>0&&(t=this.$text_input.contents()[r-1],t.nodeType===Node.TEXT_NODE&&t.nodeValue===E)?this._setCursorLocation(t,0):void 0},_selection:function(){return window.getSelection()},_setCursorLocation:function(t,n){var o;if(null!=t){if(o=document.createRange(),t.nodeType===Node.TEXT_NODE)o.setStart(t,n);else{if(!e(t).hasClass("new-mention"))return;0===n?o.setStartBefore(t):o.setStartAfter(t)}return o.collapse(!0),this._selection().removeAllRanges(),this._selection().addRange(o)}},_updateCurrentWordBoundary:function(){var e,t,n,o,i,r,s;return s=this._extractCursorInfo(),t=s[0],n=s[1],o=s[2],r=o.slice(0,n).lastIndexOf(" ")+1,e=o.slice(0,n).lastIndexOf(v)+1,e>r&&(r=e),i=o.slice(n).indexOf(" "),i=-1===i?o.length:n+i,this.currentCursorWordStartPosition=r,this.currentCursorWordEndPosition=i},_cleanMentionHighlighting:function(t){var n,o,i,r,s;for(null==t&&(t=null),o=this.$text_input.children(),null!=t&&(o=[t]),s=[],i=0,r=o.length;r>i;i++)n=o[i],s.push(e(n).removeClass("selected"));return s},_cleanUpNbsp:function(){var e;return e=this.$text_input.html(),e=e.replace(/\u00a0/g," "),e=e.replace(/\s{2,}/g," "),this.$text_input.html(e)},_cleanUpDelimiters:function(){var t,r,s,a,c,u,l,_,d,p;for(i.assert(null==o.msie,"_cleanUpDelimiters() called from MSIE"),d=this._extractCursorInfo(),r=d[0],s=d[1],u=d[2],p=this.$text_input.contents(),l=0,_=p.length;_>l;l++)t=p[l],t.nodeType===Node.TEXT_NODE?(t.nodeValue=t.nodeValue.replace(T,""),""===t.nodeValue&&(t!==r?t.parentNode.removeChild(t):s=0)):e(t).hasClass("new-mention")&&(c=document.createTextNode(n.sanitize(E)),t.parentNode.insertBefore(c,t),a=document.createTextNode(n.sanitize(E)),t.parentNode.insertBefore(a,t.nextSibling));return null!=r&&r.nodeType===Node.TEXT_NODE&&r.nodeValue.length<s&&(s=r.nodeValue.length),this._setCursorLocation(r,s),null==o.mozilla&&null!=r&&""===r.nodeValue?r.parentNode.removeChild(r):void 0},_checkAndMergeAdjacentNodes:function(){var t,n,r,a,c,u,l,_,d,p;return i.assert(null!=o.msie,"_checkAndMergeAdjacentNodes called from non IE browser"),d=this._extractCursorInfo(),c=d[0],u=d[1],_=d[2],!e(c).hasClass("text-input")&&!e(c).is("p")||(p=event.keyCode)!==s.BACKSPACE&&p!==s.DELETE||(t=e(c).contents()[u],(null!=t?t.nodeType:void 0)!==Node.TEXT_NODE)?void 0:(r=t.nodeValue,n=0,l=t.previousSibling,a=t.nextSibling,null!=l&&l.nodeType===Node.TEXT_NODE&&(n=l.nodeValue.length,r=l.nodeValue+r,l.parentNode.removeChild(l)),null!=a&&a.nodeType===Node.TEXT_NODE&&(r+=a.nodeValue,a.parentNode.removeChild(a)),t.nodeValue=r,this._setCursorLocation(t,n))},_isCursorAfterSpaceOrBeginningOfLine:function(e,t){var n;if(t-1>=0){if(n=e.slice(t-1,t)," "===n||""===n||" "===n)return!0}else if(0===t)return!0;return!1},_extractCursorInfo:function(){var e,t,n;return e=this._selection().focusNode,t=this._selection().focusOffset,n="",null!=e&&e.nodeType===Node.TEXT_NODE&&(n=e.nodeValue.length?e.nodeValue:""),[e,t,n]},_clearDefaultState:function(){return this.state.default_state&&this._clearInputWithoutBlurring(),this.state.in_edit_mode?void 0:this.setState({in_edit_mode:!0})},_clearInputWithoutBlurring:function(){return null!=o.msie?this.$text_input[0].innerText="":this.$text_input[0].textContent=""},clearTextField:function(){return this._clearInputWithoutBlurring(),this.setState({in_edit_mode:!1}),this.$text_input.blur()},_onInputKeydownMozilla:function(e){var t,n,r,a,c,u,l,_;if(i.assert(null!=o.mozilla,"_onInputKeydownMozilla called from non mozilla browser"),this._cleanUpDelimiters(),this._checkEndOfLine(),u=this._extractCursorInfo(),n=u[0],r=u[1],c=u[2],null!=n&&n.nodeType===Node.TEXT_NODE)if(a=n.previousSibling,t=n.nextSibling,(l=e.keyCode)===s.DELETE||l===s.RIGHT){if(c===E&&null!=t&&this._toggleMentionSelectState(t,e))return this._setCursorLocation(n,1);if(c.length!==r||null==t||t.nodeType!==Node.TEXT_NODE||t.nodeValue!==E)return this._cleanMentionHighlighting();if(null!=t.nextSibling&&this._toggleMentionSelectState(t.nextSibling,e))return this._setCursorLocation(t,1)}else if(((_=e.keyCode)===s.BACKSPACE||_===s.LEFT)&&0===r&&null!=a){if(c===E&&this._toggleMentionSelectState(a,e))return this._setCursorLocation(n,0);if(a.nodeType===Node.TEXT_NODE&&a.nodeValue===E&&null!=a.previousSibling&&this._toggleMentionSelectState(a.previousSibling,e))return this._setCursorLocation(a,0)}},_onInputKeydownMsie:function(t){var n,r,a,c,u,l,_,d,p,h,f;if(i.assert(null!=o.msie,"_onInputKeydownMsie called from non MSIE browser"),_=this._extractCursorInfo(),a=_[0],c=_[1],l=_[2],null!=a){if(e(a).hasClass("text-input")||e(a).is("p"))return n=e(a).contents(),((d=t.keyCode)===s.BACKSPACE||d===s.LEFT)&&c>0&&e(n[c-1]).hasClass("new-mention")?this._toggleMentionSelectState(n[c-1],t):(p=t.keyCode)!==s.DELETE&&p!==s.RIGHT||!e(n[c]).hasClass("new-mention")?this._cleanMentionHighlighting():this._toggleMentionSelectState(n[c],t);if(u=a.previousSibling,r=a.nextSibling,(h=t.keyCode)===s.BACKSPACE||h===s.LEFT){if(0===c&&null!=u&&e(u).hasClass("new-mention"))return this._toggleMentionSelectState(u,t)}else{if((f=t.keyCode)!==s.DELETE&&f!==s.RIGHT)return this._cleanMentionHighlighting();if(c===l.length&&null!=r&&e(r).hasClass("new-mention"))return this._toggleMentionSelectState(r,t)}}},_onInputKeydownWebkit:function(e){var t,n,r,a,c,u,l,_;if(i.assert(null!=o.webkit,"_onInputKeydownWebkit called from non webkit browser"),this._cleanUpDelimiters(),u=this._extractCursorInfo(),n=u[0],r=u[1],c=u[2],null!=n&&n.nodeType===Node.TEXT_NODE)if(a=n.previousSibling,t=n.nextSibling,(l=e.keyCode)===s.BACKSPACE||l===s.LEFT){if(null!=a&&c===E&&this._toggleMentionSelectState(a,e)){if(e.keyCode===s.BACKSPACE)return this._setCursorLocation(n,r-1);if(e.keyCode===s.LEFT)return this._setCursorLocation(a.previousSibling,1)}}else{if((_=e.keyCode)!==s.DELETE&&_!==s.RIGHT)return this._cleanMentionHighlighting();if(r!==c.length||null==t||t.nodeType!==Node.TEXT_NODE||t.nodeValue!==E&&0!==t.nodeValue.length){if(c===E&&0===r&&null!=t&&this._toggleMentionSelectState(t,e)){if(e.keyCode===s.DELETE)return this._setCursorLocation(n,1);if(e.keyCode===s.RIGHT)return this._setCursorLocation(t,1)}}else if(null!=t.nextSibling&&this._toggleMentionSelectState(t.nextSibling,e)){if(e.keyCode===s.DELETE)return this._setCursorLocation(t,1);if(e.keyCode===s.RIGHT)return this._setCursorLocation(t.nextSibling,1)}}},_onInputKeydown:function(e){var t,n,i,r,a,c,u,l;if(this.setState({default_state:!1}),this.setState({last_keydown:this._normalizeKeycode(e)}),this._normalizeKeycode(e)!==s.PROCESSING&&(!(this._selection().rangeCount>0&&this._selection().getRangeAt(0).collapsed||0===this._selection().rangeCount)||(c=e.keyCode)!==s.BACKSPACE&&c!==s.DELETE&&c!==s.LEFT&&c!==s.RIGHT?this._cleanMentionHighlighting():null!=o.webkit?this._onInputKeydownWebkit(e):null!=o.mozilla?this._onInputKeydownMozilla(e):null!=o.msie&&this._onInputKeydownMsie(e),"function"==typeof(a=this.props).onKeyDown&&a.onKeyDown(e),u=this._extractCursorInfo(),n=u[0],i=u[1],r=u[2],this.state.show_contacts))if(l=this._normalizeKeycode(e),__indexOf.call(S,l)>=0){if(this.contacts_selector.get_suggestions_count()>0){if(e.preventDefault(),this._normalizeKeycode(e)===s.ESC)return this.setState({show_contacts:!1})}else if(this._normalizeKeycode(e)===s.ENTER)return this.setState({show_contacts:!1})}else if(this._normalizeKeycode(e)===s.BACKSPACE&&(null!=n?n.nodeType:void 0)===Node.TEXT_NODE&&i>0&&(t=r.substr(i-1,1),"@"===t&&this._isCursorAfterSpaceOrBeginningOfLine(r,i-1)))return this.setState({show_contacts:!1})},_onInputKeypress:function(t){var n,i,r,a,c,u,l,_,d;return d=this._extractCursorInfo(),a=d[0],c=d[1],u=d[2],this._normalizeKeycode(t)===s.AT_SIGN&&!this.state.mention_triggered&&("function"==typeof(l=this.props).position_contacts_callback&&l.position_contacts_callback(),i=!1,a.nodeType===Node.TEXT_NODE?this._isCursorAfterSpaceOrBeginningOfLine(u,c)&&(i=!0,n=c):(e(a).hasClass("text-input")||null!=o.msie&&e(a).is("p"))&&(i=!0,n=0),i)?(r={search_start_position:n,search_end_position:n,mention_triggered:!0},this.setState(r),"function"==typeof(_=this.props).onAtSignKeyPress?_.onAtSignKeyPress():void 0):void 0},_onInputKeyup:function(e){var t,n,r,a,c,u,l,_,d,p,h,f;if(this.state.last_keydown===s.PROCESSING)return void i.assert(null!=o.webkit,"PROCESSING keycode detected in non-webkit browser");if(null!=o.msie&&this._checkAndMergeAdjacentNodes(),d=this._extractCursorInfo(),a=d[0],c=d[1],l=d[2],this.props.enableNoAtMentions&&this._updateCurrentWordBoundary(),r={},this.state.mention_triggered&&(r.mention_triggered=!1,r.show_contacts=!0,c-this.state.search_start_position>1&&(t=l.slice(this.state.search_start_position+1,c).indexOf("@"),r.show_contacts=-1===t?!0:!1)),!this.state.show_contacts&&!r.show_contacts||this.isInNoAtMentionMode)this.props.enableNoAtMentions&&(h=e.keyCode,__indexOf.call(S,h)>=0&&this.state.show_contacts&&this.contacts_selector.get_suggestions_count()>0?this.contacts_selector.navigate_suggestions(e):this.contacts_selector.get_suggestions(l.slice(this.currentCursorWordStartPosition,this.currentCursorWordEndPosition).trim(),!1));else if(p=e.keyCode,__indexOf.call(S,p)>=0&&this.contacts_selector.get_suggestions_count()>0)this.contacts_selector.navigate_suggestions(e);else if(c<=this.state.search_start_position||a.nodeType!==Node.TEXT_NODE)r.show_contacts=!1;else if(e.keyCode===s.SPACE)if(u=this._parseMentionQuery(l,this.state.search_end_position).trim(),0!==u.length){if(C(u))return n=this._createMentionObject(u),void this._addMentionIntoInput(n);this.contacts_selector.get_suggestions(u,!0)}else this.setState({show_contacts:!1});else this.contacts_selector.get_suggestions(this._parseMentionQuery(l,c).trim(),!0);return(e.keyCode===s.ENTER||e.keyCode===s.TAB||e.keyCode===s.SPACE&&!this.state.show_contacts&&!r.show_contacts)&&this._parseInputTextAndReplace(),null==o.msie&&(this._selection().rangeCount>0&&this._selection().getRangeAt(0).collapsed||0===this._selection().rangeCount)&&this._cleanUpDelimiters(),"function"==typeof(_=this.props).onKeyUp&&_.onKeyUp(e),f=this._normalizeKeycode(e),__indexOf.call(S,f)>=0&&this.state.show_contacts?void 0:this.setState(r,function(e){return function(){var t;return"function"==typeof(t=e.props).resize_callback?t.resize_callback():void 0}}(this))},_normalizeKeycode:function(e){return e.keyCode||e.which||e.charCode},_onInputBlur:function(){var e,t;return this._parseInputTextAndReplace(),"function"==typeof(t=this.props).onBlur&&t.onBlur(),e={show_contacts:!1,default_state:!1},this.state.in_edit_mode&&!this.getEncodedMessage().length&&(e.in_edit_mode=!1,e.search_end_position=-1,e.search_start_position=-1),this.setState(e)},_onInputFocus:function(e){var t,n;return e.target===this.$text_input.get(0)?("function"==typeof(n=this.props).onFocus&&n.onFocus(),t={show_contacts:!1},this.state.in_edit_mode||(t.in_edit_mode=!0,t.search_end_position=-1,t.search_start_position=-1),setTimeout(function(e){return function(){return e.isMounted()?e.setState(t):void 0}}(this),0)):void 0},_onInputMouseDown:function(){return this.setState({default_state:!1}),this._cleanMentionHighlighting()},_onInputPaste:function(e){var t;return this.setState({default_state:!1}),"function"==typeof(t=this.props).onPaste?t.onPaste(e):void 0},_createMentionObjectFromSuggestion:function(e){var t,n,o;return o=e.data("name"),n=e.data("identifier"),t=e.data("dbx-account-id"),this._createMentionObject(n,o,t)},_createMentionObject:function(e,t,n){return null==t&&(t=null),null==n&&(n=null),t||(t=e),{name:t,identifier:e,dbx_account_id:n}},_toggleMentionSelectState:function(t,n){if(e(t).hasClass("new-mention")){if(e(t).hasClass("selected"))return this._cleanMentionHighlighting(t),!0;n.stopPropagation(),n.preventDefault(),e(t).addClass("selected")}return!1},_onMentionMouseDown:function(e){var t;return e.preventDefault(),e.stopPropagation(),0===e.button?(this._cleanMentionHighlighting(),this._toggleMentionSelectState(e.target,e),t=document.createRange(),t.selectNode(e.target),this._selection().removeAllRanges(),this._selection().addRange(t)):null!=o.mozilla&&2===e.button?this._setCursorLocation(e.target,1):void 0},_mentionWrapper:function(e,t,n){return null!=o.webkit?"<span class='new-mention' data-id=\""+e+'" data-name="'+t+'" data-dbx-account-id="'+n+'">'+t+"</span>":'<input type="button" class=\'new-mention\' data-id="'+e+'" data-name="'+t+'" data-dbx-account-id="'+n+'" value="'+t+'"></input>'},_parseMentionQuery:function(e,t){var n;return t>this.state.search_end_position?this.setState({search_end_position:t}):t=this.state.search_end_position,n="",t<=e.length?n=e.slice(this.state.search_start_position,t):this.state.search_start_position<=e.length&&(this.setState({search_end_position:e.length}),n=e.slice(this.state.search_start_position)),n.replace("@","")},_addMentionIntoInput:function(t,i){var r,s,a,c,u,l,_,d,p,h,f,m;return u=this.refs.textInput.getDOMNode(),h=this._mentionWrapper(t.identifier,t.name,t.dbx_account_id),l=e(n.sanitize(h))[0],null!=o.webkit?l.setAttribute("contenteditable","false"):null!=o.mozilla&&l.setAttribute("style","margin-left:-3px; margin-right:-3px"),e(l).mousedown(function(e){return function(t){return e._onMentionMouseDown(t)}}(this)),null==i&&(m=this._extractCursorInfo(),a=m[0],c=m[1],p=m[2],i=document.createRange(),d=this.state.search_start_position,
r=this.state.search_end_position,this.state.show_contacts||(this.setState({search_start_position:a.length}),this.setState({search_end_position:a.length}),d=a.length,r=a.length),this.isInNoAtMentionMode&&(d=this.currentCursorWordStartPosition,r=this.currentCursorWordEndPosition),i.setStart(a,d),i.setEnd(a,r)),l=this.unsafeInsertHtmlAtRange(l,i,!0),s=l.nextSibling,null!=s&&s.nodeType===Node.TEXT_NODE?(s.nodeValue=v+s.nodeValue,this._setCursorLocation(s,1)):(_=document.createTextNode(n.sanitize(v)),e(_).insertAfter(l),this._setCursorLocation(_,1)),"function"==typeof(f=this.props).onMention&&f.onMention(t),this.setState({show_contacts:!1})},focusInput:function(){var e;return this.setState({in_edit_mode:!0}),e=this.refs.textInput.getDOMNode(),e.focus()},disableMentions:function(){return this.state.show_contacts?this.setState({show_contacts:!1}):void 0},mentionsEnabled:function(){return this.state.show_contacts},_encodedMention:function(e){return"@[%(identifier)s:%(name)s]".format({identifier:e.identifier,name:e.name})},extractMentions:function(){var t,n,o,i,r,s,a,c;for(i=this.$text_input.find(".new-mention"),r=[],a=0,c=i.length;c>a;a++)o=i[a],n=e(o).data("id"),s=e(o).data("name"),t=e(o).data("dbx-account-id"),r.push(this._createMentionObject(n,s,t));return r},_encodeHtml:function(t){var n,o,i,r,s,a,c,u,l;if(i="",r=!1,t=t.replace(T,""),null!=t&&""!==t)for(l=e.parseHTML(t),c=0,u=l.length;u>c;c++)n=l[c],n.nodeType===Node.TEXT_NODE&&""!==n.nodeValue?(r=!0,i+=n.nodeValue):n instanceof HTMLParagraphElement?(r=!0,i=i+this._encodeHtml(e(n).html())+"\n"):e(n).hasClass("new-mention")?(r=!0,o=e(n).data(),s=this._createMentionObject(o.id,o.name),i+=this._encodedMention(s)):e(n).is("br")?i+="\n":e(n).is("div")?(a=e(n).text(),r=r||a.length>0,i=i+"\n"+a):(a=e(n).text(),r=r||a.length>0,i+=a);return i!==this.props.placeholder_text&&r?i:""},getEncodedMessage:function(){var e;return e=this.$text_input.html(),this._encodeHtml(e)},render:function(){var e,n,i,r,s,a,l,f,m,v;return s={"text-input":!0,"edit-mode":this.state.in_edit_mode},l=b(s),a=!0,null!=o.webkit&&(a="plaintext-only"),e={ref:"textInput",className:l,contentEditable:a,defaultValue:this.props.initial_text,onKeyPress:this._onInputKeypress,onKeyDown:this._onInputKeydown,onKeyUp:this._onInputKeyup,onFocus:this._onInputFocus,onBlur:this._onInputBlur,onPaste:this._onInputPaste,onMouseDown:this._onInputMouseDown},u=w.div({className:"mention-text-input-wrapper"},w.div(e,this.state.in_edit_mode?void 0:this.props.placeholder_text)),v=p({ref:"contactSelector",contactSelectedCallback:this._contactSelectedCallback,noAtMentionTriggerCallback:this._noAtMentionTriggerCallback,show_contacts:this.state.show_contacts,should_dropdown:this.props.contacts_should_dropdown,y_offset:this.state.y_offset,x_offset:this.state.x_offset,user:this.props.user,last_keydown:this.state.last_keydown,resultsLimit:this.props.resultsLimit}),f=t.addons.classSet({"mentions-container":!0,"mentions-container-w-hint":this.props.showMentionsHelper}),m=t.addons.classSet({"mentions-input":!0,"mentions-input-w-bottom-sharp-corners":this.props.bottomSharpCorners}),w.div({className:f,ref:"container"},w.div({className:m,ref:"input"},u,this.props.showMentionsHelper?(i=w.a({className:"comment-mention-hint-add",onMouseUp:this._contactsSelectorPopupShown},_({group:"web",name:"s_mention_add"})),n=this.props.contacts_should_dropdown?"top":"bottom",r=this.props.contacts_should_dropdown?-18:-15,w.div({className:"comment-mention-hint"},d.Tooltip({position:d.TooltipPosition.LEFT,tooltip_contents:g({},"@mention someone"),tooltip_classname:"notification-names-tooltip"},w.div({className:"comment-mention-hint-button",onMouseDown:this.refreshDropdownDirection},c({target:i,ref:"mentionsHintDropdown",arrow_position:""+n+"-right",vertical_displacement:r,horizontal_displacement:-5,anchor_bottom:!this.props.contacts_should_dropdown,extra_css_class:"mentions-helper-bubble-dropdown",bubbleDropdownHidden:this._contactsSelectorPopupHidden},h({key:"mentionsContactSelectorPopup",ref:"mentionsContactSelectorPopup",shouldShowNoNotifyHint:this.props.shouldShowNoNotifyHint,user:this.props.user,emailEnteredCallback:this._emailEnteredCallback,contactSelectedCallback:this._contactPopupSelectedCallback,contactHighlightedCallback:this._contactHighlightedCallback,clearContactHighlightedCallback:this._clearContactHighlightedCallback,should_dropdown:this.props.contacts_should_dropdown,onAddPeopleMouseUp:this._onAddPeopleMouseUp,onSkipAddMention:this._onSkipAddMention})))))):void 0),v)}})}),define("modules/clean/react/activity/resolve_button",["external/react","modules/core/i18n","modules/clean/react/sprite","modules/clean/react/tooltip"],function(e,t,n){var o,i;return i=e.DOM,o=e.createClass({propTypes:{resolved:e.PropTypes.bool.isRequired,update_resolved:e.PropTypes.func.isRequired},render:function(){var e;return e={className:"resolved-icon",onMouseDown:function(e){return function(){return e.props.update_resolved(!e.props.resolved)}}(this),onMouseEnter:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseLeave:function(e){return function(){return e.setState({hover:!1})}}(this)},this.props.resolved?i.div({className:"resolve-wrapper"},i.div(e,n({group:"web",name:"s_greencheck"})),this.state.hover?i.div({className:"unresolve-text"},t._("Unresolve")):void 0):this.props.resolved?void 0:i.div({className:"resolve-wrapper"},i.div(e,n({group:"web",name:"s_greycheck"})),this.state.hover?i.div({className:"resolve-text"},t._("Resolve")):void 0)},getInitialState:function(){return{hover:!1}}})}),define("modules/clean/react/activity/users_to_notify",["external/react","modules/core/i18n","modules/clean/react/tooltip"],function(e,t,n){var o,i,r,s;return s=t._,r=t.ungettext,i=e.DOM,o=e.createClass({propTypes:{usersToNotify:e.PropTypes.array.isRequired,user:e.PropTypes.object.isRequired,show_extra_text:e.PropTypes.bool.isRequired},render:function(){var e,t,o,a,c,u;return e=function(){var e,t,n,o;for(n=this.props.usersToNotify,o=[],e=0,t=n.length;t>e;e++)u=n[e],u.id!==this.props.user.id&&o.push(u);return o}.call(this.props.user.is_signed_in?this:this),e.length>0?(c=i.div({className:"notification-names-container"},function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)u=e[t],o.push(function(){return function(e){return i.div({key:e.id},e.get_display_identity())}}(this)(u));return o}.call(this)),o=this.props.show_extra_text?r('Comments will notify <span class="blue">%(num)s person</span>. Anyone who can view this file can comment.','Comments will notify <span class="blue">%(num)s people</span>. Anyone who can view this file can comment.',e.length).format({num:e.length}):r('Comments will notify <span class="blue">%(num)s person</span>','Comments will notify <span class="blue">%(num)s people</span>',e.length).format({num:e.length}),t=i.div({dangerouslySetInnerHTML:{__html:o},className:"notification-names-target"}),n.Tooltip({position:n.TooltipPosition.TOP,tooltip_contents:c,tooltip_classname:"notification-names-tooltip"},t)):(a=s(this.props.show_extra_text?"Comments won't notify anyone yet. Anyone who can view this file can comment.":"Comments won't notify anyone yet"),i.div({dangerouslySetInnerHTML:{__html:a},className:"notification-names-target"}))}})}),define("modules/clean/react/bubble_dropdown",["jquery","external/keymaster","external/react","external/underscore"],function(e,t,n,o){var i,r,s,a,c;return a=n.DOM,s="react-bubble-dropdown-root",c=function(){var t;return t=e("#"+s),t.length||(t=e("<div />").attr({id:s}).prependTo("body")),t[0]},r=n.createClass({displayName:"BubbleDropdownContents",propTypes:{target:n.PropTypes.element.isRequired,arrow_position:n.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:n.PropTypes.number,horizontal_displacement:n.PropTypes.number},componentDidMount:function(){var t,n,o,i,r,a,c,u,l,_,d,p,h,f,m,g;switch(i=this._arrow_direction(),this.target_position={top:"bottom",left:"right",bottom:"top",right:"left"}[i],o=e(this.props.target.getDOMNode()),n=e(this.refs.dropdown.getDOMNode()),t=e(this.refs.arrow.getDOMNode()),d=e("#"+s).position().top,g=t.outerWidth(),c=t.outerHeight(),p=t.position().top,u=this.props.horizontal_displacement||0,l=t.position().left+u,m=this.props.vertical_displacement||0,h=c+d,this._arrow_direction()){case"left":r=0>h?"left+"+g+"px top+"+-h+"px":"left+"+g+"px top-"+h+"px";break;case"right":r=0>h?"right-"+g+"px top+"+-h+"px":"right-"+g+"px top-"+h+"px";break;case"top":h=c-d-m,r=0>h?"left-"+l+"px top-"+-h+"px":"left-"+l+"px top+"+h+"px";break;case"bottom":a=c+d-m,r=0>a?"left-"+l+"px bottom+"+-a+"px":"left-"+l+"px bottom-"+a+"px"}return f=function(e){return function(t){var n,i,r;return r=t.top,i=t.left,e.props.anchor_bottom?(n=document.documentElement.clientHeight-o.offset().top-m,e.setState({dropdown_style:{bottom:n,left:i}})):e.setState({dropdown_style:{top:r,left:i}})}}(this),_={my:r,at:this.target_position,of:o,collision:"none",using:f},n.position(_),n.position(_),this.props.show_arrow?void 0:(t.css("visibility","hidden"),e(".bubble-arrow-border").css("visibility","hidden"))},render:function(){return this.state.dropdown_style.display="right"===this._arrow_direction()?"block":"inline-block",a.div({className:"bubble-dropdown "+this.props.extra_css_class+" "+this.props.arrow_position,style:this.state.dropdown_style,ref:"dropdown"},this.props.children,a.div({className:"bubble-arrow-border"}),a.div({className:"bubble-arrow",ref:"arrow"}))},_arrow_direction:function(){var e;return"top"===this.props.arrow_position.substring(0,3)?e="top":"bottom"===this.props.arrow_position.substring(0,6)?e="bottom":"left"===this.props.arrow_position.substring(0,4)?e="left":"right"===this.props.arrow_position.substring(0,5)&&(e="right"),e},getInitialState:function(){return{dropdown_style:{}}}}),i=n.createClass({displayName:"BubbleDropdown",propTypes:{target:n.PropTypes.element.isRequired,arrow_position:n.PropTypes.oneOf(["top","top-left","top-right","bottom","bottom-left","bottom-right","right","right-top","right-bottom","left","left-top","left-bottom"]).isRequired,vertical_displacement:n.PropTypes.number,horizontal_displacement:n.PropTypes.number,show_arrow:n.PropTypes.bool,anchor_bottom:n.PropTypes.bool},getInitialState:function(){return this.eventId=o.uniqueId(),{}},getDefaultProps:function(){return{vertical_displacement:0,horizontal_displacement:0,anchor_bottom:!1,show_arrow:!0,extra_css_class:""}},render:function(){return a.span({className:"bubble-dropdown-container"},a.a({className:"bubble-dropdown-target",ref:"target",onMouseDown:this.preventSelection,onMouseUp:this.toggle},this.props.target))},render_tooltip:function(){var t,o;return o=c(),n.unmountComponentAtNode(o),this.shown?(e("#"+s).css("position","fixed"),this.props.anchor_bottom?(e("#"+s).css("bottom","0"),e("#"+s).css("top","auto")):(e("#"+s).css("top","0"),e("#"+s).css("bottom","auto")),t=r({target:this.refs.target,arrow_position:this.props.arrow_position,vertical_displacement:this.props.vertical_displacement,horizontal_displacement:this.props.horizontal_displacement,anchor_bottom:this.props.anchor_bottom,show_arrow:this.props.show_arrow,extra_css_class:this.props.extra_css_class},this.props.children),n.render(t,o)):void 0},preventSelection:function(e){return e.preventDefault()},componentDidMount:function(){return this.shown=!1,this.$target=e(this.refs.target.getDOMNode()),this.bodyClickHandler=function(t){return function(n){var o,i;if(t.shown)return o=e(n.target),o.is("select")?!0:(i=o.closest(t.$target).length||o.closest(e("#"+s)).length,i||t.hide(),!0)}}(this),e("body").on("mouseup."+this.eventId,this.bodyClickHandler)},bindDocHandlers:function(){return this.hasBindedDocHandlers?void 0:(key("esc",this.hideBubble),e("*").on("scroll."+this.eventId,this.hideBubble),e(window).on("resize."+this.eventId,this.hideBubble),this.hasBindedDocHandlers=!0)},unbindDocHandlers:function(){return this.hasBindedDocHandlers?(e("body").off("mouseup."+this.eventId),e("*").off("scroll."+this.eventId),e(window).off("resize."+this.eventId),this.hide()):void 0},hideBubble:function(){return this.shown?(this.hide(),!0):void 0},componentWillUnmount:function(){return this.unbindDocHandlers()},toggle:function(){return this.shown?this.hide():this.show()},show:function(){var e;return this.shown=!0,this.render_tooltip(),"function"==typeof(e=this.props).bubbleDropdownShown&&e.bubbleDropdownShown(),this.bindDocHandlers()},hide:function(){var e;return this.shown=!1,this.render_tooltip(),"function"==typeof(e=this.props).bubbleDropdownHidden?e.bubbleDropdownHidden():void 0}})}),define("modules/clean/react/button",["external/react"],function(e){var t,n;return n=e.DOM,t=function(t){return e.createClass({render:function(){var e,o,i,r;return i="",r=this.props.importance||"primary",i+=" button-"+r,this.props.variant&&"standard"!==this.props.variant&&(i+=" button-"+this.props.variant),this.props.className&&(i+=" "+this.props.className),o={className:i},this.props.disabled&&(o.disabled=!0),e=this.transferPropsTo(n[t](o,this.props.children))}})},{button:t("button"),link_button:t("a")}}),define("modules/clean/react/file_comments/comment_list_header",["jquery","external/react","modules/clean/activity/activity","modules/clean/react/activity/contacts_selector_popup","modules/clean/react/activity/users_to_notify_facepile","modules/clean/react/bubble_dropdown","modules/clean/react/file_comments/logger","modules/clean/react/react_i18n","modules/clean/react/sprite_div","modules/clean/react/tooltip"],function(e,t,n,o,i,r,s,a,c,u){var l,_,d,p;return p=t.DOM,d=a.R_,l=n.ActivityContext,_=t.createClass({propTypes:{activity:t.PropTypes.object,show_resolved:t.PropTypes.bool.isRequired,toggle_show_resolved_callback:t.PropTypes.func.isRequired,num_resolved:t.PropTypes.number.isRequired,hide_callback:t.PropTypes.func.isRequired,is_subscribed:t.PropTypes.bool.isRequired,onSubscribeButtonClicked:t.PropTypes.func.isRequired,feedback_off:t.PropTypes.bool.isRequired,turn_off_feedback_callback:t.PropTypes.func.isRequired,activity_context:t.PropTypes.number.isRequired,onFacepileContactAdded:t.PropTypes.func,shouldShowDisableButton:t.PropTypes.bool.isRequired,user:t.PropTypes.object},_is_browse_view:function(){return this.props.activity_context===l.BROWSE_FILE_VIEWER||this.props.activity_context===l.BROWSE_LIGHTBOX},_hide_comments:function(e){return this.refs.dropdown.hide(),this.props.hide_callback(e)},_toggle_show_resolved:function(){return 0===this.props.num_resolved||this.props.feedback_off?void 0:(this.refs.dropdown.hide(),this.props.toggle_show_resolved_callback())},_toggle_subscribe:function(){return this.props.feedback_off?void 0:(this.refs.dropdown.hide(),this.props.onSubscribeButtonClicked())},_turn_off_feedback:function(){return this.refs.dropdown.hide(),this.props.turn_off_feedback_callback()},contactSelectedCallback:function(e){var t;return this.refs.facepileContactSelectorDropdown.hide(),"function"==typeof(t=this.props).onFacepileContactAdded&&t.onFacepileContactAdded(e),s.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SELECTED,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.FACEPILE_ADD_BUTTON,this.props.user.id)},_contactsSelectorPopupShown:function(){return setTimeout(function(){return function(){return e(".contacts-selector-popup input").trigger("focus")}}(this),300)},_facepileContactsSelectorPopupShown:function(){return null!=this.props.activity&&this.props.enableFacepile?s.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SHOWN,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.FACEPILE_ADD_BUTTON,this.props.user.id):void 0},render:function(){var e,n,s,a,l,_,h,f,m,g,v;return a=[],s=p.a({key:"hide",className:"comments-header-menu-option hide",onMouseUp:this._hide_comments},c({group:"web",name:"s_hide",text:d({},"Hide comments")})),a.push(s),h=this.props.show_resolved?d({},"Hide resolved comments"):d({},"Show resolved comments"),l=t.addons.classSet({"comments-header-menu-option":!0,"toggle-resolved":!0,disabled:0===this.props.num_resolved||this.props.feedback_off}),_=p.a({key:"resolved",className:l,onMouseUp:this._toggle_show_resolved},c({group:"web",name:"s_resolve",text:h})),a.push(_),this.props.is_subscribed?(v=d({},"Unsubscribe from notifications"),m="s_notifications_off"):(v=d({},"Subscribe to notifications"),m="s_notifications_on"),f=t.addons.classSet({"comments-header-menu-option":!0,"toggle-subscribe":!0,disabled:this.props.feedback_off}),g=p.a({key:"subscribe",className:f,onMouseUp:this._toggle_subscribe},c({group:"web",name:m,text:v})),a.push(g),this.props.shouldShowDisableButton&&(n=p.a({key:"toggle-feedback-setting",className:"comments-header-menu-option toggle-feedback-setting",onMouseUp:this._turn_off_feedback},c({group:"web",name:"s_disable",text:d({},"Turn off comments")})),a.push(n)),p.div({className:"comment-list-header-container"},null!=this.props.activity&&this.props.enableFacepile?(this.props.user.is_signed_in?e=p.a({className:"comment-list-facepile-add-button",onMouseUp:this._contactsSelectorPopupShown},"+"):void 0,p.div({className:"comment-list-facepile"},u.Tooltip({position:u.TooltipPosition.BOTTOM,tooltip_contents:d({},"Subscribers will be notified of new comments"),tooltip_classname:"notification-names-tooltip"},p.div({className:"title"},d({},"Subscribers"))),p.div({},i({usersToNotify:this.props.activity.users_to_notify,user:this.props.user}),this.props.user.is_signed_in?p.div({className:"comment-list-facepile-add"},u.Tooltip({position:u.TooltipPosition.BOTTOM,tooltip_contents:d({},"Add subscribers"),tooltip_classname:"notification-names-tooltip"},r({ref:"facepileContactSelectorDropdown",target:e,arrow_position:"top-right",vertical_displacement:-24,horizontal_displacement:-14,bubbleDropdownShown:this._facepileContactsSelectorPopupShown,extra_css_class:"notify-facepile-bubble-dropdown"},p.div({},o({ref:"facepileContactSelectorPopup",contactSelectedCallback:this.contactSelectedCallback,should_dropdown:!0,user:this.props.user,key:"facepileContactsPopup"}))))):void 0))):void 0,p.div({className:"comment-list-header"},p.div({className:"comment-list-header-inner"},p.span({className:"title"},d({},"Comments")),p.span({className:"options"},r({ref:"dropdown",target:d({},"Options"),arrow_position:"top-right",vertical_displacement:8,extra_css_class:"comments-header-bubble-dropdown"},a))),p.hr({className:"separator"})))}})}),define("modules/clean/react/file_comments/logger",["modules/clean/ajax","modules/clean/activity/activity","modules/clean/activity/like","modules/clean/viewer","modules/core/exception"],function(e,t,n,o,i){var r,s;return r=function(){function t(){}return t.prototype.log_event=function(t,n,o,r,s,a){return i.assert(t,"event_type not provided"),i.assert(n,"file_activity_key not provided"),e.WebRequest({url:"/file_activity/client_log",type:"POST",data:{event_type:t,file_activity_key:n,comment_activity_key:o,client_origin_type:r,activity_context:a},subject_user:s})},t}(),s=new r}),define("modules/clean/react/form_error_mixin",["external/react"],function(e){var t,n;return n=e.DOM,t={propTypes:{errorWrapperClassName:e.PropTypes.string,"disable-errors":e.PropTypes.bool,"error-after":e.PropTypes.bool,error:e.PropTypes.shape({message_text:e.PropTypes.string,message_html:e.PropTypes.string})},renderErrorIfEnabled:function(){return this.props["disable-errors"]?void 0:this.renderError()},renderError:function(){var e,t;return null!=(null!=(e=this.props.error)?e.message_html:void 0)?n.div({className:this.props.errorWrapperClassName,dangerouslySetInnerHTML:{__html:this.props.error.message_html}}):n.div({className:this.props.errorWrapperClassName},null!=(t=this.props.error)?t.message_text:void 0)}}}),define("modules/clean/react/help/bubble_picker",["jquery","external/react","modules/clean/react/sprite"],function(e,t,n){var o,i;return i=t.DOM,o=t.createClass({propTypes:{color:t.PropTypes.oneOf(["gray","blue"]),header:t.PropTypes.node,onPick:t.PropTypes.func,options:t.PropTypes.arrayOf(t.PropTypes.shape({value:t.PropTypes.any.isRequired,label:t.PropTypes.node.isRequired,disabled:t.PropTypes.bool})),value:t.PropTypes.object},getDefaultProps:function(){return{color:"gray",options:[]}},getInitialState:function(){var e;return{value:null!=(e=this.props.value)?e:this.props.options[0].value,open:!1}},componentDidMount:function(){return this.globalMenuCloser=function(t){return function(n){var o;return t.state.open&&(o=e(n.target).closest(".bubble-picker-label"),!o.length||o[0]!==t.refs.label.getDOMNode())?t.setState({open:!1}):void 0}}(this),e(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return e(document).off("click",this.globalMenuCloser)},selectedOption:function(){var e,t,n,o;for(o=this.props.options,t=0,n=o.length;n>t;t++)if(e=o[t],e.value===this.state.value)return e},render:function(){var e;return i.div({className:"bubble-picker color-"+this.props.color,onClick:function(e){return function(){return e.setState({open:!e.state.open})}}(this)},i.div({className:"bubble-picker-label",ref:"label"},null!=this.props.header?this.props.header:[this.state.selected.label,n({group:"web",name:"arrow-down-"+this.props.color})]),this.state.open?i.div({className:"bubble-picker-dropdown chat-bubble"},function(){var t,n,o,i;for(o=this.props.options,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(function(e){return function(t){return e.renderOption(t)}}(this)(e));return i}.call(this),i.div({className:"chat-bubble-arrow-border"}),i.div({className:"chat-bubble-arrow"})):void 0)},renderOption:function(e){return i.div({className:e.disabled?"bubble-picker-option disabled":"bubble-picker-option",onMouseDown:function(t){return function(){var n;if(!e.disabled)return t.setState({value:e.value,open:!1}),"function"==typeof(n=t.props).onPick?n.onPick(e.value):void 0}}(this)},e.label)}})});var __hasProp={}.hasOwnProperty;define("modules/clean/react/image",["external/react","external/underscore","jquery","modules/clean/static_urls"],function(e,t,n,o){var i,r,s,a,c;return s=e.DOM,r=e.addons.classSet,c=function(e){var t;return t=e.lastIndexOf("."),-1!==t?[e.substring(0,t),e.substring(t+1)]:[e,""]},a=function(e){return!("/"===e[0]||0===e.indexOf("http:")||0===e.indexOf("https:"))},i=e.createClass({statics:{addStaticUrls:function(e){var n,i;return o.add_static_urls(t.object(function(){var t;t=[];for(n in e)__hasProp.call(e,n)&&(i=e[n],t.push([a(n)?"/images/"+n:n,i]));return t}()))}},propTypes:{alt:e.PropTypes.string,noHiRes:e.PropTypes.bool,src:e.PropTypes.string.isRequired,srcHiRes:e.PropTypes.string,onLoad:e.PropTypes.func},getDefaultProps:function(){return{alt:"",noHiRes:!1,_window:null}},getInitialState:function(){return{staticUrl:null,width:null,height:null}},render:function(){var e,n,o;return o=null!=this.state.staticUrl&&(!this.shouldUseHiRes()||null!=this.state.width&&null!=this.state.height),e={blankSrc:o},null!=this.props.className&&(e[this.props.className]=!0),n={alt:this.props.alt,className:r(e)},o&&t.extend(n,{src:this.state.staticUrl,width:this.state.width,height:this.state.height}),t.extend(n,t.pick(this.props,function(e,t){return t.match(/^(aria|data)-/)})),null!=this.props.id&&(n.id=this.props.id),s.img(n)},componentDidUpdate:function(e){return this.isMounted()&&this.props.src!==e.src?this.replaceState(this.getInitialState(),this.fetchStaticUrl):void 0},componentDidMount:function(){return this.fetchStaticUrl()},shouldUseHiRes:function(){var e,t;return e=null!=(t=this.props._window)?t:window,!this.props.noHiRes&&"devicePixelRatio"in e&&e.devicePixelRatio>1},getLocalImagePath:function(){var e,t,n,o;return n=this.shouldUseHiRes()?this.props.srcHiRes?this.props.srcHiRes:(o=c(this.props.src),e=o[0],t=o[1],o,""+e+"@2x."+t):this.props.src,a(n)?"/images/"+n:n},fetchStaticUrl:function(){var e,t,n;return null==this.state.staticUrl?(e=this.getLocalImagePath(),t=o.static_url(e),null!=t?this.setStaticUrl(t):o.multifetch_static_urls([e],function(t){return function(n){return t.setStaticUrl(n[e])}}(this))):null!=(n=this.props.onLoad)?n.apply(this.getDOMNode()):void 0},setStaticUrl:function(e){var t,o;return this.isMounted()?(o={staticUrl:e},this.shouldUseHiRes()?(t=new window.Image,n(t).on("load",function(e){return function(){return e.isMounted()?(o.width=t.width/2,o.height=t.height/2,e.setState(o,function(){var t;return null!=(t=e.props.onLoad)?t.apply(e.getDOMNode()):void 0})):void 0}}(this)),t.src=o.staticUrl):this.setState(o,function(e){return function(){var t;return null!=(t=e.props.onLoad)?t.apply(e.getDOMNode()):void 0}}(this))):void 0}})}),define("modules/clean/react/input",["external/react","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/sprite"],function(e,t,n,o,i,r){var s,a,c;return s=e.addons.classSet,a=e.DOM,c=function(c,u){return e.createClass({propTypes:{expandable:e.PropTypes.bool,expandedWidthOffset:e.PropTypes.number,animationCurve:e.PropTypes.string,animationDuration:e.PropTypes.number,onCloseClick:e.PropTypes.func,defaultValue:e.PropTypes.string,value:e.PropTypes.string,autofocus:e.PropTypes.bool,autoresize:e.PropTypes.bool,inline:e.PropTypes.bool,className:e.PropTypes.string,valueLink:e.PropTypes.object,variant:e.PropTypes.string,id:e.PropTypes.string,label:e.PropTypes.string,afterRender:e.PropTypes.func,onClick:e.PropTypes.func,onFocus:e.PropTypes.func,onKeyDown:e.PropTypes.func,onChange:e.PropTypes.func},mixins:[i],getDefaultProps:function(){return{errorWrapperClassName:"text-input-error-wrapper",expandedWidthOffset:90,expandable:!1,animationCurve:"easeOutSine",animationDuration:300}},getInitialState:function(){return{inputWidth:0,expanded:!1,value:this.props.defaultValue}},render:function(){var e,n,o,i,l,_,d,p,h,f,m;if(o={"text-input-input":!0,autofocus:this.props.autofocus,"password-input":"password"===u},i={"text-input":!0,"text-input-expandable":this.props.expandable,"text-input-inline":this.props.inline,"textarea-input":"textarea"===c},i[this.props.variant||"standard"]=!0,null!=this.props.className)for(h=this.props.className.split(/\s/),d=0,p=h.length;p>d;d++)n=h[d],i[n]=!0;return e=t.omit(this.props,"className","onChange","onFocus","onKeyDown","value","valueLink","ref","defaultValue"),_=a[c](t.extend({className:s(o),type:u,value:this.props.value||(null!=(f=this.props.valueLink)?f.value:void 0)||this.state.value,onChange:this.onChangeInternal,onFocus:this.onFocusInternal,onKeyDown:this.onKeyDownInternal,ref:"inputComponent",placeholder:this.props.placeholder||""},e)),l=this.renderErrorIfEnabled(),a.div({className:s(i)},this.props["error-after"]?void 0:l,a.div({className:"text-input-wrapper"},_,this.props.expandable?a.a({href:"#",onClick:this.onCloseClick,ref:"closeButton",className:"close-button"},r({group:"web",name:"xclose"})):void 0,this.props.value||(null!=(m=this.props.valueLink)?m.value:void 0)||this.state.value?void 0:a.label({htmlFor:this.props.id},this.props.label)),this.props["error-after"]?l:void 0)},getValue:function(){return this.refs.inputComponent.getDOMNode().value},setValue:function(e){return this.refs.inputComponent.getDOMNode().value=e,this.setState({value:e})},resizeComponent:function(){var e,t;return t=this.refs.inputComponent.getDOMNode(),e=n(t),e.css("height","1px"),e.css("height",t.scrollHeight+"px")},_renderFinished:function(){var e;return this.props.autoresize&&this.resizeComponent(),"function"==typeof(e=this.props).afterRender?e.afterRender():void 0},componentDidMount:function(){var e;return this._renderFinished(),e=this.refs.inputComponent.getDOMNode().offsetWidth,this.setState({inputWidth:e})},componentDidUpdate:function(){return this._renderFinished()},onCloseClick:function(e){var t,o,i;return null!=e&&e.preventDefault(),t=n(this.refs.closeButton.getDOMNode()),o=n(this.refs.inputComponent.getDOMNode()),t.stop().animate({opacity:0},this.props.animationDuration),o.stop().animate({width:this.state.inputWidth},this.props.animationDuration,this.props.animationCurve),"function"==typeof(i=this.props).onCloseClick&&i.onCloseClick(e),this.setState({expanded:!1})},onChangeInternal:function(e){var t;return"function"==typeof(t=this.props).onChange&&t.onChange(e),this.props.value?void 0:this.props.valueLink?this.props.valueLink.requestChange(e.target.value):this.setState({value:e.target.value})},onFocusInternal:function(e){var t,o,i,r,s,a;return"function"==typeof(a=this.props).onFocus&&a.onFocus(e),this.props.expandable!==!1?(r=n(e.target),t=n(this.refs.closeButton.getDOMNode()),i=this.state.inputWidth+this.props.expandedWidthOffset,s=parseInt(r.css("padding-right")),o=i-s+t.width()/2,t.css({left:o}),r.stop().animate({width:i},this.props.animationDuration,this.props.animationCurve,function(e){return function(){return t.stop().animate({opacity:1},e.props.animationDuration)}}(this)),this.setState({expanded:!0})):void 0},onKeyDownInternal:function(e){if(null!=this.state.expanded!=!1)switch(e.keyCode){case o.ESC:return e.target.blur(),this.onCloseClick()}}})},{password:c("input","password"),text:c("input","text"),textarea:c("textarea","text")}}),define("modules/clean/react/modal",["external/react","jquery","modules/core/i18n","modules/core/dom","modules/clean/react/button","modules/clean/keycode"],function(e,t,n,o,i,r){var s,a,c,u,l,_;return l=n._,u=e.DOM,s="react-modal-root",_=function(e){var n,o;return null==e&&(e=!0),n=s,o=t("#"+n),!o.length&&e&&(o=t("<div />").attr({id:n}).prependTo("body")),o[0]},a=e.createClass({statics:{showInstance:function(t){var n;return n=_(),e.unmountComponentAtNode(n),e.render(t,n)},close:function(){var t;return t=_(),t?e.unmountComponentAtNode(t):void 0},unhide:function(){var e;return e=_(),e?t(e).show():void 0},hide:function(){var e;return e=_(),e?t(e).hide():void 0}},close:function(){return a.close()},_invokeCallbackAndClose:function(e,t,n){return null!=e&&"function"==typeof e.call&&e.call(this,t),t.isDefaultPrevented()?void 0:this.props.autoClose||n?this.close():void 0},_dismiss:function(e){return this._invokeCallbackAndClose(this.props.onDismiss,e,!0)},_accept:function(e){return this._invokeCallbackAndClose(this.props.onAccept,e,!1)},propTypes:{width:e.PropTypes.number,submitting:e.PropTypes.bool,title:e.PropTypes.string,acceptButtonText:e.PropTypes.string,dismissButtonText:e.PropTypes.string,altAction:e.PropTypes.node,onAccept:e.PropTypes.func,onDismiss:e.PropTypes.func,onShow:e.PropTypes.func,buttonComponent:e.PropTypes.element,autoClose:e.PropTypes.bool,showX:e.PropTypes.bool,acceptButtonDisabled:e.PropTypes.bool,style:e.PropTypes.oneOf(["default","clean"]),setMaxHeight:e.PropTypes.bool},getDefaultProps:function(){return{acceptButtonText:l("OK"),dismissButtonText:null,buttonComponent:null,onAccept:function(){},onDismiss:function(){},onShow:function(){},autoClose:!0,style:"default",showX:!0,acceptButtonDisabled:!1}},_fitInViewport:function(){var e,n,o,i,r,s,a,c,u;return e=90,u=t(window).height(),n=t(this.getDOMNode()),r=n.find(".db-modal"),o=n.find(".db-modal-content"),s=r.height(),r.css(this.props.width?{width:this.props.width,marginLeft:-this.props.width/2}:{marginLeft:-r.width()/2}),s>u?(a=s-u,o.css({maxHeight:Math.max(50,o.height()-a),overflowY:"auto"}),r.css({top:0})):r.css(2*e>u-s?{top:"50%",marginTop:-(.5*s)}:{top:e,marginTop:0}),r.css({position:"fixed"}),this.props.setMaxHeight?(c=parseInt(o.css("padding-top"))+parseInt(o.css("padding-bottom")),i=u-o.offset().top-5-c,o.css({overflow:"auto",maxHeight:Math.max(100,i)})):void 0},_focus:function(){var e,n;return e=t(this.refs.modal.getDOMNode()),n=e.find("input").first(),n.length?e=n:this.refs.primaryButton?e=t(this.refs.primaryButton.getDOMNode()):this.refs.tertiaryButton&&(e=t(this.refs.tertiaryButton.getDOMNode())),e.focus()},_keyDown:function(e){return e.stopPropagation(),e.which===r.ESC&&this._dismiss(e),e.which!==r.BACKSPACE||o.focus_in_input()?void 0:(e.preventDefault(),this._dismiss(e))},_renderButtons:function(){var e;return this.props.buttonComponent?this.props.buttonComponent:(e=[],
this.props.submitting&&e.push(u.span({className:"dbmodal-loading"},u.img({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif"}))),this.props.acceptButtonText&&e.push(i.button({ref:"primaryButton",className:"dbmodal-button",importance:"primary",disabled:this.props.acceptButtonDisabled,onClick:this._accept},this.props.acceptButtonText)),this.props.dismissButtonText&&e.push(i.button({ref:"tertiaryButton",className:"dbmodal-button",importance:"tertiary",onClick:this._dismiss},this.props.dismissButtonText)),e.length?u.div({className:"db-modal-buttons"},e):void 0)},_renderAltAction:function(){return this.props.altAction?u.div({className:"db-modal__alt-action"},this.props.altAction):void 0},componentDidMount:function(){var e;return t(document).trigger("modalOpened",this),o.scroll_lock_document(),t(this.getDOMNode()).find("img").on("load",this._fitInViewport),this._fitInViewport(),t(this.refs.modal.getDOMNode()).on("keydown",this._keyDown),this._focus(),"function"==typeof(e=this.props).onShow?e.onShow():void 0},componentWillUnmount:function(){return t(document).trigger("modalClosed",this),o.scroll_unlock_document(),t(this.refs.modal.getDOMNode()).off("keydown",this._keyDown)},render:function(){var e;return e=this.props.className,"clean"===this.props.style&&(e+=" db-modal--clean-style"),u.div({className:e},u.div({className:"db-modal-overlay",onClick:this._dismiss}),u.div({ref:"modal",className:"db-modal",tabIndex:0},u.div({className:"db-modal-box"},this.props.showX?u.span({className:"db-modal-x",onClick:this._dismiss}):void 0,u.h2({className:"db-modal-title"},u.div({className:"db-modal-title-text"},this.props.title)),u.div({className:"db-modal-content clearfix"},this.props.children,this._renderButtons(),this._renderAltAction()))))}}),c={show:function(t){var n;return n={acceptButtonText:t.confirm_text,onAccept:t.confirm_callback,dismissButtonText:t.cancel_text,onDismiss:t.cancel_callback,title:t.title_text,width:t.width,className:"simple-modal",autoClose:t.autoclose},a.showInstance(new a(n,e.DOM.div({className:"simple-modal-content",dangerouslySetInnerHTML:{__html:t.body_html}})))}},{Modal:a,SimpleModal:c}});var __hasProp={}.hasOwnProperty,__slice=[].slice;define("modules/clean/react/react_i18n",["external/react","external/underscore","modules/core/i18n","modules/clean/react/util"],function(e,t,n,o){var i,r,s,a,c;return s=e.DOM,c=n._,a=function(e,n){var o,i,r;if(!t.isEmpty(n)){o={};for(i in n)__hasProp.call(n,i)&&(r=n[i],o[i]=t.escape(r));e=e.format(o)}return e},r=e.createClass({displayName:"R_",render:function(){var e,n,o,i;if(n=this.props.children,"string"!=typeof n)throw new Error("R_ can only take a single string child");return i=c(n),o=t.omit(this.props,"children"),e=a(i,o),s.span({dangerouslySetInnerHTML:{__html:e}})}}),i=e.createClass({displayName:"RP_",propTypes:function(){return{n:e.PropTypes.number}},render:function(){var i,r,c,u;if(r=[],"number"!=typeof this.props.n)throw new Error("RP_ requires a number prop for @props.n, got "+this.props.n);return e.Children.forEach(this.props.children,function(e){return r.push(o.getText(e))}),u=n.ungettext.apply(n,__slice.call(r).concat([this.props.n])),c=t.omit(this.props,"children","n"),i=a(u,c),s.span({dangerouslySetInnerHTML:{__html:i}})}}),{R_:e.createFactory(r),RP_:e.createFactory(i)}}),define("modules/clean/react/recaptcha_challenge",["jquery","external/react","modules/clean/react/form_error_mixin","modules/clean/react/image","modules/clean/react/input","modules/clean/react/react_i18n"],function(e,t,n,o,i,r){var s,a,c;return c=t.DOM,s=r.R_,a=t.createClass({mixins:[n],getDefaultProps:function(){return{public_key:"",errorWrapperClassName:"text-input-error-wrapper",variant:"standard"}},componentDidMount:function(){var t;return t=this.props.public_key,e.getScript("https://www.google.com/recaptcha/api/js/recaptcha_ajax.js",function(){return Recaptcha.create(t,"recaptcha_widget",{theme:"custom"})})},handleReloadLinkClick:function(){return Recaptcha.reload()},handleSwitchTypeToAudioLinkClick:function(){return Recaptcha.switch_type("audio")},handleSwitchTypeToImageLinkClick:function(){return Recaptcha.switch_type("image")},handleHelpLinkClick:function(){return Recaptcha.showhelp()},_renderButtons:function(){return c.div({className:""+this.props.variant+" recaptcha-buttons"},c.a({className:"recaptcha-button recaptcha-reload",onClick:this.handleReloadLinkClick},o({src:"icons/captcha-reload.png",noHiRes:!0})),c.a({className:"recaptcha-button recaptcha_only_if_image",onClick:this.handleSwitchTypeToAudioLinkClick},o({src:"icons/captcha-audio.png",noHiRes:!0})),c.a({className:"recaptcha-button recaptcha_only_if_audio",onClick:this.handleSwitchTypeToImageLinkClick},o({src:"icons/captcha-words.png",noHiRes:!0})),c.a({className:"recaptcha-button recaptcha-show-help",onClick:this.handleHelpLinkClick},o({src:"icons/captcha-help.png",noHiRes:!0})))},_renderRecaptchaResponseInput:function(){return i.text({id:"recaptcha_response",name:"recaptcha_response",className:"login-text-input","disable-errors":!0,label:s({},"Type the text")})},_renderDummyInput:function(){return c.input({type:"hidden",id:"recaptcha_response_field"})},_renderStandard:function(){var e;return e=this.renderErrorIfEnabled(),c.div({id:"recaptcha_widget",className:"standard recaptcha-container"},e,c.div({id:"recaptcha_image",className:"standard login-recaptcha-challenge-container"}),this._renderRecaptchaResponseInput(),this._renderButtons(),this._renderDummyInput())},_renderSmall:function(){var e;return e=this.renderErrorIfEnabled(),c.div({id:"recaptcha_widget",className:"small recaptcha-container"},e,c.div({id:"recaptcha_image",className:"small login-recaptcha-challenge-container"}),this._renderButtons(),this._renderRecaptchaResponseInput(),this._renderDummyInput())},render:function(){return"standard"===this.props.variant?this._renderStandard():"small"===this.props.variant?this._renderSmall():void 0},reload:function(e){return this.setProps({error:e}),Recaptcha.reload()}})}),define("modules/clean/react/select",["external/react","external/underscore","jquery","modules/clean/keycode","modules/clean/react/form_error_mixin","modules/clean/react/sprite","modules/clean/react/util"],function(e,t,n,o,i,r,s){var a,c,u,l,_,d;return c=e.addons.classSet,a=e.addons.cloneWithProps,u=e.DOM,l=function(e,t){var n,o,i,r;return r=e.scrollTop(),i=r+e.height(),o=t.position().top+r,n=o+t.height(),r>o?e.scrollTop(o):n>i?e.scrollTop(n-e.height()):void 0},d=e.createClass({propTypes:function(){return{disabled:e.PropTypes.bool,title:e.PropTypes.string,value:e.PropTypes.string}},render:function(){var e;return e={"list-item":!0,"select-option":!0,"select-option-disabled":this.props.disabled},this.transferPropsTo(u.div({className:c(e),"data-value":this.props.value,title:this.props.title},this.props.children))}}),_=e.createClass({mixins:[i],mouseInput:!0,propTypes:{name:e.PropTypes.string,onChange:e.PropTypes.func,defaultValue:e.PropTypes.string,style:e.PropTypes.object,value:e.PropTypes.string,variant:e.PropTypes.string,className:e.PropTypes.string,valueLink:e.PropTypes.object},getDefaultProps:function(){return{errorWrapperClassName:"select-input-error-wrapper",style:null}},getInitialState:function(){return{open:!1,focused:null,keyboarsSelectPrefix:"",value:this.props.defaultValue}},render:function(){var t,n;return t={"select-input":!0,"select-input-dropdown-shown":this.state.open},this.props.variant&&(t[this.props.variant]=!0),this.props.className&&(t[this.props.className]=!0),n={"list-menu":!0,"select-input-dropdown":!0,"select-input-disable-error":this.props["disable-errors"]},u.div({className:c(t),style:this.props.style},u.div({className:"hidden-select-wrapper"},u.select({tabIndex:-1,name:this.props.name,defaultValue:this.props.defaultValue,value:this.getValue()},e.Children.map(this.props.children,function(){return function(e){return u.option({value:e.props.value,disabled:e.props.disabled})}}(this)))),this.renderErrorIfEnabled(),u.div({className:"select-input-input",tabIndex:0,"aria-hidden":!0,onClick:this.toggle,onKeyDown:this.handleKeydown,onMouseMove:this.handleMouseMove,ref:"label"},this.selectedOption(),u.div({className:"select-input-dropdown-arrow"},r({group:"web",name:"arrow-down-gray"}))),u.div({style:{position:"relative"}},u.div({className:c(n),"aria-hidden":!0,ref:"dropdown"},this.menuChildren())))},handleMouseMove:function(e){var t,n;return(e.pageX!==t||e.pageY!==n)&&(this.mouseInput=!0),t=e.pageX,n=e.pageY},_commonPrefixLen:function(e,t){var o;for(e=n.trim(e).toLowerCase(),t=n.trim(t).toLowerCase(),o=0;o<e.length&&o<t.length&&e.charAt(o)===t.charAt(o);)o++;return o},_keyboardSelect:function(e){var n,o,i,r,s;return s=t.sortedIndex(this.sortedOptions,{text:e.toLowerCase()},"text"),i=this.sortedOptions[Math.max(s-1,0)],n=this.sortedOptions[Math.min(s,this.sortedOptions.length-1)],r=this._commonPrefixLen(e,i.text),o=this._commonPrefixLen(e,n.text),this.setState(r>=o?{keyboarsSelectPrefix:e,focused:i.value}:{keyboarsSelectPrefix:e,focused:n.value})},handleKeydown:function(e){var n,i;switch(this.mouseInput=!1,e.keyCode){case o.TAB:return this.setState({open:!1,focused:null}),!0;case o.ENTER:this.state.open&&this.state.focused?(this.setValue(this.state.focused),this.setState({open:!1})):this.toggle();break;case o.UP:this.setState(this.state.open?{focused:this.prev(this.state.focused)}:{open:!0});break;case o.DOWN:this.setState(this.state.open?{focused:this.next(this.state.focused)}:{open:!0});break;default:if(!this.state.open)return!0;t.contains(t.values(o),e.keyCode)||(n=String.fromCharCode(e.which),i=this.state.keyboarsSelectPrefix+n,this._keyboardSelect(i),this._keyboardSelect_timeout&&clearTimeout(this._keyboardSelect_timeout),this._keyboardSelect_timeout=setTimeout(function(e){return function(){return e.setState({keyboarsSelectPrefix:""}),e._keyboardSelect_timeout=null}}(this),500))}return!1},prev:function(t){var n,o;return n=null,o=null,e.Children.forEach(this.props.children,function(){return function(e){return o||(o=e),e.props.value===t&&(n=o),o=e}}(this)),null!=n?n.props.value:void 0},next:function(t){var n,o,i;return n=null,o=null,e.Children.forEach(this.props.children,function(){return function(e){return(null!=o?o.props.value:void 0)===t&&(n=e),o=e}}(this)),null!=(i=n||o)?i.props.value:void 0},menuChildren:function(){var t,n;return n=this.getValue(),t=e.Children.map(this.props.children,function(e){return function(t){var o;return o=a(t,{onMouseEnter:function(){return e.mouseInput?e.setState({focused:t.props.value}):void 0},onClick:function(){return t.props.disabled?void 0:(e.setState({open:!1}),e.setValue(t.props.value))},className:c({"focused-option":e.state.focused===t.props.value,"selected-option":n===t.props.value})})}}(this))},componentWillMount:function(){var o;return o=e.Children.map(this.props.children,function(e){return{value:e.props.value,text:n.trim(s.getText(e).toLowerCase())}}),this.sortedOptions=t.sortBy(o,"text")},componentDidMount:function(){return this.globalMenuCloser=function(e){return function(t){var o;return e.state.open&&(o=n(t.target).closest(".select-input-input"),!o.length||o[0]!==e.refs.label.getDOMNode())?e.setState({open:!1,focused:null}):void 0}}(this),n(document).on("click",this.globalMenuCloser)},componentWillUnmount:function(){return n(document).off("click",this.globalMenuCloser)},componentDidUpdate:function(){var e,t;return this.state.open&&this.state.focused?(t=n(this.refs.dropdown.getDOMNode()),e=t.find("[data-value='"+this.state.focused+"']"),l(t,e)):void 0},selectedOption:function(){var t;return t=null,e.Children.forEach(this.props.children,function(e){return function(n){return t||(t=n),(null!=n?n.props.value:void 0)===e.getValue()?t=n:void 0}}(this)),t?a(t):null},toggle:function(){return this.setState({open:!this.state.open,focused:null})},getValue:function(){var e,t,n;return null!=(e=null!=(t=this.props.value)?t:null!=(n=this.props.valueLink)?n.value:void 0)?e:this.state.value},setValue:function(e){var t,n;return t=this.getValue(),this.props.valueLink?this.props.valueLink.requestChange(e):this.setState({value:e}),t!==e&&"function"==typeof(n=this.props).onChange?n.onChange(t,e):void 0}}),{input:_,option:d,example:e.createClass({render:function(){return _({name:"field-name"},d({value:"0one"},"one"),d({value:"0two"},"twotwo"),d({value:"0three"},"threethreethree"),d({value:"1one"},"one"),d({value:"1two"},"twotwo"),d({value:"1three"},"threethreethree"),d({value:"2one"},"one"),d({value:"2two"},"twotwo"),d({value:"2three"},"threethreethree"),d({value:"3one"},"one"),d({value:"3two"},"twotwo"),d({value:"3three"},"threethreethree"))}})}}),define("modules/clean/react/sprite",["external/react"],function(e){var t,n;return n=e.DOM,t=e.createClass({render:function(){var e,t,o;return t=this.props.group,o=this.props.name,e=["sprite","sprite_"+t,"s_"+t+"_"+o],null!=this.props.className&&e.push(this.props.className),n.img({className:e.join(" "),src:"/static/images/icons/icon_spacer-vflN3BYt2.gif","data-src":this.props["data-src"],onClick:this.props.onClick})}})}),define("modules/clean/react/sprite_div",["external/react"],function(e){var t;return t=e.DOM,e.createClass({render:function(){var e,n,o;return e=this.props.group,n=this.props.name,o=this.props.text,t.div({className:"sprite-div"},t.div({className:"sprite-frame small icon-left"},t.img({className:"sprite sprite_"+e+" s_"+e+"_"+n,src:"/static/images/icons/icon_spacer-vflN3BYt2.gif"})),t.div({className:"sprite-text"},o))}})}),define("modules/clean/react/tooltip",["external/react","external/underscore","jquery"],function(e,t,n){var o,i,r,s,a,c,u,l,_;return c={TOP:0,BOTTOM:1,LEFT:2,RIGHT:3},u=e.DOM,i="tooltip-holder",o=7,r=1e3,_=function(){var e,t;return e=i,t=n("#"+e),t.length||(t=n("<div />").attr({id:e,style:"z-index: "+r}).prependTo("body")),t[0]},a=e.createClass({displayName:"TooltipBubble",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(l in c)e.push(c[l]);return e}()),tooltip_target_ref:e.PropTypes.object,contents:e.PropTypes.oneOfType([e.PropTypes.element,e.PropTypes.string]),tooltip_classname:e.PropTypes.string},_getDimensionsOfElement:function(e){var t,n,o;return n=e.offset(),o=e.outerWidth(),t=e.outerHeight(),{left_x:n.left,right_x:n.left+o,top_y:n.top,bottom_y:n.top+t,width:o,height:t}},render:function(){var e,t,i,r,s;return t=this._getDimensionsOfElement(n(this.props.tooltip_target_ref.getDOMNode())),i=n(window),s=n(window).scrollTop(),r=n(window).scrollLeft(),e=function(){switch(this.props.position){case c.TOP:return{bottom:i.height()-t.top_y+o+s};case c.BOTTOM:return{top:t.bottom_y+o-s};case c.LEFT:return{right:i.width()-t.left_x+o+r};case c.RIGHT:return{left:t.right_x+o-r}}}.call(this),u.div({className:"tooltip-bubble "+(this.props.className||""),ref:"tooltip",style:e},u.div({className:"tooltip-inner"},this.props.contents))},componentDidMount:function(){return this._centerAndShow()},componentDidUpdate:function(){return this._centerAndShow()},_centerAndShow:function(){var e,t,o,i,r,s,a,u,l;return e=n(this.refs.tooltip.getDOMNode()),r=this._getDimensionsOfElement(n(this.props.tooltip_target_ref.getDOMNode())),s=this._getDimensionsOfElement(e),i=n(window).scrollTop(),o=n(window).scrollLeft(),(u=this.props.position)===c.TOP||u===c.BOTTOM?(t=r.left_x+r.width/2-s.width/2-o,e.css("left",""+t+"px")):((l=this.props.position)===c.LEFT||l===c.RIGHT)&&(a=r.top_y+r.height/2-s.height/2-i,e.css("top",""+a+"px")),e.show()}}),s=e.createClass({displayName:"Tooltip",propTypes:{position:e.PropTypes.oneOf(function(){var e;e=[];for(l in c)e.push(c[l]);return e}()),tooltip_contents:e.PropTypes.element,tooltip_classname:e.PropTypes.string},render:function(){return u.div({className:"tooltip-target",onMouseMove:function(e){return function(t){return e._show(t)}}(this),onMouseLeave:function(e){return function(t){return e._hide(t)}}(this),id:this.state.tooltip_id,ref:"tooltipTarget"},this.props.children)},componentDidMount:function(){return n(document).bind("scroll."+this.state.event_id,function(e){return function(t){return e._hide(t)}}(this))},componentDidUpdate:function(){return this.state.visible?this._render_tooltip():void 0},componentWillUnmount:function(){var t;return n(document).unbind("scroll."+this.state.event_id),t=_(),e.unmountComponentAtNode(t)},_render_tooltip:function(){var t,o;return o=_(),n("#"+i).css("position","fixed"),n("#"+i).css("left","0"),n("#"+i).css("right","0"),this.props.position===c.TOP?(n("#"+i).css("top","auto"),n("#"+i).css("bottom","0")):(n("#"+i).css("top","0"),n("#"+i).css("bottom","auto")),t=a({position:this.props.position,contents:this.props.tooltip_contents,tooltip_target_ref:this.refs.tooltipTarget,className:this.props.tooltip_classname}),e.unmountComponentAtNode(o),e.render(t,o)},_show:function(){return this.state.visible?void 0:(this._render_tooltip(),this.setState({visible:!0}))},_hide:function(){var t;if(this.state.visible)return t=_(),e.unmountComponentAtNode(t),this.setState({visible:!1})},getInitialState:function(){return{visible:!1,event_id:t.uniqueId()}}}),{Tooltip:s,TooltipPosition:c}}),define("modules/clean/react/util",["external/react","external/underscore"],function(e){var t,n;return t=function(n){var o;return"string"==typeof n?n:"string"==typeof n.props?n.props:n.props.text?n.props.text:(o=[],e.Children.forEach(n.props.children,function(e){return o.push(t(e))}),o.join(""))},n=function(t,o,i){var r,s;return o(t)?i(t):(r=!1,s=[],e.Children.forEach(t.props.children,function(){return function(e){var t;return t=n(e,o,i),s.push(t),t!==e?r=!0:void 0}}(this)),r?e.addons.cloneWithProps(t,{children:s}):t)},{getText:t,replaceSubtree:n}}),define("modules/clean/referrer_cleansing_redirect",["external/sjcl","modules/core/browser","modules/core/cookies","modules/core/uri"],function(e,t,n,o){var i,r,s,a;return a=function(t){var o,i,r,s;return o=e.codec.utf8String.toBits(n.read(Constants.JS_CSRF_COOKIE)),s=e.codec.utf8String.toBits(t),i=new e.misc.hmac(o),r=i.encrypt(t),e.codec.base64.fromBits(r)},r=function(e){var t,n;return t=o.parse(e).scheme,t&&"http"!==t&&"https"!==t?"#":(n=new o({path:"/referrer_cleansing_redirect"}),n.setQuery({url:e,hmac:a(e)}),n)},s=function(e){return t.redirect(r(e))},i={get_redirect_uri:r,redirect:s}}),define("modules/clean/shared_link_error",["jquery","modules/clean/ajax"],function(e,t){var n;return n=function(){function n(){e("#broken-share-article").on("click",function(){return t.WebRequest({url:"/shared_link_error_log",data:{evt:o}})})}var o;return o="click-sharing-article",n}()}),define("modules/clean/sharing/namespace_conversion_alert_modal",["external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/dbmodal","modules/clean/react/modal","modules/core/i18n"],function(e,t,n,o,i,r){var s,a,c,u,l;return s=o.DBModalStack,a=i.Modal,l=r._,u=e.DOM,c=e.createClass({statics:{showInstance:function(e){return a.showInstance(e)}},propTypes:{user:e.PropTypes.object.isRequired,req_url:e.PropTypes.string.isRequired,req_data:e.PropTypes.object.isRequired,success_callback:e.PropTypes.func.isRequired},getInitialState:function(){return{converting_to_shared_folder:!1}},render:function(){return a({title:l("Convert to shared folder?"),acceptButtonText:l("Continue"),dismissButtonText:l("Cancel"),autoClose:!1,onAccept:this._onAccept,onDismiss:this.close,submitting:this.state.converting_to_shared_folder,ref:"modal"},u.div({},l("For other people to edit files in this folder, you have to convert it into a shared folder. Do you want to continue?")))},_onAccept:function(){return this.state.converting_to_shared_folder?void 0:(n.SimpleSharingLogger.log(this.props.user.id,24),t.FormWebRequest({subject_user:this.props.user.id,url:this.props.req_url,data:this.props.req_data,success:function(e){return function(t){return e.setState({converting_to_shared_folder:!1}),e.props.success_callback(t)}}(this),error:function(e){return function(){return e.setState({converting_to_shared_folder:!1})}}(this)}),this.setState({converting_to_shared_folder:!0}))},close:function(){return this.refs.modal.close()},componentDidMount:function(){return n.SimpleSharingLogger.log(this.props.user.id,23)}})}),define("modules/clean/sharing/share_inband",["jquery","external/underscore","modules/clean/ajax","modules/clean/analytics","modules/clean/contacts/importer","modules/clean/contacts/tokenizer","modules/clean/contacts/types","modules/clean/em_string","modules/clean/filepath","modules/clean/form","modules/clean/react/button","modules/clean/react/modal","modules/clean/react/select","modules/clean/sharing/namespace_conversion_alert_modal","modules/clean/sharing/non_namespace_manage_access_modal","modules/clean/sharing/shared_folder_settings_modal","modules/clean/sharing/shared_link_for_sf","modules/clean/viewer","modules/core/exception","modules/core/i18n","modules/core/notify","external/react"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w){var E,T,S,C,x,k,O,A,N,I,R,P;return S=r.ContactsTokenizer,T=r.ContactTokenValidator,E=r.ContactTokenState,C=_.Modal,A=v.assert,P=y._,R=y.ungettext,x={ACCESS_NO_ACCESS:0,ACCESS_READER:1,ACCESS_WRITER:2,ACCESS_OWNER:3},N=w.DOM,k=function(){function t(){}return t.createAndShowModal=function(t,i,r,l,_,d,f,m){var g,v,y,w,E;return w=a.em_snippet(c.filename(i),16),E=P("Share ‘%(filename)s’ with others").format({filename:w}),v=P(l?"Who do you want to share this folder with?":"Who do you want to share this file with?"),g=function(e){var n,s,a,c,u;return c=e._getSerializedData(),n=e.state.access_type,a=e.restore_inband_modal_with_can_manage_access,s=e.get_message(),u=e.state.show_message_field,e.close(),o.SimpleSharingLogger.log(t.id,19,"viewed"),d?r(t,i,a.bind(null,c,n,s,u,!0)):h.showInstance(h({user:t,fq_path:i,done_callback:a.bind(null,c,n,s,u)}))},y=function(o,r,a,c){var h,m,g,v,y,E,T;if(g=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)h=o[e],h.type===s.EMAIL&&n.push(h.email);return n}(),v=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)h=o[e],h.type===s.FB&&n.push(h.fb_id);return n}(),y=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)h=o[e],h.type===s.NEW_STYLE_GROUP&&n.push(h.fb_id);return n}(),E=g.length+v.length+y.length,T=function(t,n){var o,i,r,s,a,c;return a=u.parse_response(t),r=a[0],i=a[1],r?(n&&e(document).trigger("db:sf_new"),s=R("Shared ‘%(filename)s’!","Shared ‘%(filename)s’ with %(num_recipients)s people!",E),b.success(s.format({filename:w,num_recipients:E})),e(document).trigger("db:sharing_api:request_succeeded",{request_url:"",ns_id:_}),C.close()):(c=u.parse_error(i),r=c[0],o=c[1],r?b.error(o):b.error())},"edit"===r)if(d)n.FormWebRequest({subject_user:t.id,url:"/share_ajax/invite_more",data:{ns_id:_,emails:g,fb_ids:v,new_style_group_ids:y,custom_message:a,access_type:x.ACCESS_WRITER,is_simple_sharing:!0},success:T});else{if(!f)return l?A(!1,"Tried to share unshareable folder with edit access"):b.error(P("Not implemented yet!"));m={path:i,emails:g,fb_ids:v,new_style_group_ids:y,custom_message:a,access_type:x.ACCESS_WRITER,is_simple_sharing:!0,folder_settings:1,shared_link_policy:void 0,audience:void 0,inviter:c?void 0:"me"},(m.audience||m.inviter)&&(m.custom_folder_settings=1),p.showInstance(p({user:t,req_url:"/share_ajax/existing",req_data:m,success_callback:function(e){return T(e,!0)}}))}else n.FormWebRequest({subject_user:t.id,url:"/sm/share_inband",data:{fq_path:i,emails:g,fb_ids:v,new_style_group_ids:y,is_simple_sharing:!0,custom_message:a},success:T})},C.showInstance(O({user:t,fq_path:i,is_dir:l,title:E,recipient_prompt:v,send_handler:y,manage_access_handler:g,initial_can_manage_access:d,initial_access_type:"view",allows_edit:d||f,target_ns_id:_,is_shared_folder:d,sf_perm_role:m,could_be_shared_folder:f,initial_allows_editor_manage_membership:!d,initial_message:"",initial_show_message_field:!1}))},t}(),I=function(e){var t;return(t=e.type)!==s.FB&&t!==s.USER_GROUP&&t!==s.NEW_STYLE_GROUP},O=w.createClass({displayName:"ShareInbandModal",propTypes:{title:w.PropTypes.string.isRequired,user:w.PropTypes.object.isRequired,fq_path:w.PropTypes.string.isRequired,is_dir:w.PropTypes.bool.isRequired,recipient_prompt:w.PropTypes.string.isRequired,initial_access_type:w.PropTypes.string.isRequired,allows_edit:w.PropTypes.bool.isRequired,send_handler:w.PropTypes.func.isRequired,manage_access_handler:w.PropTypes.func,initial_can_manage_access:w.PropTypes.bool.isRequired,target_ns_id:w.PropTypes.number,is_shared_folder:w.PropTypes.bool.isRequired,sf_perm_role:w.PropTypes.number.isRequired,could_be_shared_folder:w.PropTypes.bool.isRequired,tokenizer_input:w.PropTypes.shape,initial_allows_editor_manage_membership:w.PropTypes.bool,initial_message:w.PropTypes.string,initial_show_message_field:w.PropTypes.bool},getInitialState:function(){return{access_type:this.props.initial_access_type,tokens:[],can_manage_access:this.props.initial_can_manage_access,show_message_field:this.props.initial_show_message_field,allows_editor_manage_membership:this.props.initial_allows_editor_manage_membership}},componentDidMount:function(){return o.SimpleSharingLogger.log(this.props.user.id,14),this.props.is_shared_folder&&this._updateAllowingEditorManageMembership(),this.state.can_manage_access||this._updateManageAccess(),this.state.show_message_field?this.refs.message_field.getDOMNode().value=this.props.initial_message:void 0},shouldComponentUpdate:function(e,n){return!t.isEqual(e,this.props)||!t.isEqual(n,this.state)},render:function(){var e;return e=this._getCustomContactValidator(),C({autoClose:!1,title:this.props.title,ref:"modal",buttonComponent:this._renderButtons()},N.div({className:"share-inband-container"},N.div({className:"prompt-line"},this.props.recipient_prompt,this._renderSettingsLink()),N.div({className:"recipients-container o-flag o-flag--rev o-flag--top"},S({ref:"tokenizer",customClass:"recipients-tokenizer o-flag__flex",user:this.props.user,importer:i.get_contacts_importer({user:this.props.user}),onContentsChange:this._setTokens,populatedInputData:this.props.tokenizer_input,customContactValidator:e,customContactFilter:I}),d.input({ref:"access",className:"invite-access o-flag__fix",value:this.state.access_type,onChange:function(e){return function(t,n){return e.props.allows_edit||"edit"!==n||(b.error(P("Can’t invite others to edit this folder.")),n="view"),e.setState({access_type:n})}}(this)},d.option({value:"view"},P("can view")),d.option({value:"edit",disabled:!this._can_edit()},P("can edit")))),this.state.show_message_field?N.div({className:"custom-message-container sick-input small"},N.textarea({ref:"message_field",className:"textinput act_as_block",placeholder:P("Message (optional)")})):void 0,this._renderManageAccessLink(),this._renderExternalTokenWarning(e)))},close:function(){return this.refs.modal.close()},get_message:function(){var e;return e=this.refs.message_field,e?e.getDOMNode().value:""},_getCustomContactValidator:function(){return T.basic},_renderButtons:function(){return N.div({className:"db-modal-buttons share-inband-buttons"},m({fq_path:this.props.fq_path,user:this.props.user,is_dir:this.props.is_dir,is_shared_folder:this.props.is_shared_folder,could_be_shared_folder:this.props.could_be_shared_folder,can_edit:this._can_edit()}),N.button({className:"dbmodal-button button-primary send-button",onClick:function(e){return function(){var t;return t=e._getRecipients(),0===t.length?void b.error(P("No one to share with! Please enter a valid recipient.")):e.props.send_handler(t,e.state.access_type,e.get_message(),e.state.allows_editor_manage_membership)}}(this)},P("Send")))},_setTokens:function(e){return this.setState({tokens:e}),this._validate_input(e)?this.setState({show_message_field:!0}):void 0},_validate_input:function(e){var t,n,o;for(n=0,o=e.length;o>n;n++)if(t=e[n],!t.invalid)return!0},_renderExternalTokenWarning:function(e){var t,n,o,i,r,s,a;if(!this.props.user.is_team)return!1;for(n=0,a=this.state.tokens,r=0,s=a.length;s>r;r++)t=a[r],t.invalid||e(t).state!==E.warn||(n+=1);return n>0?(o=g.get_viewer().team_name,i=P("Sharing with %(warned_tokens)s people outside of %(team_name)s").format({warned_tokens:n,team_name:o}),1===n&&(i=P("Sharing with 1 person outside of %(team_name)s").format({team_name:o})),N.span({className:"external-token-warning"},N.img({src:"/static/images/teams/sharefolder_warning-vflzbBoRL.png"}),i)):!1},_renderSettingsLink:function(){return this.props.could_be_shared_folder&&"edit"===this.state.access_type||this._can_see_settings_for_shared_folder()?l.link_button({className:"settings-link",importance:"standard",onClick:function(e){return function(){var t,n,o,i,r;return i=e._getSerializedData(),t=e.state.access_type,o=e.restore_inband_modal_with_allows_editor_manage_membership,n=e.get_message(),r=e.state.show_message_field,C.close(),f.showInstance(f({user:e.props.user,fq_path:e.props.fq_path,is_shared_folder:e.props.is_shared_folder,ns_id:e.props.target_ns_id,initial_allows_editor_manage_membership:e.state.allows_editor_manage_membership,done_callback:o.bind(null,i,t,n,r)}))}}(this)},P("Settings")):void 0},_updateManageAccess:function(){return n.WebRequest({url:"/sm/get_token",data:{path:this.props.fq_path},dataType:"json",subject_user:this.props.user.id,type:"POST",success:function(e){return function(t){return e.setState({can_manage_access:e.props.is_shared_folder||null!=t.tkey})}}(this)})},_updateAllowingEditorManageMembership:function(){return this.props.is_shared_folder?n.WebRequest({url:"/share_ajax/members_can_invite",data:{ns_id:this.props.target_ns_id},subject_user:this.props.user.id,dataType:"json",success:function(e){return function(t){return e.setState({allows_editor_manage_membership:t.allows_editor_manage_membership})}}(this)}):void 0},_can_see_settings_for_shared_folder:function(){return this.props.is_shared_folder&&this.props.sf_perm_role===x.ACCESS_OWNER},_can_edit:function(){return!this.props.is_shared_folder||this.props.sf_perm_role===x.ACCESS_OWNER||this.props.sf_perm_role===x.ACCESS_WRITER&&this.state.allows_editor_manage_membership},_renderManageAccessLink:function(){var e;return this.state.can_manage_access?(e=P("Manage Access"),N.span({className:"folder-members-link"},l.link_button({importance:"standard",onClick:function(e){return function(){return e.props.manage_access_handler(e)}}(this)},e))):void 0},_getSerializedData:function(){return this.refs.tokenizer.serializeInputData()},_getRecipients:function(){return this.refs.tokenizer.getContacts()},restore_inband_modal:function(e,t,n,o){return this.restore_inband_modal_with_settings(e,t,n,o,this.state.allows_editor_manage_membership,this.state.can_manage_access)},restore_inband_modal_with_allows_editor_manage_membership:function(e,t,n,o,i){return this.restore_inband_modal_with_settings(e,t,n,o,i,this.state.can_manage_access)},restore_inband_modal_with_can_manage_access:function(e,t,n,o,i){return this.restore_inband_modal_with_settings(e,t,n,o,this.state.allows_editor_manage_membership,i)},restore_inband_modal_with_settings:function(e,t,n,o,i,r){var s;return s=O({user:this.props.user,fq_path:this.props.fq_path,is_dir:this.props.is_dir,title:this.props.title,recipient_prompt:this.props.recipient_prompt,send_handler:this.props.send_handler,manage_access_handler:this.props.manage_access_handler,initial_can_manage_access:r,initial_access_type:t,allows_edit:this.props.is_shared_folder||this.props.could_be_shared_folder,target_ns_id:this.props.target_ns_id,is_shared_folder:this.props.is_shared_folder,sf_perm_role:this.props.sf_perm_role,could_be_shared_folder:this.props.could_be_shared_folder,tokenizer_input:e,initial_allows_editor_manage_membership:i,initial_message:n,initial_show_message_field:o}),C.showInstance(s)}}),k}),define("modules/clean/sharing/shared_link_for_sf",["jquery","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/filepath","modules/clean/react/button","modules/clean/react/sprite_div","modules/clean/sharing/shared_link_modal","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,c,u,l){var _,d,p;return p=c._,d=t.DOM,_=t.createClass({statics:{showInstance:function(e,n){return t.render(e,n)}},propTypes:{fq_path:t.PropTypes.string.isRequired,
user:t.PropTypes.object.isRequired,is_dir:t.PropTypes.bool.isRequired,is_shared_folder:t.PropTypes.bool.isRequired,could_be_shared_folder:t.PropTypes.bool.isRequired,can_edit:t.PropTypes.bool.isRequired},getInitialState:function(){return{fetching_link:!1}},render:function(){return d.div({className:"get-link-button-spinner"},d.button({className:"get-link-button dbmodal-button button-tertiary",onClick:function(t){return function(){return t.state.fetching_link?void 0:(t.setState({fetching_link:!0}),n.WebRequest({url:l({path:"/sm/token_for_sf"+i.normalize(t.props.fq_path)}),subject_user:t.props.user.id,type:"POST",dataType:"json",success:function(n){return e(document).trigger("db:browse:update"),t.setState({fetching_link:!1}),"ok"===n.status?a.showInstance(a({user:t.props.user,fq_path:t.props.fq_path,is_dir:t.props.is_dir,initial_editable:n.editable,visibility:n.visibility,link:n.link,can_reader_sync:!1,tkey:n.tkey,initial_is_shared_folder:t.props.is_shared_folder,initial_could_be_shared_folder:t.props.could_be_shared_folder,can_edit:t.props.can_edit})):"error"===n.status?u.error(n.msg):void 0},error:function(){return t.setState({fetching_link:!1})}}))}}(this)},s({group:"web",name:"s_link",text:p("Get link")})),this.state.fetching_link?d.img({src:"/static/images/icons/ajax-loading-small-vfl3Wt7C_.gif",className:"fetch-link-loading"}):void 0)}})}),define("modules/clean/sharing/shared_link_modal",["jquery","external/flash_detect","external/react","modules/clean/ajax","modules/clean/analytics","modules/clean/clipboard","modules/clean/dbmodal","modules/clean/em_string","modules/clean/filepath","modules/clean/form","modules/clean/react/modal","modules/clean/sharing/namespace_conversion_alert_modal","modules/clean/react/select","modules/clean/viewer","modules/core/i18n","modules/core/notify"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h,f){var m,g,v,y,b,w;return m=s.DBModalStack,g=l.Modal,w=h._,v={PUBLIC:1,TEAM_ONLY:2,PASSWORD:3},b=n.DOM,y=n.createClass({statics:{showInstance:function(e){return m.pop(),g.showInstance(e)}},propTypes:{user:n.PropTypes.object.isRequired,fq_path:n.PropTypes.string.isRequired,is_dir:n.PropTypes.bool.isRequired,initial_editable:n.PropTypes.bool.isRequired,link:n.PropTypes.string.isRequired,visibility:n.PropTypes.number.isRequired,can_reader_sync:n.PropTypes.bool.isRequired,tkey:n.PropTypes.string.isRequired,initial_is_shared_folder:n.PropTypes.bool.isRequired,initial_could_be_shared_folder:n.PropTypes.bool.isRequired,can_edit:n.PropTypes.bool.isRequired},getInitialState:function(){return{editable:this.props.initial_editable,is_shared_folder:this.props.initial_is_shared_folder,could_be_shared_folder:this.props.initial_could_be_shared_folder,can_copy_to_clipboard:FlashDetect.installed}},componentDidMount:function(){var t,n;return t=e(".simple-sharing-link-field").parent(),this.state.can_copy_to_clipboard?(n=function(e){return function(){return f.success(w("Link copied to clipboard")),i.SimpleSharingLogger.log(e.props.user.id,17)}}(this),r.clipboard_overlay(t.find(".simple-sharing-link-field .text-input-wrapper input").val(),t.find(".button-primary"),n,t.find(".simple-sharing-link-field"))):void 0},render:function(){var e,t;return t=a.em_snippet(c.filename(this.props.fq_path),16),e=w(this.state.can_copy_to_clipboard?"Copy Link":"Done"),g({title:w("Share ‘%(filename)s’ with others").format({filename:t}),acceptButtonText:e,ref:"modal"},b.div({className:"simple-sharing-access-label"},b.label({className:"access-label"},w("%(who_can_access)s with the link %(capability)s").format({who_can_access:this._renderWhoCanAccessLabel(this.props.visibility),capability:this._renderEditableLabel(this.state.editable)}))),b.div({className:"simple-sharing-link-field o-flag o-flag--rev o-flag--top"},b.div({className:"text-input standard o-flag__flex"},b.div({className:"text-input-wrapper"},b.input({readOnly:!0,type:"text",value:this.props.link,className:"text-input-input",onClick:this._select_all_text}))),this._renderEditDropdown()))},_renderEditDropdown:function(){return d.input({className:"oob-invite-access o-flag__fix","disable-errors":!0,value:this.state.editable?"edit":"view",onChange:function(e){return function(t,n){return e._permissionChanged(n)}}(this)},d.option({value:"view"},w("can view")),d.option({value:"edit",disabled:!this.props.can_edit},w("can edit")))},_renderWhoCanAccessLabel:function(e){return e===v.PUBLIC?w("Anyone"):e===v.TEAM_ONLY?w("%(team_name)s members").format({team_name:p.get_viewer().team_name}):e===v.PASSWORD?w("Anyone with the password"):void 0},_renderEditableLabel:function(e){return w(e?"can edit":"can view")},_select_all_text:function(t){return e(t.currentTarget)[0].select(),i.SimpleSharingLogger.log(this.props.user.id,18)},_change_sf_access:function(e,t,n){return o.WebRequest({url:"/sm/change_sf_access",data:{link_url:this.props.link,editable:e,can_sync:this.props.can_reader_sync},subject_user:this.props.user.id,type:"POST",success:t,error:n})},_update_sf_access:function(e){return this._change_sf_access(e,function(t){return function(){var n;return n=w(e?"Anyone with the link can edit":"Anyone with the link can view"),f.success(n),t.setState({editable:e})}}(this))},_restore_shared_link_modal:function(e,t){var n,o,i,r;return o=e&&t?!0:!1,i=e?!0:!1,n=!i,r=y({user:this.props.user,fq_path:this.props.fq_path,is_dir:this.props.is_dir,initial_editable:o,visibility:this.props.visibility,link:this.props.link,can_reader_sync:!1,tkey:this.props.tkey,initial_is_shared_folder:i,initial_could_be_shared_folder:n,can_edit:e||this.props.can_edit}),g.close(),y.showInstance(r)},_permissionChanged:function(e){var t,n,o;if(t="edit"===e,this.state.editable||t!==!0){if(this.state.editable&&t===!1)return this._update_sf_access(t)}else{if(this.state.could_be_shared_folder)return o=function(e){return function(n){var o,i,r,s,a,c,l;return c=u.parse_response(String(n)),s=c[0],r=c[1],s?(a=function(){var t;return document.fire("db:sf_new"),e._restore_shared_link_modal(!0,!0),t=JSON.parse(r),f.success(t.success_msg)},i=function(){return e._restore_shared_link_modal(!0,!1)},e._change_sf_access(t,a,i)):(e._restore_shared_link_modal(!1,!1),l=u.parse_error(r),s=l[0],o=l[1],s?f.error(o):f.error())}}(this),n={path:this.props.fq_path,emails:[],fb_ids:[],new_style_group_ids:[],custom_message:"",access_type:2,is_simple_sharing:!0,folder_settings:1,shared_link_policy:void 0,audience:void 0,inviter:void 0},_.showInstance(_({user:this.props.user,req_url:"/share_ajax/existing_no_recipient",req_data:n,success_callback:o}));if(this.state.is_shared_folder)return this._update_sf_access(t);if(!this.props.is_dir)return this._update_sf_access(t)}}})}),define("modules/clean/sprite",["jquery","modules/core/html"],function(e,t){var n;return n={SPACER:"/static/images/icons/icon_spacer-vflN3BYt2.gif",CLASS_PREFIX:"s_",_make_class:function(e,t){return this.CLASS_PREFIX+e+"_"+t},src:function(t,n,o){return this.clear(t),e(t).addClass(this._make_class(n,o))},replace:function(t,n,o,i){return e(t).removeClass(this._make_class(n,o)).addClass(this._make_class(n,i))},clear:function(t){var n;return n=t.className.split(" "),n=e.grep(n,function(e){return function(t){return t&&0!==t.indexOf(e.CLASS_PREFIX)}}(this)),t.className=n.join(" ")},make:function(t,n,o){var i;return o=this._prep_attrs(t,n,o),i=e("<img />",o),i[0]},html:function(e,n,o){var i,r;o=this._prep_attrs(e,n,o),i=["<img "];for(r in o)i.push(r,'="',t._raw_escape(o[r]),'" ');return i.push("/>"),new t(i.join(""))},_prep_attrs:function(e,t,n){var o;return null==n&&(n={}),n.src=n.src||this.SPACER,o=["sprite","sprite_"+e,this._make_class(e,t)],n["class"]&&o.push(n["class"]),n["class"]=o.join(" "),n},_get:function(e){return e.className},_set:function(e,t){return e.className=t,e.src=this.SPACER}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/sso_login_checks",["modules/clean/ajax"],function(e){var t;return t=function(){function t(e,t,n){this.$email_input=e,this.show_sso_fn=t,this.hide_sso_fn=n,this._check_sso_state=__bind(this._check_sso_state,this),e.on("input keyup change",this._check_sso_state)}return t._sso_check_in_flight={},t._sso_check_cache={},t.prototype._check_sso_state=function(){var n,o,i;return i=this.$email_input.val(),o=i.trim(),o.match(/^[^@\s]+@[^@\s]+\.[A-Za-z]{2,}$/)?(n=o.toLowerCase(),n in t._sso_check_cache?this._handle_sso_state(t._sso_check_cache[n]):t._sso_check_in_flight[n]?void 0:(t._sso_check_in_flight[n]=!0,e.WebRequest({url:"/sso_state",data:{email:o},success:function(e){return function(o){return o=JSON.parse(o),delete t._sso_check_in_flight[n],t._sso_check_cache[n]=o.user_sso_state,e.$email_input.val()!==i?e._check_sso_state():e._handle_sso_state(o.user_sso_state)}}(this),error:function(e){return function(){return delete t._sso_check_in_flight[n],e.hide_sso_fn()}}(this)}))):this.hide_sso_fn()},t.prototype._handle_sso_state=function(e){return"required"===e?this.show_sso_fn(!1):"optional"===e?this.show_sso_fn(!0):this.hide_sso_fn()},t}()}),define("modules/clean/static_resource_loader",["jquery"],function(e){var t,n,o,i,r;return r=function(){var e,t,n;return e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},t=function(t,n){return e.ajax({url:t,type:"get",success:function(t){return e("head").append("<style>"+t+"</style>"),"function"==typeof n?n():void 0}})},n=function(t,n){return e.ajax({dataType:"script",cache:!0,url:t,success:function(){return"function"==typeof n?n():void 0}})},i=function(e,t,n){var o,i,s,a,c,u,l,_;if(i={},!e)return void("function"==typeof n&&n());for(a=0,u=e.length;u>a;a++)s=e[a],i[s]=!1;for(o=function(e){var t,o,r;i[e]=!0,o=!0;for(t in i)if(r=i[t],!r){o=!1;break}return o&&"function"==typeof n?n():void 0},_=[],c=0,l=e.length;l>c;c++)s=e[c],_.push(t(s,r(o,this,s)));return _},o=function(e,o,r){var s,a;return a={css:!e,js:!o},s=function(e){var t,n,o;a[e]=!0,n=!0;for(t in a)if(o=a[t],!o){n=!1;break}return n&&"function"==typeof r?r():void 0},i(e,t,function(){return s("css")}),i(o,n,function(){return s("js")})},{async_multiload:o}});var __hasProp={}.hasOwnProperty;define("modules/clean/static_urls",["external/underscore","modules/clean/ajax"],function(e,t){var n,o,i,r,s;return s={},o=function(){var e,t;t=[];for(e in s)__hasProp.call(s,e)&&t.push(delete s[e]);return t},n=function(e){var t,n;for(t in e)__hasProp.call(e,t)&&(n=e[t],s[t]=n);return e},i=function(o,i){var r,a;return null==i&&(i=null),a=function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)r=o[e],r in s||n.push(r);return n}(),a.length>0?t.BackgroundRequest({url:"/web_ajax/static_urls",data:{paths:JSON.stringify(a)},type:"POST",success:function(t,a,c){return c.responseText.length?(n(JSON.parse(c.responseText)),"function"==typeof i?i(e.object(function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)r=o[e],n.push([r,s[r]]);return n}())):void 0):void 0}}):"function"==typeof i?i(e.object(function(){var e,t,n;for(n=[],e=0,t=o.length;t>e;e++)r=o[e],n.push([r,s[r]]);return n}())):void 0},r=function(e){return s[e]},{add_static_urls:n,clear_static_urls:o,multifetch_static_urls:i,static_url:r}});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/storage",[],function(){var e,t,n;return e=function(){function e(){}return e.storage=void 0,e.get=function(e){return this.storage&&window.JSON?JSON.parse(this.storage.getItem(e)):void 0},e.set=function(e,t){var n;if(this.storage&&window.JSON)try{return this.storage.setItem(e,JSON.stringify(t))}catch(o){if(n=o,!(n instanceof DOMException&&22===n.code))throw n}},e}(),n=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.storage=function(){try{return window.sessionStorage}catch(e){}}(),t}(e),t=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.storage=function(){try{return window.localStorage}catch(e){}}(),t}(e),{SessionStorage:n,LocalStorage:t}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/clean/teams/team_folder_modal",["modules/core/browser","modules/clean/components/ajax_form","modules/clean/dbmodal"],function(e,t,n){var o,i;return o=n.DBModal,i=function(n){function o(){return this.on_confirm_button_click=__bind(this.on_confirm_button_click,this),this._$form=__bind(this._$form,this),o.__super__.constructor.apply(this,arguments)}return __extends(o,n),o.prototype._$form=function(){return this.$modal_window.find(".new_team_folder_form")},o.prototype.on_confirm_button_click=function(e){return e.preventDefault(),this._$form().submit()},o.prototype.on_show=function(){var n;return n=this._$form(),new t(n),n.on(t.SUCCESS_EVENT,function(t){return function(n,o){return t.options.open_created_folder?e.redirect(o.sf_info.href):e.reload()}}(this)),this.options.back_fn?this.$modal_window.find("a.back").on("click",function(e){return function(t){return e.options.back_fn(t,e)}}(this)):void 0},o}(o)}),define("modules/clean/teams/trial_buy_now",["jquery","modules/clean/ajax","modules/clean/react/modal","modules/core/browser","modules/core/i18n"],function(e,t,n,o,i){var r,s,a;return a=i._,s=i.ungettext,r={showModal:function(e){var t,o;return o=a("Buy Dropbox for Business now"),t=s("You have <strong>%(days)s</strong> day remaining in your Dropbox for Business trial. Buy now to ensure that your team continues to work efficiently!","You have <strong>%(days)s</strong> days remaining in your Dropbox for Business trial. Buy now to ensure that your team continues to work efficiently!",e).format({days:e}),n.SimpleModal.show({title_text:o,body_html:t,confirm_text:a("Buy now"),confirm_callback:r._confirm,cancel_callback:r._cancel})},_confirm:function(){return e.ajax({type:"POST",url:"/team/setup/trial_buy_now/dismiss",success:function(){return function(){return o.redirect("/team/renew")}}(this)})},_cancel:function(){return e.post("/team/setup/trial_buy_now/dismiss")}}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/clean/tokenizer",["external/react","jquery","external/underscore","modules/clean/keycode","modules/clean/typeahead"],function(e,t,n,o,i){var r,s,a,c;return a=i.TypeaheadSelector,c=e.DOM,r=e.createClass({propTypes:{data:e.PropTypes.any,onRemove:e.PropTypes.func},render:function(){return this.transferPropsTo(c.a({className:"tokenizer-token",tabIndex:-1},String(this.props.data),this._makeCloseButton()))},_makeCloseButton:function(){return this.props.onRemove?c.span({className:"tokenizer-token-close",onClick:function(e){return function(){return e.props.onRemove(),!1}}(this),dangerouslySetInnerHTML:{__html:"&nbsp;"}}):""}}),s=e.createClass({displayName:"Tokenizer",propTypes:{customClass:e.PropTypes.string,dataSource:e.PropTypes.object.isRequired,initialInputText:e.PropTypes.string,onContentsChange:e.PropTypes.func,onTokenAdd:e.PropTypes.func,onTokenRemove:e.PropTypes.func,placeholderText:e.PropTypes.string,populatedTokenData:e.PropTypes.array,renderToken:e.PropTypes.func.isRequired,renderInput:e.PropTypes.func.isRequired,renderSelector:e.PropTypes.func.isRequired,stringTokenizer:e.PropTypes.func.isRequired,INPUT_OFFSET:e.PropTypes.number,TOKEN_OFFSET:e.PropTypes.number},getDefaultProps:function(){return{initialInputText:"",renderInput:function(){return c.input()},renderSelector:function(){return a()},renderToken:function(e){return r({data:e})},stringTokenizer:function(e,t){var n,o;return n=e.split(","),o=t?"":n.pop(),{tokens:n,value:o}},TOKEN_OFFSET:4,INPUT_OFFSET:16}},getInitialState:function(){return this.tokenData=this.props.populatedTokenData||[],{queryResults:null,tokenData:this.tokenData,selectedTokenIndex:null,inputWidth:150}},componentDidMount:function(){return this._resizeTokenizerInput(this.props.INPUT_OFFSET,this.props.TOKEN_OFFSET),this.refs.input.getDOMNode().value=this.props.initialInputText,t(this.refs.tokenizer_input.getDOMNode()).on("keydown",this._proxyKeys),document.addEventListener("click",this._handleDocumentClick,!1)},componentWillUnmount:function(){return t(this.refs.tokenizer_input.getDOMNode()).off("keydown",this._proxyKeys),document.removeEventListener("click",this._handleDocumentClick,!1)},componentDidUpdate:function(){return this._resizeTokenizerInput(this.props.INPUT_OFFSET,this.props.TOKEN_OFFSET)},render:function(){var t;return t={"react-tokenizer":!0},null!=this.props.customClass&&(t[this.props.customClass]=null!=this.props.customClass),c.div({onClick:this._handleMyClick,className:e.addons.classSet(t)},c.div({className:"tokenizer-input",ref:"tokenizer_input"},c.div({className:"token-container"},c.div({className:"tokenizer-accessory",ref:"tokenizer_accessory"},this.props.children),this._renderTokens(),this._renderInput())),this._renderSelector())},serializeInputData:function(){return{tokens:this.tokenData,value:this.refs.input.getDOMNode().value}},tokenizeAll:function(){var e,t;return e=this.refs.input.getDOMNode(),t=this.props.stringTokenizer(e.value,!0).tokens,t.length>0&&this.addTokens(t),e.value="",this.refs.selector.close()},addTokens:function(e){var t,o,i,r,s,a,c;if(o=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},r=n.map(this.tokenData,o),i=e.filter(function(e){var t;return t=o(e),__indexOf.call(r,t)<0}),this.tokenData=this.tokenData.concat(i),this.setState({tokenData:this.tokenData}),null!=this.props.onTokenAdd)for(a=0,c=i.length;c>a;a++)t=i[a],this.props.onTokenAdd(t);return"function"==typeof(s=this.props).onContentsChange?s.onContentsChange(this.tokenData,this.refs.input.getDOMNode().value):void 0},addToken:function(e){return this.addTokens([e])},removeTokens:function(e){var t,n,o,i,r,s,a,c,u,l;for(r=this.state.selectedTokenIndex,i=[],a=0,u=e.length;u>a;a++)t=e[a],o=this.tokenData.indexOf(t),-1!==o&&(r===o?r=null:r>o&&(r-=1),this.tokenData.splice(o,1),i.push(t));if(n=this.refs.input.getDOMNode(),n.focus(),this._setSelectedToken(r),this.setState({tokenData:this.tokenData,queryResults:null}),null!=this.props.onTokenRemove)for(c=0,l=i.length;l>c;c++)t=i[c],this.props.onTokenRemove(t);return"function"==typeof(s=this.props).onContentsChange?s.onContentsChange(this.tokenData,n.value):void 0},removeToken:function(e){return this.removeTokens([e])},_renderTokens:function(){var t,n,o,i,r,s,a,c,u;for(i=[],o=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},u=this.state.tokenData,n=a=0,c=u.length;c>a;n=++a)t=u[n],s=this.props.renderToken(t),r=this.state.selectedTokenIndex===n,i.push(e.addons.cloneWithProps(s,{ref:"token"+n,key:"token"+o(t),className:e.addons.classSet({selected:r}),onClick:this._setSelectedToken.bind(this,n),onRemove:this.removeToken.bind(this,t)}));return i},_renderSelector:function(){return e.addons.cloneWithProps(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._onSelect,onClose:this._clearResults})},_renderInput:function(){var t;return t=this.state.tokenData.length?"":this.props.placeholderText,e.addons.cloneWithProps(this.props.renderInput(),{ref:"input",style:{width:this.state.inputWidth},onChange:this._textUpdated,placeholder:t,onClick:this._setSelectedToken.bind(this,null)})},_getTokenizerInput:function(){return this.refs.tokenizer_input},_getTokenizerAccessory:function(){return this.refs.tokenizer_accessory},_getTokenComponents:function(){var e;return function(){var t,n,o;for(o=[],e=t=0,n=this.state.tokenData.length;n>=0?n>t:t>n;e=n>=0?++t:--t)o.push(this.refs["token"+e]);return o}.call(this).filter(function(e){return e})},_setSelectedToken:function(e){return null!=e?(this.refs["token"+e].getDOMNode().focus(),this.refs.selector.close()):this.refs.input.getDOMNode().focus(),this.setState({selectedTokenIndex:e})},_resizeTokenizerInput:function(e,t){var n,o,i,r,s,a,c,u,l,_;for(n=80,c=this._getTokenizerInput().getDOMNode().clientWidth,o=this._getTokenizerAccessory().getDOMNode().clientWidth,r=0,u=this._getTokenComponents(),l=0,_=u.length;_>l;l++)s=u[l],a=s.getDOMNode().clientWidth+t,r+a+e+o>c&&(r=0,o=0),r+=a;return i=c-r-e-o,n>i&&(i=c-e),i!==this.state.inputWidth?this.setState({inputWidth:i}):void 0},_onSelect:function(e){var t;return t=this.refs.input.getDOMNode(),t.focus(),t.value="",this.setState({queryResults:null}),this.addToken(e)},_handleMyClick:function(e){var t;return"function"==typeof(t=e.nativeEvent).stopImmediatePropagation?t.stopImmediatePropagation():void 0},_handleDocumentClick:function(){return this.refs.selector.close()},_proxyKeys:function(e){return this._shouldListenForTokenNavigation()&&!this._onTokenNavigate(e)?!1:this.refs.selector.onKeyDown(e)?!0:!1},_shouldListenForTokenNavigation:function(){var e;return this.state.tokenData.length?(e=this.refs.input.getDOMNode(),0===e.selectionStart&&0===e.selectionEnd):!1},_textUpdated:function(){var e,t,o,i,r,s;return e=this.refs.input.getDOMNode(),t=e.value,s=this.props.stringTokenizer(t),o=s.tokens,i=s.value,i!==t&&(e.value=i,i||this.refs.selector.close()),o.length>0?this.addTokens(o):"function"==typeof(r=this.props).onContentsChange&&r.onContentsChange(this.tokenData,i),this.props.dataSource.query(i,function(e){return function(t){var o,r;return i||(t=null),o=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},r=n.map(e.tokenData,o),t=null!=t?t.filter(function(e){var t;return t=o(e),__indexOf.call(r,t)<0}):null,e.setState({queryResults:t})}}(this))},_clearResults:function(){return this.setState({queryResults:null})},_onTokenNavigate:function(e){var t;if(0===this.state.tokenData.length)return!0;switch(t=this.state.selectedTokenIndex,e.keyCode){case o.BACKSPACE:return null===t?this._setSelectedToken(this.state.tokenData.length-1):this.removeToken(this.state.tokenData[t]),!1;case o.LEFT:return null===t?this._setSelectedToken(this.state.tokenData.length-1):t>0&&this._setSelectedToken(t-1),!1;case o.RIGHT:return null===t?!0:(this._setSelectedToken(t>=this.state.tokenData.length-1?null:t+1),!1);case o.DELETE:if(null!==t)return this.removeToken(this.state.tokenData[t]),!1;break;default:return!0}}}),{Token:r,Tokenizer:s}}),define("modules/clean/top_notif",["jquery"],function(e){var t,n,o,i,r,s;return s={HIDE_EVENT:"db:topnotificationbar:hide",hide:function(){return e("#top-notification-bar-container").hide(),e("body").removeClass("top-notification-bar"),e(document).trigger(this.HIDE_EVENT)}},o={init:function(){return e(".eu-bar-dismiss").on("click",function(t){return t.preventDefault(),s.hide(),e.ajax({url:"/dismiss_eu_cookie_notification",type:"POST"})})}},i={init:function(){return e(".expired-ios-bar-dismiss").on("click",function(t){return t.preventDefault(),s.hide(),e.ajax({url:"/dismiss_expired_ios_notification",type:"POST"})})}},n={init:function(){return e("#early-admin-access-fts-and-link-controls-banner-dismiss").on("click",function(t){return t.preventDefault(),s.hide(),e.ajax({url:"/team/dismiss_sharing_controls_banner",type:"POST"})})}},t={init:function(){return e("#early-admin-access-fts-banner-dismiss").on("click",function(t){return t.preventDefault(),s.hide(),e.ajax({url:"/team/dismiss_fts_banner",type:"POST"})})}},r={init:function(){return e("#locale-switch-banner-dismiss").on("click",function(t){return t.preventDefault(),s.hide(),e.ajax({url:"/dismiss_locale_switch_banner",type:"POST"})})}},{TopNotificationBar:s,EUCookieNotificationBar:o,ExpiredIOSNotificationBar:i,DfBAdminEarlyAccessSharingControlsBar:n,DfBAdminEarlyAccessFtsBar:t,LocaleSwitchBar:r}}),define("modules/clean/typeahead",["external/react","external/underscore","modules/clean/fuzzy","modules/clean/keycode"],function(e,t,n,o){var i,r,s,a,c;return c=e.DOM,r=function(){function e(e){this.local=(null!=e?e:{}).local}return e.prototype.query=function(e,o){var i;return i=t.map(n.filter(e,this.local),function(e){return e.original}),o(i)},e}(),a={getInitialState:function(){return{selectionIndex:0}},getOptions:function(){var e;return this.props.queryOptions?(e=this.props.maxVisible||this.props.queryOptions.length,this.props.queryOptions.slice(0,e)):[]},renderOptions:function(){var t,n,o,i,r,s,a,c,u;for(a=[],s=this.getOptions(),i=function(e){return("function"==typeof e.getKey?e.getKey():void 0)||String(e)},o=c=0,u=s.length;u>c;o=++c)n=s[o],t={selected:this.state.selectionIndex===o,"typeahead-option":!0},r=this.renderOption(n),a.push(e.addons.cloneWithProps(r,{className:e.addons.classSet(t),key:"option"+i(n),onMouseEnter:this._hover.bind(this,o),onClick:this.onSelect.bind(this,n)}));return a},onSelect:function(e){return this.props.onSelect(e),this.reset()},renderOption:function(e){return this.props.renderQueryOption(e)},onKeyDown:function(e){var t;switch(e.keyCode){case o.UP:return this._navigate(-1),!1;case o.DOWN:return this._navigate(1),!1;case o.ENTER:return t=this.getOptions(),t.length?(this.onSelect(t[this.state.selectionIndex]),!1):!0;case o.ESC:return this.close(),!1;case o.TAB:return t=this.getOptions(),t.length?(this.onSelect(t[this.state.selectionIndex]),!1):!0;default:return this.reset(),!0}},reset:function(){return this.setState({selectionIndex:0})},close:function(){var e;return"function"==typeof(e=this.props).onClose&&e.onClose(),this.reset()},_hover:function(e){return this.setState({selectionIndex:e})},_navigate:function(e){var t,n;return(n=this.getOptions().length)?(t=this.state.selectionIndex+e,0>t?t+=n:t>=n&&(t-=n),this.setState({selectionIndex:t})):void 0}},i=e.createClass({propTypes:{customClass:e.PropTypes.string,dataSource:e.PropTypes.object.isRequired,renderCompletionText:e.PropTypes.func.isRequired,renderInput:e.PropTypes.func.isRequired,renderSelector:e.PropTypes.func.isRequired},getDefaultProps:function(){return{renderCompletionText:function(e){return String(e)},renderInput:function(){return c.input()},renderSelector:function(){return s()}}},getInitialState:function(){return{queryResults:null}},render:function(){var t;return t={},t[this.props.customClass]=null!=this.props.customClass,c.div({className:e.addons.classSet(t)},this._renderInput(),this._renderSelector())},_renderInput:function(){return e.addons.cloneWithProps(this.props.renderInput(),{ref:"input",onChange:this._inputChanged,onKeyDown:this._proxyKeys})},_renderSelector:function(){return e.addons.cloneWithProps(this.props.renderSelector(),{ref:"selector",queryOptions:this.state.queryResults,onSelect:this._autocomplete,onClose:this._clearResults})},_inputChanged:function(){var e;return e=this.refs.input.getDOMNode().value,this.props.dataSource.query(e,function(t){return function(n){return e||(n=[]),t.setState({queryResults:n})}}(this)),this.refs.selector.reset()},_proxyKeys:function(e){return this.refs.selector.onKeyDown(e)},_autocomplete:function(e){var t;return t=this.refs.input.getDOMNode(),t.focus(),t.value=this.props.renderCompletionText(e),this._clearResults()},_clearResults:function(){return this.setState({queryResults:null})}}),s=e.createClass({mixins:[a],propTypes:{customClass:e.PropTypes.string,maxVisible:e.PropTypes.number,onClose:e.PropTypes.func.isRequired,onSelect:e.PropTypes.func.isRequired,queryOptions:e.PropTypes.array,renderQueryOption:e.PropTypes.func.isRequired},getDefaultProps:function(){return{maxVisible:7,onClose:function(){},onSelect:function(){},renderQueryOption:function(e){return c.li({},String(e))}}},render:function(){var t;return this.getOptions().length?(t={"typeahead-selector":!0},t[this.props.customClass]=null!=this.props.customClass,c.ul({className:e.addons.classSet(t)},this.renderOptions())):c.div({})}}),{Autocomplete:i,DataSource:r,TypeaheadSelector:s,TypeaheadSelectorMixin:a}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/uirequest",["jquery","modules/core/html","modules/core/notify","modules/clean/ajax","modules/clean/components/ajax_form","modules/clean/dbmodal","modules/clean/static_resource_loader"],function(e,t,n,o,i,r,s){var a,c;return a=r.DBModal,c=function(){function r(e,t,n){return this.$node=e,this.url=t,this.options=null!=n?n:{},this.complete=__bind(this.complete,this),this.handle_errors=__bind(this.handle_errors,this),this.error=__bind(this.error,this),this.perform_actions=__bind(this.perform_actions,this),this.success=__bind(this.success,this),this.shouldDelayComplete=!1,this.$node.hasClass("ajax-loading")?!1:(this.$node.addClass("ajax-loading"),void new o.WebRequest({url:this.url,data:this.options.data||{},success:this.success,error:this.error,complete:this.complete,subject_user:this.options.subject_user}))}return r.prototype.success=function(e,t,n){var o,r,a;return(o=i.extract_errors(n.responseText))?(this.handle_errors(o),void("function"==typeof(r=this.options).error&&r.error(n,t))):(e=JSON.parse(n.responseText),e.redirect?void(window.location.href=e.redirect):e.reload?void window.location.reload():(this.shouldDelayComplete=e.js||e.css,this.shouldDelayComplete?s.async_multiload(e.css,e.js,function(o){return function(){var i,r;return o.perform_actions(e.actions||[]),"function"==typeof(i=o.options).success&&i.success(e,t,n),o.$node.removeClass("ajax-loading"),"function"==typeof(r=o.options).complete?r.complete(n,t):void 0}}(this)):(this.perform_actions(e.actions||[]),void("function"==typeof(a=this.options).success&&a.success(e,t,n)))))},r.prototype.perform_actions=function(o){var i,r,s,c,u,l,_,d,p,h,f,m;for(m=[],h=0,f=o.length;f>h;h++)switch(r=o[h],c=r[0],s=r[1],p=r[2],i=this.$node,p&&"modal"!==c&&("^"===p.charAt(0)&&(l=p.split(" "),i=i.closest(l[0].substr(1)),p=l.slice(1).join(" ")),p&&(i=i.find(p).filter(":first"))),c){case"modal":_="db-modal-response-modal-placeholder",e("#"+_).remove(),d=e(s),d.attr("id",_),e("body").append(d),u=new a({element_id:"response-modal-placeholder"}),m.push(u.show());break;case"html":m.push(i.html(s));break;case"replaceWith":m.push(i.replaceWith(s));break;case"after":m.push(i.after(s));break;case"before":m.push(i.before(s));break;case"toggleClass":m.push(i.toggleClass(s));break;case"addClass":m.push(i.addClass(s));break;case"removeClass":m.push(i.removeClass(s));break;case"notify":m.push(n.success(s));break;case"notifyError":m.push(n.error(new t(s)));break;default:m.push(void 0)}return m},r.prototype.error=function(e,t){var n,o;return n=i.extract_errors(e.responseText),this.handle_errors(n),"function"==typeof(o=this.options).error?o.error(e,t):void 0},r.prototype.handle_errors=function(e){var o;return e===!1?n.error():"string"==typeof e?(o=this.options.html_in_error_msg?new t(e):e,n.error(o)):i.fill_errors(this.$node,e)},r.prototype.complete=function(e,t){var n;if(!this.shouldDelayComplete)return this.$node.removeClass("ajax-loading"),"function"==typeof(n=this.options).complete?n.complete(e,t):void 0},r}()}),define("modules/clean/undo",["jquery","modules/core/html","modules/core/i18n","modules/core/notify"],function(e,t,n,o){var i,r;return r=n._,i=function(){function t(){}return t.perform_undo=function(){return null!=this.undo_handler?(this.undo_handler(this.undo_info),this.undo_handler=this.undo_info=null):void 0},t.notifyWithUndo=function(n,i,s,a){var c,u;return a=a||30,i?(this.undo_info=i,this.undo_handler=s,c=e("<span />"),null!=n.toHTML?c.html(n.toHTML()):c.text(n),u=e("<a/>",{href:"#"}).text(r("Undo")),u.on("click",function(){return t.perform_undo(),!1}),c.append("&nbsp;").append(u),this.undo_notification=o.success(c,a)):o.success(n)},t}()}),define("modules/clean/unity/check_file_cache",["modules/clean/unity/features"],function(e){var t;if(null!=e)return t=function(){function t(){}return t._cache={},t.is_cached_and_locally_available=function(t,n){var o;return o=this._cache[e.server_path(t,n)],null!=o&&o.is_locally_available},t.get=function(t,n){return this._cache[e.server_path(t,n)]},t.set=function(e,t){return this._cache[e]=t;

},t.set_batch=function(e){var t,n,o;o=[];for(n in e)t=e[n],o.push(this._cache[n]=t);return o},t.clear=function(){return this._cache={}},t}(),__CONDITIONAL_JS__.UnityCheckFileCache=t,t});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/unity/connection",["jquery","modules/core/exception","modules/core/uri","modules/clean/ajax","modules/clean/gandalf_util","modules/clean/unity/connection_error","modules/clean/unity/logger","modules/clean/unity/web_socket"],function(e,t,n,o,i,r,s,a){var c;if(null!=a)return c=function(){function c(){this._on_response_timeout=__bind(this._on_response_timeout,this),this._on_message=__bind(this._on_message,this),this._set_connection_state=__bind(this._set_connection_state,this),this._on_error=__bind(this._on_error,this),this._on_close=__bind(this._on_close,this);var e,o,r,u,l,_,d;i.getGandalfRule("unity-web-debug")&&(window.uc=this),this.client_version=null,this._on_open_callbacks=[],this._on_open_failed_callbacks=[],this._on_close_callbacks=[],this._pending_callbacks=[],this._response_callbacks={},this._ws=null,this._port=null,this._active_ports={},this._connection_state=c._CONNECTION_PENDING,this._current_message_id=1,this.logger=new s,this._routes={check_unity_version:this._check_unity_version.bind(this),fetch_unity_nonce:this._fetch_unity_nonce.bind(this),complete_handshake:this._complete_handshake.bind(this)};try{for(o=l=_=c._MIN_PORT,d=c._MAX_PORT;d>=_?d>=l:l>=d;o=d>=_?++l:--l)this._active_ports[o]=!0,r={scheme:"ws",authority:"127.0.0.1:"+o.toString(),path:"/ws"},u=new a(n(r).toString()),u.onmessage=this._on_message({ws:u,port:o,state:c._CONNECTION_OPENED_STATE,client_version:null}),u.onclose=this._on_close(o),u.onerror=this._on_error(o)}catch(p){return e=p,this.logger.report_event("unity_failure",{message:"WebSocket creation failed. Message: "+e.message,error_name:e.name,port:o,stack:t.stackTrace()}),void this._set_connection_state(c._CONNECTION_CLOSED)}this.logger.report_event("handshake_started")}return c._CONNECTION_OPENED_STATE=0,c._VERSION_CHECK_STATE=1,c._FETCHING_NONCE_STATE=2,c._NONCE_RETURNED_TO_CLIENT_STATE=3,c._HANDSHAKE_COMPLETED_STATE=4,c._CONNECTION_PENDING=0,c._CONNECTION_ESTABLISHED=1,c._CONNECTION_CLOSED=2,c._RESPONSE_TIMEOUT=5e3,c._MIN_PORT=17600,c._MAX_PORT=17602,c.prototype._on_close=function(e){return function(t){return function(n){var o;return 1e3===(o=n.code)||1001===o||1005===o||1006===o||t.logger.report_event("unity_failure",{message:"WebSocket closed. Code: "+n.code+". Reason: "+n.reason,port:e}),t._close_port(e)}}(this)},c.prototype._on_error=function(e){return function(t){return function(n){return t.logger.report_event("unity_failure",{message:"WebSocket error. Message: "+n.data,port:e}),t._close_port(e)}}(this)},c.prototype._close_port=function(t){return delete this._active_ports[t],e.isEmptyObject(this._active_ports)?this._set_connection_state(c._CONNECTION_CLOSED):void 0},c.prototype._set_connection_state=function(e){var n,o,i,s,a,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T;if(e!==this._connection_state){if(i=this._connection_state,t.assert(i!==c._CONNECTION_CLOSED,"Shouldn't unclose a closed connection."),this._connection_state=e,e===c._CONNECTION_ESTABLISHED){for(t.assert(i===c._CONNECTION_PENDING,"Can only establish from pending."),this.logger.report_event("handshake_complete"),g=this._on_open_callbacks,_=0,h=g.length;h>_;_++)(a=g[_])();for(E=[];this._pending_callbacks.length;)v=this._pending_callbacks.pop(),n=v[0],o=v[1],E.push(this.is_ready()?n():"function"==typeof o?o(r.UNEXPECTED_ERROR):void 0);return E}if(e===c._CONNECTION_CLOSED){if(i===c._CONNECTION_PENDING)for(this.logger.report_event("connection_not_established"),y=this._on_open_failed_callbacks,d=0,f=y.length;f>d;d++)(u=y[d])();else if(i===c._CONNECTION_ESTABLISHED)for(this.logger.report_event("connection_terminated"),b=this._on_close_callbacks,p=0,m=b.length;m>p;p++)(s=b[p])();for(T=[];this._pending_callbacks.length;)w=this._pending_callbacks.pop(),l=w[0],o=w[1],T.push("function"==typeof o?o(r.CONNECTION_CLOSED):void 0);return T}return t.assert(!1,"Changing connection_state to CONNECTION_PENDING not yet supported.")}},c.prototype._on_message=function(e){return function(t){return function(n){var o,i,r,s,a,c;return i=JSON.parse(n.data),null==i.func||null==(null!=(s=i.header)?s.message_id:void 0)||null==(null!=(a=i.header)?a.should_respond:void 0)?void t._terminate_handshake(e.ws,"Malformed message from client.",{message:n.data}):(null!=(null!=(c=i.header)?c.log_data:void 0)&&t.logger.update(i.header.log_data),t.logger.update({port:e.port}),"response"===i.func?t._on_response(i.header.message_id,i.data):(o=t._routes[i.func],null==o?void t._terminate_handshake(e.ws,"Unknown function.",{"function":i.func}):(r=t.is_ready()?o(i.data):o(e,i.data),i.header.should_respond?t.send("response",r,null,null,i.header.message_id):void 0)))}}(this)},c.prototype.send=function(e,t,n,o,i){return null==t&&(t=null),null==n&&(n=null),null==o&&(o=null),null==i&&(i=null),this._send_with_ws(this._ws,e,t,n,o,i)},c.prototype._send_with_ws=function(e,n,o,i,s,a){var u,l,_;null==o&&(o=null),null==i&&(i=null),null==s&&(s=null),null==a&&(a=null),null==a&&(a=this._current_message_id,t.assert(this._current_message_id%2===1,"Web-initiated message_ids should remain odd"),this._current_message_id+=2),null!==i&&(_=window.setTimeout(this._on_response_timeout(a),c._RESPONSE_TIMEOUT),this._response_callbacks[a]=[i,s,_]),l={func:n,header:{message_id:a,should_respond:null!==i,log_data:this.logger.get_log_data_for_client()}},null!=o&&(l.data=o);try{return e.send(JSON.stringify(l))}catch(d){return u=d,this.logger.report_event("unity_failure",{message:"WebSocket send failed. Message: "+u.message,error_name:u.name}),"function"==typeof s?s(r.COULD_NOT_SEND):void 0}},c.prototype._on_response=function(e,t){var n,o,i,r;return e in this._response_callbacks?(r=this._response_callbacks[e],n=r[0],i=r[1],o=r[2],delete this._response_callbacks[e],window.clearTimeout(o),n(t)):void 0},c.prototype._on_response_timeout=function(e){return function(t){return function(){var n,o,i;return i=t._response_callbacks[e],o=i[0],n=i[1],o=i[2],delete t._response_callbacks[e],"function"==typeof n?n(r.CONNECTION_TIMEOUT):void 0}}(this)},c.prototype._check_unity_version=function(e,t){return e.state===c._CONNECTION_OPENED_STATE?(e.state=c._VERSION_CHECK_STATE,e.client_version=t.client_version,t.client_version>=2?(this.logger.report_event("handshake_version_check"),this._send_with_ws(e.ws,"initiate_handshake")):this._terminate_handshake(e.ws,"Client version is too old.")):this._terminate_handshake(e.ws,"Handshake version check at wrong time of protocol.")},c.prototype._fetch_unity_nonce=function(e,t){return e.state===c._VERSION_CHECK_STATE?(e.state=c._FETCHING_NONCE_STATE,this.logger.report_event("handshake_fetch_nonce"),this._retrieve_unity_nonce(e,t.nonce_key)):this._terminate_handshake(e.ws,"Fetch Unity nonce at wrong time of protocol.")},c.prototype._retrieve_unity_nonce=function(e,t){return o.WebRequest({url:n({path:"/retrieve_unity_nonce"}),dataType:"json",data:{nonce_key:t},success:function(t){return function(n){switch(n.status){case"OK":return e.state=c._NONCE_RETURNED_TO_CLIENT_STATE,t.logger.report_event("handshake_nonce_sent_to_unity_server"),n.message.client_has_auth||null==n.message.client_has_auth?t._send_with_ws(e.ws,"verify_unity_nonce",{nonce:n.message.nonce}):t._terminate_handshake(e.ws,"Connected to insecure client. Permission levels not supported yet.");case"MISMATCHED_USER_IDS":return t._terminate_handshake(e.ws,"Mismatched user_ids.",{client_user_ids:n.message.client_user_ids,web_user_ids:n.message.web_user_ids});case"INVALID":return t._terminate_handshake(e.ws,"Could not find nonce with given nonce_key.")}}}(this),error:function(t){return function(n,o,i){return t._terminate_handshake(e.ws,"Unable to retrieve nonce from server",{status:o,error_string:i})}}(this)})},c.prototype._complete_handshake=function(e,t){var n;return e.state===c._NONCE_RETURNED_TO_CLIENT_STATE&&t.is_success?(e.state=c._HANDSHAKE_COMPLETED_STATE,this._connection_state===c._CONNECTION_CLOSED?this._terminate_handshake(e.ws,"No more handshakes are allowed to complete."):null!=this._ws?(n="Only one Unity handshake can succeed! There's likely a MITM attack, so close all connections.",this._terminate_handshake(e.ws,n),this._terminate_handshake(this._ws,n),this.client_version=null,this._ws=null,this._port=null,this._set_connection_state(c._CONNECTION_CLOSED)):(this.client_version=e.client_version,this._ws=e.ws,this._port=e.port,this._set_connection_state(c._CONNECTION_ESTABLISHED))):this._terminate_handshake(e.ws,"Unable to complete handshake.")},c.prototype._terminate_handshake=function(t,n,o){var r;return null==o&&(o=null),r={message:n},null!=o&&e.extend(r,o),i.getGandalfRule("unity-web-debug")&&console.error(r),this.logger.report_event("unity_failure",r),t.close()},c.prototype.add_on_open_callback=function(e){return this._on_open_callbacks.push(e)},c.prototype.add_on_open_failed_callback=function(e){return this._on_open_failed_callbacks.push(e)},c.prototype.add_on_close_callback=function(e){return this._on_close_callbacks.push(e)},c.prototype.call_when_ready=function(e,t){return null==t&&(t=null),this.is_ready()?e():this._connection_state===c._CONNECTION_PENDING?this._pending_callbacks.push([e,t]):"function"==typeof t?t(r.CONNECTION_CLOSED):void 0},c.prototype.is_ready=function(){var e;return(null!=(e=this._ws)?e.readyState:void 0)===WebSocket.OPEN&&this._connection_state===c._CONNECTION_ESTABLISHED},c}()}),define("modules/clean/unity/features",["modules/clean/ajax","modules/clean/filepath","modules/clean/unity/connection","modules/core/exception","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s){var a,c;if(null!=n)return c=new n,a=function(){function n(){}return n.client_supports_open_in_file_browser=function(){return c.client_version>=4},n.open_file=function(n,i,r,a,u,l){var _;return null==u&&(u=null),null==l&&(l=!1),_=this.server_path(n,i),c.call_when_ready(function(){var n;return c.client_version>=2?(c.logger.report_event("open_file",{user_id:r,path_id:_,file_extension:t.file_extension_for_logging(_),in_file_browser:l}),e.AuthenticatedRequest({url:s({path:"/unity_open_log"}),data:{user_id:r,server_path:_,file_extension:t.file_extension_for_logging(_),in_file_browser:l,unity_session_id:c.logger.unity_session_id(),buildno:c.logger._data.buildno,host_id:c.logger._data.host_id}}),n={server_path:_,user_id:r},c.client_version>=4?n.in_file_browser=l:o.assert(!l,"The connected client doesn't support opening in file browser."),c.send("open_file",n,a,u)):void 0},u)},n.standard_open_file_handler=function(e){return e?void 0:r.error(i._("Error opening file"))},n.check_file=function(e,n,o,i,r){var s,a;return null==r&&(r=null),a=this.server_path(e,n),s=function(e){return function(t){return e._check_file_deprecated_on_client()&&(t={is_locally_available:t}),i(t)}}(this),c.call_when_ready(function(){return c.client_version>=2?(c.logger.report_event("check_file",{user_id:o,path_id:a,file_extension:t.file_extension_for_logging(a)}),c.send("check_file",{server_path:a,user_id:o},s,r)):void 0},r)},n.check_file_batch=function(e,n,o,i){var r,s,a;return null==i&&(i=null),a=function(){var t,n,o;for(o=[],t=0,n=e.length;n>t;t++)r=e[t],o.push(this.server_path(r.ns_id,r.ns_path));return o}.call(this),s=function(e){return function(t){var n,i;if(e._check_file_deprecated_on_client())for(n in t)i=t[n],t[n]={is_locally_available:i};return o(t)}}(this),c.call_when_ready(function(){var e;return c.client_version>=2?(c.logger.report_event("check_file_batch",{user_id:n,path_ids:a,file_extensions:function(){var n,o,i;for(i=[],n=0,o=a.length;o>n;n++)e=a[n],i.push(t.file_extension_for_logging(e));return i}()}),c.send("check_file_batch",{server_paths:a,user_id:n},s,i)):void 0},i)},n.file_browser_display_name=function(e,t){var n;return null==t&&(t=null),n=function(){return c.client_version>=5?(c.logger.report_event("file_browser_display_name"),c.send("file_browser_display_name",null,e,t)):e(null)},c.call_when_ready(n,t)},n._check_file_deprecated_on_client=function(){return 2<=c.client_version&&c.client_version<5},n.server_path=function(e,t){return""+e+":"+t},n}(),__CONDITIONAL_JS__.UnityFeatures=INLINE_JS.UnityFeatures=a,a}),define("modules/clean/unity/flash_config",["external/flash_detect","modules/clean/gandalf_util","modules/core/browser"],function(e,t){return window.DefaultWebSocket=window.WebSocket,window.FlashDetect.versionAtLeast(10,3)&&(window.WEB_SOCKET_FORCE_FLASH=!0),window.WEB_SOCKET_SWF_LOCATION=Constants.static_url_web_socket_swf,t.getGandalfRule("unity-web-debug")?void 0:window.WEB_SOCKET_LOGGER={log:function(){},error:function(){}}}),define("modules/clean/unity/web_socket",["modules/core/browser","modules/clean/unity/logger","external/web_socket"],function(e,t,n){var o,i;if(o=("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)?17603:17604,i=new t,null!=(null!=n?n.loadFlashPolicyFile:void 0))i.report_event("load_flash_policy_file"),n.loadFlashPolicyFile("xmlsocket://127.0.0.1:"+o);else{if(null==e.safari)return void i.report_event("unity_failure",{message:"Could not use WebSockets."});i.report_event("using_default_web_socket")}return n}),define("modules/clean/upsell/ha_loader",["jquery","modules/clean/ajax"],function(e,t){var n;return n={init:function(n,o,i){return o?t.WebRequest({url:"/promo",data:{campaign_id:i,ha_location:n},subject_user:o,success:function(){return function(t){return t&&"no_ad"!==t?e("#ha-container").html(t):void 0}}(this)}):void 0}}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/clean/upsell/upsell_controller",["jquery","modules/clean/dbmodal","modules/core/dom","modules/core/uri"],function(e,t,n,o){var i,r,s;return i=t.DBModal,r=t.DBModalStack,s=function(){function t(t,n,o){this.options=o,this.post_confirm=__bind(this.post_confirm,this),this.post_dismiss=__bind(this.post_dismiss,this),this.confirm=__bind(this.confirm,this),this.dismiss=__bind(this.dismiss,this),this._dismissUrl=__bind(this._dismissUrl,this),this._confirmUrl=__bind(this._confirmUrl,this),this._keydown=__bind(this._keydown,this),t.length>0&&t.one("click",this.confirm),n.length>0&&n.one("click",this.dismiss),this.options.dismissWithKeys&&e(document).on("keydown",this._keydown)}return t.ON_SHOW_EVENT_NAME="db:prompt:show",t.ON_CONFIRM_EVENT_NAME="db:prompt:confirm",t.ON_DISMISS_EVENT_NAME="db:prompt:dismiss",t.PRE_CONFIRM_EVENT_NAME="db:prompt:pre-confirm",t.PRE_DISMISS_EVENT_NAME="db:prompt:pre-dismiss",t.prototype._keydown=function(t){return 27===t.keyCode||8===t.keyCode&&!n.focus_in_input()?(t.preventDefault(),e(document).off("keydown",this._keydown),this.dismiss(t)):void 0},t.prototype._campaignUrl=function(e){var t;return this.options&&this.options.campaignId?(t=o({path:e}).updateQuery({campaign_id:this.options.campaignId}),t.toString()):void 0},t.prototype._confirmUrl=function(){return this._campaignUrl("/upsell/confirm")},t.prototype._dismissUrl=function(){return this._campaignUrl("/upsell/dismiss")},t.prototype._confirmOrDismiss=function(t,n,o,i){return"keydown"===t.type||o||(t.stopImmediatePropagation(),t.preventDefault()),e.ajax({type:"POST",url:n,success:function(n){return function(){return"keydown"===t.type||o||t.target.click(),e(document).trigger(i,{campaignName:n.options.campaignName})}}(this)})},t.prototype.dismiss=function(n){var o;return o=this._dismissUrl(),o&&this._confirmOrDismiss(n,o,!1,t.ON_DISMISS_EVENT_NAME),e(document).trigger(t.PRE_DISMISS_EVENT_NAME,{campaignName:this.options.campaignName})},t.prototype.confirm=function(n){var o;return o=this._confirmUrl(),o&&this._confirmOrDismiss(n,o,this.options.confirmInNewTab,t.ON_CONFIRM_EVENT_NAME),e(document).trigger(t.PRE_CONFIRM_EVENT_NAME,{campaignName:this.options.campaignName})},t.prototype.log_impression=function(){var t;return t=this._campaignUrl("/upsell/log_impression"),t?e.post(t):void 0},t.prototype.log_event=function(t){var n;return this.options&&this.options.campaignId?(n=o({path:"/upsell/log_event"}).updateQuery({event_name:t,campaign_id:this.options.campaignId}),e.post(n.toString())):void 0},t.prototype.post_dismiss=function(){var t;return t=this._dismissUrl(),t?e.post(t):void 0},t.prototype.post_confirm=function(){var t;return t=this._confirmUrl(),t?e.post(t):void 0},t.register_custom_controller=function(n,o,i,r,s){return e(document).on(t.ON_SHOW_EVENT_NAME,n),e(document).on(t.ON_CONFIRM_EVENT_NAME,o),e(document).on(t.ON_DISMISS_EVENT_NAME,i),e(document).on(t.PRE_CONFIRM_EVENT_NAME,r),e(document).on(t.PRE_DISMISS_EVENT_NAME,s)},t}()});var __hasProp={}.hasOwnProperty;define("modules/clean/user",[],function(){var e;return e=function(){function e(e){var t;for(t in e)__hasProp.call(e,t)&&"string"==typeof t&&"_"!==t[0]&&(this[t]=e[t])}return e.prototype.toString=function(){return String(this.id)},e}()});var __hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e},__slice=[].slice;define("modules/clean/validators/validators",["jquery","external/underscore","modules/core/i18n","modules/core/instantiate"],function(e,t,n,o){var i,r,s,a,c,u,l,_,d,p,h,f,m;return f=n._,m={},p=function(e,t){return m[e]=t},d=function(e){var t,n;if(n=e[0],t=e.slice(1),!m[n])throw new Error("Cannot find validator of type "+n);return o.construct(m[n],t)},l=function(){function e(e){this.messages=t.extend({},this.constructor.messages,null!=e?e.messages:void 0)}return e}(),r=function(e){function n(){var e,o,i;i=1<=arguments.length?__slice.call(arguments,0):[],o=null,t.isArray(t.last(i))||(o=t.last(i),i=t.initial(i)),this.validators=function(){var t,n,o;for(o=[],t=0,n=i.length;n>t;t++)e=i[t],null!==e&&o.push(d(e));return o}(),n.__super__.constructor.call(this,o)}return __extends(n,e),n.prototype.validate=function(e,t){var n,o,i,r,s;for(r=this.validators,s=[],o=0,i=r.length;i>o;o++)n=r[o],s.push(n.validate(e,t));return s},n}(l),p("AllValidator",r),i=/^[\x00-\x7f]*$/,s=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.messages={asciiOnly:f("Only basic ASCII characters allowed")},t.prototype.validate=function(e){if(!i.test(e))throw new Error(this.messages.asciiOnly)},t}(l),p("AsciiOnlyValidator",s),u=function(t){function n(e){n.__super__.constructor.call(this,e),this.not_empty=e.not_empty,this.strip=e.strip}return __extends(n,t),n.messages={empty:f("Please enter a value for %(field)s")},n.prototype.validate=function(t,n){if(this.strip&&(t=e.trim(t)),this.not_empty&&!t)throw new Error(this.messages.empty.format({field:null!=n?n.field:void 0}))},n}(l),p("StringValidator",u),c=function(e){function t(e){t.__super__.constructor.call(this,e),this.lastname_goes_first=null!=e?e.lastname_goes_first:void 0}return __extends(t,e),t.messages={empty:f("Please enter your name")},t.prototype.validate=function(e,t){var n;if(!t.data.lname&&!t.data.fname)if(this.lastname_goes_first){if("lname"===t.field)throw new Error(this.messages.empty)}else if("fname"===t.field)throw new Error(this.messages.empty);return"fname"===t.field?(n=d(["StringValidator",{not_empty:!0,strip:!0,messages:{empty:f("Please enter your first name")}}]),n.validate(e,t)):void 0},t}(l),p("NameValidator",c),a=function(t){function n(){return n.__super__.constructor.apply(this,arguments)}return __extends(n,t),n.messages={empty:f("Please enter an email address"),noAt:f("An email address must contain a single @"),badUsername:f("The username portion of the email address is invalid (the portion before the @: %(username)s)"),badDomain:f("The domain portion of the email address is invalid (the portion after the @: %(domain)s)")},n.username_re=/^[\w!#$%&'*+\-\/=?^`{|}~.]+$/,n.domain_re=new RegExp("^([a-z0-9][a-z0-9\\-]*\\.)+([a-z]+|xn--[a-z0-9\\-]+)$","i"),n.prototype.validate=function(t){var o,r,s;if(t=e.trim(t),!t)throw new Error(this.messages.empty);if(r=t.split("@"),2!==r.length)throw new Error(this.messages.noAt);if(s=r[0],o=r[1],!n.username_re.test(s))throw new Error(this.messages.badUsername.format({username:s}));if(i.test(o)&&!n.domain_re.test(o))throw new Error(this.messages.badDomain.format({domain:o}))},n}(l),p("EmailValidator",a),_=function(e){return function(t,n){var o;o=!0;try{e.validate(t,n)}catch(i){o=!1}return o}},h={create:d,register:p,check:_}}),define("modules/clean/video_util",["jquery","modules/core/browser","modules/core/i18n","external/flash_detect","external/videojs/video","external/videojs/videojs_hls","modules/clean/ajax"],function(e,t,n,o,i,r,s){var a,c,u;return c=n._,a={_video_counter:0,embed:function(n,o){var i,r,a,l,_,d,p,h,f,m,g,v;if(null==o&&(o={}),!this.can_embed_type(o.type))return null!=o.onError&&setTimeout(function(){return o.onError("needflash")},0),document.createElement("div");for(o.preload="undefined"!=typeof o.preload?o.preload:!0,o.preload&&(o.preload="auto"),r="video-"+this._video_counter,this._video_counter+=1,h=e("<video/>",{"class":"video-js vjs-default-skin vjs-big-play-centered",id:r,controls:o.controls}),h=h[0],g=-1,v=["width","height","preload","poster","autoplay"],f=0,m=v.length;m>f;f++)l=v[f],o[l]&&h.setAttribute(l,o[l]);return _=e("<source/>",{src:o.src,type:o.type}),_=_[0],h.appendChild(_),n=e(n),n.empty(),n=n[0],n.appendChild(h),a=function(){var n,i,r,a;return r=this,o.onError&&r.on("error",o.onError),"function"==typeof o.onReady&&o.onReady(),a=function(){return null!=r.hls?r.hls.fillBuffer():void 0},t&&(t.ipad&&(n=0,e(document).on("dropdownOpened modalOpened",function(t,o){return n+=o,e(r.el_).children("video").removeAttr("controls")}),e(document).on("dropdownClosed modalClosed",function(t,o){return n-=o,0===n?e(r.el_).children("video").attr("controls","controls"):void 0})),t.msie&&"9.0"===t.version&&r.on("playing",function(){return r.removeClass("vjs-seeking")})),"Hls"===r.techName&&r.on("seeked",function(){return r.controlBar.currentTimeDisplay.updateContent()}),r.on("pause",function(){return g=setInterval(a,500),r.ended()?r.removeClass("vjs-has-started"):void 0}),r.on("play",function(){return clearInterval(g),g=-1}),r.on("dispose",function(){return clearInterval(g)}),r.on("ended",function(){return r.src({type:o.type,src:o.src})}),"application/vnd.apple.mpegurl"===o.type&&u(r),i=function(){return r.addClass("show-truncated-bar")},!o.metadata&&o.metadata_link?s.AuthenticatedRequest({url:o.metadata_link,type:"GET",data:{},xhrFields:{withCredentials:!0},success:function(e){return"function"==typeof o.metadata_cb&&o.metadata_cb(e),e=JSON.parse(e),e.is_truncated?i.defer():void 0}}):o.metadata&&o.metadata.is_truncated?i.defer():void 0},p=c("The clip displayed here is a preview. To view the entire video, download or add it to your Dropbox."),Constants.transcoder_hls4web&&(videojs.Hls.GOAL_BUFFER_LENGTH=120),videojs.TruncatedBar=videojs.Component.extend(),videojs.TruncatedBar.prototype.options_={loadEvent:"play",components:{}},videojs.TruncatedBar.prototype.createEl=function(){var e;return e=videojs.createEl("div",{className:"truncated-bar",id:"truncated-video-message-bar"}),e.textContent=p,e},videojs.options.children.TruncatedBar={},i={swf:Constants.static_url_video_js_swf,flashVars:{contentType:o.type,hlsDebugLevel:Constants.hls_debug_level}},d=Constants.transcoder_hls4web?["html5","hls","flash"]:["flash"],videojs(h,{flash:i,techOrder:d},a)},can_embed_type:function(e){var t;return""!==("function"==typeof(t=document.createElement("video")).canPlayType?t.canPlayType(e):void 0)?!0:FlashDetect.installed&&FlashDetect.majorAtLeast(10)?"application/vnd.apple.mpegurl"===e||"video/flv"===e||"video/mp4"===e:!1}},u=function(e){var t,n,o,i,r,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T,S,C,x,k,O,A,N,I,R,P,L;for(l=[250,500,1500],i=null,u=null,c=null,g=0,r=-1,o=!1,a=null,n=-1,p=[],v=!0,b=0,t={},E=0,T=l.length;T>E;E++)h=l[E],t[h.toString()]=0;return y=null,w=[],d=100,f=function(){var n,o,i,c,u;for(n={},c=0,u=l.length;u>c;c++)h=l[c],i=t[h.toString()],n[h.toString()]=Math.round(i/b*100)||0;return o={duration:Math.round(1e3*e.duration()),initial_bitrate:l[r]||0,initial_play_wait:a||0,bitrate_percentages:JSON.stringify(n),stalls:g,quality_events:JSON.stringify(p),xhr_errors:JSON.stringify(w),percentage_watched:d},m(),s.AuthenticatedRequest({url:"/video_web_play_log",type:"POST",data:o})},m=function(){var e,s;for(i=null,u=null,c=null,g=0,r=-1,o=!1,a=null,n=-1,p=[],v=!0,b=0,t={},e=0,s=l.length;s>e;e++)h=l[e],t[h.toString()]=0;return y=null,w=[],d=100},C=function(){return P(),f()},I=function(){return P(),d=Math.round(e.currentTime()/e.duration()*100),isFinite(d)||(d=0),f()},L=function(){return v?(y=Date.now(),v=!1):void 0},P=function(){var e;if(!v)return e=Date.now()-y,b+=e,t[l[n].toString()]+=e,v=!0},k=function(){return null===i&&(c=i=Date.now()),u=Date.now()},S=function(){var t;return t=e.hls.selectPlaylist().attributes.BANDWIDTH/1e3,n=l.indexOf(t),r=n,L(),o?void 0:(a=Date.now()-i,o=!0)},x=function(){return P()},N=function(){return u=Date.now()},R=function(){return P(),Date.now()-u>5e3?g+=1:void 0},A=function(t){var o;if(!e.paused())return P(),o=n,n=t.data.level,Date.now()-i<1e3?r=n:p.push([l[o],l[n],Date.now()-c]),c=Date.now(),L()},O=function(){var t,o;if(!(e.ended()||e.error()||e.paused()))return P(),t=e.hls.selectPlaylist().attributes.BANDWIDTH/1e3,n=l.indexOf(t),o=n,Date.now()-i<1e3?r=n:p.push([l[o],l[n],Date.now()-c]),c=Date.now(),L()},e.on("play",k),e.on("pause",x),e.on("canplay",S),e.on("waiting",R),e.on("seeking",N),e.on("ended",C),e.on("shutdown",I),e.on("mediachange",O),"Hls"===e.techName?(_=videojs.Hls.xhr,videojs.Hls.xhr=function(e,t){var n;return n=function(e,n){var o;return e&&(o="",(""===this.responseType||"text"===this.responseType)&&(o=this.responseText),w.push([this.status.toString(),o,n])),t.call(this,e,n)},_.call(this,e,n)}):void 0},a});var __hasProp={}.hasOwnProperty;define("modules/clean/viewer",["modules/core/exception","modules/core/i18n","modules/clean/user"],function(e,t,n){var o,i,r;return i=e.assert,r=t._,o=function(){function e(e){var t,o,i,r,s,a;for(null==e&&(e={}),this._authed_users={},this._all_users={},i=e._user_data||[],s=0,a=i.length;a>s;s++)r=i[s],o=new n(r),this._all_users[o.id]=o,r._authed&&(this._authed_users[o.id]=o);for(t in e)__hasProp.call(e,t)&&"string"==typeof t&&"_"!==t[0]&&(this[t]=e[t]);this.is_signed_in=i.length>0,this.is_paired=i.length>1,this.deprecated_first_user_in_the_cookie_id&&(this.deprecated_first_user_in_the_cookie=this.get_user_by_id(this.deprecated_first_user_in_the_cookie_id),delete this.deprecated_first_user_in_the_cookie_id),this._load_cached_users()}return e._cached_viewer=null,e.get_viewer=function(){var t;return this._cached_viewer||(t=null,"undefined"!=typeof Constants&&null!==Constants&&(t=Constants._viewer_properties),this._cached_viewer=new e(t)),this._cached_viewer},e.get_role_title=function(e){var t;return t=this.get_viewer(),t.is_paired?e.role===("undefined"!=typeof Constants&&null!==Constants?Constants.ROLE_PERSONAL:void 0)?r("Personal"):t.team_name:""},e.get_root_name=function(e){return this.get_role_title(e)||r("Dropbox")},e.prototype.get_user_by_role=function(e,t){var n;return n=this.get_uid_by_role(e),void 0===n?void 0:this.get_user_by_id(n,t)},e.prototype.role_exists=function(e){return void 0!==this.get_uid_by_role(e)},e.prototype.get_user_by_id=function(e,t){var n,o;return i(this.is_uid_associated(e),"User "+e+" is not associated with this viewer"),o=t?this._all_users:this._authed_users,n=o[e],i(n,"User "+e+" is not signed in"),n},e.prototype.is_role_signed_in=function(e){return this.get_uid_by_role(e)in this._authed_users},e.prototype.is_uid_signed_in=function(e){return e in this._authed_users},e.prototype.is_user_signed_in=function(e){return!(!e||!this.is_uid_signed_in(e.id))},e.prototype.is_uid_associated=function(e){return e in this._all_users},e.prototype.get_users=function(e){var t,n,o,i;return o=e?this._all_users:this._authed_users,i=function(){var e;e=[];for(t in o)n=o[t],e.push(n);return e}(),i.sort(function(e){return e.role===Constants.ROLE_PERSONAL?-1:1}),i},e.prototype.get_user_ids=function(e){var t;return function(){var n,o,i,r;for(i=this.get_users(e),r=[],n=0,o=i.length;o>n;n++)t=i[n],r.push(t.id);return r}.call(this)},e.prototype.get_email_by_role=function(e){var t;return t=this.get_user_by_role(e,!0),t&&t.email},e.prototype.get_uid_by_role=function(e){var t,n,o;e===Constants.ROLE_PHOTOS&&(e=this._get_photos_role()),o=this._all_users;for(t in o)if(n=o[t],n.role===e)return t;return void 0},e.prototype._get_photos_role=function(){return this.is_paired||!this.is_signed_in?Constants.ROLE_PERSONAL:this._values(this._all_users)[0].role},e.prototype._sign_in_all_users=function(){return this._authed_users=this._shallow_clone(this._all_users),this._load_cached_users()},e.prototype._sign_out_user_by_id=function(e){return delete this._authed_users[e],this._load_cached_users()},e.prototype.sign_in_user_by_id=function(e){return i(this.is_uid_associated(e),"User "+e+" is not associated with this viewer"),this._authed_users[e]=this._all_users[e],this._load_cached_users()},e.prototype._values=function(e){var t,n;n=[];for(t in e)n.push(e[t]);return n},e.prototype._shallow_clone=function(e){var t,n;n={};for(t in e)n[t]=e[t];return n},e.prototype._load_cached_users=function(){return this.personal_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_PERSONAL)],this.photos_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_PHOTOS)],this.work_user=this._authed_users[this.get_uid_by_role(Constants.ROLE_WORK)],this.personal_email=this.get_email_by_role(Constants.ROLE_PERSONAL),this.work_email=this.get_email_by_role(Constants.ROLE_WORK),this.is_personal_user_signed_in=this.is_role_signed_in(Constants.ROLE_PERSONAL),this.is_photos_user_signed_in=this.is_role_signed_in(Constants.ROLE_PHOTOS),this.is_work_user_signed_in=this.is_role_signed_in(Constants.ROLE_WORK)},e}()}),define("modules/clean/web_timing_logger",["modules/clean/ajax","modules/clean/event_load"],function(e,t){var n;return n={init:function(e){return this.source_type=null!=e?e:"web",window.performance?t.window_load(function(){return setTimeout(n._log_navigation,0)}):void 0},_log_navigation:function(){var e,t,o;return o=window.performance&&window.performance.timing,o&&(t=o.navigationStart||o.fetchStart)?(e={},Constants.GSLB_ENABLED&&(e.gslb_enabled=!0),Constants.IS_SPDY&&(e.is_spdy=!0),n._log({navigation_type:n._get_navigation_type(),server_request_start_time:Constants.REQUEST_START_TIME,redirect_time:o.fetchStart-t,dns_time:o.domainLookupEnd-t,tcp_connect_time:(o.secureConnectionStart||o.requestStart)-t,ssl_connect_time:o.requestStart-t,time_to_first_byte:o.responseStart-t,dom_load_time:o.domContentLoadedEventEnd-t,page_load_time:(o.loadEventEnd||o.domContentLoadedEventEnd)-t,extra_columns:JSON.stringify(e)})):void 0},log_ajax_transition:function(e,t,o,i,r,s){var a;return a={navigation_type:"ajax",page_load_time:e,url:s},null!=r&&(a.server_response_time=r),Constants.GSLB_ENABLED&&(o=o||{},o.gslb_enabled=!0),null!=o&&(a.extra_columns=JSON.stringify(o)),null!=i&&(a.stopwatch_suffix=i),n._log(a,t)},_log:function(t,n,o){return null==o&&(o="/web_timing_log"),t.url=t.url||window.location.href,t.request_id=Constants.REQUEST_ID,t.source_type=this.source_type,t.request_tracing_enabled=Constants.REQUEST_TRACING_ENABLED,n&&(t.url_info=n),e.AuthenticatedRequest({url:o,type:"POST",data:t})},_get_navigation_type:function(){switch(window.performance.navigation.type){case 0:return"navigate";case 1:return"reload";case 2:return"back_forward"}}}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/core/browser",["modules/core/exception","modules/core/uri"],function(e,t){var n,o,i,r,s;return o=e.assert,s=function(e){var t;return e=e.toLowerCase(),t=/(ipad)/.exec(e)||/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||/(trident).*? rv:([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[],
{browser:t[1]||"",version:t[2]||"0"}},i=s(navigator.userAgent),"trident"===i.browser&&(i.browser="msie"),r="undefined"!=typeof Constants&&null!==Constants?[Constants.WEBSERVER,Constants.BLOCK_CLUSTER,Constants.CAROUSEL_WEBSERVER]:[],n={version:i.version,msie_version_at_most:function(e){return n.msie&&parseInt(n.version,10)<=e},get_uri:function(e){return null==e&&(e=window),t.parse(this.get_href(e))},get_href:function(e){return null==e&&(e=window),e.location.href},_parse_target:function(e,n){var i,s,a,c,u,l;return null==n&&(n=window),a=n.document.createElement("a"),a.href=e,u=":"===a.protocol?n.location.protocol:a.protocol||n.location.protocol,i=a.hostname||n.location.hostname,c=0===a.pathname.indexOf("/")?a.pathname:"/"+a.pathname,e=u+"//"+i+c+a.search+a.hash,s=t.parse(String(e)),o((l=s.authority,__indexOf.call(r,l)>=0&&"https"===s.scheme),"Target URI must be secure and in domain whitelist"),s},open_tab:function(e){var t;return t=this._parse_target(e),window.open(t.toString(),"_blank")},redirect:function(e,t){var n;return null==t&&(t=window),n=this._parse_target(e,t),t.location.href=n.toString()},replace_location:function(e){var t;return t=this._parse_target(e),window.location.replace(t.toString())},reload:function(){return window.location.reload()},unsafeRedirect:function(e){var n,i,r;return n=t.parse(String(e)),o("data"!==(null!=(i=n.scheme)?i.toLowerCase():void 0)&&"javascript"!==(null!=(r=n.scheme)?r.toLowerCase():void 0),"Target URI can't be a Javascript/data URI"),window.location.href=n.toString()}},n[i.browser]=!0,n.ipad?(n.webkit=!0,n.safari=!0):n.chrome?n.webkit=!0:n.webkit&&(n.safari=!0),n}),define("modules/core/controller_registry",["jquery","modules/core/exception","modules/core/instantiate"],function(e,t,n){var o,i,r,s;return i=t.assert,s=n.construct,r=function(t,n,o){var i,r,a,c;for(i=[t].concat(o),a=0,c=t.length;c>a;a++)r=t[a],e(r).data("jscontroller",s(n,i));return t},o=function(){function t(){}return t.controllers={},t.register_controller=function(e,t,n){return this.controllers[e]={constructor:t,args:n},this.find_and_bind_controller(e)},t.bind_controller=function(e){var t,n;return t=e.data("js-component-id"),i(this.controllers[t],"No controller for "+t),n=this.controllers[t],r(e,n.constructor,n.args)},t.find_and_bind_controller=function(t){var n,o;return i(this.controllers[t],"No controller for "+t),o=this.controllers[t],n=e("[data-js-component-id='"+t+"']"),r(n,o.constructor,o.args)},t}()}),define("modules/core/cookies",[],function(){var e;return e={create:function(e,t,n){var o,i;return i="",n&&(o=new Date,o.setTime(o.getTime()+24*n*60*60*1e3),i="; expires="+o.toGMTString()),document.cookie=""+e+"="+t+i+"; path=/"},read:function(e){var t,n,o,i,r;for(n=""+e+"=",r=document.cookie.split(";"),o=0,i=r.length;i>o;o++){for(t=r[o];" "===t.charAt(0);)t=t.substring(1,t.length);if(0===t.indexOf(n))return t.substring(n.length,t.length)}return null},"delete":function(e){return this.create(e,"",-1)},are_enabled:function(){return null!=navigator.cookieEnabled?navigator.cookieEnabled:(document.cookie="this_is_a_test_cookie",-1!==document.cookie.indexOf("this_is_a_test_cookie"))}}}),define("modules/core/dom",["jquery","modules/core/controller_registry","modules/core/exception"],function(e,t,n){var o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T,S,C;return o=n.assert,i=function(n){var o,r,s,c;for(c=n.children(),r=0,s=c.length;s>r;r++)o=c[r],i(e(o));return!a(n)&&n.data("js-component-id")?t.bind_controller(n):void 0},r=function(e){var t;return o(e,"Trying to clone nonexistent element"),t=e.clone(),i(t),t},a=function(e){return e.data("jscontroller")},y=function(e,t){return e.data("jscontroller",t)},_=function(e){return e?1===e.nodeType?!0:e.length>=1&&1===e[0].nodeType?!0:!1:!1},l=function(){var e,t,n,o,i;return("INPUT"===(e=null!=(t=document.activeElement)?t.tagName:void 0)||"TEXTAREA"===e||"SELECT"===e)&&"submit"!==(n=null!=(o=document.activeElement)?o.type:void 0)&&"button"!==n||(null!=(i=document.activeElement)?i.getAttribute("contentEditable"):void 0)},w=function(t){var n,o,i;return n=e(t),i=n.offset(),o=e(window),{left:i.left-o.scrollLeft(),top:i.top-o.scrollTop()}},T=null,S=null,b=function(){return T||(T={height:e(window).height(),width:e(window).width()}),S||(S=e(window).on("resize",function(){return T=null})),T},c=function(){return Math.max(e(document).height(),e(window).height(),document.documentElement.clientHeight)},C=null,E=null,m=function(){var t,n,o;return C||(C=e(window).scroll(function(){return E=null})),d()?E||(o=e(window).scrollTop(),n=e(window).scrollLeft(),E={0:n,1:o,left:n,top:o}):(t=e(document.documentElement),o=-1*parseInt(t.css("top"),10),n=-1*parseInt(t.css("left"),10),E={0:n,1:o,left:n,top:o}),E},p=function(){return E=null},d=function(){return!e(document.documentElement).hasClass("no-scroll")},f=0,h=function(){var t,n,o,i;return f++,t=e(document.documentElement),t.hasClass("no-scroll")?void 0:(i=m(),o=-1*i.top+"px",n=-1*i.left+"px",t.css({top:o,left:n}),t.addClass("no-scroll"))},v=function(){var t,n,o;return f>0&&f--,t=e(document.documentElement),0===f&&t.hasClass("no-scroll")?(o=-1*parseInt(t.css("top"),10),n=-1*parseInt(t.css("left"),10),t.css({top:"",left:""}),t.removeClass("no-scroll"),g(n,o+1),g(n,o-1),g(n,o)):void 0},g=function(t,n){var o,i,r;return t=Math.max(t,0),n=Math.max(n,0),n>m().top&&(n=Math.min(n,c()-u.viewport_dimensions().height)),d()?(window.scrollTo(t,n),E={0:t,1:n,left:t,top:n}):(r=-1*n+"px",i=-1*t+"px",o=e(document.documentElement),o.css({top:r,left:i}))},s=function(t,n,o){var i,r,s,a,c,u,l,_;return r=e(n),s=e(t),u={setLeft:!0,setTop:!0,setWidth:!0,setHeight:!0,offsetTop:0,offsetLeft:0},o=e.extend({},u,o),_=w(r),l={top:0,left:0},i=null,"absolute"===s.css("position")&&(i=s.offsetParent(),l=w(i)),i&&i[0]===document.body&&(l.left-=document.body.offsetLeft,l.top-=document.body.offsetTop),o.setLeft&&(a=_.left-l.left+o.offsetLeft+"px",s.css("left",a)),o.setTop&&(c=_.top-l.top+o.offsetTop+"px",s.css("top",c)),o.setWidth&&s.width(r[0].offsetWidth),o.setHeight&&s.height(r[0].offsetHeight),s},w=function(t){var n,o,i;return n=e(t),i=n.offset(),o=e(window),{left:i.left-o.scrollLeft(),top:i.top-o.scrollTop()}},u={bind_controllers:i,clone:r,clone_position:s,controller:a,document_height:c,focus_in_input:l,is_page_scrollable:d,scroll_clear_cache:p,scroll_lock_document:h,scroll_offsets:m,scroll_to:g,scroll_unlock_document:v,set_controller:y,is_element:_,viewport_offset:w,viewport_dimensions:b}}),define("modules/core/exception",["modules/core/exception_tag_registry"],function(e){var t,n;return n=e.get_registered_tags,t=function(){function e(){}return e.strip_comments=function(e){return e.replace(/\/\/.*/g,"").replace(/\/\*[\s\S]*?\*\//g,"")},e.fn_body=function(t){var n;return n=e.strip_comments(t.toString()),n=n.replace(/[\s]+/g," "),"("===n[0]&&(n=n.substr(1)),")"===n[n.length-1]&&(n=n.substr(0,n.length-1)),n=n.replace("function (","function(")},e.stackTrace=function(){var t,n,o,i,r;for(i=[],r={},t=arguments.callee.caller;t;){if(t.__tb_ajax_info__){i.unshift("Ajax.DBRequest: "+t.__tb_ajax_info__);break}if(t.__tb__){i=t.__tb__.concat(i);break}if(o=e.fn_body(t),o in r)break;r[o]=!0,i.unshift(o);try{t=t.caller}catch(s){n=s,t=null;break}}return i},e.__callbacks=[],e.registerOnFailedAssert=function(e){return this.__callbacks.push(e)},e.reportException=function(t,o,i,r,s,a){var c,u,l,_;if(__CIRCULAR_DEPENDENCY__.active_user_loaded?__CIRCULAR_DEPENDENCY__.an_error_happened_after_loading=!0:__CIRCULAR_DEPENDENCY__.an_error_happened_before_loading=!0,!this.reported_exception||s){if(l="",!r)try{u=e.stackTrace(),u.pop(),u.pop(),r=u.join("\\n")}catch(d){}if(a||(a=[]),a=a.concat(n()),c={e:t,f:o||window.location.href,l:i||"",loc:window.location.href,ref:"undefined"!=typeof Constants&&null!==Constants?Constants.referrer:void 0,tb:r,trace:null!=(_=__CONDITIONAL_JS__.Trace)?_.get():void 0,tags:JSON.stringify(a)},"undefined"!=typeof jQuery&&null!==jQuery&&"function"==typeof jQuery.ajax&&jQuery.ajax({url:"/jse",type:"POST",data:c}),this.reported_exception=t,!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)&&window.sessionStorage)return c.source="exception.coffee",window.sessionStorage.setItem("reported_exception",JSON.stringify(c))}},e.alert=function(t){return"undefined"!=typeof jQuery&&null!==jQuery&&"function"==typeof jQuery.ajax&&jQuery.ajax({url:"/tormod",type:"POST",data:{tor:""+t,mod:window.location.href,ssk:e.stackTrace().join("\n\n"),oog:document.documentElement.innerHTML}}),window.alertd(t)},e.alertd=function(e){return window.alertd(e)},e.assert=function(t,n,o,i,r,s){var a,c,u,l,_;if(null==n&&(n=""),null==o&&(o=!0),null==i&&(i=[]),null==r&&(r=!0),null==s&&(s=!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)),!t){for(n="Assertion Error: "+n,s&&"undefined"!=typeof console&&null!==console&&"function"==typeof console.trace&&console.trace(),("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)||window.alertd(n),c=e.stackTrace(),c.pop(),e.reportException(n,window.location.href,"",c.join("\n"),o,i),_=e.__callbacks,u=0,l=_.length;l>u;u++)(a=_[u])(n,c);if(r)throw new Error(n)}},e}(),window.alertd=window.alert,window.alert=t.alert,__CONDITIONAL_JS__.JSException=t,t}),define("modules/core/html",["jquery","external/underscore"],function(e,t){var n;return n=function(){function e(e){this._str_DONT_TOUCH=e}return e.prototype.toHTML=function(){return this._str_DONT_TOUCH},e.prototype.toString=function(){return"[object HTML]"},e}(),function(){var o,i,r,s;return n.tmpl=function(o,i){var r,s,a,c,u;return/[^\w:.-]/.test(o)||(r=document.getElementById(o),o=r.innerHTML,null!=(null!=(u=window.Constants)?u.CSP_SCRIPT_NONCE:void 0)&&window.Constants.CSP_SCRIPT_NONCE!==r.getAttribute("nonce")&&(o="")),a=o.replace(/[\r\t\n]/g," ").replace(/'(?=[^%]*%>)/g,"	").split("'").join("\\'").split("	").join("'").replace(/<%=(.*?)%>/g,"',__no_conflict_HTML__._raw_escape($1),'").split("<%").join("');").split("%>").join("p.push('"),c=new Function("__no_conflict_HTML__","__no_conflict_jQuery__","TEMPLATE_DATA","var p=[],print=function(){p.push.apply(p,arguments);}; window.MONKEY_CHECK_OFF = true; p.push('"+a+"'); window.MONKEY_CHECK_OFF = false; return new __no_conflict_HTML__(__no_conflict_jQuery__.trim(p.join('')));"),s=t.partial(c,n,e),i?s(i):s},o=/[^\w@\.\ \-\(\)\,\$~%#\[\]\{\}\!\^]/g,r=function(e){return"&#"+e.charCodeAt(0)+";"},i=function(e){return(""+e).replace(o,r)},n.escape=function(e){return e instanceof n?e:new n(i(e))},n._raw_escape=s=function(e){return e instanceof n?e.toHTML():"number"==typeof e?e:i(e)}}(),n});var __slice=[].slice;define("modules/core/i18n",["modules/core/kwargs","modules/core/exception","external/sha1"],function(e,t){var n,o,i,r,s,a,c,u,l,_,d,p,h;for(d=t.assert,r="abcdefghijklmnopqrstuvwxyz",s="âḃćḋèḟĝḫíĵǩĺṁńŏṗɋŕśṭůṿẘẋẏẓ",l="ABCDEFGHIJKLMNOPQRSTUVWXYZ",_="ḀḂḈḊḔḞḠḢḬĴḴĻḾŊÕṔɊŔṠṮŨṼẄẌŸƵ",n={},p=h=0;26>h;p=++h)n[r.charAt(p)]=s.charAt(p),n[l.charAt(p)]=_.charAt(p);return o=function(){function t(){}return t.messages={},t.emessages={},t.RAND=0,t.NUM_MISSED=0,t.add_i18n_message=function(e,t,n,o){return t=t.strip_tags().friendly_format(),n=n.strip_tags(),this.messages[t]=e,this.emessages[t]=n,o?(delete this.messages[o],delete this.emessages[o]):void 0},t.PLURAL_RULES={SINGULAR_1:function(e){return 1===e?0:1},SINGULAR_01:function(e){return 1>=e?0:1},SINGULAR_ALL:function(){return 0},RUSSIA_UKRAINE:function(e){return e%10===1&&e%100!==11?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2},POLAND:function(e){return 1===e?0:e%10>=2&&4>=e%10&&(10>e%100||e%100>=20)?1:2}},t.PLURAL_RULES_BY_LOCALE={en:t.PLURAL_RULES.SINGULAR_1,en_GB:t.PLURAL_RULES.SINGULAR_1,da_DK:t.PLURAL_RULES.SINGULAR_1,de:t.PLURAL_RULES.SINGULAR_1,es_ES:t.PLURAL_RULES.SINGULAR_1,es:t.PLURAL_RULES.SINGULAR_1,fr:t.PLURAL_RULES.SINGULAR_01,id:t.PLURAL_RULES.SINGULAR_ALL,it:t.PLURAL_RULES.SINGULAR_1,ja:t.PLURAL_RULES.SINGULAR_ALL,ko:t.PLURAL_RULES.SINGULAR_ALL,ms:t.PLURAL_RULES.SINGULAR_ALL,nb_NO:t.PLURAL_RULES.SINGULAR_1,nl_NL:t.PLURAL_RULES.SINGULAR_1,pl:t.PLURAL_RULES.POLAND,pt_BR:t.PLURAL_RULES.SINGULAR_01,ru:t.PLURAL_RULES.RUSSIA_UKRAINE,sv_SE:t.PLURAL_RULES.SINGULAR_1,th_TH:t.PLURAL_RULES.SINGULAR_ALL,tr:t.PLURAL_RULES.SINGULAR_ALL,uk_UA:t.PLURAL_RULES.RUSSIA_UKRAINE,xx_AC:t.PLURAL_RULES.SINGULAR_1,xx_LS:t.PLURAL_RULES.SINGULAR_1,xx_HA:t.PLURAL_RULES.SINGULAR_1,xx_RL:t.PLURAL_RULES.SINGULAR_1,xx_AE:t.PLURAL_RULES.SINGULAR_1,zh_CN:t.PLURAL_RULES.SINGULAR_ALL,zh_TW:t.PLURAL_RULES.SINGULAR_ALL},t.PERCENT_FORMAT={SUFFIX:function(e){return"%(percent)s%".format({percent:e})},PREFIX:function(e){return"%"+"%(percent)s".format({percent:e})},SUFFIX_SPACE:function(e){return"%(percent)s %".format({percent:e})}},t.PERCENT_FORMAT_BY_LOCALE={en:t.PERCENT_FORMAT.SUFFIX,en_GB:t.PERCENT_FORMAT.SUFFIX,da_DK:t.PERCENT_FORMAT.SUFFIX_SPACE,de:t.PERCENT_FORMAT.SUFFIX_SPACE,es_ES:t.PERCENT_FORMAT.SUFFIX,es:t.PERCENT_FORMAT.SUFFIX,fr:t.PERCENT_FORMAT.SUFFIX_SPACE,id:t.PERCENT_FORMAT.SUFFIX,it:t.PERCENT_FORMAT.SUFFIX,ja:t.PERCENT_FORMAT.SUFFIX,ko:t.PERCENT_FORMAT.SUFFIX,ms:t.PERCENT_FORMAT.SUFFIX,nb_NO:t.PERCENT_FORMAT.SUFFIX_SPACE,nl_NL:t.PERCENT_FORMAT.SUFFIX,pl:t.PERCENT_FORMAT.SUFFIX,pt_BR:t.PERCENT_FORMAT.SUFFIX,ru:t.PERCENT_FORMAT.SUFFIX_SPACE,sv_SE:t.PERCENT_FORMAT.SUFFIX_SPACE,th_TH:t.PERCENT_FORMAT.SUFFIX,tr:t.PERCENT_FORMAT.PREFIX,uk_UA:t.PERCENT_FORMAT.SUFFIX,xx_AC:t.PERCENT_FORMAT.SUFFIX,xx_LS:t.PERCENT_FORMAT.SUFFIX,xx_HA:t.PERCENT_FORMAT.SUFFIX,xx_RL:t.PERCENT_FORMAT.SUFFIX,xx_AE:t.PERCENT_FORMAT.SUFFIX,zh_CN:t.PERCENT_FORMAT.SUFFIX,zh_TW:t.PERCENT_FORMAT.SUFFIX},t.get_langpack=function(){return window.LANGPACK||(window.LANGPACK={}),window.LANGPACK},t._=function(){var n,o,r,s,a,c,u,l,_;return u=arguments[0],n=2<=arguments.length?__slice.call(arguments,1):[],_=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),a=_.project,o=_.comment,("undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0)&&t.locale_is_fake(Constants.USER_LOCALE)?c=t.fake_translate(u,"undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0):(l=i.get_string_key(u,a,o),r=t.get_langpack(),s=r[l]||r[u],s?c=s instanceof String||"string"==typeof s?s:s[0]||u:(0===t.RAND&&"undefined"!=typeof Constants&&null!==Constants&&"en"!==Constants.USER_LOCALE&&(t.RAND=Math.floor(20*Math.random()+1)),1===t.RAND&&t.NUM_MISSED<4&&(t.NUM_MISSED+=1,"undefined"!=typeof jQuery&&null!==jQuery&&jQuery.ajax({url:"/missed_translation_log",type:"POST",data:{message:u,comment:o,project:a}})),c=u)),t.add_i18n_message(u,c,u),c},t.fake_translate=function(e,t){var o,i,r,s,a,c,u;if("xx_LS"===t&&(e+="SSSSSSSSSSSSSSSSSSSSSSSSS"),"xx_AC"!==t||/</.test(e)||(e=e.toUpperCase()),"xx_HA"===t&&(e="[javascript]"+e),"xx_RL"===t&&!/</.test(e)&&!/%/.test(e)){for(s=97,r=1488,a="",e=e.toLowerCase(),p=c=0,u=e.length;u>=0?u>c:c>u;p=u>=0?++c:--c)o=e.charCodeAt(p)-s,a+=o>=0&&26>o?String.fromCharCode(r+o):e[p];e=a}return"xx_AE"!==t||/</.test(e)||/%/.test(e)||(e=function(){var t,o,r,s;for(s=[],p=t=0,o=e.length;o>=0?o>t:t>o;p=o>=0?++t:--t)i=e.charAt(p),s.push(null!=(r=n[i])?r:i);return s}().join("")),e},t.locale_is_fake=function(e){return-1!==e.indexOf("xx_")},t.ungettext=function(){var n,o,r,s,a,c,u,l,_,p,h,f,m,g;if(f=arguments[0],l=arguments[1],u=arguments[2],n=4<=arguments.length?__slice.call(arguments,3):[],g=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(n))),p=g.project,o=g.comment,d(null!=u,"missing number parameter for ungettext"),a="undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0)if(t.locale_is_fake(a))f=t.fake_translate(f,a),l=t.fake_translate(l,a);else if(m=i.get_string_key(f,p,o),s=t.get_langpack(),c=s[m]||s[f]){if(c instanceof String||"string"==typeof c)return c;_=t.PLURAL_RULES_BY_LOCALE[a](u),_ in c&&(h=c[_])}return r=1===u?f:l,null==h&&(h=r),t.add_i18n_message(f,h,r),h},t.N_=function(){var t,n,o,i,r;return i=arguments[0],t=2<=arguments.length?__slice.call(arguments,1):[],r=e.apply(null,[[["project","web"],"comment"]].concat(__slice.call(t))),o=r.project,n=r.comment,new a(i,o,n)},t.E_=function(e){return t._(e.msg,e.project,e.comment)},t.render_sentences=function(e){var n,o,i,r,s,a;if(n=e.length,1===n)return e[0];if(2===n)return t._("%s %s",{comment:"Two sentences"}).format(e);if(3===n)return t._("%s %s %s",{comment:"Three sentences"}).format(e);if(4===n)return t._("%s %s %s %s",{comment:"Four sentences"}).format(e);for(o="",r=0,s=0,a=e.length;a>s;s++)i=e[s],o+=i,r!==n-1&&(o+=t._(" ",{comment:"Sentence separator character"})),r+=1;return o},t.format_percent=function(e){var n;return n="undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0,n?t.PERCENT_FORMAT_BY_LOCALE[n](e):t.PERCENT_FORMAT.SUFFIX(e)},t.i18n_default_project=function(n){return{_:function(){var o,i,r,s;return r=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],s=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=s.project,i=s.comment,t._(r,n,i)},ungettext:function(){var o,i,r,s,a,c;return a=arguments[0],s=arguments[1],r=arguments[2],o=4<=arguments.length?__slice.call(arguments,3):[],c=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=c.project,i=c.comment,t.ungettext(a,s,r,n,i)},N_:function(){var o,i,r,s;return r=arguments[0],o=2<=arguments.length?__slice.call(arguments,1):[],s=e.apply(null,[[["project",n],"comment"]].concat(__slice.call(o))),n=s.project,i=s.comment,t.N_(r,n,i)},E_:t.E_}},t}(),a=function(){function e(e,t,n){this.msg=e,this.project=t,this.comment=n}return e}(),i=function(){function e(){}return e.get_message_context=function(e,t){var n,o,i;return o=void 0,"web"!==e&&(o="project:"+e),null!=t&&(i=new jsSHA(t,"TEXT"),n=i.getHash("SHA-1","HEX"),null!=o?o+=" "+n:o=n),o},e.CONTEXT_DELIMITER="",e.get_string_key=function(t,n,o){var i;return i=e.get_message_context(n,o),null!=i?i+e.CONTEXT_DELIMITER+t:t},e}(),u=function(e){return"undefined"==typeof Array.isArray?"[object Array]"===Object.prototype.toString.call(e):Array.isArray(e)},c=function(){var e,t,n;return e=Array.prototype.slice.call(arguments),t=e.shift(),n=e.shift(),function(){return t.apply(n,e.concat(Array.prototype.slice.call(arguments)))}},String.prototype.format_sub=function(e){return this.replace(/%(\([a-zA-Z0-9_\-]+\))?(.\d+)?(.)/g,c(e,this))},String.prototype.format=function(){var e,t,n,i,r,s;return 0===arguments.length?this.toString():(t=void 0,e=0,t=1===arguments.length&&arguments[0]instanceof Object?arguments[0]:Array.prototype.slice.call(arguments,0),r=function(n,o,i,r){var s,a,c,l;if(o?(o=o.slice(1,-1),d(0>=e,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),e=-1,s="xx_AC"===("undefined"!=typeof Constants&&null!==Constants?Constants.USER_LOCALE:void 0),d(o in t||s&&o.toLowerCase()in t,"Key '"+o+"' not present during string substitution for string '"+this+"'"),l=t[o],s&&(l=t[o.toLowerCase()])):(u(t)||(t=[t]),d(e>-1,"Cannot mix named and positional indices in string formatting for string '"+this+"'."),d(e<t.length,"Insufficient number of items in format for string '"+this+"'"),l=t[e],e++),d("undefined"!=typeof l,"value for key '"+(o||"")+"' is undefined"),c=void 0,"s"===r||"S"===r)c=l.toString();else if("d"===r||"D"===r)c=parseInt(l,10).toString();else if("f"===r||"F"===r)c=Number(l).toString();else{if("%"===r)return"%";d(!1,"Unexpected format character '"+r+"' for string '"+this+"'.")}return i?(i=parseInt(i.slice(1),10),"f"===r||"F"===r?(c.indexOf(!1)&&(c+=".0"),a=c.split("."),a[0]+"."+a[1].slice(0,i)):c.slice(0,i)):c},s=this.format_sub(r),o.messages&&this in o.messages&&(e=0,i=o.emessages[this],n=String.prototype.format_sub.call(i,r),o.add_i18n_message(i,s,n,this)),s)},String.prototype.friendly_format=function(){var e,t,n;return t=function(t,o,i,r){return o?"["+o.slice(1,1).replace("-","_")+"]":"s"===r||"S"===r?"[word"+n++ +"]":"[number"+e++ +"]"},e=1,n=1,this.format_sub(t)},String.prototype.blank_format=function(){var e;return e=function(){return""},this.format_sub(e)},String.prototype.strip_tags=function(){return this.replace(/<\w+(\s+("[^"]*"|'[^']*'|[^>])+)?>|<\/\w+>/gi,"")},o}),define("modules/core/instantiate",["modules/core/exception"],function(e){var t,n,o;return t=e.assert,n=function(e,n){var o;return t(e),o=function(){return e.apply(this,n)},o.prototype=e.prototype,new o},o={construct:n}});var __slice=[].slice;define("modules/core/kwargs",[],function(){var e;return e=function(){var e,t,n,o,i,r,s,a,c,u,l;if(r=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],i={},r=function(){var e,t,n;for(n=[],e=0,t=r.length;t>e;e++)s=r[e],n.push("string"==typeof s?{name:s,"default":void 0}:{name:s[0],"default":s[1]});return n}(),(t=function(){var t,n,o,i,s,a,c,u;if(null==e||"object"!=typeof e[e.length-1])return!1;for(o={},t=s=a=e.length-1,c=r.length-1;c>=s;t=s+=1)o[r[t].name]=!0;u=e[e.length-1];for(n in u)if(i=u[n],!(n in o))return!1;return!0})()){u=e[e.length-1];for(o in u)a=u[o],i[o]=a;e.pop()}for(n=c=0,l=r.length-1;l>=c;n=c+=1)n<e.length?i[r[n].name]=e[n]:r[n].name in i||(i[r[n].name]=r[n]["default"]);return i}}),define("modules/core/notify",["jquery","modules/core/i18n"],function(e,t){var n,o;return o=t._,n=function(){function t(){}return t.DEFAULT_ERROR=o("There was a problem completing this request."),t.DEFAULT_SUCCESS=o("Your request completed successfully."),t.success=function(e,t){return null==t&&(t=10),e=e||this.DEFAULT_SUCCESS,this._show(e,t,"server-success"),this.current()},t.error=function(e,t){return null==t&&(t=10),e=e||this.DEFAULT_ERROR,this._show(e,t,"server-error"),this.current()},t.warning=function(e,t){return null==t&&(t=10),this._show(e,t,"server-warning"),this.current()},t.info=function(e,t){return null==t&&(t=10),this._show(e,t,"server-info"),this.current()},t.clear=function(){return this._last_timeout&&clearTimeout(this._last_timeout),this._last_animation&&this._last_animation.stop(),this._last_timeout=null,this._last_animation=null,e("#notify").removeClass("server-error server-info server-success server-warning").hide()},t.isShown=function(){return e("#notify").is(":visible")},t.current=function(){return this._last_timeout},t._show=function(e,t,n){return this._buildElement(),this.clear(),this._setMessage(e),this._showElement(n),this._scheduleHide(t),this.current()},t._buildElement=function(){var t;if(!e("#notify").length)return t='<div id="notify-wrapper"> <span id="notify"> <span id="notify-msg" /> </span> </div>',e("body").append(t)},t._setMessage=function(t){var n;return n=e("#notify-msg"),null!=t.toHTML?n.html(t.toHTML()):t instanceof e?n.html(t):n.text(t)},t._showElement=function(t){var n;return n=e("#notify"),n.addClass(t),this._last_animation=n.fadeIn(500)},t._scheduleHide=function(e){return this._last_timeout=setTimeout(this._hide,1e3*e)},t._hide=function(){var n;return n=e("#notify"),t._last_animation=n.fadeOut(1e3),t._last_timeout=null},t}(),INLINE_JS.Notify=n,n}),define("modules/core/ordered_dictionary",[],function(){var e;return e=function(){function e(e,t){this.list=e,this.dict=t}return e.list=[],e.dict={},e.prototype.push=function(e,t){this.list.push(e),this.dict[e]=t},e.prototype.remove=function(e){this.list.removeItem(e),delete this.dict[e]},e.prototype.indexOfKey=function(e){return this.list.indexOf(e)},e.prototype.keyAtIndex=function(e){return this.list[e]},e.prototype.valueFromKey=function(e){return this.dict[e]},e.prototype.valueAtIndex=function(e){return this.dict[this.list[e]]},e.prototype.getValues=function(){var e;return function(){var t,n,o,i;for(o=this.list,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(this.dict[e]);return i}.call(this)},e.prototype.length=function(){return this.list.length},e.prototype.insertAtIndex=function(e,t,n){return this.list.splice(e,0,t),this.dict[t]=n},e}()}),define("modules/core/uri",["modules/core/exception"],function(e){var t,n,o;return o=e.assert,n=function(){function e(n,o){var i,r,s,a;if(!(this instanceof e))return new e(n,o);if(this._query=new t,s={},"string"==typeof n||n instanceof e){if(!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0))throw new Error("URI/uri string passed into URI constructor.  Use URI.parse instead.");s=e.parse(n).toObject()}else"object"==typeof n&&(s=n);if(o&&!("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0))throw new Error("Multiple arguments passed into URI constructor.");r=o||{};for(i in r)a=r[i],s[i]=a;this.initFromObject(s)}return e.prototype.initFromObject=function(e){var t,n,o;return o=null!=e?e:{},n=o.scheme,this.authority=o.authority,this.path=o.path,t=o.query,this.fragment=o.fragment,this.setScheme(n),this.setQuery(t)},e.parse=function(n){var i,r,s,a,c,u,l,_;return o(null!=n,"must pass in a valid url-encoded string"),i=String(n).match(e.REGEXP)||[],_=i[0],l=i[1],s=i[2],c=i[3],u=i[4],a=i[5],r=new e,r.setScheme(l),r.setAuthority(e.decode(s)),r.setPath(e.decode(c)),r.setQuery(t.parse_string(u)),r.setFragment(e.decode(a)),r},e.prototype.getScheme=function(){return this.scheme||""},e.prototype.setScheme=function(t){return o(!t||t.match(e.SCHEME_REGEXP,"Invalid scheme")),this.scheme=t,this},e.prototype.getAuthority=function(){return this.authority||""},e.prototype.setAuthority=function(e){return this.authority=e,this},e.prototype.getPath=function(){return this.path||""},e.prototype.setPath=function(e){return this.path=e,this},e.prototype.getFragment=function(){return this.fragment||""},e.prototype.setFragment=function(e){return this.fragment=e,this},e.prototype.getQuery=function(){return this._query.dict},e.prototype.setQuery=function(e){return null==e&&(e={}),this._query=new t(e),this},e.prototype.updateQuery=function(e,t){return null==t&&(t=null),this._query.add(e,t),this},e.prototype.removeQuery=function(e){return this._query.remove(e),this},e.prototype.clone=function(){return e(this.toObject())},e.prototype.toObject=function(){return{scheme:this.getScheme(),authority:this.getAuthority(),path:this.getPath(),query:this.getQuery(),fragment:this.getFragment()}},e.prototype.toString=function(){var t,n;return n="",this.scheme&&(n+=this.scheme+":"),this.authority&&(n+="//"+e.encode(this.authority,":@[]")),this.path&&(o(!this.authority||!this.path.length||"/"===this.path[0],'Path must start with a "/" if URI is not relative'),n+=e.encode(this.path,"/")),t=this._query.toString(),t&&(n+="?"+t),this.fragment&&(n+="#"+e.encode(this.fragment,":@[]/&=+?#!")),n},e.REGEXP=/^(?:([^:/\\?#]+):)?(?:[/\\]{2}([^/\\?#]*))?([^?#]*)(?:\?([^#]*))?(?:[#](.*))?$/,e.SCHEME_REGEXP=/^[a-zA-Z][a-zA-Z0-9+.\-]*$/,e.decode=function(e){return e?decodeURIComponent(e):""},e.encode=function(e,t){var n,o,i,r;if(null==t&&(t=""),!e)return"";for(e=encodeURIComponent(e),t+="~",i=0,r=t.length;r>i;i++)o=t[i],n=encodeURIComponent(o),e=e.replace(new RegExp(n,"g"),o);return e},e.encode_parts=function(t,n){var o;return null==n&&(n="/"),function(){var i,r,s,a;for(s=t.split(n),a=[],i=0,r=s.length;r>i;i++)o=s[i],a.push(e.encode(o));return a}().join(n)},e}(),t=function(){function e(e){this.dict={},this.add(e)}return e.parse_string=function(t){var n,o,i,r,s,a,c,u;if(!t)return null;for(i={},r=t.split("&"),c=0,u=r.length;u>c;c++)o=r[c],""!==o&&(s=o.split("="),n=e.decode(s[0]),a=e.decode(s.slice(1).join("=")),n in i?(Array.isArray(i[n])||(i[n]=[i[n]]),i[n].push(a)):i[n]=a);return i},e.prototype.add=function(e,t){var n,o,i,r;if(null==t&&(t=null),"string"==typeof e)null!=t&&(this.dict[e]=Array.isArray(t)?function(){var e,o,i;for(i=[],e=0,o=t.length;o>e;e++)n=t[e],i.push(String(n));return i}():String(t));else{i=e||{};for(o in i)r=i[o],null!=r&&(this.dict[o]=Array.isArray(r)?function(){var e,t,o;for(o=[],e=0,t=r.length;t>e;e++)n=r[e],o.push(String(n));return o}():String(r))}return this},e.prototype.remove=function(e){return delete this.dict[e]},e.prototype.replace=function(e){return this.dict=e||{},this},e.prototype.toString=function(){var t,n,o,i;n=[],i=this.dict;for(t in i)o=i[t],Array.isArray(o)?o.forEach(function(o){return n.push(e.encode(t)+"="+e.encode(o))}):n.push(e.encode(t)+"="+e.encode(o));return n.length?n.join("&"):""},e.decode=function(e){return null===e?"":n.decode(e.replace(/\+/g,"%20"))},e.encode=function(e){return null===e?"":n.encode(e).replace(/%20/g,"+")},e}(),INLINE_JS.URI=n,n}),define("modules/dirty/groups/api",["jquery","dropbox","modules/clean/ajax","modules/clean/contacts/cache","modules/clean/viewer"],function(e,t,n,o,i){var r,s,a;return r=o.DefaultContactsCache,a={},s="/groups_ajax",a.ready=function(){},a.get_groups_for_user=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"get_groups_for_user",data:e,success:t})},a.get_group_info=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"get_group_info",data:e,success:t})},a.get_groups_for_team=function(e,t){return null==e&&(e={}),null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"get_groups_for_team",data:{},success:t})},a.get_users_for_group=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"get_users_in_group",data:e,success:t})},a.create_group=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"make_new_group",data:e,success:t,reload_contacts:!0})},a.create_group_with_users=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"make_new_group_with_users",data:e,success:t,reload_contacts:!0})},a.remove_group=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"remove_group",data:e,success:t,reload_contacts:!0})},a.rename_group=function(e,t,n){return null==n&&(n=function(){return{}}),a.metaserver_ajax({method:"rename_group",data:e,success:t,error:n,reload_contacts:!0})},a.add_users_to_group=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"add_users_to_group",data:e,success:t,reload_contacts:!0})},a.remove_user_from_group=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"remove_user_from_group",data:e,success:t,reload_contacts:!0})},a.change_group_member_type=function(e,t){return null==t&&(t=function(){return{}}),a.metaserver_ajax({method:"change_group_member_type",data:e,success:t})},a.remove_namespace_from_group=function(e,t){return a.metaserver_ajax({method:"remove_namespace_from_group",data:e,success:t})},a.change_group_access_type=function(e,t){var o;return o=function(e,n,o){return t(o)},n.WebRequest({url:s+"/change_group_access_type",type:"post",data:e,subject_user:i.get_viewer().work_user,success:o})},a.refresh_account_photos=function(){var e,t;e=JSON.stringify(r.cached_contacts.contacts.map(function(e){return e.email})),t=function(e){var t,n,o,i;for(i=r.cached_contacts.contacts,n=0,o=i.length;o>n;n++)t=i[n],t.photo_url=e[t.email]},a.metaserver_ajax({method:"get_account_photo_urls_for_emails",data:{emails:e},success:t})},a.metaserver_ajax=function(t){var o,a,c,u;return u=s+"/"+t.method,a=t.reload_contacts||!1,c=function(n){var o,i;o=JSON.parse(n),o.ok&&(t.success(o.data),e(".error_msg").hide()),a&&r.load_contacts(i=!0)},o=function(n){var o;o=n.responseText,t.error&&(t.error(o.slice(4)),e(".error_msg").hide())},n.WebRequest({url:u,type:"post",data:t.data,subject_user:i.get_viewer().work_user,success:c,error:o})},__CIRCULAR_DEPENDENCY__.GroupsApi=a,a});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/growth/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri","modules/dirty/register_form","modules/clean/components/login_form","modules/clean/dbmodal"],function(e,t,n,o,i,r,s,a,c,u){var l,_,d,p;return d=e.SharingModel,p=i._,l=u.DBModal,_=function(){function e(e){this.show_default_modal=e,this.toggle_form=__bind(this.toggle_form,this),this.save_to_dropbox=__bind(this.save_to_dropbox,this),this.reload_and_direct_download=__bind(this.reload_and_direct_download,this),this.reload=__bind(this.reload,this),this.direct_download=__bind(this.direct_download,this),this.show_welcome_modal=__bind(this.show_welcome_modal,this),
this.show_downloading_modal=__bind(this.show_downloading_modal,this),this.before_welcome_modal=__bind(this.before_welcome_modal,this),this.before_download_signup_modal=__bind(this.before_download_signup_modal,this),this.before_default_signup_modal=__bind(this.before_default_signup_modal,this),this.before_signup_modal=__bind(this.before_signup_modal,this),this.init_modals=__bind(this.init_modals,this),this.init_modals(),this.show_default_modal&&(this.default_signup_modal.show(),this.has_seen_modal=!0),t("#download_button_link, #default_content_download_button").click(function(e){return function(){return e.has_seen_modal?e.direct_download():(e.download_type="direct_download",e.download_signup_modal.show(),e.has_seen_modal=!0)}}(this)),t("#add_to_my_dropbox_link, #default_content_a2md").click(function(e){return function(){return e.download_type="add_to_dropbox",e.download_signup_modal.show()}}(this))}return e.prototype.init_modals=function(){return this.default_signup_modal=new l({element_id:"shared-link-default-signup-modal"}),this.default_signup_modal.before_show=this.before_default_signup_modal,this.download_signup_modal=new l({element_id:"shared-link-download-signup-modal"}),this.download_signup_modal.before_show=this.before_download_signup_modal,this.welcome_modal=new l({element_id:"shared-link-welcome-modal"}),this.welcome_modal.before_show=this.before_welcome_modal},e.prototype.before_signup_modal=function(e){var t,n;return e.find(".toggle-form-link").click(function(t){return function(){return t.toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&n.on(a.REGISTER_SUCCESS,function(e){return function(t,n){var i,a,c;if(e.user_info=n,r.success(p("Successfully signed up for Dropbox.")),"shared-link-onboarding"===(null!=(c=e.user_info.one_ring_experiment)?c.active_experiment:void 0)){if(a=e.user_info.one_ring_experiment.active_variant,"redirect_to_downloading_page"===a)return i=s.parse("/downloading").updateQuery({shared_link:!0,tkey:d.c2d_vars.tkey}),o.redirect(i);if("non_blocking_download_modal"===a)return e.show_downloading_modal(!0);if("blocking_download_modal"===a)return e.show_downloading_modal(!1)}else{if(!e.download_type)return e.show_welcome_modal();if("direct_download"===e.download_type)return e.show_welcome_modal(),e.direct_download();if("add_to_dropbox"===e.download_type)return e.save_to_dropbox(!1)}}}(this)),t=e.find(".login-form"),t.length?t.on(c.LOGIN_SUCCESS,function(e){return function(t,n){return e.user_info=n,r.success(p("Successfully signed in to Dropbox")),e.download_type?"direct_download"===e.download_type?e.reload_and_direct_download():"add_to_dropbox"===e.download_type?e.save_to_dropbox(!1):void 0:e.reload()}}(this)):void 0},e.prototype.before_default_signup_modal=function(e){return this.before_signup_modal(e)},e.prototype.before_download_signup_modal=function(e){return this.before_signup_modal(e),"direct_download"===this.download_type?(e.find(".add-to-dropbox-component").hide(),e.find(".direct-download-component").show()):"add_to_dropbox"===this.download_type&&(e.find(".direct-download-component").hide(),e.find(".add-to-dropbox-component").show(),e.find(".login-form-component").is(":visible")||this.toggle_form(e)),e.find(".close-link").click(function(e){return function(){return e.download_signup_modal.hide()}}(this))},e.prototype.before_welcome_modal=function(e){return e.find(".welcome-modal-no-thanks a").click(function(){return function(){return o.reload()}}(this))},e.prototype.show_downloading_modal=function(e){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.save_to_dropbox(!0),this.onboarding_download_modal=new l({click_out_to_close:e,element_id:"shared-link-onboarding-download-modal"}),this.onboarding_download_modal.before_show=function(){return function(t){return t.find("#onboarding-download-modal__download_container").attr("src","/download"),e?void 0:t.find(".db-modal-x").css("visibility","hidden")}}(this),this.onboarding_download_modal.show()},e.prototype.show_welcome_modal=function(){return this.default_signup_modal.hide(),this.download_signup_modal.hide(),this.welcome_modal.show()},e.prototype.direct_download=function(){var e;return e=o.get_uri().updateQuery({dl:1}),o.redirect(e)},e.prototype.reload=function(){return o.reload()},e.prototype.reload_and_direct_download=function(){var e;return e=o.get_uri().updateQuery({force_dl:1}),o.redirect(e)},e.prototype.save_to_dropbox=function(e){var t;return e||r.success(p("Saving to your Dropbox ...")),t=d.c2d_vars,t.job=d.is_folder,n.WebRequest({url:d.c2d_url,data:t,subject_user:this.user_info.id,success:function(){return function(t){return e?void 0:(r.success(p("Successfully saved to your Dropbox.")),o.redirect(t))}}(this)})},e.prototype.toggle_form=function(e){var t,n;return n=e.find(".register-form-component"),t=e.find(".login-form-component"),n.is(":visible")?n.fadeOut({complete:function(){return t.show()}}):t.fadeOut({complete:function(){return n.show()}})},e}()}),define("modules/dirty/home",["jquery","dropbox","modules/clean/account/email","modules/clean/analytics","modules/clean/payments/pro_trial_onboarding_tour","modules/clean/teams/trial_buy_now","modules/clean/upsell/ha_loader","modules/clean/viewer","modules/dirty/sharing/sharing_growth_email_experiments"],function(e,t,n,o,i,r,s,a,c){var u,l,_,d,p,h,f;return u=t.Browse,l=t.ClientDownload,d=t.FileOps,f=t.SharingModals,_=n.EmailVerification,h=o.SharedFolderActivityLogger,p={init:function(t){var n,o,m,g;return s.init("home",u.active_user,t.force_campaign_id),t.show_email_just_verified?_.getForRole(t.role).show_verified_modal():t.show_email_just_verified_and_changed?_.getForRole(t.role).show_verified_and_changed_modal():t.show_sent_verification_email?_.getForRole(t.role).show_sent_modal():t.show_upload?(m=function(){var e;return t.email_src&&(e={ns_id:u.containing_ns_id(),email_src:t.email_src},h.log("web","show_upload_modal_for_sf_from_email",u.active_user,e),c.listen_for_first_upload(u.active_user,e)),d.show_upload.bind(d)()},p._call_when_browse_ready(m)):t.show_share_existing_modal?(t.email_src&&(o={email_src:t.email_src},h.log("web","show_share_existing_folder_modal_from_email",u.active_user,o)),f.show_share_existing_modal(t.fq_path,u.active_user)):t.show_share_options&&!t.share_subfolder?(g=a.get_viewer().get_user_by_role(t.role),g||(g=a.get_viewer().get_users()[0]),f.show_shared_folder_options_modal(t.fq_path,g)):t.show_share_options&&t.share_subfolder?(g=a.get_viewer().get_user_by_role(t.role),g||(g=a.get_viewer().get_users()[0]),f.show_shared_subfolder_modal(t.fq_path,g)):t.show_download_modal?(n=new l,n.show_download_modal()):t.show_pro_trial_modal?i.ProTrialOnboardingTour.show("trial_start"):t.remaining_trial_days?r.showModal(t.remaining_trial_days):t.show_upsell_modal?e("#db-modal-upsell-home-modal").addClass("show-upsell-modal").trigger("show-upsell-modal"):void 0},_call_when_browse_ready:function(e){var t;return u.first_load?(t=function(){return document.stopObserving(u.UPDATE_EVT,t),e()},document.observe(u.UPDATE_EVT,t)):e()}}}),define("modules/dirty/print",["dropbox"],function(e){var t;return t=e.NOTCLIENTS,{print:function(){var e,n,o;for(n in t)e=t[n],e.abort();window.print(),o=[];for(n in t)e=t[n],o.push(e.reconnect());return o}}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/activity/comment_activity_ui",["external/react","external/underscore","modules/clean/react/activity/like_bar","modules/clean/react/activity/resolve_button","modules/dirty/react/activity/time_counter","modules/clean/react/modal","modules/core/i18n","modules/clean/viewer","modules/clean/avatar/components","modules/clean/referrer_cleansing_redirect"],function(e,t,n,o,i,r,s,a,c,u){var l,_,d,p,h,f;return p=r.SimpleModal,l=c.AvatarWithDefault,d=c.InitialsAvatar,h=c.ViewerAvatar,f=e.DOM,_=e.createClass({propTypes:{context_activity_store:e.PropTypes.object.isRequired,comment_activity:e.PropTypes.object.isRequired,update_resolved:e.PropTypes.func.isRequired,delete_comment:e.PropTypes.func.isRequired,user:e.PropTypes.object.isRequired,add_like_callback:e.PropTypes.func,fileViewerState:e.PropTypes.object},getInitialState:function(){return{hover:!1}},updateResolved:function(e){return this.props.update_resolved(this.props.comment_activity,e)},deleteComment:function(e){return e.preventDefault(),p.show({title_text:s._("Delete comment?"),body_html:s._("Are you sure you want to delete this comment?"),cancel_text:s._("Cancel"),confirm_text:s._("Delete"),confirm_callback:function(e){return function(){return e.props.delete_comment(e.props.comment_activity)}}(this)})},addLikeCallback:function(){var e;return"function"==typeof(e=this.props).add_like_callback?e.add_like_callback(this.props.comment_activity):void 0},renderPhoto:function(){var e,t,n;return t={dimension:32,photoUrl:this.props.comment_activity.comment.commenter.photo_circle_url,defaultAvatar:new d({dimension:32,shape:"CIRCLE",initials:this.props.comment_activity.comment.commenter.initials}),key:this.props.comment_activity.comment.commenter.id},n=this.props.comment_activity.comment.commenter.id,e=__indexOf.call(a.get_viewer().get_user_ids(!0),n)>=0?new h(t):new l(t),f.div({className:"commenter-photo"},e)},renderCommentBody:function(){var e,t,n,o,i,r,s,a,c,l,_,d,p,h,m;for(n=/@\[[^:^\[]+:[^:^\]]+\]/,d="(?:[-a-zA-Z0-9@:%_+~#=]+[.])+[a-z]{2,6}(?:[:./?#][-a-zA-Z0-9@%_+~&=]+)*",l="http://"+d+"|https://"+d+"|www."+d+"|"+d,_=new RegExp(l,"gi"),t=/\n/,s=[n,_,t],a=RegExp("("+function(){var e,t,n;for(n=[],e=0,t=s.length;t>e;e++)r=s[e],n.push(r.source);return n}().join("|")+")"),i=[],m=this.props.comment_activity.comment.raw_comment_text.split(a),p=0,h=m.length;h>p;p++)e=m[p],e&&(e.match(n)?(o=e.split(/\[|\]|:/)[2],i.push(f.span({className:"comment-mention"},o))):e.match(_)?(c=e,c.indexOf("http://")<0&&c.indexOf("https://")<0&&(c="http://"+c),c=u.get_redirect_uri(c),i.push(f.a({href:c,target:"_blank"},e))):i.push(e.match(t)?f.br({}):e));return i},renderBody:function(){var e,r,c,u,l,_,d,p,h;return l=f.div({className:"second-bottom-dot",dangerouslySetInnerHTML:{__html:"&middot;"}}),u=f.div({className:"delete-icon",onMouseDown:function(e){return function(t){return e.deleteComment(t)}}(this)},s._("Delete")),c=[],c.push(l),c.push(u),e=this.state.hover,t.intersection(a.get_viewer().get_user_ids(!0),this.props.comment_activity.permissions.user_ids_who_can_delete).length||(e=!1),r=this.props.comment_activity.comment,r.has_metadata()&&(r.comment_metadata.has_pptx_data()?(h=function(e){return function(t){return e.props.fileViewerState.navToObject(t.comment_metadata)}}(this),p=r.get_metadata_as_string(),d=f.div({className:"comment-metadata"},f.span({className:"right-triangle"}," ▶"),f.span({className:r.is_metadata_deleted()?"deleted-slide-id":"active-slide-id",onMouseUp:function(){return function(){return h(r)}}(this)},p))):r.comment_metadata.has_annotation_data()&&(_=f.div({className:"comment-annotation"},f.a({},"Annotation on page "+r.comment_metadata.annotation.pdf_coordinates.page)))),f.div({className:"comment-body"},f.div({className:"comment-top-bar"},f.div({className:"commenter-name"},r.commenter.display_name),d,this.props.user.is_signed_in&&(this.state.hover&&!r.resolved||r.resolved)?o({resolved:r.resolved,update_resolved:this.updateResolved}):void 0),f.div({className:"comment-text"},this.renderCommentBody()),_,f.div({className:"comment-bottom-bar"},n({activity:this.props.comment_activity,context_activity_store:this.props.context_activity_store,user:this.props.user,add_like_callback:function(e){return function(){return e.addLikeCallback()}}(this)}),f.div({className:"bottom-dot",dangerouslySetInnerHTML:{__html:"&middot;"}}),i({when_mses:r.when_mses}),e?c:void 0))},render:function(){var t;return t=e.addons.classSet({comment:!0,resolved:this.props.comment_activity.comment.resolved}),f.div({className:"comment-activity",onMouseMove:function(e){return function(){return e.setState({hover:!0})}}(this),onMouseLeave:function(e){return function(){return e.setState({hover:!1})}}(this)},f.div({className:t},this.renderPhoto(),this.renderBody()))}})});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/activity/comment_input",["jquery","external/react","external/underscore","modules/core/exception","modules/core/i18n","modules/core/notify","modules/clean/activity/activity_user","modules/clean/gandalf_util","modules/clean/keycode","modules/clean/storage","modules/clean/react/activity/mentions_controller","modules/clean/react/activity/users_to_notify","modules/clean/react/button","modules/clean/react/tooltip","modules/clean/avatar/components","modules/dirty/growth/shared_link_signup_modals","modules/clean/viewer","modules/clean/react/file_comments/logger","modules/clean/react/sprite","modules/clean/react/react_i18n"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y){var b,w,E,T,S,C,x,k,O,A;return A=i._,O=i.ungettext,T=u.LocalStorage,b=h.AvatarWithDefault,E=h.InitialsAvatar,x=h.ViewerAvatar,S=y.R_,k=t.DOM,C=t.addons.CSSTransitionGroup,w=t.createClass({propTypes:{activity:t.PropTypes.object.isRequired,comment_callback:t.PropTypes.func,resize_callback:t.PropTypes.func,position_contacts_callback:t.PropTypes.func,onFocus:t.PropTypes.func,onBlur:t.PropTypes.func,user:t.PropTypes.object.isRequired,show_new_comment_callback:t.PropTypes.func,in_blank_state:t.PropTypes.bool,enableNotifyText:t.PropTypes.bool,enableNoNotifyHint:t.PropTypes.bool,show_new_comment:t.PropTypes.bool,contacts_should_dropdown:t.PropTypes.bool,comment_metadata_allowed:t.PropTypes.bool,file_viewer_state:t.PropTypes.object.isRequired,verifyAfterSignUpCallback:t.PropTypes.func},getInitialState:function(){var e,t,n;return e=!0,n=!1,t=this._getCommentLocalStorage(this.props.activity.activity_key),this.isPostSignUp=!1,t.length>0&&(e=!1,n=!0,this.isPostSignUp=!0),{button_disabled:e,show_post_button:n,initial_text:t,users_to_notify:this.props.activity.users_to_notify,comment_metadata:null}},componentDidMount:function(){var t,n;return t=function(t,n){var o;return o=(null!=n?n.getDOMNode():void 0)||null,t.target===o||e.contains(o,t.target)},e(this.getDOMNode()).on("click.comment-input",function(e){return function(n){return t(n,e.refs.postButton)&&e.verifySubscribersBeforePost(),t(n,e.refs.showNewCommentButton)?e.showNewComment():void 0}}(this)),null!=(n=this.props.file_viewer_state)&&n.registerStateChangedCB(this._onViewerStateChanged),this.isPostSignUp&&!this.props.user.is_email_verified?this.props.verifyAfterSignUpCallback():void 0},componentWillUnmount:function(){return e(this.getDOMNode()).off(".comment-input")},componentWillReceiveProps:function(e){return this.updateNotificationCount(e.activity)},_contactsSelectorPopupShown:function(){return g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SHOWN,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.LITTLE_MAN_BUTTON,this.props.user.id)},_onAtSignKeyPress:function(){return this.props.user.is_signed_in?g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SHOWN,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.AT_SIGN_KEYPRESS,this.props.user.id):void 0},_onNoAtSignKeyPress:function(){return g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SHOWN,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.NO_AT_SIGN_KEYPRESS,this.props.user.id)},_contactPopupSelectedCallback:function(){return o.assert(this.props.user.is_signed_in,"Contact selected from popup when user is logged out"),g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SELECTED,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.LITTLE_MAN_BUTTON,this.props.user.id)},_contactSelectedCallback:function(e){var t;return o.assert(this.props.user.is_signed_in,"Contact selected when user is logged out"),t=e?Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.NO_AT_SIGN_KEYPRESS:Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.AT_SIGN_KEYPRESS,g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_CONTACT_LIST_SELECTED,this.props.activity.activity_key,null,t,this.props.user.id)},onMentionsFocus:function(e){var t;return this.togglePostButton(!0),"function"==typeof(t=this.props).onFocus?t.onFocus(e):void 0},onMentionsBlur:function(){var e;return"function"==typeof(e=this.props).onBlur&&e.onBlur(),this.refs.mentions.getEncodedMessage()?this.shouldSaveText()?this._storeCommentLocalStorage(this.refs.mentions.getEncodedMessage(),this.props.activity.activity_key):void 0:this.togglePostButton(!1)},onKeyDown:function(e){return e.keyCode===c.ENTER&&(e.ctrlKey||e.metaKey)?(this.verifySubscribersBeforePost(),e.preventDefault()):void 0},onKeyUp:function(){return this._setPostButtonState(),this.updateNotificationCount(this.props.activity)},onPaste:function(){return setTimeout(function(e){return function(){return e._setPostButtonState(),e.updateNotificationCount(e.props.activity)}}(this),10)},togglePostButton:function(e){return this.setState({show_post_button:e},function(e){return function(){var t;return"function"==typeof(t=e.props).resize_callback?t.resize_callback():void 0}}(this))},shouldSaveText:function(){return!this.props.user.is_signed_in||!this.props.user.is_email_verified},updateNotificationCount:function(e){var t,o,i,r,a,c,u,l,_,d,p,h,f;if(d=function(){var t,n,o,i;for(o=e.users_to_notify,i=[],t=0,n=o.length;n>t;t++)p=o[t],i.push(p.unique_id);return i}(),u=this.refs.mentions.extractMentions(),c=function(){var e,t,n;for(n=[],e=0,t=u.length;t>e;e++)a=u[e],n.push(a.dbx_account_id||a.identifier);return n}(),t=n.union(d,c).sort(),o=n.pluck(this.state.users_to_notify,"id").sort(),!n.isEqual(o,t)){for(l=n.object(c,u),r=n.difference(t,d),_=n.clone(e.users_to_notify),h=0,f=r.length;f>h;h++)i=r[h],_.push(new s({id:i,display_name:l[i].name}));return this.setState({users_to_notify:_})}},_onSkipAddMention:function(){return this.postComment()},_setPostButtonState:function(){var e;return e=""===this.refs.mentions.getEncodedMessage(),this.state.button_disabled!==e?this.setState({button_disabled:e}):void 0},showNewComment:function(){var e;return"function"==typeof(e=this.props).show_new_comment_callback?e.show_new_comment_callback():void 0},verifySubscribersBeforePost:function(){var e,t,n,o;return this.props.user.is_signed_in&&(e=function(){var e,n,o,i;for(o=this.state.users_to_notify,i=[],e=0,n=o.length;n>e;e++)t=o[e],t.id!==this.props.user.id&&i.push(t);return i}.call(this),0===e.length&&0===(null!=(n=this.props.activity.comment_activities)?n.length:void 0)&&this.props.enableNoNotifyHint)?void(null!=(o=this.refs.mentions)&&o.showNoNotifyHint()):this.postComment()},postComment:function(){var e,t;return(e=this.refs.mentions.getEncodedMessage())?(this.shouldSaveText()||(this.refs.mentions.disableMentions(),this.refs.mentions.clearTextField(),this._setPostButtonState(),this.togglePostButton(!1)),"function"==typeof(t=this.props).comment_callback?t.comment_callback(e):void 0):void 0},_clearCommentLocalStorage:function(){return T.set("tmp-file-comment",null)},_getCommentLocalStorage:function(e){var t,n;return n=T.get("tmp-file-comment"),t="",n&&n.activity_key===e&&((new Date).getTime()-n.time<3e5&&(t=n.text),this._clearCommentLocalStorage()),t},_storeCommentLocalStorage:function(e,t){return T.set("tmp-file-comment",{activity_key:t,text:e,time:(new Date).getTime()})},_onViewerStateChanged:function(e){return this.isMounted()?this.setState({comment_metadata:e.selectedObject}):void 0},_renderShowNewComment:function(){var e,t;return t=[],this.props.show_new_comment&&(e=k.a({className:"show-new-comment-button",ref:"showNewCommentButton"},[k.span({className:"show-new-comment-icon"}),k.span({className:"show-new-comment-text"},A("New Comment"))]),t=k.div({className:"comment-show-new-comment"},e)),C({transitionName:"comment-show-new-comment",component:k.div},t)},_renderCommentBox:function(){var e,t,n,o,i;return o=A(this.props.in_blank_state?"Write a comment":"Comment or @mention"),i=this.props.comment_metadata_allowed&&null!=this.state.comment_metadata,e=l({placeholder_text:o,initial_text:this.state.initial_text,ref:"mentions",contacts_should_dropdown:this.props.contacts_should_dropdown,onFocus:this.onMentionsFocus,onBlur:this.onMentionsBlur,position_contacts_callback:this.props.position_contacts_callback,resize_callback:this.props.resize_callback,onKeyUp:this.onKeyUp,onKeyDown:this.onKeyDown,onPaste:this.onPaste,onMention:function(e){return function(){return e.updateNotificationCount(e.props.activity)}}(this),user:this.props.user,showMentionsHelper:a.getGandalfRule("dw-comments-add-mention-dropdown")&&this.props.user.is_signed_in,enableNoAtMentions:a.getGandalfRule("dw-comments-no-at-mentions")&&this.props.user.is_signed_in,bottomSharpCorners:i,contactsSelectorPopupShown:this._contactsSelectorPopupShown,onAtSignKeyPress:this._onAtSignKeyPress,onNoAtSignKeyPress:this._onNoAtSignKeyPress,contactPopupSelectedCallback:this._contactPopupSelectedCallback,contactSelectedCallback:this._contactSelectedCallback,onSkipAddMention:this._onSkipAddMention}),k.div({className:"comment-box"},[e,i?(t=null,n=this.state.comment_metadata.type,"slide"===n?t=S({index:this.state.comment_metadata.index},'Comment will be left on <span class="metadata-area-slide-id">slide %(index)s</span>'):void 0,null!=t?k.div({className:"metadata-area"},[t,k.a({href:"#",className:"metadata-area-close",onMouseUp:function(e){return function(){return e._metadata_close()}}(this)},v({group:"web",name:"x"}))]):void 0):void 0,k.div({className:"post-area",ref:"postArea"},[this.props.enableNotifyText?this._renderTooltipContainer():void 0,this._renderButtonContainer()])])},_metadata_close:function(){var e;return null!=(e=this.props.file_viewer_state)?e.setSelectedObject(null):void 0},_renderCommenterPhoto:function(){var e,t,n,o;return t={dimension:32,photoUrl:this.props.user.photo_circle_url,defaultAvatar:new E({dimension:32,shape:"CIRCLE",initials:this.props.user.initials||"?"})},n=null!=(o=this.props.user)?o.id:void 0,e=__indexOf.call(m.get_viewer().get_user_ids(!0),n)>=0?new x(t):new b(t),k.div({className:"commenter-photo"},e)},_renderTooltipContainer:function(){return k.div({className:"tooltip-container"},_({usersToNotify:this.state.users_to_notify,user:this.props.user,show_extra_text:!this.state.show_post_button}))},_renderButtonContainer:function(){var e,t,n,o;return n=!this.state.show_post_button,t=this.state.button_disabled,e={className:"post-button",disabled:t,ref:"postButton"},o=d.button(e,A("Post")),k.div({className:"button-container",hidden:n},o)},render:function(){var e;return e=t.addons.classSet({"comment-field":!0,"comment-expanded":a.getGandalfRule("dw-comments-expanded-input")&&(this.state.show_post_button||this.props.in_blank_state)}),k.div({className:e},[this._renderShowNewComment(),this._renderCommenterPhoto(),this._renderCommentBox()])}})}),define("modules/dirty/react/activity/time_counter",["external/react","modules/clean/datetime"],function(e,t){var n,o;return o=e.DOM,n=e.createClass({render:function(){var e;return e=t.ago(new Date(this.props.when_mses)),o.div({className:"activity-time-ago"},e)},updateLoop:function(){},componentDidMount:function(){return this.updateLoop()},getUpdateInterval:function(){return 5e3}})});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/file_comments/comment_list_ui",["jquery","external/react","external/underscore","modules/core/i18n","modules/core/notify","modules/clean/account/email","modules/clean/account/email_verify_reasons","modules/clean/activity/activity","modules/clean/activity/activity_local_storage","modules/clean/activity/activity_user","modules/clean/activity/comment","modules/clean/activity/file_viewer_state","modules/clean/datetime","modules/clean/gandalf_util","modules/clean/keycode","modules/clean/react/button","modules/clean/react/file_comments/comment_list_header","modules/clean/react/file_comments/logger","modules/clean/react/image","modules/clean/react/input","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/dirty/react/activity/comment_activity_ui","modules/dirty/react/activity/comment_input","modules/dirty/react/file_comments/shared_link_signup_modals"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T,S){var C,x,k,O,A,N;return N=o._,x=r.EmailVerification,A=t.DOM,k=b.R_,O=t.addons.CSSTransitionGroup,C=t.createClass({displayName:"CommentListUI",propTypes:{contextActivityStore:t.PropTypes.object.isRequired,activity:t.PropTypes.object,onInputFocus:t.PropTypes.func,onInputBlur:t.PropTypes.func,height:t.PropTypes.number,user:t.PropTypes.object,hideCallback:t.PropTypes.func.isRequired,turnOffFeedbackCallback:t.PropTypes.func.isRequired,turnOnFeedbackCallback:t.PropTypes.func.isRequired,onSubscribeUpdated:t.PropTypes.func,enableFacepile:t.PropTypes.bool,enableNoNotifyHint:t.PropTypes.bool,fileViewerState:t.PropTypes.object,shouldShowLoadingSpinner:t.PropTypes.bool},getInitialState:function(){return this.props.user.is_signed_in||(this.modals=new S),{isLoading:!1,contactsShouldDropdown:!0,showResolved:!1,showNewComment:!1,isSender:!1}},getDefaultProps:function(){return{shouldShowLoadingSpinner:!0}},componentWillUnmount:function(){return e(window).unbind("resize.bottom_bar")},componentDidMount:function(){return e(window).bind("resize.bottom_bar",function(e){return function(){return e.checkScroll()}}(this))},componentDidUpdate:function(e,t){var n,o,i,r,s,a,u,l,_,d,p,h;if(this._isReady()){if(i=(this.props.activity&&this.props.activity.activity_key)!==(e.activity&&e.activity.activity_key)){if(this.props.activity.feedback_off||this.modals&&this.modals.set_activity_key(this.props.activity.activity_key),this.props.user.is_signed_in&&(a=c.get_store("like",this.props.activity.activity_key),a&&a.comment_activity_key))for(d=this.props.activity.comment_activities,l=0,_=d.length;_>l;l++)n=d[l],n.activity_key===a.comment_activity_key&&(c.clear_store("like"),this.props.contextActivityStore.add_comment_like(n,this.props.user,null,null));this.props.user.is_signed_in&&!this._isSubscribed()&&(u=c.get_store("subscribe",this.props.activity.activity_key),c.clear_store("subscribe"),u&&this.toggleFeedbackForViewer())}return s=this.shouldShowBottomBar(),o=this.getCommentBoxHeight(),(null==e.activity&&(null!=(p=this.props.activity)&&null!=(h=p.comment_activities)?h.length:void 0)>0||null==t.comment_box_height&&o)&&this.animateScrollToBottom(500),r={},this.state.show_bottom_bar!==s&&(r.show_bottom_bar=s),this.state.comment_box_height!==o&&(r.comment_box_height=o),Object.keys(r).length?this.setState(r):void 0}},onAddCommentFromList:function(e){var t,n;return t=(null!=(n=this.props.fileViewerState)?n.get_state().selectedObject:void 0)||null,this.addComment(e,t)},addComment:function(t,n){var o,r,a;return null==n&&(n=null),this.props.user.is_signed_in?this.props.user.is_email_verified?(t=e.trim(t),a=function(e){return function(){return e.setState({isLoading:!1},function(){return e.animateScrollToBottom()})}}(this),r=function(e){return function(t){var n;return n=t.error_text||N("An error occurred while commenting."),i.error(n),e.setState({isLoading:!1})}}(this),this.props.contextActivityStore.add_comment(this.props.activity,this.props.user,t,n,a,r),this.setState({isLoading:!0},function(e){return function(){return e.scrollToBottom()}}(this)),this.setState({isSender:!0})):(o=x.get_for_user(this.props.user),o.show_verify_modal(null,s.ADD_COMMENT)):(this.modals.show_sign_in_modal(S.POST_COMMENT_VARIANT),g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.POST_BUTTON))},addLikeCallback:function(e){return this.props.user.is_signed_in?void 0:(c.set_store("like",this.props.activity.activity_key,e.activity_key),this.modals.show_sign_in_modal(S.LIKE_COMMENT_VARIANT),g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,this.props.activity.activity_key,e.activity_key,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.LIKE_BUTTON))},updateResolved:function(e,t){var n;return n=function(e){return function(){return i.error(N(t?"An error occurred while setting the comment to resolved.":"An error occurred while setting the comment to not resolved.")),e.forceUpdate()}}(this),this.props.contextActivityStore.update_resolved(e,this.props.user,t,null,n),this.forceUpdate()},deleteComment:function(e){var t,n;return t=function(e){return function(){return i.error(N("An error occurred while deleting the comment.")),e.forceUpdate()}}(this),n=function(e){return function(){i.success(N("Comment deleted"),2),e.forceUpdate()}}(this),this.props.contextActivityStore.delete_comment(this.props.activity,this.props.user,e.activity_key,n,t)},_isSubscribed:function(){var e,t,n,o;if(this._isReady())for(o=this.props.activity.users_to_notify,t=0,n=o.length;n>t;t++)if(e=o[t],e.id===this.props.user.id)return!0;return!1},toggleFeedbackForViewer:function(){var e,t,n;return this.props.user.is_signed_in?(n=!this._isSubscribed(),t=N(n?"You have been subscribed.":"You have been unsubscribed."),e=N(n?"We failed to subscribe you.":"We failed to unsubscribe you."),this._toggleSubscribe(null,n,t,e)):(c.set_store("subscribe",this.props.activity.activity_key),this.modals.show_sign_in_modal(S.SUBSCRIBE_VARIANT),g.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,this.props.activity.activity_key,null,Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.SUBSCRIBE_BUTTON))},onFacepileContactAdded:function(e){var t,n,o,r,s,a,c,l,_;return o=e.data("name"),n=e.data("identifier"),a=e.data("photo-url"),t=e.data("dbx-account-id"),l=new u({id:t,display_name:o,email:n,photo_url:a,photo_circle_url:a}),_=l.id,__indexOf.call(function(){var e,t,n,o;for(n=this.props.activity.users_to_notify,o=[],e=0,t=n.length;t>e;e++)c=n[e],o.push(c.id);return o}.call(this),_)>=0?void i.error(N("User has already been subscribed!")):(s=N("User subscribed to comments."),r=N("An error occurred while subscribing user."),this._toggleSubscribe(l,!0,s,r))},_toggleSubscribe:function(e,t,n,o){var r,a,u,l;return!this.props.user.is_email_verified&&t?(c.set_store("subscribe",this.props.activity.activity_key),r=x.get_for_user(this.props.user),r.show_verify_modal(null,s.SUBSCRIBE_TO_COMMENTS)):(a=function(e){return function(t){var o;return i.success(n),"function"==typeof(o=e.props).onSubscribeUpdated?o.onSubscribeUpdated(t):void 0}}(this),l=function(e){return function(t){var n;return"function"==typeof(n=e.props).onSubscribeUpdated?n.onSubscribeUpdated(t):void 0}}(this),u=function(e){return function(t){var n;return i.error(o),"function"==typeof(n=e.props).onSubscribeUpdated?n.onSubscribeUpdated(t):void 0}}(this),this.props.contextActivityStore.update_subscribe(this.props.activity,this.props.user,t,e,a,l,u))},toggleShowResolved:function(){return this.setState({showResolved:!this.state.showResolved})},shouldShowBottomBar:function(){var t;return t=e(this.refs.commentList.getDOMNode()),t[0].scrollHeight-t.scrollTop()-4>t.outerHeight()},checkScroll:function(){var t,n;return t=e(this.refs.commentList.getDOMNode()),n=this.shouldShowBottomBar(),!n&&this.state.show_bottom_bar?this.setState({show_bottom_bar:!1}):n&&!this.state.show_bottom_bar&&this.setState({show_bottom_bar:!0}),!n&&this.state.showNewComment?this.setState({showNewComment:!1}):void 0},_verifyAfterSignUpCallback:function(){var e;return e=x.get_for_user(this.props.user),e.send_email(s.ADD_COMMENT,function(){}),e.show_resend_verify_modal(s.ADD_COMMENT)},turnOnFeedback:function(){return this.props.turnOnFeedbackCallback()},turnOffFeedback:function(){return this.props.turnOffFeedbackCallback()},_isReady:function(){return this.props.activity?!0:!1},onFocus:function(){var e;return p.getGandalfRule("dw-comments-expanded-input")&&setTimeout(function(e){
return function(){return e.forceUpdate()}}(this),10),"function"==typeof(e=this.props).onInputFocus?e.onInputFocus():void 0},resizeCallback:function(){return this.forceUpdate()},showNewCommentCallback:function(){return this.setState({showNewComment:!1},function(e){return function(){return e.animateScrollToBottom()}}(this))},animateScrollToBottom:function(t){var n;return null==t&&(t=600),n=this.refs.commentList.getDOMNode(),e(n).animate({scrollTop:n.scrollHeight},{duration:t})},scrollToBottom:function(){var e;return e=this.refs.commentList.getDOMNode(),e.scrollTop=e.scrollHeight},getCommentBoxHeight:function(){return null!=this.refs.commentInput?e(this.refs.commentInput.getDOMNode()).outerHeight():0},onNewActivityFromEventBus:function(e){return this.setState({isLoading:!1}),this.shouldShowBottomBar()&&!this.state.isSender&&e===Constants.FILE_ACTIVITY_ACTION_TYPE.NEW_COMMENT&&this.setState({showNewComment:!0}),this.setState({isSender:!1})},positionContactsCallback:function(){var t;return t=e(this.refs.commentList.getDOMNode()).height(),this.setState({contactsShouldDropdown:Boolean(t<this.props.height/2)})},render:function(){var e,n,o,i,r,s,a,c,u,l,_,d,h,g;if(u=v({src:"icons/ajax-loading-small-blue.gif"}),i=[],_=0,this._isReady())for(g=this.props.activity.comment_activities,d=0,h=g.length;h>d;d++)e=g[d],e.comment.resolved&&(_+=1),(!e.comment.resolved||this.state.showResolved)&&i.push(E({context_activity_store:this.props.contextActivityStore,comment_activity:e,update_resolved:this.updateResolved,delete_comment:this.deleteComment,add_like_callback:this.addLikeCallback,user:this.props.user,key:e.activity_key,fileViewerState:this.props.fileViewerState}));return o=t.addons.classSet({"comment-list":!0,scrolled:this.state.show_bottom_bar}),r=t.addons.classSet({"comments-holder":!0,"comments-holder-responsive":p.getGandalfRule("dw-comments-responsive-width")}),this.props.height&&(a={height:this.props.height},this.state.comment_box_height&&(c={maxHeight:this.props.height-this.state.comment_box_height})),s=this._isReady()&&this.props.activity.feedback_off,n=this._isReady()&&this.props.activity.can_edit_feedback,A.div({className:r,ref:"commentsHolder",style:a},A.div({className:o,ref:"commentList",onScroll:this.checkScroll,style:c},m({show_resolved:this.state.showResolved,toggle_show_resolved_callback:this.toggleShowResolved,hide_callback:this.props.hideCallback,is_subscribed:this._isSubscribed(),onSubscribeButtonClicked:this.toggleFeedbackForViewer,num_resolved:_,shouldShowDisableButton:!s&&n,feedback_off:s,turn_off_feedback_callback:this.turnOffFeedback,activity_context:this.props.contextActivityStore.activity_context,activity:this.props.activity,user:this.props.user,onFacepileContactAdded:this.onFacepileContactAdded,enableFacepile:this.props.enableFacepile}),!this._isReady()&&this.props.shouldShowLoadingSpinner?A.div({className:"comments-loading"},u):void 0,this._isReady()&&this.props.activity.feedback_off?A.div({className:"blank-state"},A.div({className:"blank-state-icon"},w({group:"web",name:"s_comments_locked"})),A.div({className:"blank-state-text"},k({},"Comments are off for this file.")),A.div({className:"blank-state-button"},f.button({importance:"secondary",onMouseUp:this.turnOnFeedback},k({},"Turn on comments")))):i.length>0?O({transitionName:"comment"},i):this._isReady()&&!this.state.isLoading?A.div({className:"blank-state"},A.div({className:"blank-state-illustration"},v({src:"commenting/comments_null_state.png"})),A.div({className:"blank-state-text"},k({},'Post a comment to start a discussion. <span class="blue">@Mention</span> someone to notify them.'))):void 0,this.state.isLoading?(l=t.addons.classSet({"loading-comment":!0,"blank-state":0===i.length}),A.div({className:l},u)):void 0),this._isReady()&&!this.props.activity.feedback_off?T({activity:this.props.activity,comment_callback:this.onAddCommentFromList,verifyAfterSignUpCallback:this._verifyAfterSignUpCallback,ref:"commentInput",resize_callback:this.resizeCallback,position_contacts_callback:this.positionContactsCallback,contacts_should_dropdown:this.state.contactsShouldDropdown,onFocus:this.onFocus,onBlur:this.props.onInputBlur,user:this.props.user,show_new_comment_callback:this.showNewCommentCallback,show_new_comment:this.state.showNewComment,in_blank_state:0===i.length,enableNotifyText:!this.props.enableFacepile,enableNoNotifyHint:this.props.enableNoNotifyHint,comment_metadata_allowed:p.getGandalfRule("pptx-commenting"),file_viewer_state:this.props.fileViewerState}):void 0)}})}),define("modules/dirty/react/file_comments/file_feedback_ui",["jquery","external/react","dropbox","modules/core/i18n","modules/core/notify","modules/clean/activity/activity","modules/clean/activity/activity_store","modules/clean/activity/activity_local_storage","modules/clean/activity/activity_user","modules/clean/activity/file_viewer_state","modules/clean/annotations/annotation","modules/clean/file_viewer_interface_controller","modules/clean/gandalf_util","modules/clean/react/modal","modules/clean/react/react_i18n","modules/clean/react/sprite","modules/clean/storage","modules/clean/viewer","modules/dirty/react/file_comments/annotation_bubble","modules/dirty/react/file_comments/comment_list_ui","modules/dirty/react/file_comments/file_feedback_likes_section","modules/dirty/react/file_comments/file_feedback_sharing_section","modules/clean/react/file_comments/logger","modules/dirty/streams/lib/user_queue"],function(e,t,n,o,i,r,s,a,c,u,l,_,d,p,h,f,m,g,v,y,b,w,E,T){var S,C,x,k,O,A,N,I,R,P,L,M,D,U,F,B,q,j;return I=n.FileViewer,L=n.Lightbox,j=o._,F=p.SimpleModal,B=t.DOM,D=h.R_,x="comment",q=g.get_viewer(),C=r.ActivityContext,O=r.FileActivity,A=s.FileActivityStore,P=50,k=50,S="annotation-overlay",N=t.createClass({displayName:"FileFeedbackUI",propTypes:{visible:t.PropTypes.bool.isRequired,showButtonColor:t.PropTypes.string.isRequired,activityContext:t.PropTypes.number,activityContextData:t.PropTypes.string,hideToggledCallback:t.PropTypes.func,photoLikesVariant:t.PropTypes.string,photoSocialShareVariant:t.PropTypes.string,previewWidthCallback:t.PropTypes.func,feedbackId:t.PropTypes.string.isRequired,onInputFocus:t.PropTypes.func,onInputBlur:t.PropTypes.func,userId:t.PropTypes.number,showDisabledCommentBar:t.PropTypes.bool,previewSelector:t.PropTypes.string,fileViewerState:t.PropTypes.object,shouldShowLoadingSpinner:t.PropTypes.bool},getInitialState:function(){return{visible:this.props.visible,enabled:!0,height:0,comments_on:!0,icon:"s_comments_locked",contextActivityStore:new A(this.props.activityContext,this.props.activityContextData),started_fetching_activity:!1}},getDefaultProps:function(){return{photoLikesVariant:"CONTROL",photoSocialShareVariant:"CONTROL",shouldShowLoadingSpinner:!0}},componentWillMount:function(){return this.annotationEnabled=d.getGandalfRule("dw-comments-annotation-marker")},componentDidMount:function(){var n;return this._refreshWidth(),this._shouldFetchActivity()&&this._fetchActivity(),null!=this.props.previewSelector&&this.annotationEnabled&&(this.$previewContainer=e(this.props.previewSelector),this.$previewContainer.length&&(e("#"+S).length||(n=e("<div />",{id:""+S}),this.$previewContainer.append(n)),this.$annotationOverlayContainer=e("#"+S).get(0),this.annotationBubble=t.render(t.createElement(v,{showBubble:!1,onAddComment:this.onAddCommentFromAnnotationBubble}),this.$annotationOverlayContainer))),this.fileViewerInterfaceController=new _(this.props.activityContext),this.fileViewerInterfaceController.registerEventsCallbacks(this.onAnnotationEventsCallback)},componentDidUpdate:function(e,t){return(this.state.comments_on!==t.comments_on||this.state.visible!==t.visible||this.state.enabled!==t.enabled)&&this._refreshWidth(),this.redrawAllAnnotations()},componentWillUnmount:function(){return this._shutdownQueue()},hideAnnotation:function(){return this.fileViewerInterfaceController.dispatchEvent("hide-annotation")},hideAnnotationBubble:function(){var e;return null!=(e=this.annotationBubble)?e.setProps({showBubble:!1}):void 0},placeAnnotationBubble:function(e){var t;return this.annotationEnabled&&(t=(new l).generateAnnotation(e.annotation),this.annotationBubble)?(this._prepareAnnotationBubble,this.annotationBubble.setProps({annotation:t,showBubble:!0,x:t.getBubblePos().x,y:t.getBubblePos().y})):void 0},_prepareAnnotationBubble:function(){var e;return null!=(e=this.annotationBubble)?e.setProps({user:this.getUser(),contextActivityStore:this.state.contextActivityStore,activity:this.state.activity}):void 0},redrawAnnotation:function(e){return this.fileViewerInterfaceController?this.fileViewerInterfaceController.dispatchEvent("draw-annotation",e):void 0},redrawAllAnnotations:function(){var e,t,n,o,i;if(this.state.activity){for(o=this.state.activity.comment_activities,i=[],t=0,n=o.length;n>t;t++)e=o[t],i.push(!e.comment.resolved&&e.comment.has_metadata()&&e.comment.comment_metadata.has_annotation_data()?this.redrawAnnotation(e.comment.comment_metadata.annotation):void 0);return i}},onAnnotationEventsCallback:function(e,t){switch(e){case"annotation-hidden":return this.hideAnnotationBubble();case"annotation-placed":return this.placeAnnotationBubble(t);case"annotation-start-drag":return this.hideAnnotationBubble();case"annotation-end-drag":return this.placeAnnotationBubble(t)}},addRevisionToCommentMetadata:function(e){return null==e&&(e={}),e.revision=this.props.fileViewerState.getFileRevision(),e},prepareCommentMetadataWithAnnotation:function(e){var t;return t={annotation:e.toMetadataDict()},this.addRevisionToCommentMetadata(t)},onAddCommentFromAnnotationBubble:function(e,t){return this.hideAnnotationBubble(),this.onAddComment(e,this.prepareCommentMetadataWithAnnotation(t)),setTimeout(function(e){return function(){return e.hideAnnotation()}}(this),1e3)},onAddComment:function(e,t){var n;return null!=(n=this.refs.commentListUI)?n.addComment(e,t):void 0},resetToBlankState:function(){return 0===e(".blank-state").length?(e(".comments-holder .comment-list-facepile:visible").hide(),e(".comments-holder .comment-activity:visible").hide(),e(".comments-holder .comment-field:visible").hide()):void 0},showFeedbackModal:function(t){var n;return t.preventDefault(),n='<div class="text-input comment-feedback-input"> <div class="text-input-wrapper"> <textarea id="comments-feedback-input" placeholder="Describe your experience, concerns, ideas, etc." ></textarea> </div> </div>',F.show({title_text:j("Send feedback about Comments"),body_html:n,cancel_text:j("Cancel"),confirm_text:j("Submit Feedback"),confirm_callback:function(t){return function(){var n;return n=e("#comments-feedback-input").val(),t.state.contextActivityStore.submit_product_feedback(t.getUser(),n,function(){return i.success(j("Thank you! Your feedback will help improve Dropbox."))},function(){return i.error(j("There was an error submitting your feedback."))})}}(this)})},getUser:function(){return this.props.userId?new c(q.get_user_by_id(this.props.userId)):q.work_user||q.personal_user?new c(q.work_user||q.personal_user):q.is_signed_in?void 0:new c},setLockedIcon:function(){return this.setState({icon:"s_comments_locked"})},setUnlockedIcon:function(){return this.setState({icon:"s_comments_unlocked"})},disable:function(){return this.setState({enabled:!1})},enable:function(){return this.setState({enabled:!0}),this.forceUpdate()},turnOffComments:function(){return this.setState({comments_on:!1,icon:"s_comments_locked"})},turnOnComments:function(e){return null!=e&&e.preventDefault(),this.setState({comments_on:!0})},turnOnFeedback:function(){return this.state.contextActivityStore.update_feedback_setting(this.state.activity,this.getUser(),!1,function(e){return function(t){return e.setState({activity:t})}}(this))},turnOffFeedback:function(){return this.state.contextActivityStore.update_feedback_setting(this.state.activity,this.getUser(),!0,function(e){return function(t){return e.setState({activity:t})}}(this)),this.turnOffComments()},onSubscribeUpdated:function(e){return this.setState({activity:e})},hide:function(e){var t;return e.preventDefault(),this.setState({visible:!1}),this.state.activity&&E.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_COMMENTS_HIDDEN,this.state.activity.activity_key,null,null,this.getUser().id,this.props.activityContext),"function"==typeof(t=this.props).hideToggledCallback?t.hideToggledCallback(!1):void 0},show:function(e){var t;return e.preventDefault(),this.setState({visible:!0}),this.state.activity&&E.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_COMMENTS_SHOWN,this.state.activity.activity_key,null,null,this.getUser().id,this.props.activityContext),"function"==typeof(t=this.props).hideToggledCallback?t.hideToggledCallback(!0):void 0},fitToHeight:function(e){return this.state.height!==e?this.setState({height:e}):void 0},_refreshWidth:function(){var t,n;return e(".video-js").length&&e(".video-js").css("width","100%"),t=this.state.enabled&&(this.state.comments_on||this.props.showDisabledCommentBar)?e(this.getDOMNode()).width():0,"function"==typeof(n=this.props).previewWidthCallback?n.previewWidthCallback(t):void 0},_shouldFetchActivity:function(){return this.props.activityContext&&this.props.activityContextData&&!this.state.is_fetching_activity},_fetchActivity:function(){var e,t,n;return t=function(e){return function(t){return e.isMounted()&&(t.feedback_off?e.turnOffComments():e.turnOnComments(),e.enable(),e.setState({activity:t,is_fetching_activity:!1}),e._prepareAnnotationBubble(),e.getUser().is_signed_in)?e._queueListen():void 0}}(this),e=function(e){return function(){return e.disable(),e.setState({is_fetching_activity:!1})}}(this),m.SessionStorage.set("reload-timestamp",(new Date).getTime()),n=d.getGandalfRule("dw-comments-annotation-marker"),this.state.contextActivityStore.fetch_activity(this.getUser(),t,e,n),this.setState({is_fetching_activity:!0})},_hasLoaded:function(){return null!=this.state.activity},_queueListen:function(){var e,t;return e=this.props.activityContext,t=this.props.activityContextData,this._queue=T.get_user_queue(this.getUser().id,"/file_activity/queue",{activity_context:e,activity_context_data:t}),this._queue_cb=function(e){return function(t){var n,o;if(e.isMounted())return o=new O(t[0].activity),n=-1,t[0].action_type&&(n=t[0].action_type),o.feedback_off?void e.turnOffComments():(e.turnOnComments(),e.setState({activity:o}),e.refs.commentListUI.onNewActivityFromEventBus(n))}}(this),this._queue.on("events",this._queue_cb),this._queue.start()},_shutdownQueue:function(){return this._queue&&this._queue.remove_listener(this._queue_cb),this._queue=null,this._queue_cb=null},render:function(){var e,n,o,i,r,s,a,c;return n=t.addons.classSet({"file-feedback":!0,hidden:!this.state.enabled}),this.state.enabled||"function"==typeof(c=this.props).previewWidthCallback&&c.previewWidthCallback(0),a=this.getUser(),i=a.is_signed_in&&d.getGandalfRule("comments-web-feedback"),r=this.props.activityContext&&this.props.activityContextData&&"CONTROL"!==this.props.photoLikesVariant,s=this.props.activityContext&&this.props.activityContextData&&"CONTROL"!==this.props.photoSocialShareVariant,e=this.state.height,r&&(e-=P),s&&(o=w.get_height_by_activity_context(this.props.activityContext),e-=o),i&&(e-=k),this.state.visible&&this.state.comments_on?B.div({id:this.props.feedbackId,className:n,tabIndex:"-1",style:{height:this.state.height}},r?b({contextActivityStore:this.state.contextActivityStore,activity:this.state.activity,height:P,user:a}):void 0,s?w.FileFeedbackSharingSection({activity_context:this.props.activityContext,activity_context_data:this.props.activityContextData,height:o,user:a}):void 0,this.props.activityContext&&this.props.activityContextData?B.div({className:"comments-and-feedback"},y({key:"comment_list_"+this.props.activityContext+"_"+this.props.activityContextData,ref:"commentListUI",contextActivityStore:this.state.contextActivityStore,activity:this.state.activity,onInputFocus:this.props.onInputFocus,onInputBlur:this.props.onInputBlur,height:e,user:a,hideCallback:this.hide,disableComments:this.disable,enable_comments:this.enable,turnOnFeedbackCallback:this.turnOnFeedback,turnOffFeedbackCallback:this.turnOffFeedback,onSubscribeUpdated:this.onSubscribeUpdated,enableFacepile:d.isGandalfInVariant("dw-comments-notify-facepile","FACEPILE"),enableNoNotifyHint:d.isGandalfInVariant("dw-comments-no-notify-hint","CONTROL"),fileViewerState:this.props.fileViewerState,shouldShowLoadingSpinner:this.props.shouldShowLoadingSpinner}),i?B.div({className:"comments-feedback-link",style:{height:k}},B.div({className:"comments-feedback-link-inner"},B.a({onMouseUp:this.showFeedbackModal},D({},"Send feedback about Comments")))):void 0):void 0):this.state.comments_on&&!this.state.visible?B.div({id:this.props.feedbackId,className:"hidden-comments",style:{height:this.state.height}},B.div({className:"show-button "+this.props.showButtonColor,onMouseDown:this.show},B.div({className:"show-button-sprite"},f({group:"web",name:"s_show_comments_grey"})))):this._hasLoaded()&&this.state.activity.can_edit_feedback?B.div({id:this.props.feedbackId,className:"hidden-comments",style:{height:this.state.height},onMouseOver:this.setUnlockedIcon,onMouseOut:this.setLockedIcon},B.div({className:"show-button "+this.props.showButtonColor,onMouseDown:this.turnOnComments},B.div({className:"show-button-sprite"},f({group:"web",name:this.state.icon})))):B.div({id:this.props.feedbackId,className:"hidden"})}}),M=t.createClass({displayName:"LightboxFeedbackUI",getInitialState:function(){return this.setCommentsVisibility(!0),{}},componentDidMount:function(){return e("#file-preview-modal").on(L.LIGHTBOX_SHOW_EVT,function(t){return function(n,o){var i;return null!=(i=t.refs.fileFeedback)&&i.resetToBlankState(),clearTimeout(t.feedbackLoadTimer),t.feedbackLoadTimer=setTimeout(function(){var n;return n=o.preview,e("#file-preview-modal").addClass("comments"),t.setState(null!=n.fq_path?{activityContext:C.BROWSE_LIGHTBOX,activityContextData:n.fq_path,key:""+n.ns_id+"_"+n.ns_path}:{activityContext:C.SHARED_LINK_LIGHTBOX,activityContextData:n.shmodel_link,key:""+n.shmodel_link}),t.autoResize()},250)}}(this)),e("#file-preview-modal").on(L.LIGHTBOX_HIDE_EVT,function(t){return function(){return t.setCommentsVisibility(!0),e("#file-preview-modal").removeClass("comments"),t.setState({activityContext:null,activityContextData:null})}}(this)),e(window).resize(function(e){return function(){return e.autoResize()}}(this))},render:function(){return B.div({},this.state.activityContext&&this.state.activityContextData?N({ref:"fileFeedback",feedbackId:"photo-comments",showButtonColor:"white",previewWidthCallback:this.setPreviewWidth,activityContext:this.state.activityContext,activityContextData:this.state.activityContextData,onInputFocus:function(){return function(){return key.setScope(x)}}(this),onInputBlur:function(){return function(){return key.setScope(L.KEY_SCOPE)}}(this),userId:this.props["user-id"],photoLikesVariant:this.props["photo-likes-variant"],photoSocialShareVariant:this.props["photo-social-share-variant"],key:this.state.key,visible:this._commentsVisible,hideToggledCallback:this.setCommentsVisibility}):void 0)},setCommentsVisibility:function(e){return this._commentsVisible=e},autoResize:function(){var t;return null!=(t=this.refs.fileFeedback)?t.fitToHeight(e("#file-preview-modal").height()):void 0},setPreviewWidth:function(t){var n;return n=e("#file-preview-modal.comments"),0!==n.length&&n.css("right")!==t?n.css("right",t):void 0}}),R=t.createClass({displayName:"FileViewerFeedbackUI",getInitialState:function(){return this.setCommentsVisibility(!0),{}},componentDidMount:function(){var t;return this.fileViewerState=new u(C.BROWSE_FILE_VIEWER),e("#file-viewer").on("db:filepreview:open",function(t){return function(n,o,i,r){return e("#file-viewer").addClass("comments"),clearTimeout(t.feedbackLoadTimer),t.feedbackLoadTimer=setTimeout(function(){return t._setFile(o,i,r)},10)}}(this)),e("#file-viewer").on("db:filepreview:prev db:filepreview:next",function(e){return function(t,n,o,i){var r;return null!=(r=e.refs.fileFeedback)&&r.resetToBlankState(),clearTimeout(e.feedbackLoadTimer),e.feedbackLoadTimer=setTimeout(function(){return e._setFile(n,o,i,!1)},250)}}(this)),e("#file-viewer").on("db:filepreview:close",function(e){return function(){return e.setState({activityContext:null,activityContextData:null})}}(this)),t=function(t){return function(){return e("#file-viewer").addClass("comments"),t.autoResize()}}(this),e("#file-viewer").on("preview_failed",t),e(window).resize(function(e){return function(){return e.autoResize()}}(this))},_setFile:function(e,t,n,o){var i;return null==o&&(o=!0),i={key:""+e.ns_id+"_"+e.sjid,viewingUserId:n,shouldShowLoadingSpinner:o},t?(i.activityContext=C.SHARED_LINK_VIEW,i.activityContextData=e.href):(i.activityContext=C.BROWSE_FILE_VIEWER,i.activityContextData=e.fq_path),this.setState(i,function(e){return function(){return e.autoResize()}}(this)),this.fileViewerState.setFile(e)},render:function(){return B.div({},N({ref:"fileFeedback",activityContext:this.state.activityContext,activityContextData:this.state.activityContextData,feedbackId:"file-comments",previewWidthCallback:this.setPreviewWidth,showButtonColor:"white",userId:this.state.viewingUserId,key:this.state.key,visible:this._commentsVisible,hideToggledCallback:this.setCommentsVisibility,previewSelector:"#file-viewer-container .preview",fileViewerState:this.fileViewerState,shouldShowLoadingSpinner:this.state.shouldShowLoadingSpinner}))},setCommentsVisibility:function(e){return this._commentsVisible=e},autoResize:function(){var t,n,o;return t=e("#file-viewer").hasClass("no-preview")?e(window).height():e("#file-viewer-container").height()-e("#file-viewer-container .title-bar").height(),this.setPreviewWidth(e(null!=(n=this.refs.fileFeedback)?n.getDOMNode():void 0).width()),null!=(o=this.refs.fileFeedback)?o.fitToHeight(t):void 0},setPreviewWidth:function(t){var n,o,i,r,s,a;return n=e("#file-viewer"),o=n.find("#file-viewer-container"),r=o.find(".preview"),0!==r.length?(n.hasClass("no-preview")?(a=o.width()-t,s=t?(e(window).width()-t)/2+"px":""+e(window).width()/2+"px"):"True"===n.attr("data-docpreview-ui-rams-enabled")&&(n.hasClass("doc-preview")||n.hasClass("html-preview")||n.hasClass("htmlified-preview")||n.hasClass("adobecs-preview")||n.hasClass("linkfile-preview")||n.hasClass("photo-preview")||n.hasClass("video-preview"))?(a=I.is_rams_fullscreen_active()?window.innerWidth:o.width()-t,s="0"):(a=o.width()-t,s="50%"),r.width()!==a&&(r.width(a),i=o.find(".loading"),null!=i&&i.width(a)),r.css("left")!==s?o.css("left",s):void 0):void 0}}),U=t.createClass({displayName:"SharedLinkFeedbackUI",getInitialState:function(){return{}},componentDidMount:function(){return this.fileViewerState=new u(C.SHARED_LINK_VIEW),"photo"===this.props["preview-type"]&&(e("#preview-img").on("photo-zoom",this.autoResize),e("#full-img").on("photo-unzoom",this.autoResize)),e(window).resize(this.autoResize),this.autoResize()},render:function(){return B.div({className:"shmodel-comments"},N({showButtonColor:"white",previewWidthCallback:this.setPreviewWidth,activityContext:C.SHARED_LINK_VIEW,activityContextData:this.props["shared-link-url"],photoLikesVariant:this.props["photo-likes-variant"],photoSocialShareVariant:this.props["photo-social-share-variant"],ref:"fileFeedback",feedbackId:"file-comments",key:this.props["shared-link-url"],visible:!0,previewSelector:this.previewSelector(),fileViewerState:this.fileViewerState}))},autoResize:function(){var t,n,o,i,r,s,a;return i=parseInt(e("#file-comments").css("top")),r=e(window).height(),o=r-i,null!=(s=this.refs.fileFeedback)&&s.fitToHeight(o),t=e(null!=(a=this.refs.fileFeedback)?a.getDOMNode():void 0),n=t.visible()?t.outerWidth():0,this.setPreviewWidth(n)},setPreviewWidth:function(t){var n,o,i;if(null!=this.previewSelector()&&(n=e(this.previewSelector()),0!==n.length))return n.data("rams-fullscreen")?o=e(window).width():(i=n.outerWidth()-n.width(),o=e(window).width()-t-i),n.width()!==o?n.width(o):void 0},previewSelector:function(){return{doc:"#shmodel-content-area .preview-box #pdf-embed-container",photo:"#shmodel-content-area .preview-box",video:"#shmodel-content-area .preview-box",text:"#shmodel-content-area #htmlified-wrapper",html:"#shmodel-content-area",download:"#shmodel-content-area",excel:"#shmodel-content-area #html-container",adobecs:"#shmodel-content-area .preview-box #pdf-embed-container"}[this.props["preview-type"]]}}),{FileViewerFeedbackUI:R,SharedLinkFeedbackUI:U,LightboxFeedbackUI:M}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/react/file_comments/shared_link_signup_modals",["dropbox","jquery","modules/clean/ajax","modules/core/browser","modules/core/i18n","modules/core/notify","modules/dirty/register_form","modules/clean/components/login_form","modules/clean/dbmodal","modules/clean/react/file_comments/logger"],function(e,t,n,o,i,r,s,a,c,u){var l,_,d,p;return d=e.SharingModel,p=i._,_=c.DBModal,l=function(){function e(){this._toggle_form=__bind(this._toggle_form,this),this._prepare_form=__bind(this._prepare_form,this),this._reload=__bind(this._reload,this),this.before_modal=__bind(this.before_modal,this),this.show_sign_in_modal=__bind(this.show_sign_in_modal,this),this.show_sign_up_modal=__bind(this.show_sign_up_modal,this),this.hide_modal=__bind(this.hide_modal,this),this.init_modals=__bind(this.init_modals,this),this.show_register=!1,this.init_modals()}return e.POST_COMMENT_VARIANT="post_comment_variant",e.LIKE_COMMENT_VARIANT="like_comment_variant",e.SUBSCRIBE_VARIANT="subscribe_variant",e.prototype.init_modals=function(){return this.default_signup_modal=new _({element_id:"shared-link-default-comments-signup-modal"}),this.default_signup_modal.before_show=this.before_modal},e.prototype.hide_modal=function(){return this.default_signup_modal.hide()},e.prototype.show_sign_up_modal=function(e){return this.show_register=!0,this.variant=e,this.default_signup_modal.show()},e.prototype.show_sign_in_modal=function(e){return this.show_register=!1,this.variant=e,this.default_signup_modal.show()},e.prototype.set_activity_key=function(e){return this.activity_key=e},e.prototype.before_modal=function(e){var t,n;return this._prepare_form(e),e.find(".toggle-form-link").click(function(t){return function(){return t._toggle_form(e)}}(this)),n=e.find(".register-form"),n.length&&n.on(s.REGISTER_SUCCESS,function(e){return function(t,n){return e.user=n,r.success(p("Successfully signed up for Dropbox")),u.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this)),t=e.find(".login-form"),t.length?t.on(a.LOGIN_SUCCESS,function(e){return function(t,n){return e.user=n,r.success(p("Successfully signed in to Dropbox")),u.log_event(Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_SUCCESS,e.activity_key,null,null,e.user.id),e._reload()}}(this)):void 0},e.prototype._reload=function(){return o.reload()},e.prototype._prepare_form=function(t){switch(t.find(".form-component").hide(),t.find(".text-variant").hide(),this.show_register?t.find(".register-form-component").show():t.find(".login-form-component").show(),this.variant){case e.POST_COMMENT_VARIANT:return t.find(".text-variant.post-comment-variant").show();case e.LIKE_COMMENT_VARIANT:return t.find(".text-variant.like-comment-variant").show();case e.SUBSCRIBE_VARIANT:return t.find(".text-variant.subscribe-variant").show();default:return t.find(".text-variant.default-variant").show()}},e.prototype._toggle_form=function(e){var t,n,o,i,r,s;return r=e.find(".register-form-component"),i=e.find(".login-form-component"),r.is(":visible")?(n=Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_IN_MODAL,r.fadeOut({complete:function(){return i.show()}})):(n=Constants.FILE_ACTIVITY_LOG_EVENT_TYPE.CLIENT_SIGN_UP_MODAL,i.fadeOut({complete:function(){return r.show()}})),u.log_event(n=n,o=this.activity_key,t=null,s=Constants.FILE_ACTIVITY_LOG_CLIENT_ORIGIN_TYPE.MODAL_TOGGLE_BUTTON)},e}()});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/openwith/open_with_tooltip",["dropbox","external/react","modules/core/i18n","modules/clean/ajax","modules/clean/open_with","modules/clean/react/button","modules/clean/react/sprite_div","modules/clean/react/sprite","jquery"],function(e,t,n,o,i,r,s,a,c){var u,l,_,d,p,h,f;return u=e.FileViewer,l=e.FreshDropdown,h=n._,d=r.button,f={HIDDEN:0,VISIBLE:1},p=t.DOM,_=t.createClass({propTypes:{availabletooltips:t.PropTypes.object,buttonindex:t.PropTypes.number.isRequired},getInitialState:function(){return{visibility_state:f.HIDDEN,extension:null,tooltip_vendor:null,tooltip_application:null,target_button:null}},_setStateHidden:function(){return this.setState(this.getInitialState())},componentDidMount:function(){return u.globalOpenWithWebButtonStateModel.on("change",function(e){return function(){return e._handleStateChange(u.globalOpenWithWebButtonStateModel.get("user_id"),u.globalOpenWithWebButtonStateModel.get("state"),u.globalOpenWithWebButtonStateModel.get("file_extension"),u.globalOpenWithWebButtonStateModel.get("target_button"))}}(this))},componentDidUpdate:function(){var e;return this.state.visibility_state===f.VISIBLE&&(e=this.state.target_button[this.props.buttonindex],c(e).is(":visible"))?(l.show(c(this.refs.tooltip.getDOMNode()),e,null,!0),c(e).removeClass("pressed")):void 0},render:function(){var e,t;return this.state.visibility_state===f.HIDDEN?p.div({id:"open-with-onboarding-tooltip",className:"hidden"}):(t=this.props.availabletooltips[this.state.tooltip_vendor][this.state.tooltip_application].icon,e=this.props.availabletooltips[this.state.tooltip_vendor][this.state.tooltip_application].blurb,p.div({id:"open-with-onboarding-tooltip",className:"chat-bubble freshdropdown-menu black open-with-onboarding-tooltip",ref:"tooltip"},p.ul({},p.li({},p.div({className:"content-wrapper"},a({group:"web",name:t}),p.div({className:"text-wrapper"},p.span({className:"tooltip-new"},h("New!"))," ",e),d({className:"dismiss-button",importance:"tertiary"},h("OK")))),p.div({className:"chat-bubble-arrow black"}))))},_handleStateChange:function(e,t,n,o){var i,r,s,a,c,u,l,_,d,p;if("hidden"===t)return this._setStateHidden();if(this.state.visibility_state===f.VISIBLE&&n===this.state.extension)return void this.setState({visibility_state:f.VISIBLE,extension:this.state.extension,target_button:o});c=!1,l=null,u=null,p=this.props.availabletooltips;for(_ in p){d=p[_];for(s in d)if(i=d[s],r=i.extensions,__indexOf.call(r,n)>=0){c=!0,l=_,u=s;break}}return c?(this.setState({visibility_state:f.VISIBLE,extension:n,tooltip_vendor:l,tooltip_application:u,target_button:o}),a=this.props.availabletooltips,a[l][u].extensions=[],this.setProps({availabletooltips:a}),this._logImpression(n,e)):void this._setStateHidden()},_logImpression:function(e,t){return o.AuthenticatedRequest({url:"/ow/msft/log_tooltip_impression",data:{extension:e},subject_user:t})}}),{OpenWithTooltip:_}});var __indexOf=[].indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(t in this&&this[t]===e)return t;return-1};define("modules/dirty/react/previews/preview_toolbar",["dropbox","external/react","jquery","modules/clean/analytics","modules/clean/filepath","modules/clean/frame_messenger","modules/clean/keycode","modules/clean/react/sprite","modules/core/dom","modules/core/exception","modules/core/i18n"],function(e,t,n,o,i,r,s,a,c,u,l){var _,d,p,h,f,m,g,v,y,b;return _=e.FilePreview,p=e.FileViewer,d=e.FileViewRamsCommon,g=e.SharingModel,h=o.PreviewActivityLogger,v=u.assert,y=t.DOM,b=l._,m={DEFAULT:"default",SPP:"spp",SPREADSHEET:"spreadsheet",HTML:"html"},f=t.createClass({propTypes:{"viewer-type":t.PropTypes.string.isRequired},printNativeForViewerType:{FILE_VIEWER:n.proxy(p.nativePdfPrint,p),FILE_PREVIEW:n.proxy(_.nativePdfPrint,_)},_TOOLBAR_ENTRY_CLASSES:{PAGE_INDICATOR:"page-indicator",ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",FULLSCREEN:"fullscreen",
PRINT:"print"},_ELEMENT_CONFIGURATIONS:{"default":["page-indicator","zoom-in","zoom-out","page-up","page-down","fullscreen","print"],spp:["page-indicator","page-up","page-down","fullscreen","print"],spreadsheet:["zoom-in","zoom-out","fullscreen","print"],html:["fullscreen","print"]},_PARENT_TO_IFRAME_ACTIONS:{ZOOM_IN:"zoom-in",ZOOM_OUT:"zoom-out",PAGE_UP:"page-up",PAGE_DOWN:"page-down",ENTER_FULLSCREEN:"enter-fullscreen",EXIT_VIEWER_FULLSCREEN:"exit-viewer-fullscreen",PRINT:"print",CLEAR_MOUSE_TRACKING:"clear-mouse-tracking",SCROLL_DOWN:"scroll-down",SCROLL_UP:"scroll-up",SCROLL_LEFT:"scroll-left",SCROLL_RIGHT:"scroll-right",SCREEN_DOWN:"screen-down",SCREEN_UP:"screen-up"},_VIEWER_TYPES:["FILE_PREVIEW","FILE_VIEWER"],_HANDLED_KEYDOWN_KEYCODES:[s.ESC,s.SPACE,s.PAGE_UP,s.PAGE_DOWN,s.LEFT,s.UP,s.RIGHT,s.DOWN,s.EQUALS,70,80,s.PLUS_EQUALS_FF,s.MINUS_FF,s.PLUS_EQUALS_FF_GERMAN,s.MINUS_FF_MAC,s.PLUS_CHROME,s.MINUS_CHROME],_FADE_TIME_MSEC:400,_IDLE_TIME_MSEC:1500,_trustedIframeDomain:null,_fadeTimeout:null,_fullscreeningTimeout:null,_idleTimeout:null,_frameMessenger:null,_previewOpen:!1,getInitialState:function(){var e,t;return t=this.props["viewer-type"].toUpperCase(),v(__indexOf.call(this._VIEWER_TYPES,t)>=0,"Preview Toolbar received an unknown viewer-type parameter"),e={pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],viewerType:t,docType:m.DEFAULT}},_reset:function(){return null!=this._fadeTimeout&&(clearTimeout(this._fadeTimeout),this._fadeTimeout=null),null!=this._fullscreeningTimeout&&(clearTimeout(this._fullscreeningTimeout),this._fullscreeningTimeout=null),this.setState({pagesCount:0,currentPage:0,visible:!1,fadingOut:!1,fullscreening:!1,disabledClasses:[],docType:m.DEFAULT})},_setFullscreen:function(e,t){var o,i;switch(null==t&&(t=!0),this.state.viewerType){case"FILE_VIEWER":e?p.enter_rams_fullscreen():p.exit_rams_fullscreen();break;case"FILE_PREVIEW":e?_.enter_rams_fullscreen():_.exit_rams_fullscreen()}return null!=this._fullscreeningTimeout&&clearTimeout(this._fullscreeningTimeout),e?this.fadeOut():(this.fadeIn(),this._startIdleTimeout()),this.setState({fullscreening:!0}),i=function(e){return function(){return e._fullscreeningTimeout=null,e.setState({fullscreening:!1})}}(this),this._fullscreeningTimeout=setTimeout(n.proxy(i,this),d.RAMS_FULLSCREEN_TRANSITION_TIME_MSEC),this._setBrowserFullscreen(e),t?(o=e?this._PARENT_TO_IFRAME_ACTIONS.ENTER_FULLSCREEN:this._PARENT_TO_IFRAME_ACTIONS.EXIT_VIEWER_FULLSCREEN,this._frameMessenger.postMessageToChildren(o)):void 0},_isViewerFullscreen:function(){switch(this.state.viewerType){case"FILE_VIEWER":return p.is_rams_fullscreen_active();case"FILE_PREVIEW":return _.is_rams_fullscreen_active();default:return console.warn("Unexpected viewerType ("+this.state.viewerType+")"),!1}},_isBrowserFullscreen:function(){return null!=document.fullScreen?document.fullScreen:null!=document.webkitIsFullScreen?document.webkitIsFullScreen:null!=document.mozFullScreen?document.mozFullScreen:null!=document.msFullscreenElement||null!=document.fullscreenElement},_handleClick:function(e){var t,n,o,i,r,s,a;for(i={input_method:"click",file_ext:this._getOriginalFileExtension()},t=e.currentTarget,a=this.state.disabledClasses,r=0,s=a.length;s>r;r++)if(n=a[r],t.hasClassName(n))return;return t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN)?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_IN),h.log("zoom-in",i)):t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT)?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_OUT),h.log("zoom-out",i)):t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP)?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PAGE_UP),h.log("page-up",i)):t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN)?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PAGE_DOWN),h.log("page-down",i)):t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN)?(o=!this._isViewerFullscreen(),this._setFullscreen(o,!0),h.log("enter-fullscreen",i)):t.hasClassName(this._TOOLBAR_ENTRY_CLASSES.PRINT)&&(this._printDocument(),h.log("print",i)),this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING)},_getIframeQuery:function(){switch(this.state.viewerType){case"FILE_VIEWER":return".preview-content-container > iframe";case"FILE_PREVIEW":return".preview-box iframe";default:return null}},_handleMessageFromChild:function(e){var t,n,o,i,r;switch(o={input_method:"child-message",file_ext:this._getOriginalFileExtension()},e.action){case"page-change":if(r=this._isToolbarReadyToShow(),t=this._sanitizePageNumber(e.parameters.current_page),i=this._sanitizePageNumber(e.parameters.pages_count),0>=t||0>=i)return;if(null!=e.parameters.doc_type&&this.setState({docType:e.parameters.doc_type}),n=[],1>=t&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP),t>=i&&n.push(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN),this.setState({currentPage:t,pagesCount:i,disabledClasses:n}),!r&&this._isToolbarReadyToShow())return this.fadeIn(),this._startIdleTimeout();break;case"idle-mouse":return this.fadeOut(),h.log("idle-mouse",o);case"active-mouse":return this.fadeIn(),h.log("active-mouse",o);case"exit-parent-fullscreen":return this._setFullscreen(!1),h.log("exit-fullscreen",o);case"keydown":if(null!=e.parameters)return this.onKeydown(e.parameters);break;case"get-keydown-keys-handled-by-parent":return this._frameMessenger.postMessageToChildren("keydown-keys-handled-by-parent",{keycodes:this._HANDLED_KEYDOWN_KEYCODES})}},onPreviewOpen:function(){return this._previewOpen?!0:(n(document).on("keydown",this.onKeydown),n(document).on("fullscreenchange",this.onBrowserFullscreenChange),n(document).on("webkitfullscreenchange",this.onBrowserFullscreenChange),n(document).on("msfullscreenchange",this.onBrowserFullscreenChange),n(document).on("mozfullscreenchange",this.onBrowserFullscreenChange),this._previewOpen=!0,!0)},onPreviewClose:function(){return this._previewOpen?(n(document).off("keydown",this.onKeydown),n(document).off("fullscreenchange",this.onBrowserFullscreenChange),n(document).off("webkitfullscreenchange",this.onBrowserFullscreenChange),n(document).off("msfullscreenchange",this.onBrowserFullscreenChange),n(document).off("mozfullscreenchange",this.onBrowserFullscreenChange),this._reset(),this._frameMessenger.resetOriginsForPosting(),this._previewOpen=!1,!0):!0},componentDidMount:function(){var e;return window.addEventListener("message",this.handleViewerMessage),"FILE_VIEWER"===this.state.viewerType?(e=n("#file-viewer"),1===e.length&&(e.on("db:filepreview:open",this.onPreviewOpen),e.on("db:filepreview:close",this.onPreviewClose))):"FILE_PREVIEW"===this.state.viewerType&&this.onPreviewOpen(),this._frameMessenger=new r,this._frameMessenger.configureChildMessaging(this._getIframeQuery(),n.proxy(this._handleMessageFromChild,this),["page-change","idle-mouse","active-mouse","exit-parent-fullscreen","keydown","child-focus","get-keydown-keys-handled-by-parent"]),this._frameMessenger.startListening()},componentWillUnmount:function(){var e;if(window.removeEventListener("message",this.handleViewerMessage),"FILE_VIEWER"===this.state.viewerType){if(e=n("#file-viewer"),1===e.length)return e.off("db:filepreview:open",this.onPreviewOpen),e.off("db:filepreview:close",this.onPreviewClose)}else if("FILE_PREVIEW"===this.state.viewerType)return this.onPreviewClose()},renderPageIndicatorText:function(){var e;return this.state.currentPage<1||this.state.pagesCount<1?"":(e=b(this.state.docType===m.SPP?"Slide %(current_page)s of %(pages_count)s":"Page %(current_page)s of %(pages_count)s"),e.format({current_page:this.state.currentPage,pages_count:this.state.pagesCount}))},_renderToolbarButton:function(e,t,n,o){var i,r;return __indexOf.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],e)<0?y.span({style:{display:"none"}}):(i=e+" toolbar-button-entry",r=__indexOf.call(this.state.disabledClasses,e)>=0,y.div({className:i,onMouseUp:this._handleClick},y.div({className:"toolbar-tooltip"},y.div({className:"toolbar-tooltip-container"},y.div({className:"toolbar-tooltip-pointer-border"})),y.div({className:"toolbar-tooltip-container"},y.div({className:"toolbar-tooltip-body"},o)),y.div({className:"toolbar-tooltip-container"},y.div({className:"toolbar-tooltip-pointer"}))),a({group:t,name:n,className:r?"disabled":""})))},_renderPageIndicator:function(){var e;return e=this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR,__indexOf.call(this._ELEMENT_CONFIGURATIONS[this.state.docType],e)>=0?y.div({className:this._TOOLBAR_ENTRY_CLASSES.PAGE_INDICATOR},this.renderPageIndicatorText()):void 0},render:function(){var e,t,n,o,i,r;return e="preview-toolbar-overlay-container ",this.state.visible||(e+="hide "),this.state.fadingOut&&(e+="fadeout "),t={className:e},r=b(this.state.docType===m.SPP?"Previous slide":"Page up"),o=b(this.state.docType===m.SPP?"Next slide":"Page down"),i=this.state.docType===m.SPP?"left":"up",n=this.state.docType===m.SPP?"right":"down",y.div(t,y.div({className:"preview-toolbar-overlay",onMouseEnter:this.onMouseEnterToolbar},y.div({className:"preview-toolbar-content"},this._renderPageIndicator(),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_OUT,"web","zoomout",b("Zoom out")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.ZOOM_IN,"web","zoom",b("Zoom in")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_UP,"web",i,r),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PAGE_DOWN,"web",n,o),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.FULLSCREEN,"web","fullscreen",b("Fullscreen")),this._renderToolbarButton(this._TOOLBAR_ENTRY_CLASSES.PRINT,"web","print",b("Print")))))},_sanitizePageNumber:function(e){var t;return null==e?0:(t=parseInt(e),isNaN(t)?0:t)},_getOriginFromUrl:function(e){var t;return t=document.createElement("a"),t.href=e,"https://"+t.hostname},fadeOut:function(){return null==this._fadeTimeout||this.state.fadingOut||(clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this.setState({fadingOut:!0,tooltipClass:null}),this._fadeTimeout=setTimeout(function(e){return function(){return e._fadeTimeout=null,e.setState({visible:!1,fadingOut:!1})}}(this),this._FADE_TIME_MSEC)},fadeIn:function(){return this._clearIdleTimeout(),this._isViewerFullscreen()||n("html").hasClass("no-flexbox")?void 0:this._isToolbarReadyToShow()?(null!=this._fadeTimeout&&(clearTimeout(this._fadeTimeout),this._fadeTimeout=null),this.setState({visible:!0,fadingOut:!1})):void 0},onMouseEnterToolbar:function(){return this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.CLEAR_MOUSE_TRACKING),this._clearIdleTimeout()},onKeydown:function(e){var t,o,i,r;return o=!1,!this._frameMessenger.childIsValidated()||"dbmodal"===key.getScope()||c.focus_in_input()||null!=e.target&&(t=n("#file-comments"),1!==t.length&&(t=n("#photo-comments")),1===t.length&&(e.target===t[0]||n.contains(t[0],e.target)))?void 0:(r={input_method:"keydown",file_ext:this._getOriginalFileExtension(),extra:JSON.stringify({keycode:e.keyCode})},i=e.keyCode,i===s.EQUALS||i===s.PLUS_EQUALS_FF||i===s.PLUS_CHROME||i===s.PLUS_EQUALS_FF_GERMAN?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_IN),h.log("zoom-in",r),o=!0):i===s.MINUS_FF_MAC||i===s.MINUS_FF||i===s.MINUS_CHROME?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.ZOOM_OUT),h.log("zoom-out",r),o=!0):i===s.LEFT?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_LEFT),h.log("scroll-left",r),o=!0):i===s.RIGHT?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_RIGHT),h.log("scroll-right",r),o=!0):i===s.PAGE_UP?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_UP),h.log("screen-up",r),o=!0):i===s.SPACE||i===s.PAGE_DOWN?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCREEN_DOWN),h.log("screen-down",r),o=!0):i===s.UP?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_UP),h.log("scroll-up",r),o=!0):i===s.DOWN?(this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.SCROLL_DOWN),h.log("scroll-down",r),o=!0):70===i?(this._isViewerFullscreen()?(this._setFullscreen(!1),h.log("enter-fullscreen",r)):(this._setFullscreen(!0),h.log("exit-fullscreen",r)),o=!0):80===i?(this._printDocument(),h.log("print",r),o=!0):i===s.ESC&&(this._isViewerFullscreen()?(this._setFullscreen(!1),h.log("exit-fullscreen",r),o=!0):"FILE_VIEWER"===this.state.viewerType&&(p.hide(),h.log("exit-preview",r),o=!0)),o&&null!=e.preventDefault&&e.preventDefault(),!o)},onIdleTimeout:function(){return this._clearIdleTimeout(),this.fadeOut()},_startIdleTimeout:function(){return this._clearIdleTimeout(),this._idleTimeout=setTimeout(n.proxy(this.onIdleTimeout,this),this._IDLE_TIME_MSEC)},_clearIdleTimeout:function(){return null!=this._idleTimeout?(clearTimeout(this._idleTimeout),this._idleTimeout=null):void 0},_isToolbarReadyToShow:function(){return this.state.currentPage>0&&this.state.pagesCount>0},_getOriginalFileExtension:function(){switch(this.state.viewerType){case"FILE_PREVIEW":return i.file_extension_for_logging(g.filename);case"FILE_VIEWER":return i.file_extension_for_logging(p.file.filename);default:return console.warn("Unexpected viewer type in preview toolbar")}},_setBrowserFullscreen:function(e){var t;if(t=n("body")[0],e){if(null!=t.requestFullscreen)return t.requestFullscreen();if(null!=t.msRequestFullscreen)return t.msRequestFullscreen();if(null!=t.mozRequestFullScreen)return t.mozRequestFullScreen();if(null!=t.webkitRequestFullscreen)return t.webkitRequestFullscreen()}else{if(document.exitFullscreen)return document.exitFullscreen();if(document.msExitFullscreen)return document.msExitFullscreen();if(document.mozCancelFullScreen)return document.mozCancelFullScreen();if(document.webkitExitFullscreen)return document.webkitExitFullscreen()}},onBrowserFullscreenChange:function(){return this._isViewerFullscreen&&!this._isBrowserFullscreen()?this._setFullscreen(!1):void 0},_printDocument:function(){var e;return e=this.printNativeForViewerType[this.state.viewerType](),e?void 0:this._frameMessenger.postMessageToChildren(this._PARENT_TO_IFRAME_ACTIONS.PRINT)}}),{PreviewToolbar:f,PreviewToolbarDocType:m}});var __bind=function(e,t){return function(){return e.apply(t,arguments)}};define("modules/dirty/register_form",["jquery","external/security/cyfd","external/underscore","modules/clean/ajax","modules/clean/captcha","modules/clean/components/ajax_form","modules/clean/em_string","modules/clean/mailcheck","modules/clean/profile_services/profile_services_constants","modules/core/browser","modules/core/i18n","modules/core/notify","modules/core/uri"],function(e,t,n,o,i,r,s,a,c,u,l,_,d){var p,h;return h=l._,p=function(){function l(t,n,l,p,f){var m,g,v;this.$register_form_container=t,this.can_redirect=l,this.show_form=p,this.client_side_validation=f,this._animate_form=__bind(this._animate_form,this),this._on_register_success=__bind(this._on_register_success,this),this._cyberfend_submit=__bind(this._cyberfend_submit,this),this.$register_form=this.$register_form_container.find(".register-form"),this.register_controller=new r(this.$register_form,this._cyberfend_submit,{client_side_validation:this.client_side_validation}),this.cont=this.$register_form.find("input[name='cont']").val(),this.$register_form.find(".login-button, .auth-google").prop("disabled",!1),this.$captcha_component=new i(this.$register_form,"#react-signup-recaptcha-challenge-div","#react-login-recaptcha-challenge-div","/ajax_needs_signup_captcha","email",n),m=this.$register_form.find("label[for='tos_agree']"),g=parseInt(m.css("font-size")),v=200,new s(m.text()).length*g>v&&this.$register_form.find(".checkbox").removeClass("checkbox-inline"),this.$register_form.on(r.SUCCESS_EVENT,this._on_register_success),this.$register_form.on(r.ERROR_EVENT,this.$captcha_component.captcha_display_handler),this.show_form?(this.$register_form_container.filter(":input").filter(":visible").first().focus(),this.$register_form.is(":visible")&&this.$captcha_component.captcha_display_handler()):this.$register_form.find(".login-button").on("click",function(e){return function(t){return!e.$register_form_container.hasClass("form_shown")&&(t.preventDefault(),e._animate_form(),e.$register_form.find("input[name=third_party_auth_experiment]").val())?o.AuthenticatedRequest({url:"/web_signup_log",data:{event_name:"click_signup",signup_tag:"third_party_auth"}}):void 0}}(this)),this.$register_form.find(".auth-google").click(function(){return function(){var t,n;return n={service:c.GOOGLE},t=open(String(d({path:"/profile_services/auth_create_redirect",query:n})),"Google","width=600,height=600,resizable=1"),e(document).one("db:profile_service:auth_complete",function(o){return o.popup_window===t?(o.success?(n={fname:o.profile.given_name,lname:o.profile.family_name,email:o.profile.email,picture_url:o.profile.picture_url,email_sig:o.email_sig,refresh_token:o.refresh_token},u.redirect(d({path:"/third_party_signup",query:n}))):"user_exists"===o.err_msg&&(_.error(h("This email address is already taken. Please sign in.")),e("#sign-in").click(),setTimeout(function(){return e("#sign-in-form input[name=login_email]").val(o.profile.email),e("#sign-in-form input[name=login_password]").focus()},0)),t.close()):void 0})}}(this)),"small"===n?(this.$register_form.find(".bubble-dropdown-container .bubble-dropdown").css({visibility:"hidden"}),this.$register_form.find(".password-input-meter").css({cursor:"default"})):new a(e(".input-email"),e(".email-suggestion"))}return l.REGISTER_SUCCESS="db:register:success",l.prototype._cyberfend_submit=function(){return null!=t&&"function"==typeof t.cfsubmit?t.cfsubmit():void 0},l.prototype._on_register_success=function(e,t){if(this.$register_form.trigger(l.REGISTER_SUCCESS,t),this.can_redirect){if(this.cont)return u.redirect(this.cont);if(t.redirect_url)return u.redirect(t.redirect_url)}},l.prototype._animate_form=function(){return this.$register_form_container.hasClass("form_shown")?void 0:e.when(this.$register_form_container.animate({height:this.$register_form.height()},{easing:"easeInOutCubic",duration:500})).done(function(e){return function(){return e.$register_form_container.addClass("form_shown"),e.$register_form_container.filter(":input").filter(":visible").first().focus(),e.$captcha_component.captcha_display_handler()}}(this))},l.prototype.fill=function(e){return n.each(e,function(e){return function(t,n){return e.$register_form.find("[name="+n+"]").val(t)}}(this))},l}(),__CIRCULAR_DEPENDENCY__.RegisterForm=p,p}),define("modules/dirty/sharing/sf_access_type",["dropbox","jquery","modules/core/dom","modules/core/i18n","modules/core/notify","modules/clean/analytics","modules/clean/components/bubble_picker","modules/clean/dbmodal","modules/clean/dbmodal_loading","modules/clean/viewer","modules/dirty/groups/api"],function(e,t,n,o,i,r,s,a,c,u,l){var _,d,p,h,f,m,g;return p=e.MakeOwnerModal,m=e.SharingApi,g=o._,f=r.SharedFolderActivityLogger,_=a.DBModal,d=a.DBModalStack,h=function(){function e(e,t){this.$access_type_el=e,this.ajax_data=t,this.bubble_picker=n.controller(this.$access_type_el),this.$access_type_el.on(s.CHANGED,function(e){return function(t,n){var o,i,r,s,a,c;return r=n.old_val,i=n.clicked_val,Number(r)===Number(i)?!1:(e.ajax_data&&(c=u.get_viewer().get_user_by_id(e.ajax_data.user_id),s=e.ajax_data.params,o=e.ajax_data.access_types,a=e.$access_type_el.closest(".bs-row").find(".sf-display-name").text(),"owner"===o[i]?(e.show_make_owner_modal(c,s.member_uid,s.ns_id,a,i),e.bubble_picker.set_value(r)):e.update_access_type(c,s,a,i)),!1)}}(this))}return e.prototype.show_make_owner_modal=function(e,t,n,o,i){return d.push(new p(e,{element_id:"make-owner-confirm-modal",member_uid:t,member_name:o,ns_id:n,access_type:i}))},e.prototype.update_access_type=function(e,t,n,o){var r,s,a;return r={ns_id:t.ns_id,access_type:o},a=function(o){return function(s){var a,u,l;if(l=JSON.parse(s.responseText),r.member_id=t.member_uid,"OK"===l.status){switch(r.succes=!0,l.access_type){case"viewer":u=g("%(name)s can only view now.").format({name:n});break;case"editor":u=g("%(name)s can edit now.").format({name:n});break;case"owner":u=g("%(name)s is the owner now.").format({name:n})}u&&i.success(u)}else"ERROR"===l.status&&(r.succes=!1,l.msg&&(r.message=l.msg,i.error(l.msg)),l.reload&&(a=_.get_containing_modal(o.$access_type_el),a&&a instanceof c&&a.fetch()));return f.log("web","invite_modal_change_callback",e,r)}}(this),s=new m(e),t.member_uid?(s.update_member_access_type(t.ns_id,t.member_uid,o,a),r.member_uid=t.member_uid,f.log("web","invite_modal_change_collaborator",e,r)):t.invite_id?(s.update_invite_access_type(t.invite_id,o,a),r.invite_id=t.invite_id,f.log("web","invite_modal_change_invite",e,r)):t?(l.change_group_access_type({ns_id:t.ns_id,group_id:t.group_gid,access_type:o},a),r.group_id=t.group_gid,f.log("web","invite_modal_change_group",e,r)):void 0},e}()}),define("modules/dirty/sharing/sharing_growth_email_experiments",["dropbox","modules/clean/analytics"],function(e,t){var n,o,i;return i=e.Upload,n=t.SharedFolderActivityLogger,o=function(){function e(){}return e.listen_for_first_upload=function(e,t){var o;return o=function(){return function(){return n.log("web","file_upload",e,t),document.stopObserving(i.QUEUE_EVT,o),document.stopObserving(i.CHOOSE_FILE_BASIC,o)}}(this),document.observe(i.QUEUE_EVT,o),document.observe(i.CHOOSE_FILE_BASIC,o)},e}()});var __hasProp={}.hasOwnProperty;define("modules/dirty/streams/lib/check",["external/raven","external/underscore","modules/core/exception"],function(e,t,n){var o,i,r,s;return r=n.assert,i=Constants.IS_PROD,o=!Constants.IS_PROD,s={assert:function(e,t,n,o,s,a){return i&&(a=!0),r(e,t,n,o,s,a)},check:function(t,n){if(Constants.IS_PROD&&r(t,n,void 0,void 0,!1,i),!t){if(o)throw new Error(n);e.captureException(new Error(n))}return t},check_params:function(e){var t,n,o;return n=function(){var n;n=[];for(t in e)__hasProp.call(e,t)&&(o=e[t],null==o&&n.push(t));return n}(),s.check(0===n.length,"Missing parameters "+n.join(" and "))}}}),define("modules/dirty/streams/lib/constants",["modules/core/types"],function(e){var t,n,o,i,r,s;return t=e.Enum,i={},i.identityMap=r=function(e){var t,n,o,i;for(n={},o=0,i=e.length;i>o;o++)t=e[o],n[t]=t;return n},i.keyedIdentityMap=s=function(e){var t,n,o,i,r,s,a;o={};for(i in e){for(n=e[i],r={},s=0,a=n.length;a>s;s++)t=n[s],r[t]=""+i+"-"+t;o[i]=r}return o},i.PLATFORMS=r(["HEADLESS","IPHONE","IPAD","ANDROID","BROWSER","DESKTOP"]),i.PLATFORM=function(){var e;return"undefined"==typeof navigator||null===navigator?i.PLATFORMS.HEADLESS:(e=navigator.userAgent.toLowerCase(),e.indexOf("iphone")>=0?i.PLATFORMS.IPHONE:e.indexOf("ipad")>=0?i.PLATFORMS.IPHONE:e.indexOf("android")>=0?i.PLATFORMS.ANDROID:window.bridge?i.PLATFORMS.DESKTOP:i.PLATFORMS.BROWSER)}(),i.ActivityType={ADD:0,EDIT:1,POST:2,FILE:3,COMMENT:4,NS_RELATED_EVENT:5},i.RelatedEventType={LINK:1,COMMENT:2,REFERENCE:3},i.DataStatus=r(["LOADING","LOADED","ERROR","LOADED_ALL"]),i.PresenceState=r(["AVAILABLE","IDLE","OFFLINE"]),i.ActionEventTypes=s({Search:["INSTANT_SONOMA_RESULT_READY","INSTANT_FILE_RESULT_READY","INSTANT_USER_RESULT_READY","INSTANT_UPDATED","ROUTED","RESULT_READY"],SharedFolder:["BROWSE_RESULT","PINNED_ACTIVITIES_UPDATED","UPLOAD_STARTED","UPLOAD_PROGRESS","UPLOAD_COMPLETE","FOLDER_ADDED","DISCUSS"]}),i.Route=r(["ACTIVITY","CREATE_STREAM","FEED","HOME","SEARCH"]),i.Visibility=new t("Visibility",{PRIVATE:"0",ORGANIZATION:"1"}),i.NotificationPref={ALL:0,INVOLVED:1,NONE:2},i.UserQueueEventType={ACTIVITY_UPDATE:"activity_update",USER_ADDED_TO_STREAM:"user_added_to_stream",WORKSPACE_SETTINGS_UPDATE:"workspace_settings_update",USER_TYPING:"user_typing",NEW_USER_SETTINGS:"new_user_settings",USER_LAST_VIEW_UPDATE:"user_last_view_update",NOCE_UPDATE:"noce_update"},i.Presence={POLLING_PERIOD:2e4,PRESENCE_THRESHOLD:3e4,IDLE_THRESHOLD:9e5},i.TypingTiming={RESEND_INTERVAL:2e3,TIMEOUT:3e4},i.TypingState={STARTED:0,STOPPED:1},i.EmailNotifications=r(["WEEKLY","DAILY"]),i.ActionTypes=r(["ADD_MEMBERS_TO_STREAM","ALL_TEAM_MEMBERS","CHAT_PRESENCE_UPDATE","CLOSE_CHAT","CREATE_COMMENT","CREATE_POST","CREATE_STREAM","CREATE_STREAM_ERROR","CREATE_ACTIVITY_ERROR","DID_LIKE","ELIGIBLE_FOR_EMAIL_LINKING","ERROR_CREATING_STREAM","EVENTBUS_ERROR","EVENTBUS_CONNECTED","FEED_LOAD_MORE","FETCHING_ACTIVITES","FETCHING_STREAMS","FINISHED_LOADING_FEED","GET_OR_NEW_CHAT","TYPING_STARTED","TYPING_STOPPED","TYPING_TIMEOUT","JOIN_STREAM","MARK_FEED_READ","MAXIMIZE_CHAT","MINIMIZE_CHAT","NEW_CONTACTS","NEW_FEED_ACTIVITIES","NEW_JOINABLE_STREAMS","NEW_POTENTIAL_STREAMS","NEW_PREVIEW","NEW_NAVS","NEW_STREAMS","NEW_STREAM_SETTINGS","ONBOARDING_VISIT_FEED","ONE_TIME_CHAT_PRESENCE_UPDATE","OPEN_CHAT","ORG_CONTACTS_UPDATE","PIN_OR_UNPIN_ACTIVITY","PRESENCE_UPDATE","RECENT_FILES_UPDATED","RECENT_FILES_LOADING_ERROR","REPLY_IN_FEED","RESET_STATE","RESTORE_CHATS","SAVE_CHATS","SAVE_DRAFT","SEARCH_RETURN","SEARCH_SUBMIT","SEARCH_TYPING","SETTINGS_UPDATE","TAB_BLUR","TAB_FOCUS","TAB_MOUSE_MOVEMENT","TAB_UNLOAD","TOGGLE_CHAT_SEARCH","TYPING_NOTIFICATIONS","UPDATE_ACTIVITY_KEY","UPDATE_NS_ID","UPDATE_ROUTE","ACTIVITY_UPLOAD_STARTED","ACTIVITY_UPLOAD_STOPPED","USER_SETTINGS_UPDATE","USER_LAST_VIEW_UPDATE","VIEWER_SENT_TYPING_STARTED","NEW_NOCES","UPDATE_NOCES_LAST_SEEN"]),i.PayloadSources=r(["SERVER_ACTION","VIEW_ACTION","LOCALSTORAGE_ACTION"]),i.RecentEventTypes=[i.ActivityType.POST,i.ActivityType.COMMENT,i.ActivityType.FILE],i.LOCAL_STORE_SCHEMA_VERSION="1.1.9",i.SearchTypes=r(["QUERY_TEST","SUGGEST_SEARCH"]),i.EntityType=new t("EntityType",{LINK:"LINK",CONTACT_MENTION:"CONTACT_MENTION",SMART_MENTION:"SMART_MENTION",FILE_MENTION:"FILE_MENTION",HASHTAG:"HASHTAG",TEXT:"TEXT",EMOJI:"EMOJI",STICKER:"STICKER",SEARCH_HIGHLIGHT:"SEARCH_HIGHLIGHT"}),i.STICKER_SETS={CatBlobs:6,Bearfriend:8,Beemer:8,Dawgs:6,MonsterMash:6,SchoolHouse:10,Sweets:6,ToasterBots:9},i.ATTACHMENT_ERROR_TITLE="ERROR: The requested URL could not be retrieved",i.FILE_UPLOAD_PATH="Workspace Uploads",i.SMART_MENTION_RE=/(@all)/i,i.CONTACT_MENTION_EXTRACT_RE=/@\[([^:^\[]+):([^:^\]]+)\]/,i.CONTACT_MENTION_RE=/(@\[[^:^\[]+:[^:^\]]+\])/,i.FILE_MENTION_EXTRACT_RE=/\/\[(.*?) : (.*?) : (.*?)\]/,i.FILE_MENTION_RE=/(\/\[.*? : .*? : .*?\])/,i.URL_RE=/\b((?:https?:(?:\/{1,3}|[a-z0-9%])|[a-z0-9.\-]+[.](?:abb|abbott|abogado|ac|academy|accountant|accountants|active|actor|ad|ads|adult|ae|aero|af|afl|ag|agency|ai|airforce|al|allfinanz|alsace|am|amsterdam|an|android|ao|apartments|aq|aquarelle|ar|archi|army|arpa|as|asia|associates|at|attorney|au|auction|audio|autos|aw|ax|axa|az|ba|band|bank|bar|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bd|be|beer|berlin|best|bf|bg|bh|bi|bid|bike|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bmw|bn|bnpparibas|bo|boats|bond|boo|boutique|br|brussels|bs|bt|budapest|build|builders|business|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|camera|camp|cancerresearch|canon|capetown|capital|caravan|cards|care|career|careers|cartier|casa|cash|casino|cat|catering|cbn|cc|cd|center|ceo|cern|cf|cfd|cg|ch|channel|chat|cheap|chloe|christmas|chrome|church|ci|citic|city|ck|cl|claims|cleaning|click|clinic|clothing|club|cm|cn|co|coach|codes|coffee|college|cologne|com|community|company|computer|condos|construction|consulting|contractors|cooking|cool|coop|country|courses|cr|credit|creditcard|cricket|crs|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|deals|degree|delivery|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|doha|domains|doosan|download|durban|dvag|dz|eat|ec|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fail|faith|fan|fans|farm|fashion|feedback|fi|film|finance|financial|firmdale|fish|fishing|fit|fitness|fj|fk|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|forex|forsale|foundation|fr|frl|frogans|fund|furniture|futbol|ga|gal|gallery|garden|gb|gbiz|gd|gdn|ge|gent|gf|gg|ggee|gh|gi|gift|gifts|gives|gl|glass|gle|global|globo|gm|gmail|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|gov|gp|gq|gr|graphics|gratis|green|gripe|gs|gt|gu|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|healthcare|help|here|hermes|hiphop|hiv|hk|hm|hn|holdings|holiday|homes|horse|host|hosting|house|how|hr|ht|hu|ibm|id|ie|ifm|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insure|int|international|investments|io|iq|ir|irish|is|it|iwc|java|jcb|je|jetzt|jewelry|jm|jo|jobs|joburg|jp|juegos|kaufen|kddi|ke|kg|kh|ki|kim|kitchen|kiwi|km|kn|koeln|komatsu|kp|kr|krd|kred|kw|ky|kyoto|kz|la|lacaixa|land|lat|latrobe|lawyer|lb|lc|lds|lease|leclerc|legal|lgbt|li|lidl|life|lighting|limited|limo|link|lk|loan|loans|london|lotte|lotto|love|lr|ls|lt|ltda|lu|luxe|luxury|lv|ly|ma|madrid|maif|maison|management|mango|market|marketing|markets|marriott|mc|md|me|media|meet|melbourne|meme|memorial|menu|mg|mh|miami|mil|mini|mk|ml|mm|mma|mn|mo|mobi|moda|moe|monash|money|mormon|mortgage|moscow|motorcycles|mov|movie|mp|mq|mr|ms|mt|mtn|mtpc|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|navy|nc|ne|net|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|ninja|nissan|nl|no|np|nr|nra|nrw|ntt|nu|nyc|nz|okinawa|om|one|ong|onl|online|ooo|oracle|org|organic|osaka|otsuka|ovh|pa|page|panerai|paris|partners|parts|party|pe|pf|pg|ph|pharmacy|photo|photography|photos|physio|piaget|pics|pictet|pictures|pink|pizza|pk|pl|place|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|properties|property|ps|pt|pub|pw|py|qa|qpon|quebec|racing|re|realtor|recipes|red|redstone|rehab|reise|reisen|reit|ren|rentals|repair|report|republican|rest|restaurant|review|reviews|rich|rio|rip|ro|rocks|rodeo|rs|rsvp|ru|ruhr|rw|ryukyu|sa|saarland|sale|samsung|sap|sarl|saxo|sb|sc|sca|scb|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|seat|services|sew|sex|sexy|sg|sh|shiksha|shoes|show|shriram|si|singles|site|sj|sk|sky|sl|sm|sn|so|social|software|sohu|solar|solutions|sony|soy|space|spiegel|spreadbetting|sr|st|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|sx|sy|sydney|systems|sz|taipei|tatar|tattoo|tax|tc|td|team|tech|technology|tel|temasek|tennis|tf|tg|th|tickets|tienda|tips|tires|tirol|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|toshiba|tours|town|toys|tr|trade|trading|training|travel|trust|tt|tui|tv|tw|tz|ua|ug|uk|university|uno|uol|us|uy|uz|va|vacations|vc|ve|vegas|ventures|versicherung|vet|vg|vi|viajes|video|villas|vision|vlaanderen|vn|vodka|vote|voting|voto|voyage|vu|wales|wang|watch|webcam|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|wme|work|works|world|ws|wtc|wtf|xerox|xin|xn--1qqw23a|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--55qw42g|xn--55qx5d|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80asehdb|xn--80aswg|xn--90a3ac|xn--90ais|xn--9et52u|xn--b4w605ferd|xn--c1avg|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--gecrj9c|xn--h2brj9c|xn--hxt814e|xn--i1b6b1a6a2e|xn--io0a7i|xn--j1amh|xn--j6w193g|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a4f16a|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbayh7gpa|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgberp4a5d4ar|xn--mgbx4cd0ab|xn--mxtq1m|xn--ngbc5azd|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pgbs0dh|xn--q9jyb4c|xn--qcka1pmc|xn--rhqv96g|xn--s9brj9c|xn--ses554g|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xxx|xyz|yachts|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zip|zm|zone|zuerich|zw)\/)(?:[^\s()<>{}\[\]]+|\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\))+(?:\([^\s()]*?\([^\s()]+\)[^\s()]*?\)|\([^\s]+?\)|[^\s`!()\[\]{};:'".,<>?])|(?:(?!@)[a-z0-9]+(?:[.\-][a-z0-9]+)*[.](?:abb|abbott|abogado|ac|academy|accountant|accountants|active|actor|ad|ads|adult|ae|aero|af|afl|ag|agency|ai|airforce|al|allfinanz|alsace|am|amsterdam|an|android|ao|apartments|aq|aquarelle|ar|archi|army|arpa|as|asia|associates|at|attorney|au|auction|audio|autos|aw|ax|axa|az|ba|band|bank|bar|barclaycard|barclays|bargains|bauhaus|bayern|bb|bbc|bd|be|beer|berlin|best|bf|bg|bh|bi|bid|bike|bingo|bio|biz|bj|black|blackfriday|bloomberg|blue|bm|bmw|bn|bnpparibas|bo|boats|bond|boo|boutique|br|brussels|bs|bt|budapest|build|builders|business|buzz|bv|bw|by|bz|bzh|ca|cab|cafe|cal|camera|camp|cancerresearch|canon|capetown|capital|caravan|cards|care|career|careers|cartier|casa|cash|casino|cat|catering|cbn|cc|cd|center|ceo|cern|cf|cfd|cg|ch|channel|chat|cheap|chloe|christmas|chrome|church|ci|citic|city|ck|cl|claims|cleaning|click|clinic|clothing|club|cm|cn|co|coach|codes|coffee|college|cologne|com|community|company|computer|condos|construction|consulting|contractors|cooking|cool|coop|country|courses|cr|credit|creditcard|cricket|crs|cruises|cu|cuisinella|cv|cw|cx|cy|cymru|cyou|cz|dabur|dad|dance|date|dating|datsun|day|dclk|de|deals|degree|delivery|democrat|dental|dentist|desi|design|dev|diamonds|diet|digital|direct|directory|discount|dj|dk|dm|dnp|do|docs|doha|domains|doosan|download|durban|dvag|dz|eat|ec|edu|education|ee|eg|email|emerck|energy|engineer|engineering|enterprises|epson|equipment|er|erni|es|esq|estate|et|eu|eurovision|eus|events|everbank|exchange|expert|exposed|express|fail|faith|fan|fans|farm|fashion|feedback|fi|film|finance|financial|firmdale|fish|fishing|fit|fitness|fj|fk|flights|florist|flowers|flsmidth|fly|fm|fo|foo|football|forex|forsale|foundation|fr|frl|frogans|fund|furniture|futbol|ga|gal|gallery|garden|gb|gbiz|gd|gdn|ge|gent|gf|gg|ggee|gh|gi|gift|gifts|gives|gl|glass|gle|global|globo|gm|gmail|gmo|gmx|gn|gold|goldpoint|golf|goo|goog|google|gop|gov|gp|gq|gr|graphics|gratis|green|gripe|gs|gt|gu|guge|guide|guitars|guru|gw|gy|hamburg|hangout|haus|healthcare|help|here|hermes|hiphop|hiv|hk|hm|hn|holdings|holiday|homes|horse|host|hosting|house|how|hr|ht|hu|ibm|id|ie|ifm|il|im|immo|immobilien|in|industries|infiniti|info|ing|ink|institute|insure|int|international|investments|io|iq|ir|irish|is|it|iwc|java|jcb|je|jetzt|jewelry|jm|jo|jobs|joburg|jp|juegos|kaufen|kddi|ke|kg|kh|ki|kim|kitchen|kiwi|km|kn|koeln|komatsu|kp|kr|krd|kred|kw|ky|kyoto|kz|la|lacaixa|land|lat|latrobe|lawyer|lb|lc|lds|lease|leclerc|legal|lgbt|li|lidl|life|lighting|limited|limo|link|lk|loan|loans|london|lotte|lotto|love|lr|ls|lt|ltda|lu|luxe|luxury|lv|ly|ma|madrid|maif|maison|management|mango|market|marketing|markets|marriott|mc|md|me|media|meet|melbourne|meme|memorial|menu|mg|mh|miami|mil|mini|mk|ml|mm|mma|mn|mo|mobi|moda|moe|monash|money|mormon|mortgage|moscow|motorcycles|mov|movie|mp|mq|mr|ms|mt|mtn|mtpc|mu|museum|mv|mw|mx|my|mz|na|nagoya|name|navy|nc|ne|net|network|neustar|new|news|nexus|nf|ng|ngo|nhk|ni|nico|ninja|nissan|nl|no|np|nr|nra|nrw|ntt|nu|nyc|nz|okinawa|om|one|ong|onl|online|ooo|oracle|org|organic|osaka|otsuka|ovh|pa|page|panerai|paris|partners|parts|party|pe|pf|pg|ph|pharmacy|photo|photography|photos|physio|piaget|pics|pictet|pictures|pink|pizza|pk|pl|place|plumbing|plus|pm|pn|pohl|poker|porn|post|pr|praxi|press|pro|prod|productions|prof|properties|property|ps|pt|pub|pw|py|qa|qpon|quebec|racing|re|realtor|recipes|red|redstone|rehab|reise|reisen|reit|ren|rentals|repair|report|republican|rest|restaurant|review|reviews|rich|rio|rip|ro|rocks|rodeo|rs|rsvp|ru|ruhr|rw|ryukyu|sa|saarland|sale|samsung|sap|sarl|saxo|sb|sc|sca|scb|schmidt|scholarships|school|schule|schwarz|science|scot|sd|se|seat|services|sew|sex|sexy|sg|sh|shiksha|shoes|show|shriram|si|singles|site|sj|sk|sky|sl|sm|sn|so|social|software|sohu|solar|solutions|sony|soy|space|spiegel|spreadbetting|sr|st|study|style|su|sucks|supplies|supply|support|surf|surgery|suzuki|sv|sx|sy|sydney|systems|sz|taipei|tatar|tattoo|tax|tc|td|team|tech|technology|tel|temasek|tennis|tf|tg|th|tickets|tienda|tips|tires|tirol|tj|tk|tl|tm|tn|to|today|tokyo|tools|top|toshiba|tours|town|toys|tr|trade|trading|training|travel|trust|tt|tui|tv|tw|tz|ua|ug|uk|university|uno|uol|us|uy|uz|va|vacations|vc|ve|vegas|ventures|versicherung|vet|vg|vi|viajes|video|villas|vision|vlaanderen|vn|vodka|vote|voting|voto|voyage|vu|wales|wang|watch|webcam|website|wed|wedding|weir|wf|whoswho|wien|wiki|williamhill|win|wme|work|works|world|ws|wtc|wtf|xerox|xin|xn--1qqw23a|xn--30rr7y|xn--3bst00m|xn--3ds443g|xn--3e0b707e|xn--45brj9c|xn--45q11c|xn--4gbrim|xn--55qw42g|xn--55qx5d|xn--6frz82g|xn--6qq986b3xl|xn--80adxhks|xn--80ao21a|xn--80asehdb|xn--80aswg|xn--90a3ac|xn--90ais|xn--9et52u|xn--b4w605ferd|xn--c1avg|xn--cg4bki|xn--clchc0ea0b2g2a9gcd|xn--czr694b|xn--czrs0t|xn--czru2d|xn--d1acj3b|xn--d1alf|xn--fiq228c5hs|xn--fiq64b|xn--fiqs8s|xn--fiqz9s|xn--flw351e|xn--fpcrj9c3d|xn--fzc2c9e2c|xn--gecrj9c|xn--h2brj9c|xn--hxt814e|xn--i1b6b1a6a2e|xn--io0a7i|xn--j1amh|xn--j6w193g|xn--kcrx77d1x4a|xn--kprw13d|xn--kpry57d|xn--kput3i|xn--l1acc|xn--lgbbat1ad8j|xn--mgb9awbf|xn--mgba3a4f16a|xn--mgbaam7a8h|xn--mgbab2bd|xn--mgbayh7gpa|xn--mgbbh1a71e|xn--mgbc0a9azcg|xn--mgberp4a5d4ar|xn--mgbx4cd0ab|xn--mxtq1m|xn--ngbc5azd|xn--node|xn--nqv7f|xn--nqv7fs00ema|xn--nyqy26a|xn--o3cw4h|xn--ogbpf8fl|xn--p1acf|xn--p1ai|xn--pgbs0dh|xn--q9jyb4c|xn--qcka1pmc|xn--rhqv96g|xn--s9brj9c|xn--ses554g|xn--unup4y|xn--vermgensberater-ctb|xn--vermgensberatung-pwb|xn--vhquv|xn--vuq861b|xn--wgbh1c|xn--wgbl6a|xn--xhq521b|xn--xkc2al3hye2a|xn--xkc2dl3a5ee0h|xn--yfro4i67o|xn--ygbi2ammx|xn--zfr164b|xxx|xyz|yachts|yandex|ye|yodobashi|yoga|yokohama|youtube|yt|za|zip|zm|zone|zuerich|zw)\b\/?(?!@)))/,
i.SEARCH_HIGHLIGHT_EXTRACT_RE=/<em>(.*?)<\/em>/,i.SEARCH_HIGHLIGHT_RE=/(<em>.*?<\/em>)/,i.STICKER_RE=/(::[a-zA-Z]+?:\d+?::)/,i.STICKER_EXTRACT_RE=/::([a-zA-Z]+?):(\d+?)::/,i.INVALID_FOLDER_RE=/([\u0000-\u001F]|\\|\/|:|\?|\*|<|>|\"|\|)/,i.BAD_CHARS_RE=/[\ufffe-\uffff\ud800-\udfff]/,i.OAUTH_GMAIL_SCOPES=["https://mail.google.com/","https://www.google.com/m8/feeds","https://www.googleapis.com/auth/userinfo.email","https://www.googleapis.com/auth/userinfo.profile","https://www.googleapis.com/auth/admin.directory.group","https://www.googleapis.com/auth/admin.directory.user"].join(" "),i.OAUTH_GMAIL_CLIENT_ID="621214051687-vlnqf2b8mu28c2ua3fgi94nteiu0bfm0.apps.googleusercontent.com",i.OAUTH_GMAIL_REDIRECT_HOST=Constants.IS_PROD?"www.dropbox.com":"meta-dbdev.dev.corp.dropbox.com",("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)&&(i.SUPPORT_USER={id:283122183,email:"tango409mac@dropbox.com",name:"Dropbox Support"}),i.TEST_DROPBOX_EMAILS=["aeidelson@dropbox.com","bneuberg@dropbox.com","bpreno@dropbox.com","btidor@dropbox.com","ca@dropbox.com","elliott@dropbox.com","jdubie@dropbox.com","jeandenis@dropbox.com","jz@dropbox.com","lapier@dropbox.com","maxj@dropbox.com","nsundin@dropbox.com","stein@dropbox.com"],i.STREAM_FEED_ID="stream-feed",i.UNICODE_PRIVATE_USE_1="",i.UNICODE_PRIVATE_USE_2="",i.TEN_YEARS_MS=31536e6,i.REQUEST_MAX_RETRIES=0,i.DEFAULT_AJAX_TIMEOUT_MS=18e4,i.INITIAL_FETCH_NUM_ACTIVITIES=20,i.WORKSPACES_LIST_LENGTH=15,n="https://d314a434c123486fa4d599f134e42f1c@app.getsentry.com/43692",o="https://478917af7943470291d6de58360cbfdc@app.getsentry.com/43686",i.SENTRY_DSN=("undefined"!=typeof Constants&&null!==Constants?Constants.IS_PROD:void 0)?o:n,i.BACKGROUND_RELOAD_INTERVAL_MS=216e5,i.NoceReadState=new t("NoceReadState",{READ:1,UNREAD:2}),i.NoceType=new t("NoceType",{ADDED_TO_WORKSPACE:1,LIKED_YOUR_POST:2,LIKED_YOUR_COMMENT:3,DIRECTLY_MENTIONED_IN_POST:4,ALL_MENTIONED_IN_POST:5,DIRECTLY_MENTIONED_IN_COMMENT:6,ALL_MENTIONED_IN_COMMENT:7,COMMENTED_ON_YOUR_POST:8,REPLIED_TO_YOUR_COMMENT:9,COMMENTED_ON_THREAD_YOU_SPOKE_IN:10}),i});var __slice=[].slice;define("modules/dirty/streams/lib/event_emitter",[],function(){var e;return e=function(){function e(){this.events={}}return e.prototype.emit=function(){var e,t,n,o,i,r;if(t=arguments[0],e=2<=arguments.length?__slice.call(arguments,1):[],!this.events[t])return!1;for(r=this.events[t],o=0,i=r.length;i>o;o++)n=r[o],n.apply(null,e);return!0},e.prototype.add_listener=function(e,t){var n;return this.emit("new_listener",e,t),(null!=(n=this.events)[e]?n[e]:n[e]=[]).push(t),this},e.prototype.on=e.prototype.add_listener,e.prototype.once=function(e,t){var n;return n=function(o){return function(){return o.remove_listener(e,n),t.apply(null,arguments)}}(this),this.on(e,n),this},e.prototype.remove_listener=function(e,t){var n;return this.events[e]?(this.events[e]=function(){var o,i,r,s;for(r=this.events[e],s=[],o=0,i=r.length;i>o;o++)n=r[o],n!==t&&s.push(n);return s}.call(this),this):this},e.prototype.remove_all_listeners=function(e){return e?delete this.events[e]:this.events={},this},e}()});var __bind=function(e,t){return function(){return e.apply(t,arguments)}},__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var o in t)__hasProp.call(t,o)&&(e[o]=t[o]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};define("modules/dirty/streams/lib/user_queue",["modules/clean/ajax","modules/dirty/streams/lib/reconnecting_queue"],function(e,t){var n,o,i,r;return n=function(t){function n(e,t,o){this.user_id=e,this.alloc_endpoint=t,this.params=o,this._get_queue=__bind(this._get_queue,this),n.__super__.constructor.call(this)}return __extends(n,t),n.prototype._get_queue=function(t,n){return e.WebRequest({dataType:"json",type:"POST",url:this.alloc_endpoint,data:this.params,success:function(){return function(e){return t(e.payload.queue)}}(this),error:function(){return function(e,t){return n(e,t)}}(this),subject_user:this.user_id})},n}(t),r={},o=function(e,t,o){var i,s;return i=e+"||"+t+"||"+JSON.stringify(o),s=r[i],s||(s=new n(e,t,o),r[i]=s),s.start(),s},i={get_user_queue:o}}),define("modules/dirty/unity_browse_interface",["dropbox","jquery","modules/clean/unity/check_file_cache","modules/clean/unity/features"],function(e,t,n,o){var i,r;return i=e.Browse,null!=n&&null!=o?r=function(){function e(){}return e.BATCH_SIZE_LIMIT=100,e.CHECK_FILES_PADDING=50,e.listen=function(){return i.add_visible_change_callback(e.browse_visible_change_callback)},e.check_file_callback=function(e){return n.set_batch(e)},e.browse_visible_change_callback=function(t,n,i,r){var s,a,c,u,l,_;if(t.length&&(u=Math.max(0,i-e.CHECK_FILES_PADDING),l=Math.min(t.length-1,r+e.CHECK_FILES_PADDING),a=t.slice(u,+l+1||9e9),c=e._get_files_to_check(a),c.length)){for(e._remove_unneeded_items_from_cache(a),_=[];c.length;)s=c.splice(0,e.BATCH_SIZE_LIMIT),_.push(o.check_file_batch(s,n,e.check_file_callback));return _}},e._get_files_to_check=function(e){var t;return function(){var o,i,r;for(r=[],o=0,i=e.length;i>o;o++)t=e[o],t.bytes>=0&&n.is_cached_and_locally_available(t.ns_id,t.ns_path)!==!0&&r.push(t);return r}()},e._remove_unneeded_items_from_cache=function(e){var t,i,r,s,a;for(i={},s=0,a=e.length;a>s;s++)r=e[s],n.is_cached_and_locally_available(r.ns_id,r.ns_path)===!0&&(t=n.get(r.ns_id,r.ns_path),i[o.server_path(r.ns_id,r.ns_path)]=t);return n.clear(),n.set_batch(i)},e}():void 0}),define("modules/dirty/upsell/ha",["dropbox","modules/clean/upsell/upsell_controller"],function(e,t){var n;return n=function(){function e(e,n){var o;this.$ha=e,this.options=n,this.$ha.find(".dismiss-button").on("click",function(e){return function(){return e.$ha.hide()}}(this)),o=new t(this.$ha.find(".confirm-button"),this.$ha.find(".dismiss-button"),this.options),o.log_impression()}return e}()});